<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Security advisory for Cargo (CVE-2023-38497) | Rust Blog</title>
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
<meta name="description" content="Empowering everyone to build reliable and efficient software.">
     <!-- Twitter card -->
     <meta name="twitter:card" content="summary">
     <meta name="twitter:site" content="@rustlang">
     <meta name="twitter:creator" content="@rustlang">
     <meta name="twitter:title" content="Security advisory for Cargo (CVE-2023-38497) | Rust Blog">
     <meta name="twitter:description" content="Empowering everyone to build reliable and efficient software.">
    <meta name="twitter:image" content="https://www.rust-lang.org/static/images/rust-social.jpg">
    
    <!-- Facebook OpenGraph -->
    <meta property="og:title" content="Security advisory for Cargo (CVE-2023-38497) | Rust Blog" />
    <meta property="og:description" content="Empowering everyone to build reliable and efficient software.">
    <meta property="og:image" content="https://www.rust-lang.org/static/images/rust-social-wide.jpg" />
    <meta property="og:type" content="website" />
    <meta property="og:locale" content="en_US" />
    
    <!-- styles -->
    <link rel="stylesheet" href="https://blog.rust-lang.org/styles/skeleton.css"/>
    <link rel="stylesheet" href="https://blog.rust-lang.org/styles/tachyons.css"/>
    <link rel="stylesheet" href="https://blog.rust-lang.org/styles/fonts.css"/>
    <link rel="stylesheet" href="https://blog.rust-lang.org/styles/app.css"/>
    <link rel="stylesheet" type="text/css" id="syntax-theme" />
    
    <!-- stylesheet for user agents without js -->
    <noscript>
        <link rel="stylesheet" href="https://blog.rust-lang.org/styles/noscript.css">
        <link rel="stylesheet" type="text/css" href="/styles/syntax-theme-dark.css" media="(prefers-color-scheme: dark)" />
        <link rel="stylesheet" type="text/css" href="/styles/syntax-theme-light.css" media="(prefers-color-scheme: light)" />
    </noscript>
    
    <!-- favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="https://blog.rust-lang.org/images/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://blog.rust-lang.org/images/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://blog.rust-lang.org/images/favicon-32x32.png">
    <link rel="icon" type="image/svg+xml" href="https://blog.rust-lang.org/images/favicon.svg">
    <link rel="manifest" href="https://blog.rust-lang.org/images/site.webmanifest">
    <link rel="mask-icon" href="https://blog.rust-lang.org/images/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#00aba9">
    <meta name="theme-color" content="#ffffff">
    
     <!-- atom -->
     <link type="application/atom+xml" rel="alternate" href="https://blog.rust-lang.org/feed.xml" title="Rust Blog" />
    
    <!-- theme switcher -->
    <script src="https://blog.rust-lang.org/scripts/theme-switch.js"></script>
  </head>
  <body>
    <nav class="flex flex-row justify-center justify-end-l items-center flex-wrap ph2 pl3-ns pr4-ns">
      <div class="brand flex-auto w-100 w-auto-l self-start tc tl-l">
        <a href="https://blog.rust-lang.org/">
          <img class="v-mid ml0-l rust-logo" alt="Rust Logo" src="https://blog.rust-lang.org/images/rust-logo-blk.svg">
          <span class="dib ml1 ml0-l">Rust Blog</span>
        </a>
      </div>
    
      <ul class="nav list w-100 w-auto-l flex flex-none flex-row flex-wrap justify-center justify-end-l items-center pv2 ph0 ph4-ns">
        <li class="tc pv2 ph2 ph4-ns flex-20-s"><a href="https://www.rust-lang.org">Rust</a></li>
        <li class="tc pv2 ph2 ph4-ns flex-20-s"><a href="https://www.rust-lang.org/tools/install">Install</a></li>
        <li class="tc pv2 ph2 ph4-ns flex-20-s"><a href="https://www.rust-lang.org/learn">Learn</a></li>
        <li class="tc pv2 ph2 ph4-ns flex-20-s"><a href="https://www.rust-lang.org/tools">Tools</a></li>
        <li class="tc pv2 ph2 ph4-ns flex-20-s"><a href="https://www.rust-lang.org/governance">Governance</a></li>
        <li class="tc pv2 ph2 ph4-ns flex-20-s"><a href="https://www.rust-lang.org/community">Community</a></li>
        <button class="theme-icon" onclick="dropdown();">ðŸ–Œ
          <ul id="theme-choice">
            <li class="theme-item" onclick="changeThemeTo('light');">Light</li>
            <li class="theme-item" onclick="changeThemeTo('dark');">Dark</li>
            <li class="theme-item" onclick="changeThemeTo('system');">System</li>
          </ul>
        </button>
        <script src="https://blog.rust-lang.org/scripts/theme-switch-post.js"></script>
      </ul>
    </nav><section id="Security advisory for Cargo (CVE-2023-38497)" class="white">
  <div class="w-100 mw-none ph3 mw8-m mw8-l center f3">
    <header>
      <h2>Security advisory for Cargo (CVE-2023-38497)</h2>
      <div class="highlight mt2 mb3"></div>
    </header>

    <div class="publish-date-author">Aug. 3, 2023 &middot; The Rust Security Response WG
    
    </div>

    <div class="post">
      <blockquote>
<p>This is a cross-post of <a href="https://groups.google.com/g/rustlang-security-announcements/c/PEZQleQ6IUY">the official security advisory</a>. The
official advisory contains a signed version with our PGP key, as well.</p>
</blockquote>
<p>The Rust Security Response WG was notified that Cargo did not respect the umask
when extracting crate archives on UNIX-like systems. If the user downloaded a
crate containing files writeable by any local user, another local user could
exploit this to change the source code compiled and executed by the current
user.</p>
<p>This vulnerability has been assigned CVE-2023-38497.</p>
<h2 id="overview"><a class="anchor" href="#overview" aria-hidden="true"></a>
Overview</h2>
<p>In UNIX-like systems, each file has three sets of permissions: for the user
owning the file, for the group owning the file, and for all other local users.
The "<a href="https://en.wikipedia.org/wiki/Umask">umask</a>" is configured on most systems to limit those permissions
during file creation, removing dangerous ones. For example, the default umask
on macOS and most Linux distributions only allow the user owning a file to
write to it, preventing the group owning it or other local users from doing the
same.</p>
<p>When a dependency is downloaded by Cargo, its source code has to be extracted
on disk to allow the Rust compiler to read as part of the build. To improve
performance, this extraction only happens the first time a dependency is used,
caching the pre-extracted files for future invocations.</p>
<p>Unfortunately, it was discovered that Cargo did not respect the umask during
extraction, and propagated the permissions stored in the crate archive as-is.
If an archive contained files writeable by any user on the system (and the
system configuration didn't prevent writes through other security measures),
another local user on the system could replace or tweak the source code of a
dependency, potentially achieving code execution the next time the project is
compiled.</p>
<h2 id="affected-versions"><a class="anchor" href="#affected-versions" aria-hidden="true"></a>
Affected Versions</h2>
<p>All Rust versions before 1.71.1 on UNIX-like systems (like macOS and Linux) are
affected. Note that additional system-dependent security measures configured on
the local system might prevent the vulnerability from being exploited.</p>
<p>Users on Windows and other non-UNIX-like systems are not affected.</p>
<h2 id="mitigations"><a class="anchor" href="#mitigations" aria-hidden="true"></a>
Mitigations</h2>
<p>We recommend all users to update to Rust 1.71.1, which will be released later
today, as it fixes the vulnerability by respecting the umask when extracting
crate archives. If you build your own toolchain, patches for 1.71.0 source
tarballs are <a href="https://github.com/rust-lang/wg-security-response/tree/main/patches/CVE-2023-38497">available here</a>.</p>
<p>To prevent existing cached extractions from being exploitable, the Cargo binary
included in Rust 1.71.1 or later will purge the caches it tries to access if
they were generated by older Cargo versions.</p>
<p>If you cannot update to Rust 1.71.1, we recommend configuring your system to
prevent other local users from accessing the Cargo directory, usually located
in <code>~/.cargo</code>:</p>
<pre class="z-code"><code><span class="z-text z-plain">chmod go= ~/.cargo
</span></code></pre>
<h2 id="acknowledgments"><a class="anchor" href="#acknowledgments" aria-hidden="true"></a>
Acknowledgments</h2>
<p>We want to thank Addison Crump for responsibly disclosing this to us according
to the <a href="https://www.rust-lang.org/policies/security">Rust security policy</a>.</p>
<p>We also want to thank the members of the Rust project who helped us disclose
the vulnerability: Weihang Lo for developing the fix; Eric Huss for reviewing
the fix; Pietro Albini for writing this advisory; Pietro Albini, Manish
Goregaokar and Josh Stone for coordinating this disclosure; Josh Triplett, Arlo
Siemen, Scott Schafer, and Jacob Finkelman for advising during the disclosure.</p>

    </div>
  </div>
</section>
    <footer class="footer">
      <div class="w-100 mw-none ph3 mw8-m mw9-l center f3">
        <div class="row">
          <div class="four columns mt3 mt0-l" id="get-help">
            <h4>Get help!</h4>
            <ul>
              <li><a href="https://doc.rust-lang.org" target="_blank" rel="noopener">Documentation</a></li>
              <li><a href="mailto:core-team@rust-lang.org">Contact the Rust Team</a></li>
            </ul>
          </div>
          <div class="four columns mt3 mt0-l">
            <h4>Terms and policies</h4>
            <ul>
              <li><a href="https://www.rust-lang.org/policies/code-of-conduct">Code of Conduct</a></li>
              <li><a href="https://www.rust-lang.org/policies/licenses">Licenses</a></li>
              <li><a href="https://www.rust-lang.org/policies/media-guide">Logo Policy and Media Guide</a></li>
              <li><a href="https://www.rust-lang.org/policies/security">Security Disclosures</a></li>
              <li><a href="https://www.rust-lang.org/policies">All Policies</a></li>
            </ul>
          </div>
          <div class="four columns mt3 mt0-l">
            <h4>Social</h4>
            <div class="flex flex-row flex-wrap">
              <a rel="me" href="https://social.rust-lang.org/@rust" target="_blank" rel="noopener" alt="mastodon link"><img src="https://blog.rust-lang.org/images/mastodon.svg" alt="mastodon logo" title="Mastodon"/></a>
              <a rel="me" href="https://bsky.app/profile/rust-lang.org" target="_blank" rel="noopener" alt="Bluesky link"><img src="https://blog.rust-lang.org/images/bluesky.svg" alt="Bluesky logo" title="Bluesky"/></a>
              <a href="https://www.youtube.com/channel/UCaYhcUwRBNscFNUKTjgPFiA" target="_blank" rel="noopener" alt="youtube link"><img style="padding-top: 6px; padding-bottom:6px" src="https://blog.rust-lang.org/images/youtube.svg" alt="youtube logo" title="YouTube"/></a>
              <a href="https://discord.gg/rust-lang" target="_blank" rel="noopener" alt="discord link"><img src="https://blog.rust-lang.org/images/discord.svg" alt="discord logo" title="Discord"/></a>
              <a href="https://github.com/rust-lang" target="_blank" rel="noopener" alt="github link"><img src="https://blog.rust-lang.org/images/github.svg" alt="github logo" title="GitHub"/></a>
            </div>
            <h4 class="mt4 mb3">RSS</h4>
            <ul>
              <li><a href="https://blog.rust-lang.org/feed.xml">Main Blog</a></li>
              <li><a href="https://blog.rust-lang.org/inside-rust/feed.xml">"Inside Rust" Blog</a></li>
            </ul>
          </div>
    
        </div>
        <div class="attribution">
          Maintained by the Rust Team. See a typo?
          <a href="https://github.com/rust-lang/blog.rust-lang.org/edit/master/content/cve-2023-38497.md" target="_blank" rel="noopener">Send a fix here</a>!
        </div>
      </div>
    </footer>
  </body>
</html>

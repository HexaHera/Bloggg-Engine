<!DOCTYPE html><html lang="en-us" dir="ltr"> <head><script async src="https://ot.www.cloudflare.com/public/vendor/onetrust/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" data-domain-script="b1e05d49-f072-4bae-9116-bdb78af15448"></script><meta name="HandheldFriendly" content="True"><meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="baidu-site-verification" content="KeThzeyMOr"><meta name="baidu-site-verification" content="code-NIlrS7gNhx"><meta charset="UTF-8"><meta name="description" content="Get the latest news on how products at Cloudflare are built, technologies used, and open positions to join the teams helping to build a better Internet."><title>Durable Objects</title><meta name="title" content="Durable Objects"><meta name="msvalidate.01" content="CF295E1604697F9CAD18B5A232E871F6"><meta class="swiftype" name="language" data-type="string" content="en"><script src="/static/z/i.js" type="text/javascript" referrerpolicy="origin"></script><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/favicon-32x32.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-32x32.png"><link rel="mask-icon" href="/images/favicon-32x32.png" color="#f78100"><link rel="stylesheet" href="/themes/ashes.min.css"><link rel="sitemap" href="/sitemap.xml"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"><link rel="canonical" href="https://blog.cloudflare.com/tag/durable-objects/"><link rel="alternate" type="application/rss+xml" title="Cloudflare Durable Objects RSS Feed" href="/tag/durable-objects/rss"><link rel="alternate" hreflang="en-us" href="https://blog.cloudflare.com/tag/durable-objects/"><link rel="alternate" hreflang="de-de" href="https://blog.cloudflare.com/de-de/tag/durable-objects/"><link rel="alternate" hreflang="es-es" href="https://blog.cloudflare.com/es-es/tag/durable-objects/"><link rel="alternate" hreflang="fr-fr" href="https://blog.cloudflare.com/fr-fr/tag/durable-objects/"><link rel="alternate" hreflang="ja-jp" href="https://blog.cloudflare.com/ja-jp/tag/durable-objects/"><link rel="alternate" hreflang="ko-kr" href="https://blog.cloudflare.com/ko-kr/tag/durable-objects/"><link rel="alternate" hreflang="zh-tw" href="https://blog.cloudflare.com/zh-tw/tag/durable-objects/"><link rel="alternate" hreflang="zh-cn" href="https://blog.cloudflare.com/zh-cn/tag/durable-objects/"><link rel="alternate" hreflang="pt-br" href="https://blog.cloudflare.com/pt-br/tag/durable-objects/"><link rel="alternate" hreflang="ru-ru" href="https://blog.cloudflare.com/ru-ru/tag/durable-objects/"><link rel="alternate" hreflang="nl-nl" href="https://blog.cloudflare.com/nl-nl/tag/durable-objects/"><!-- General Meta Tags --><meta property="article:publisher" content="https://www.facebook.com/cloudflare"><!-- Facebook Meta Tags --><meta property="og:site_name" content="The Cloudflare Blog"><meta property="og:type" content="website"><meta property="og:title" content="The Cloudflare Blog: Durable Objects"><meta property="og:description" content="Collection of Cloudflare blog posts tagged 'Durable Objects'"><meta property="og:url" content="https://blog.cloudflare.com/tag/durable-objects/"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="628"><!-- Twitter/X Meta Tags --><meta name="twitter:title" content="The Cloudflare Blog: Durable Objects"><meta name="twitter:description" content="Collection of Cloudflare blog posts tagged 'Durable Objects'"><meta name="twitter:url" content="https://blog.cloudflare.com/tag/durable-objects/"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@cloudflare"><meta property="og:image"><meta name="twitter:image"><link rel="stylesheet" href="/_astro/index.DAblDsYO.css"></head><style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).only=e;window.dispatchEvent(new Event("astro:only"));})();;(()=>{var A=Object.defineProperty;var g=(i,o,a)=>o in i?A(i,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[o]=a;var d=(i,o,a)=>g(i,typeof o!="symbol"?o+"":o,a);{let i={0:t=>m(t),1:t=>a(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(a(t)),5:t=>new Set(a(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t),11:t=>1/0*t},o=t=>{let[l,e]=t;return l in i?i[l](e):void 0},a=t=>t.map(o),m=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([l,e])=>[l,o(e)]));class y extends HTMLElement{constructor(){super(...arguments);d(this,"Component");d(this,"hydrator");d(this,"hydrate",async()=>{var b;if(!this.hydrator||!this.isConnected)return;let e=(b=this.parentElement)==null?void 0:b.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let c=this.querySelectorAll("astro-slot"),n={},h=this.querySelectorAll("template[data-astro-template]");for(let r of h){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of c){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("name")||"default"]=r.innerHTML)}let p;try{p=this.hasAttribute("props")?m(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",v=this.getAttribute("component-export");throw v&&(s+=` (export ${v})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}let u;await this.hydrator(this)(this.Component,p,n,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))});d(this,"unmount",()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))})}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(!this.hasAttribute("await-children")||document.readyState==="interactive"||document.readyState==="complete")this.childrenConnectedCallback();else{let e=()=>{document.removeEventListener("DOMContentLoaded",e),c.disconnect(),this.childrenConnectedCallback()},c=new MutationObserver(()=>{var n;((n=this.lastChild)==null?void 0:n.nodeType)===Node.COMMENT_NODE&&this.lastChild.nodeValue==="astro:end"&&(this.lastChild.remove(),e())});c.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",e)}}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}async start(){let e=JSON.parse(this.getAttribute("opts")),c=this.getAttribute("client");if(Astro[c]===void 0){window.addEventListener(`astro:${c}`,()=>this.start(),{once:!0});return}try{await Astro[c](async()=>{let n=this.getAttribute("renderer-url"),[h,{default:p}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),u=this.getAttribute("component-export")||"default";if(!u.includes("."))this.Component=h[u];else{this.Component=h;for(let f of u.split("."))this.Component=this.Component[f]}return this.hydrator=p,this.hydrate},e,this)}catch(n){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,n)}}attributeChangedCallback(){this.hydrate()}}d(y,"observedAttributes",["props"]),customElements.get("astro-island")||customElements.define("astro-island",y)}})();</script><astro-island uid="IBDWA" component-url="/_astro/GoogleAnalytics.o7SaAFZX.js" component-export="GoogleAnalytics" renderer-url="/_astro/client.DLO1yDVm.js" props="{&quot;title&quot;:[0,&quot;Durable Objects&quot;],&quot;canonical&quot;:[0,&quot;https://blog.cloudflare.com/tag/durable-objects&quot;],&quot;info&quot;:[0],&quot;tagInfo&quot;:[0,{&quot;id&quot;:[0,&quot;5v2UZdTRX1Rw9akmhexnxs&quot;],&quot;slug&quot;:[0,&quot;durable-objects&quot;],&quot;url&quot;:[0,&quot;https://blog.cloudflare.com/durable-objects&quot;],&quot;name&quot;:[0,&quot;Durable Objects&quot;],&quot;visibility&quot;:[0,&quot;public&quot;],&quot;feature_image&quot;:[0,&quot;&quot;],&quot;publicly_index&quot;:[0,true]}],&quot;authorInfo&quot;:[0],&quot;translatedPosts&quot;:[1,[]]}" ssr client="only" opts="{&quot;name&quot;:&quot;GoogleAnalytics&quot;,&quot;value&quot;:&quot;react&quot;}"></astro-island><script>(()=>{var l=(n,t)=>{let i=async()=>{await(await n())()},e=typeof t.value=="object"?t.value:void 0,s={timeout:e==null?void 0:e.timeout};"requestIdleCallback"in window?window.requestIdleCallback(i,s):setTimeout(i,s.timeout||200)};(self.Astro||(self.Astro={})).idle=l;window.dispatchEvent(new Event("astro:idle"));})();</script><astro-island uid="Zz84dU" prefix="r8" component-url="/_astro/Navigation.JWiNRNo9.js" component-export="Navigation" renderer-url="/_astro/client.DLO1yDVm.js" props="{&quot;title&quot;:[0,&quot;The Cloudflare Blog&quot;],&quot;logo&quot;:[0,&quot;//images.ctfassets.net/zkvhlag99gkb/69RwBidpiEHCDZ9rFVVk7T/092507edbed698420b89658e5a6d5105/CF_logo_stacked_blktype.png&quot;],&quot;pagesStore&quot;:[0,{&quot;page&quot;:[0,&quot;Tag&quot;],&quot;slug&quot;:[0,&quot;durable-objects&quot;],&quot;translationsAvailable&quot;:[1,[[0,&quot;de-de&quot;],[0,&quot;es-es&quot;],[0,&quot;fr-fr&quot;],[0,&quot;ja-jp&quot;],[0,&quot;ko-kr&quot;],[0,&quot;zh-tw&quot;],[0,&quot;zh-cn&quot;],[0,&quot;pt-br&quot;],[0,&quot;ru-ru&quot;],[0,&quot;nl-nl&quot;]]],&quot;navData&quot;:[1,[[0,{&quot;metadata&quot;:[0,{&quot;tags&quot;:[1,[]],&quot;concepts&quot;:[1,[]]}],&quot;sys&quot;:[0,{&quot;space&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Space&quot;],&quot;id&quot;:[0,&quot;zkvhlag99gkb&quot;]}]}],&quot;id&quot;:[0,&quot;6Foe3R8of95cWVnQwe5Toi&quot;],&quot;type&quot;:[0,&quot;Entry&quot;],&quot;createdAt&quot;:[0,&quot;2024-10-09T22:44:28.803Z&quot;],&quot;updatedAt&quot;:[0,&quot;2025-06-17T05:04:39.288Z&quot;],&quot;environment&quot;:[0,{&quot;sys&quot;:[0,{&quot;id&quot;:[0,&quot;master&quot;],&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Environment&quot;]}]}],&quot;publishedVersion&quot;:[0,153],&quot;revision&quot;:[0,44],&quot;contentType&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;ContentType&quot;],&quot;id&quot;:[0,&quot;blogTag&quot;]}]}],&quot;locale&quot;:[0,&quot;en-US&quot;]}],&quot;fields&quot;:[0,{&quot;entryTitle&quot;:[0,&quot;AI&quot;],&quot;name&quot;:[0,&quot;AI&quot;],&quot;slug&quot;:[0,&quot;ai&quot;],&quot;featured&quot;:[0,true],&quot;publiclyIndex&quot;:[0,true]}]}],[0,{&quot;metadata&quot;:[0,{&quot;tags&quot;:[1,[]],&quot;concepts&quot;:[1,[]]}],&quot;sys&quot;:[0,{&quot;space&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Space&quot;],&quot;id&quot;:[0,&quot;zkvhlag99gkb&quot;]}]}],&quot;id&quot;:[0,&quot;4HIPcb68qM0e26fIxyfzwQ&quot;],&quot;type&quot;:[0,&quot;Entry&quot;],&quot;createdAt&quot;:[0,&quot;2024-10-09T19:43:21.536Z&quot;],&quot;updatedAt&quot;:[0,&quot;2025-05-19T05:03:04.375Z&quot;],&quot;environment&quot;:[0,{&quot;sys&quot;:[0,{&quot;id&quot;:[0,&quot;master&quot;],&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Environment&quot;]}]}],&quot;publishedVersion&quot;:[0,135],&quot;revision&quot;:[0,46],&quot;contentType&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;ContentType&quot;],&quot;id&quot;:[0,&quot;blogTag&quot;]}]}],&quot;locale&quot;:[0,&quot;en-US&quot;]}],&quot;fields&quot;:[0,{&quot;entryTitle&quot;:[0,&quot;Developers&quot;],&quot;name&quot;:[0,&quot;Developers&quot;],&quot;slug&quot;:[0,&quot;developers&quot;],&quot;featured&quot;:[0,true]}]}],[0,{&quot;metadata&quot;:[0,{&quot;tags&quot;:[1,[]],&quot;concepts&quot;:[1,[]]}],&quot;sys&quot;:[0,{&quot;space&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Space&quot;],&quot;id&quot;:[0,&quot;zkvhlag99gkb&quot;]}]}],&quot;id&quot;:[0,&quot;5kZtWqjqa7aOUoZr8NFGwI&quot;],&quot;type&quot;:[0,&quot;Entry&quot;],&quot;createdAt&quot;:[0,&quot;2024-10-09T19:43:26.040Z&quot;],&quot;updatedAt&quot;:[0,&quot;2025-04-30T14:03:57.409Z&quot;],&quot;environment&quot;:[0,{&quot;sys&quot;:[0,{&quot;id&quot;:[0,&quot;master&quot;],&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Environment&quot;]}]}],&quot;publishedVersion&quot;:[0,142],&quot;revision&quot;:[0,43],&quot;contentType&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;ContentType&quot;],&quot;id&quot;:[0,&quot;blogTag&quot;]}]}],&quot;locale&quot;:[0,&quot;en-US&quot;]}],&quot;fields&quot;:[0,{&quot;entryTitle&quot;:[0,&quot;Cloudflare Radar&quot;],&quot;name&quot;:[0,&quot;Radar&quot;],&quot;slug&quot;:[0,&quot;cloudflare-radar&quot;],&quot;featured&quot;:[0,true]}]}],[0,{&quot;metadata&quot;:[0,{&quot;tags&quot;:[1,[]],&quot;concepts&quot;:[1,[]]}],&quot;sys&quot;:[0,{&quot;space&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Space&quot;],&quot;id&quot;:[0,&quot;zkvhlag99gkb&quot;]}]}],&quot;id&quot;:[0,&quot;6QktrXeEFcl4e2dZUTZVGl&quot;],&quot;type&quot;:[0,&quot;Entry&quot;],&quot;createdAt&quot;:[0,&quot;2024-10-09T19:43:20.198Z&quot;],&quot;updatedAt&quot;:[0,&quot;2025-04-09T11:02:56.665Z&quot;],&quot;environment&quot;:[0,{&quot;sys&quot;:[0,{&quot;id&quot;:[0,&quot;master&quot;],&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Environment&quot;]}]}],&quot;publishedVersion&quot;:[0,68],&quot;revision&quot;:[0,28],&quot;contentType&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;ContentType&quot;],&quot;id&quot;:[0,&quot;blogTag&quot;]}]}],&quot;locale&quot;:[0,&quot;en-US&quot;]}],&quot;fields&quot;:[0,{&quot;entryTitle&quot;:[0,&quot;Product News&quot;],&quot;name&quot;:[0,&quot;Product News&quot;],&quot;slug&quot;:[0,&quot;product-news&quot;],&quot;featured&quot;:[0,true]}]}],[0,{&quot;metadata&quot;:[0,{&quot;tags&quot;:[1,[]],&quot;concepts&quot;:[1,[]]}],&quot;sys&quot;:[0,{&quot;space&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Space&quot;],&quot;id&quot;:[0,&quot;zkvhlag99gkb&quot;]}]}],&quot;id&quot;:[0,&quot;6Mp7ouACN2rT3YjL1xaXJx&quot;],&quot;type&quot;:[0,&quot;Entry&quot;],&quot;createdAt&quot;:[0,&quot;2024-10-09T19:42:46.231Z&quot;],&quot;updatedAt&quot;:[0,&quot;2025-04-09T11:02:54.136Z&quot;],&quot;environment&quot;:[0,{&quot;sys&quot;:[0,{&quot;id&quot;:[0,&quot;master&quot;],&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Environment&quot;]}]}],&quot;publishedVersion&quot;:[0,134],&quot;revision&quot;:[0,41],&quot;contentType&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;ContentType&quot;],&quot;id&quot;:[0,&quot;blogTag&quot;]}]}],&quot;locale&quot;:[0,&quot;en-US&quot;]}],&quot;fields&quot;:[0,{&quot;entryTitle&quot;:[0,&quot;Security&quot;],&quot;name&quot;:[0,&quot;Security&quot;],&quot;slug&quot;:[0,&quot;security&quot;],&quot;featured&quot;:[0,true]}]}],[0,{&quot;metadata&quot;:[0,{&quot;tags&quot;:[1,[]],&quot;concepts&quot;:[1,[]]}],&quot;sys&quot;:[0,{&quot;space&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Space&quot;],&quot;id&quot;:[0,&quot;zkvhlag99gkb&quot;]}]}],&quot;id&quot;:[0,&quot;16yk8DVbNNifxov5cWvAov&quot;],&quot;type&quot;:[0,&quot;Entry&quot;],&quot;createdAt&quot;:[0,&quot;2024-10-09T19:56:23.848Z&quot;],&quot;updatedAt&quot;:[0,&quot;2025-04-07T23:03:54.104Z&quot;],&quot;environment&quot;:[0,{&quot;sys&quot;:[0,{&quot;id&quot;:[0,&quot;master&quot;],&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Environment&quot;]}]}],&quot;publishedVersion&quot;:[0,65],&quot;revision&quot;:[0,29],&quot;contentType&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;ContentType&quot;],&quot;id&quot;:[0,&quot;blogTag&quot;]}]}],&quot;locale&quot;:[0,&quot;en-US&quot;]}],&quot;fields&quot;:[0,{&quot;entryTitle&quot;:[0,&quot;Policy &amp; Legal&quot;],&quot;name&quot;:[0,&quot;Policy &amp; Legal&quot;],&quot;slug&quot;:[0,&quot;policy&quot;],&quot;featured&quot;:[0,true]}]}],[0,{&quot;metadata&quot;:[0,{&quot;tags&quot;:[1,[]],&quot;concepts&quot;:[1,[]]}],&quot;sys&quot;:[0,{&quot;space&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Space&quot;],&quot;id&quot;:[0,&quot;zkvhlag99gkb&quot;]}]}],&quot;id&quot;:[0,&quot;J61Eszqn98amrYHq4IhTx&quot;],&quot;type&quot;:[0,&quot;Entry&quot;],&quot;createdAt&quot;:[0,&quot;2024-10-09T19:43:46.068Z&quot;],&quot;updatedAt&quot;:[0,&quot;2025-04-07T23:03:53.720Z&quot;],&quot;environment&quot;:[0,{&quot;sys&quot;:[0,{&quot;id&quot;:[0,&quot;master&quot;],&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Environment&quot;]}]}],&quot;publishedVersion&quot;:[0,136],&quot;revision&quot;:[0,44],&quot;contentType&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;ContentType&quot;],&quot;id&quot;:[0,&quot;blogTag&quot;]}]}],&quot;locale&quot;:[0,&quot;en-US&quot;]}],&quot;fields&quot;:[0,{&quot;entryTitle&quot;:[0,&quot;Zero Trust&quot;],&quot;name&quot;:[0,&quot;Zero Trust&quot;],&quot;slug&quot;:[0,&quot;zero-trust&quot;],&quot;featured&quot;:[0,true]}]}],[0,{&quot;metadata&quot;:[0,{&quot;tags&quot;:[1,[]],&quot;concepts&quot;:[1,[]]}],&quot;sys&quot;:[0,{&quot;space&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Space&quot;],&quot;id&quot;:[0,&quot;zkvhlag99gkb&quot;]}]}],&quot;id&quot;:[0,&quot;48r7QV00gLMWOIcM1CSDRy&quot;],&quot;type&quot;:[0,&quot;Entry&quot;],&quot;createdAt&quot;:[0,&quot;2024-10-09T19:54:22.790Z&quot;],&quot;updatedAt&quot;:[0,&quot;2025-04-07T23:03:52.422Z&quot;],&quot;environment&quot;:[0,{&quot;sys&quot;:[0,{&quot;id&quot;:[0,&quot;master&quot;],&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Environment&quot;]}]}],&quot;publishedVersion&quot;:[0,66],&quot;revision&quot;:[0,28],&quot;contentType&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;ContentType&quot;],&quot;id&quot;:[0,&quot;blogTag&quot;]}]}],&quot;locale&quot;:[0,&quot;en-US&quot;]}],&quot;fields&quot;:[0,{&quot;entryTitle&quot;:[0,&quot;Speed &amp; Reliability&quot;],&quot;name&quot;:[0,&quot;Speed &amp; Reliability&quot;],&quot;slug&quot;:[0,&quot;speed-and-reliability&quot;],&quot;featured&quot;:[0,true]}]}],[0,{&quot;metadata&quot;:[0,{&quot;tags&quot;:[1,[]],&quot;concepts&quot;:[1,[]]}],&quot;sys&quot;:[0,{&quot;space&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Space&quot;],&quot;id&quot;:[0,&quot;zkvhlag99gkb&quot;]}]}],&quot;id&quot;:[0,&quot;4g8tPriKOAUwdUT4jNPebe&quot;],&quot;type&quot;:[0,&quot;Entry&quot;],&quot;createdAt&quot;:[0,&quot;2024-10-09T19:46:40.927Z&quot;],&quot;updatedAt&quot;:[0,&quot;2025-04-07T23:03:51.235Z&quot;],&quot;environment&quot;:[0,{&quot;sys&quot;:[0,{&quot;id&quot;:[0,&quot;master&quot;],&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Environment&quot;]}]}],&quot;publishedVersion&quot;:[0,77],&quot;revision&quot;:[0,29],&quot;contentType&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;ContentType&quot;],&quot;id&quot;:[0,&quot;blogTag&quot;]}]}],&quot;locale&quot;:[0,&quot;en-US&quot;]}],&quot;fields&quot;:[0,{&quot;entryTitle&quot;:[0,&quot;Life at Cloudflare&quot;],&quot;name&quot;:[0,&quot;Life at Cloudflare&quot;],&quot;slug&quot;:[0,&quot;life-at-cloudflare&quot;],&quot;featured&quot;:[0,true]}]}],[0,{&quot;metadata&quot;:[0,{&quot;tags&quot;:[1,[]],&quot;concepts&quot;:[1,[]]}],&quot;sys&quot;:[0,{&quot;space&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Space&quot;],&quot;id&quot;:[0,&quot;zkvhlag99gkb&quot;]}]}],&quot;id&quot;:[0,&quot;V86khSc459Yi1AhTlvtY7&quot;],&quot;type&quot;:[0,&quot;Entry&quot;],&quot;createdAt&quot;:[0,&quot;2024-10-09T19:46:53.657Z&quot;],&quot;updatedAt&quot;:[0,&quot;2025-02-04T17:12:59.473Z&quot;],&quot;environment&quot;:[0,{&quot;sys&quot;:[0,{&quot;id&quot;:[0,&quot;master&quot;],&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Environment&quot;]}]}],&quot;publishedVersion&quot;:[0,57],&quot;revision&quot;:[0,21],&quot;contentType&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;ContentType&quot;],&quot;id&quot;:[0,&quot;blogTag&quot;]}]}],&quot;locale&quot;:[0,&quot;en-US&quot;]}],&quot;fields&quot;:[0,{&quot;entryTitle&quot;:[0,&quot;Partners&quot;],&quot;name&quot;:[0,&quot;Partners&quot;],&quot;slug&quot;:[0,&quot;partners&quot;],&quot;featured&quot;:[0,true]}]}]]]}],&quot;locale&quot;:[0,&quot;en-us&quot;],&quot;translations&quot;:[0,{&quot;posts.by&quot;:[0,&quot;By&quot;],&quot;footer.gdpr&quot;:[0,&quot;GDPR&quot;],&quot;lang_blurb1&quot;:[0,&quot;This post is also available in {lang1}.&quot;],&quot;lang_blurb2&quot;:[0,&quot;This post is also available in {lang1} and {lang2}.&quot;],&quot;lang_blurb3&quot;:[0,&quot;This post is also available in {lang1}, {lang2} and {lang3}.&quot;],&quot;footer.press&quot;:[0,&quot;Press&quot;],&quot;header.title&quot;:[0,&quot;The Cloudflare Blog&quot;],&quot;search.clear&quot;:[0,&quot;Clear&quot;],&quot;search.filter&quot;:[0,&quot;Filter&quot;],&quot;search.source&quot;:[0,&quot;Source&quot;],&quot;footer.careers&quot;:[0,&quot;Careers&quot;],&quot;footer.company&quot;:[0,&quot;Company&quot;],&quot;footer.support&quot;:[0,&quot;Support&quot;],&quot;footer.the_net&quot;:[0,&quot;theNet&quot;],&quot;search.filters&quot;:[0,&quot;Filters&quot;],&quot;footer.our_team&quot;:[0,&quot;Our team&quot;],&quot;footer.webinars&quot;:[0,&quot;Webinars&quot;],&quot;page.more_posts&quot;:[0,&quot;More posts&quot;],&quot;posts.time_read&quot;:[0,&quot;{time} min read&quot;],&quot;search.language&quot;:[0,&quot;Language&quot;],&quot;footer.community&quot;:[0,&quot;Community&quot;],&quot;footer.resources&quot;:[0,&quot;Resources&quot;],&quot;footer.solutions&quot;:[0,&quot;Solutions&quot;],&quot;footer.trademark&quot;:[0,&quot;Trademark&quot;],&quot;header.subscribe&quot;:[0,&quot;Subscribe&quot;],&quot;footer.compliance&quot;:[0,&quot;Compliance&quot;],&quot;footer.free_plans&quot;:[0,&quot;Free plans&quot;],&quot;footer.impact_ESG&quot;:[0,&quot;Impact/ESG&quot;],&quot;posts.follow_on_X&quot;:[0,&quot;Follow on X&quot;],&quot;footer.help_center&quot;:[0,&quot;Help center&quot;],&quot;footer.network_map&quot;:[0,&quot;Network Map&quot;],&quot;header.please_wait&quot;:[0,&quot;Please Wait&quot;],&quot;page.related_posts&quot;:[0,&quot;Related posts&quot;],&quot;search.result_stat&quot;:[0,&quot;Results &lt;strong&gt;{search_range}&lt;/strong&gt; of &lt;strong&gt;{search_total}&lt;/strong&gt; for &lt;strong&gt;{search_keyword}&lt;/strong&gt;&quot;],&quot;footer.case_studies&quot;:[0,&quot;Case Studies&quot;],&quot;footer.connect_2024&quot;:[0,&quot;Connect 2024&quot;],&quot;footer.terms_of_use&quot;:[0,&quot;Terms of Use&quot;],&quot;footer.white_papers&quot;:[0,&quot;White Papers&quot;],&quot;footer.cloudflare_tv&quot;:[0,&quot;Cloudflare TV&quot;],&quot;footer.community_hub&quot;:[0,&quot;Community Hub&quot;],&quot;footer.compare_plans&quot;:[0,&quot;Compare plans&quot;],&quot;footer.contact_sales&quot;:[0,&quot;Contact Sales&quot;],&quot;header.contact_sales&quot;:[0,&quot;Contact Sales&quot;],&quot;header.email_address&quot;:[0,&quot;Email Address&quot;],&quot;page.error.not_found&quot;:[0,&quot;Page not found&quot;],&quot;footer.developer_docs&quot;:[0,&quot;Developer docs&quot;],&quot;footer.privacy_policy&quot;:[0,&quot;Privacy Policy&quot;],&quot;footer.request_a_demo&quot;:[0,&quot;Request a demo&quot;],&quot;page.continue_reading&quot;:[0,&quot;Continue reading&quot;],&quot;footer.analysts_report&quot;:[0,&quot;Analyst reports&quot;],&quot;footer.for_enterprises&quot;:[0,&quot;For enterprises&quot;],&quot;footer.getting_started&quot;:[0,&quot;Getting Started&quot;],&quot;footer.learning_center&quot;:[0,&quot;Learning Center&quot;],&quot;footer.project_galileo&quot;:[0,&quot;Project Galileo&quot;],&quot;pagination.newer_posts&quot;:[0,&quot;Newer Posts&quot;],&quot;pagination.older_posts&quot;:[0,&quot;Older Posts&quot;],&quot;posts.social_buttons.x&quot;:[0,&quot;Discuss on X&quot;],&quot;search.icon_aria_label&quot;:[0,&quot;Search&quot;],&quot;search.source_location&quot;:[0,&quot;Source/Location&quot;],&quot;footer.about_cloudflare&quot;:[0,&quot;About Cloudflare&quot;],&quot;footer.athenian_project&quot;:[0,&quot;Athenian Project&quot;],&quot;footer.become_a_partner&quot;:[0,&quot;Become a partner&quot;],&quot;footer.cloudflare_radar&quot;:[0,&quot;Cloudflare Radar&quot;],&quot;footer.network_services&quot;:[0,&quot;Network services&quot;],&quot;footer.trust_and_safety&quot;:[0,&quot;Trust &amp; Safety&quot;],&quot;header.get_started_free&quot;:[0,&quot;Get Started Free&quot;],&quot;page.search.placeholder&quot;:[0,&quot;Search Cloudflare&quot;],&quot;footer.cloudflare_status&quot;:[0,&quot;Cloudflare Status&quot;],&quot;footer.cookie_preference&quot;:[0,&quot;Cookie Preferences&quot;],&quot;header.valid_email_error&quot;:[0,&quot;Must be valid email.&quot;],&quot;search.result_stat_empty&quot;:[0,&quot;Results &lt;strong&gt;{search_range}&lt;/strong&gt; of &lt;strong&gt;{search_total}&lt;/strong&gt;&quot;],&quot;footer.connectivity_cloud&quot;:[0,&quot;Connectivity cloud&quot;],&quot;footer.developer_services&quot;:[0,&quot;Developer services&quot;],&quot;footer.investor_relations&quot;:[0,&quot;Investor relations&quot;],&quot;page.not_found.error_code&quot;:[0,&quot;Error Code: 404&quot;],&quot;search.autocomplete_title&quot;:[0,&quot;Insert a query. Press enter to send&quot;],&quot;footer.logos_and_press_kit&quot;:[0,&quot;Logos &amp; press kit&quot;],&quot;footer.application_services&quot;:[0,&quot;Application services&quot;],&quot;footer.get_a_recommendation&quot;:[0,&quot;Get a recommendation&quot;],&quot;posts.social_buttons.reddit&quot;:[0,&quot;Discuss on Reddit&quot;],&quot;footer.sse_and_sase_services&quot;:[0,&quot;SSE and SASE services&quot;],&quot;page.not_found.outdated_link&quot;:[0,&quot;You may have used an outdated link, or you may have typed the address incorrectly.&quot;],&quot;footer.report_security_issues&quot;:[0,&quot;Report Security Issues&quot;],&quot;page.error.error_message_page&quot;:[0,&quot;Sorry, we can&#39;t find the page you are looking for.&quot;],&quot;header.subscribe_notifications&quot;:[0,&quot;Subscribe to receive notifications of new posts:&quot;],&quot;footer.cloudflare_for_campaigns&quot;:[0,&quot;Cloudflare for Campaigns&quot;],&quot;header.subscription_confimation&quot;:[0,&quot;Subscription confirmed. Thank you for subscribing!&quot;],&quot;posts.social_buttons.hackernews&quot;:[0,&quot;Discuss on Hacker News&quot;],&quot;footer.diversity_equity_inclusion&quot;:[0,&quot;Diversity, equity &amp; inclusion&quot;],&quot;footer.critical_infrastructure_defense_project&quot;:[0,&quot;Critical Infrastructure Defense Project&quot;]}]}" ssr client="idle" opts="{&quot;name&quot;:&quot;NavigationComponent&quot;,&quot;value&quot;:true}" await-children><header class="flex flex-row flex-wrap justify-between items-flex-end mw8 center mv3 pl3 pr1"><div class="w-100 flex items-flex-end justify-between justify-start-l"><div class="w-100 tr flex justify-end"><div class="flex justify-between items-center"><span class="dn di-l pr1"><a href="https://dash.cloudflare.com/sign-up" class="f1 blue1 dn di-l b no-underline underline-hover" target="_blank" rel="noreferrer">Get Started Free</a></span><span class="f1 gray4 dn di-l pr1">|</span><span class="dn di-l"><a target="_blank" href="https://www.cloudflare.com/plans/enterprise/contact/" class="f1 gray4 no-underline underline-hover pr1" rel="noreferrer">Contact Sales</a></span><span class="f1 gray4 dn di-l pr1">|</span><div class="relative flex cf-dropdown"><div class="flex items-center" dir="ltr"><button type="button" class="f1 gray4 no-underline language-picker js-language-picker" style="background:transparent;border:none;padding:0"><span class="language-picker__globe-icon"></span><span class="language-picker__caret-icon ph1">▼</span></button></div></div></div></div></div><div class="w-100 w-50-l flex items-end nb5 nb1-l"><a href="/" class="header-logo mr4 dn db-l"><img class="header-logo" src="https://cf-assets.www.cloudflare.com/zkvhlag99gkb/69RwBidpiEHCDZ9rFVVk7T/092507edbed698420b89658e5a6d5105/CF_logo_stacked_blktype.png" alt="The Cloudflare Blog" width="170" height="57"/></a><h2 class="mt0 mb1 dn di-l"><a href="/" class="fw5 f5 gray3 no-underline"><span class="dn di-l">The Cloudflare Blog</span></a></h2></div><div class="w-100 w-50-l dn db-l"><div class="w-100 tr mkto-sub-message"><p class="f2">Subscribe to receive notifications of new posts:</p></div><div class="w-100 tr"><div class="marketo-form-container"><form id="mktoForm_1653"><div class="top-subscribe-form-container"><div class="top-subscribe-form-field"><input placeholder="Email Address" class="top-subscribe-form-input" name="email" type="email" title="Must be valid email."/></div><button class="top-subscribe-form-button" type="button">Subscribe</button></div></form></div></div></div></header><nav dir="ltr" class="bb b--black-10 db dn-l w-100 ph3 "><div class=" flex justify-between items-center" style="height:44px"><a href="/search/"><img class="h-6 w-6" src="/images/magnifier.svg" alt="magnifier icon"/></a><button type="button" style="background:transparent;border:none"><img src="/images/hamburger.svg" alt="hamburger menu"/></button></div><div class="js-mobile-nav-container dn"><div class="flex flex-column flex-wrap bg-gray9 o-95 absolute ph3 z-1 left-0 right-0 mx-4"><div class="pv3 ph2 tl"><a href="/tag/ai/" class="no-underline gray1 f4 fw7">AI</a></div><div class="pv3 ph2 tl"><a href="/tag/developers/" class="no-underline gray1 f4 fw7">Developers</a></div><div class="pv3 ph2 tl"><a href="/tag/cloudflare-radar/" class="no-underline gray1 f4 fw7">Radar</a></div><div class="pv3 ph2 tl"><a href="/tag/product-news/" class="no-underline gray1 f4 fw7">Product News</a></div><div class="pv3 ph2 tl"><a href="/tag/security/" class="no-underline gray1 f4 fw7">Security</a></div><div class="pv3 ph2 tl"><a href="/tag/policy/" class="no-underline gray1 f4 fw7">Policy &amp; Legal</a></div><div class="pv3 ph2 tl"><a href="/tag/zero-trust/" class="no-underline gray1 f4 fw7">Zero Trust</a></div><div class="pv3 ph2 tl"><a href="/tag/speed-and-reliability/" class="no-underline gray1 f4 fw7">Speed &amp; Reliability</a></div><div class="pv3 ph2 tl"><a href="/tag/life-at-cloudflare/" class="no-underline gray1 f4 fw7">Life at Cloudflare</a></div><div class="pv3 ph2 tl"><a href="/tag/partners/" class="no-underline gray1 f4 fw7">Partners</a></div></div></div></nav><nav id="nav" class="w-100 bb-0 bb-l b--black-10 z-1"><div id="desktop-nav-items-container" class="flex flex-wrap justify-between items-center mw8 center mv3 mv0-l"><div data-tag="ai" class="nav-item nav-item-desktop ml3 mr2 dn db-l pv3"><a href="/tag/ai/" class="no-underline gray1 f2 fw5 pv3">AI</a></div><div data-tag="developers" class="nav-item nav-item-desktop ml3 mr2 dn db-l pv3"><a href="/tag/developers/" class="no-underline gray1 f2 fw5 pv3">Developers</a></div><div data-tag="cloudflare-radar" class="nav-item nav-item-desktop ml3 mr2 dn db-l pv3"><a href="/tag/cloudflare-radar/" class="no-underline gray1 f2 fw5 pv3">Radar</a></div><div data-tag="product-news" class="nav-item nav-item-desktop ml3 mr2 dn db-l pv3"><a href="/tag/product-news/" class="no-underline gray1 f2 fw5 pv3">Product News</a></div><div data-tag="security" class="nav-item nav-item-desktop ml3 mr2 dn db-l pv3"><a href="/tag/security/" class="no-underline gray1 f2 fw5 pv3">Security</a></div><div data-tag="policy" class="nav-item nav-item-desktop ml3 mr2 dn db-l pv3"><a href="/tag/policy/" class="no-underline gray1 f2 fw5 pv3">Policy &amp; Legal</a></div><div data-tag="zero-trust" class="nav-item nav-item-desktop ml3 mr2 dn db-l pv3"><a href="/tag/zero-trust/" class="no-underline gray1 f2 fw5 pv3">Zero Trust</a></div><div data-tag="speed-and-reliability" class="nav-item nav-item-desktop ml3 mr2 dn db-l pv3"><a href="/tag/speed-and-reliability/" class="no-underline gray1 f2 fw5 pv3">Speed &amp; Reliability</a></div><div data-tag="life-at-cloudflare" class="nav-item nav-item-desktop ml3 mr2 dn db-l pv3"><a href="/tag/life-at-cloudflare/" class="no-underline gray1 f2 fw5 pv3">Life at Cloudflare</a></div><div data-tag="partners" class="nav-item nav-item-desktop ml3 mr2 dn db-l pv3"><a href="/tag/partners/" class="no-underline gray1 f2 fw5 pv3">Partners</a></div><div class="nav-item ml2 mr3 dn db-l pv3" data-tag="search icon"><a href="/search/"><img id="search-icon" class="h-6 w-6" src="/images/magnifier.svg" alt="magnifier icon"/></a></div></div></nav><!--astro:end--></astro-island> <script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();</script> <div class="flex flex-row flex-wrap mw8 center bb b--gray8 ph3"> <h1 class="site-title f7 fw4 mt4 mb3 mv4-l">Durable Objects</h1> </div> <main id="site-main" class="flex flex-row flex-wrap mw8 center pt0 pt3-l mt4-l"> <astro-island uid="1G3JpQ" prefix="r0" component-url="/_astro/PostCard.DalyEN7z.js" component-export="PostCard" renderer-url="/_astro/client.DLO1yDVm.js" props="{&quot;currentPage&quot;:[0,1],&quot;isFeaturedImageFirstPost&quot;:[0,true],&quot;post&quot;:[0,{&quot;id&quot;:[0,&quot;3YwK1RRHXn4kGrNazu4AKd&quot;],&quot;title&quot;:[0,&quot;Building an AI Agent that puts humans in the loop with Knock and Cloudflare’s Agents SDK&quot;],&quot;slug&quot;:[0,&quot;building-agents-at-knock-agents-sdk&quot;],&quot;excerpt&quot;:[0,&quot;How Knock shipped an AI Agent with human-in-the-loop capabilities with Cloudflare’s Agents SDK and Cloudflare Workers.&quot;],&quot;featured&quot;:[0,false],&quot;html&quot;:[0,&quot;&lt;p&gt;&lt;sub&gt;&lt;i&gt;This is a guest post by Chris Bell, CTO of &lt;/i&gt;&lt;/sub&gt;&lt;a href=\&quot;https://knock.app/\&quot;&gt;&lt;sub&gt;&lt;i&gt;&lt;u&gt;Knock&lt;/u&gt;&lt;/i&gt;&lt;/sub&gt;&lt;/a&gt;&lt;/p&gt;&lt;p&gt;There’s a lot of talk right now about building AI agents, but not a lot out there about what it takes to make those agents truly &lt;i&gt;useful&lt;/i&gt;.&lt;/p&gt;&lt;p&gt;An Agent is an autonomous system designed to make decisions and perform actions to achieve a specific goal or set of goals, without human input.&lt;/p&gt;&lt;p&gt;No matter how good your agent is at making decisions, you will need a person to provide guidance or input on the agent’s path towards its goal. After all, an agent that cannot interact or respond to the outside world and the systems that govern it will be limited in the problems it can solve.&lt;/p&gt;&lt;p&gt;That’s where the “human-in-the-loop” interaction pattern comes in. You&amp;#39;re bringing a human &lt;i&gt;into&lt;/i&gt; the agent&amp;#39;s loop and requiring an input from that human before the agent can continue on its task.&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/6dhEhrOtwdaWOjJqhrzmMw/cc8576e7ccce43e2df1bacfd91b125ff/image3.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;625\&quot; height=\&quot;565\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;In this blog post, we&amp;#39;ll use&lt;a href=\&quot;https://knock.app/\&quot;&gt; &lt;u&gt;Knock&lt;/u&gt;&lt;/a&gt; and the Cloudflare&lt;a href=\&quot;https://developers.cloudflare.com/agents/\&quot;&gt; &lt;u&gt;Agents SDK&lt;/u&gt;&lt;/a&gt; to build an AI Agent for a virtual card issuing workflow that requires human approval when a new card is requested.&lt;/p&gt;&lt;p&gt;You can find the complete code for this example&lt;a href=\&quot;https://github.com/knocklabs/ai-agent-examples/tree/main/card-issue-agent\&quot;&gt; &lt;u&gt;in the repository&lt;/u&gt;&lt;/a&gt;.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;what-is-knock\&quot;&gt;What is Knock?&lt;/h2&gt;\n            &lt;a href=\&quot;#what-is-knock\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;&lt;a href=\&quot;https://knock.app/\&quot;&gt;&lt;u&gt;Knock&lt;/u&gt;&lt;/a&gt; is messaging infrastructure you can use to send multi-channel messages across in-app, email, SMS, push, and Slack, without writing any integration code.&lt;/p&gt;&lt;p&gt;With Knock, you gain complete visibility into the messages being sent to your users while also handling reliable delivery, user notification preferences, and more.&lt;/p&gt;&lt;p&gt;You can use Knock to power human-in-the-loop flows for your agents using Knock’s&lt;a href=\&quot;https://docs.knock.app/developer-tools/agent-toolkit/overview\&quot;&gt; &lt;u&gt;Agent Toolkit&lt;/u&gt;&lt;/a&gt;, which is a set of tools that expose Knock’s APIs and messaging capabilities to your AI agents.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;using-the-agent-sdk-as-the-foundation-of-our-ai-agent\&quot;&gt;Using the Agent SDK as the foundation of our AI Agent&lt;/h2&gt;\n            &lt;a href=\&quot;#using-the-agent-sdk-as-the-foundation-of-our-ai-agent\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;The Agents SDK provides an abstraction for building stateful, real-time agents on top of &lt;a href=\&quot;https://developers.cloudflare.com/durable-objects/\&quot;&gt;&lt;u&gt;Durable Objects&lt;/u&gt;&lt;/a&gt; that are globally addressable and persist state using an embedded, &lt;a href=\&quot;https://blog.cloudflare.com/sqlite-in-durable-objects/\&quot;&gt;&lt;u&gt;zero-latency&lt;/u&gt;&lt;/a&gt; SQLite database.&lt;/p&gt;&lt;p&gt;Building an AI agent outside of using the Agents SDK and the Cloudflare platform means we need to consider WebSocket servers, state persistence, and how to scale our service horizontally. Because a Durable Object backs the Agents SDK, we receive these benefits for free, while having a globally addressable piece of compute with built-in storage, that’s completely serverless and scales to zero.&lt;/p&gt;&lt;p&gt;In the example, we’ll use these features to build an agent that users interact with in real-time via chat, and that can be paused and resumed as needed. The Agents SDK is the ideal platform for powering asynchronous agentic workflows, such as those required in human-in-the-loop interactions.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;setting-up-our-knock-messaging-workflow\&quot;&gt;Setting up our Knock messaging workflow&lt;/h2&gt;\n            &lt;a href=\&quot;#setting-up-our-knock-messaging-workflow\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;Within Knock, we design our approval workflow using the visual workflow builder to create the cross-channel messaging logic. We then make the notification templates associated with each channel to which we want to send messages.&lt;/p&gt;&lt;p&gt;Knock will automatically apply the&lt;a href=\&quot;https://docs.knock.app/concepts/preferences\&quot;&gt; &lt;u&gt;user’s preferences&lt;/u&gt;&lt;/a&gt; as part of the workflow execution, ensuring that your user’s notification settings are respected.&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/5f1hOpKg3xTxZwYuJYmUAl/83088b52e8cb26aaed561d00733fd2e1/image1.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1999\&quot; height=\&quot;1299\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;You can find an example workflow that we’ve already created for this demo in the repository. You can use this workflow template via the&lt;a href=\&quot;https://docs.knock.app/cli\&quot;&gt; &lt;u&gt;Knock CLI&lt;/u&gt;&lt;/a&gt; to import it into your account.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;building-our-chat-ui\&quot;&gt;Building our chat UI&lt;/h2&gt;\n            &lt;a href=\&quot;#building-our-chat-ui\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;We’ve built the AI Agent as a chat interface on top of the &lt;code&gt;AIChatAgent&lt;/code&gt; abstraction from Cloudflare’s Agents SDK (&lt;a href=\&quot;https://developers.cloudflare.com/agents/api-reference/agents-api/#chat-agent\&quot;&gt;&lt;u&gt;docs&lt;/u&gt;&lt;/a&gt;). The Agents SDK here takes care of the bulk of the complexity, and we’re left to implement our LLM calling code with our system prompt.&lt;/p&gt;\n            &lt;pre class=\&quot;language-TypeScript\&quot;&gt;&lt;code class=\&quot;language-TypeScript\&quot;&gt;// src/index.ts\n\nimport { AIChatAgent } from &amp;quot;agents/ai-chat-agent&amp;quot;;\nimport { openai } from &amp;quot;@ai-sdk/openai&amp;quot;;\nimport { createDataStreamResponse, streamText } from &amp;quot;ai&amp;quot;;\n\nexport class AIAgent extends AIChatAgent {\n  async onChatMessage(onFinish) {\n    return createDataStreamResponse({\n      execute: async (dataStream) =&amp;gt; {\n        try {\n          const stream = streamText({\n            model: openai(&amp;quot;gpt-4o-mini&amp;quot;),\n            system: `You are a helpful assistant for a financial services company. You help customers with credit card issuing.`,\n            messages: this.messages,\n            onFinish,\n            maxSteps: 5,\n          });\n\n          stream.mergeIntoDataStream(dataStream);\n        } catch (error) {\n          console.error(error);\n        }\n      },\n    });\n  }\n}&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;On the client side, we’re using the &lt;code&gt;useAgentChat&lt;/code&gt; hook from the &lt;code&gt;agents/ai-react&lt;/code&gt; package to power the real-time user-to-agent chat.&lt;/p&gt;&lt;p&gt;We’ve modeled our agent as a chat per user, which we set up using the &lt;code&gt;useAgent&lt;/code&gt; hook by specifying the name of the process as the &lt;code&gt;userId&lt;/code&gt;.&lt;/p&gt;\n            &lt;pre class=\&quot;language-TypeScript\&quot;&gt;&lt;code class=\&quot;language-TypeScript\&quot;&gt;// src/index.ts\n\nimport { useAgent } from &amp;quot;agents/react&amp;quot;;\nimport { useAgentChat } from &amp;quot;agents/ai-react&amp;quot;;\n\nfunction Chat({ userId }: { userId: string }) {\n  const agent = useAgent({ agent: &amp;quot;AIAgent&amp;quot;, name: userId });\n  const { messages, input, handleInputChange, handleSubmit, isLoading } = useAgentChat({ agent });\n  // ... \n}&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;This means we have an agent process, and therefore a durable object, per-user. For our human-in-the-loop use case, this becomes important later on as we talk about resuming our deferred tool call.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;deferring-the-tool-call-to-knock\&quot;&gt;Deferring the tool call to Knock&lt;/h2&gt;\n            &lt;a href=\&quot;#deferring-the-tool-call-to-knock\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;We give the agent our card issuing capability through exposing an &lt;code&gt;issueCard&lt;/code&gt; tool. However, instead of writing the approval flow and cross-channel logic ourselves, we delegate it entirely to Knock by wrapping the issue card tool in our &lt;code&gt;requireHumanInput&lt;/code&gt; method.&lt;/p&gt;&lt;p&gt;Now when the user asks to request a new card, we make a call out to Knock to initiate our card request, which will notify the appropriate admins in the organization to request an approval.&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/3siyPnpYiEmoNIQ7eNCRP/13bd33905cfb5c7ad6812a4359d35627/image2.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1999\&quot; height=\&quot;664\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;To set this up, we need to use Knock’s Agent Toolkit, which exposes methods to work with Knock in our AI agent and power cross-channel messaging.&lt;/p&gt;\n            &lt;pre class=\&quot;language-TypeScript\&quot;&gt;&lt;code class=\&quot;language-TypeScript\&quot;&gt;import { createKnockToolkit } from &amp;quot;@knocklabs/agent-toolkit/ai-sdk&amp;quot;;\nimport { tool } from &amp;quot;ai&amp;quot;;\nimport { z } from &amp;quot;zod&amp;quot;;\n\nimport { AIAgent } from &amp;quot;./index&amp;quot;;\nimport { issueCard } from &amp;quot;./api&amp;quot;;\nimport { BASE_URL } from &amp;quot;./constants&amp;quot;;\n\nasync function initializeToolkit(agent: AIAgent) {\n  const toolkit = await createKnockToolkit({ serviceToken: agent.env.KNOCK_SERVICE_TOKEN });\n\n  const issueCardTool = tool({\n    description: &amp;quot;Issue a new credit card to a customer.&amp;quot;,\n    parameters: z.object({\n      customerId: z.string(),\n    }),\n    execute: async ({ customerId }) =&amp;gt; {\n      return await issueCard(customerId);\n    },\n  });\n\n  const { issueCard } = toolkit.requireHumanInput(\n    { issueCard: issueCardTool },\n    {\n      workflow: &amp;quot;approve-issued-card&amp;quot;,\n      actor: agent.name,\n      recipients: [&amp;quot;admin_user_1&amp;quot;],\n      metadata: {\n        approve_url: `${BASE_URL}/card-issued/approve`,\n        reject_url: `${BASE_URL}/card-issued/reject`,\n      },\n    }\n  );\n  \n  return { toolkit, tools: { issueCard } };  \n}&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;There’s a lot going on here, so let’s walk through the key parts:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;We wrap our &lt;code&gt;issueCard&lt;/code&gt; tool in the &lt;code&gt;requireHumanInput&lt;/code&gt; method, exposed from the Knock Agent Toolkit&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;We want the messaging workflow to be invoked to be our &lt;code&gt;approve-issued-card&lt;/code&gt; workflow&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;We pass the agent.name as the &lt;code&gt;actor&lt;/code&gt; of the request, which translates to the user ID&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;We set the recipient of this workflow to be the user &lt;code&gt;admin_user_1&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;We pass the approve and reject URLs so that they can be used in our message templates&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;The wrapped tool is then returned as &lt;code&gt;issueCard&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;Under the hood, these options are passed to the&lt;a href=\&quot;https://docs.knock.app/api-reference/workflows/trigger\&quot;&gt; &lt;u&gt;Knock workflow trigger API&lt;/u&gt;&lt;/a&gt; to invoke a workflow per-recipient. The set of the recipients listed here could be dynamic, or go to a group of users through&lt;a href=\&quot;https://docs.knock.app/concepts/subscriptions\&quot;&gt; &lt;u&gt;Knock’s subscriptions API&lt;/u&gt;&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;We can then pass the wrapped issue card tool to our LLM call in the &lt;code&gt;onChatMessage&lt;/code&gt; method on the agent so that the tool call can be called as part of the interaction with the agent.&lt;/p&gt;\n            &lt;pre class=\&quot;language-TypeScript\&quot;&gt;&lt;code class=\&quot;language-TypeScript\&quot;&gt;export class AIAgent extends AIChatAgent {\n  // ... other methods\n\n  async onChatMessage(onFinish) {\n    const { tools } = await initializeToolkit(this);\n\n    return createDataStreamResponse({\n      execute: async (dataStream) =&amp;gt; {\n        const stream = streamText({\n          model: openai(&amp;quot;gpt-4o-mini&amp;quot;),\n          system: &amp;quot;You are a helpful assistant for a financial services company. You help customers with credit card issuing.&amp;quot;,\n          messages: this.messages,\n          onFinish,\n          tools,\n          maxSteps: 5,\n        });\n\n        stream.mergeIntoDataStream(dataStream);\n      },\n    });\n  }\n}&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;Now when the agent calls the &lt;code&gt;issueCardTool&lt;/code&gt;, we invoke Knock to send our approval notifications, deferring the tool call to issue the card until we receive an approval. Knock’s workflows take care of sending out the message to the set of recipient’s specified, generating and delivering messages according to each user’s preferences.&lt;/p&gt;&lt;p&gt;Using Knock&lt;a href=\&quot;https://docs.knock.app/concepts/workflows\&quot;&gt; &lt;u&gt;workflows&lt;/u&gt;&lt;/a&gt; for our approval message makes it easy to build cross-channel messaging to reach the user according to their communication&lt;a href=\&quot;https://docs.knock.app/concepts/preferences\&quot;&gt; &lt;u&gt;preferences&lt;/u&gt;&lt;/a&gt;. We can also leverage&lt;a href=\&quot;https://docs.knock.app/designing-workflows/delay-function\&quot;&gt; &lt;u&gt;delays&lt;/u&gt;&lt;/a&gt;,&lt;a href=\&quot;https://docs.knock.app/designing-workflows/throttle-function\&quot;&gt; &lt;u&gt;throttles&lt;/u&gt;&lt;/a&gt;,&lt;a href=\&quot;https://docs.knock.app/designing-workflows/batch-function\&quot;&gt; &lt;u&gt;batching&lt;/u&gt;&lt;/a&gt;, and&lt;a href=\&quot;https://docs.knock.app/designing-workflows/step-conditions\&quot;&gt; &lt;u&gt;conditions&lt;/u&gt;&lt;/a&gt; to orchestrate more complex messaging.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;handling-the-approval\&quot;&gt;Handling the approval&lt;/h2&gt;\n            &lt;a href=\&quot;#handling-the-approval\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;Once the message has been sent to our approvers, the next step is to handle the approval coming back, bringing the human into the agent’s loop.&lt;/p&gt;&lt;p&gt;The approval request is asynchronous, meaning that the response can come at any point in the future. Fortunately, Knock takes care of the heavy lifting here for you, routing the event to the agent worker via a&lt;a href=\&quot;https://docs.knock.app/developer-tools/outbound-webhooks/overview\&quot;&gt; &lt;u&gt;webhook&lt;/u&gt;&lt;/a&gt; that tracks the interaction with the underlying message. In our case, that’s a click to the &amp;quot;approve&amp;quot; or &amp;quot;reject&amp;quot; button.&lt;/p&gt;&lt;p&gt;First, we set up a &lt;code&gt;message.interacted&lt;/code&gt; webhook handler within the Knock dashboard to forward the interactions to our worker, and ultimately to our agent process.&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/5CZkwJmmOw09FNmhRUqFrC/7e7d195276331b42778518b821f7707f/image4.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1999\&quot; height=\&quot;1299\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;In our example here, we route the approval click back to the worker to handle, appending a Knock message ID to the end of the &lt;code&gt;approve_url&lt;/code&gt; and &lt;code&gt;reject_url&lt;/code&gt; to track engagement against the specific message sent. We do this via liquid inside of our message templates in Knock: &lt;code&gt;{{ data.approve_url }}?messageId={{ current_message.id }} &lt;/code&gt;. One caveat here is that if this were a production application, we’re likely going to handle our approval click in a different application than this agent is running. We co-located it here for the purposes of this demo only.&lt;/p&gt;&lt;p&gt;Once the link is clicked, we have a handler in our worker to mark the message as interacted using Knock’s&lt;a href=\&quot;https://docs.knock.app/api-reference/messages/mark_as_interacted\&quot;&gt; &lt;u&gt;message interaction API&lt;/u&gt;&lt;/a&gt;, passing through the status as metadata so that it can be used later.&lt;/p&gt;\n            &lt;pre class=\&quot;language-TypeScript\&quot;&gt;&lt;code class=\&quot;language-TypeScript\&quot;&gt;import Knock from &amp;#039;@knocklabs/node&amp;#039;;\nimport { Hono } from &amp;quot;hono&amp;quot;;\n\nconst app = new Hono();\nconst client = new Knock();\n\napp.get(&amp;quot;/card-issued/approve&amp;quot;, async (c) =&amp;gt; {\n  const { messageId } = c.req.query();\n  \n  if (!messageId) return c.text(&amp;quot;No message ID found&amp;quot;, { status: 400 });\n\n  await client.messages.markAsInteracted(messageId, {\n    status: &amp;quot;approved&amp;quot;,\n  });\n\n  return c.text(&amp;quot;Approved&amp;quot;);\n});&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;The message interaction will flow from Knock to our worker via the webhook we set up, ensuring that the process is fully asynchronous. The payload of the webhook includes the full message, including metadata about the user that generated the original request, and keeps details about the request itself, which in our case contains the tool call.&lt;/p&gt;\n            &lt;pre class=\&quot;language-TypeScript\&quot;&gt;&lt;code class=\&quot;language-TypeScript\&quot;&gt;import { getAgentByName, routeAgentRequest } from &amp;quot;agents&amp;quot;;\nimport { Hono } from &amp;quot;hono&amp;quot;;\n\nconst app = new Hono();\n\napp.post(&amp;quot;/incoming/knock/webhook&amp;quot;, async (c) =&amp;gt; {\n  const body = await c.req.json();\n  const env = c.env as Env;\n\n  // Find the user ID from the tool call for the calling user\n  const userId = body?.data?.actors[0];\n\n  if (!userId) {\n    return c.text(&amp;quot;No user ID found&amp;quot;, { status: 400 });\n  }\n\n  // Find the agent DO for the user\n  const existingAgent = await getAgentByName(env.AIAgent, userId);\n\n  if (existingAgent) {\n    // Route the request to the agent DO to process\n    const result = await existingAgent.handleIncomingWebhook(body);\n\n    return c.json(result);\n  } else {\n    return c.text(&amp;quot;Not found&amp;quot;, { status: 404 });\n  }\n});&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;We leverage the agent’s ability to be addressed by a named identifier to route the request from the worker to the agent. In our case, that’s the &lt;code&gt;userId&lt;/code&gt;. Because the agent is backed by a durable object, this process of going from incoming worker request to finding and resuming the agent is trivial.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;resuming-the-deferred-tool-call\&quot;&gt;Resuming the deferred tool call&lt;/h2&gt;\n            &lt;a href=\&quot;#resuming-the-deferred-tool-call\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;We then use the context about the original tool call, passed through to Knock and round tripped back to the agent, to resume the tool execution and issue the card.&lt;/p&gt;\n            &lt;pre class=\&quot;language-TypeScript\&quot;&gt;&lt;code class=\&quot;language-TypeScript\&quot;&gt;export class AIAgent extends AIChatAgent {\n  // ... other methods\n\n  async handleIncomingWebhook(body: any) {\n    const { toolkit } = await initializeToolkit(this);\n\n    const deferredToolCall = toolkit.handleMessageInteraction(body);\n\n    if (!deferredToolCall) {\n      return { error: &amp;quot;No deferred tool call given&amp;quot; };\n    }\n\n    // If we received an &amp;quot;approved&amp;quot; status then we know the call was approved \n    // so we can resume the deferred tool call execution\n    if (result.interaction.status === &amp;quot;approved&amp;quot;) {\n      const toolCallResult = \n\t      await toolkit.resumeToolExecution(result.toolCall);\n\n      const { response } = await generateText({\n        model: openai(&amp;quot;gpt-4o-mini&amp;quot;),\n        prompt: `You were asked to issue a card for a customer. The card is now approved. The result was: ${JSON.stringify(toolCallResult)}.`,\n      });\n\n      const message = responseToAssistantMessage(\n        response.messages[0],\n        result.toolCall,\n        toolCallResult\n      );\n\n      // Save the message so that it&amp;#039;s displayed to the user\n      this.persistMessages([...this.messages, message]);\n    }\n\n    return { status: &amp;quot;success&amp;quot; };\n  }\n}&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;Again, there’s a lot going on here, so let’s step through the important parts:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;We attempt to transform the body, which is the webhook payload from Knock, into a deferred tool call via the &lt;code&gt;handleMessageInteraction&lt;/code&gt; method&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;If the metadata status we passed through to the interaction call earlier has an “approved” status then we resume the tool call via the &lt;code&gt;resumeToolExecution&lt;/code&gt; method&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Finally, we generate a message from the LLM and persist it, ensuring that the user is informed of the approved card&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;With this last piece in place, we can now request a new card be issued, have an approval request be dispatched from the agent, send the approval messages, and route those approvals back to our agent to be processed. The agent will asynchronously process our card issue request and the deferred tool call will be resumed for us, with very little code.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;protecting-against-duplicate-approvals\&quot;&gt;Protecting against duplicate approvals&lt;/h2&gt;\n            &lt;a href=\&quot;#protecting-against-duplicate-approvals\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;One issue with the above implementation is that we’re prone to issuing multiple cards if someone clicks on the approve button more than once. To rectify this, we want to keep track of the tool calls being issued, and ensure that the call is processed at most once.&lt;/p&gt;&lt;p&gt;To power this we leverage the&lt;a href=\&quot;https://developers.cloudflare.com/agents/api-reference/store-and-sync-state/\&quot;&gt; &lt;u&gt;agent’s built-in state&lt;/u&gt;&lt;/a&gt;, which can be used to persist information without reaching for another persistence store like a database or Redis, although we could absolutely do so if we wished. We can track the tool calls by their ID and capture their current status, right inside the agent process.&lt;/p&gt;\n            &lt;pre class=\&quot;language-TypeScript\&quot;&gt;&lt;code class=\&quot;language-TypeScript\&quot;&gt;type ToolCallStatus = &amp;quot;requested&amp;quot; | &amp;quot;approved&amp;quot; | &amp;quot;rejected&amp;quot;;\n\nexport interface AgentState {\n  toolCalls: Record&amp;lt;string, ToolCallStatus&amp;gt;;\n}\n\nclass AIAgent extends AIChatAgent&amp;lt;Env, AgentState&amp;gt; {\n  initialState: AgentState = {\n    toolCalls: {},\n  };\n  \n  setToolCallStatus(toolCallId: string, status: ToolCallStatus) {\n    this.setState({\n      ...this.state,\n      toolCalls: { ...this.state.toolCalls, [toolCallId]: status },\n    });\n  } \n  // ... \n}&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;Here, we create the initial state for the tool calls as an empty object. We also add a quick setter helper method to make interactions easier.&lt;/p&gt;&lt;p&gt;Next up, we need to record the tool call being made. To do so, we can use the &lt;code&gt;onAfterCallKnock&lt;/code&gt; option in the &lt;code&gt;requireHumanInput&lt;/code&gt; helper to capture that the tool call has been requested for the user.&lt;/p&gt;\n            &lt;pre class=\&quot;language-TypeScript\&quot;&gt;&lt;code class=\&quot;language-TypeScript\&quot;&gt;const { issueCard }  = toolkit.requireHumanInput(\n  { issueCard: issueCardTool },\n  {\n    // Keep track of the tool call state once it&amp;#039;s been sent to Knock\n    onAfterCallKnock: async (toolCall) =&amp;gt; \n      agent.setToolCallStatus(toolCall.id, &amp;quot;requested&amp;quot;),\n    // ... as before\n  }\n);&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;Finally, we then need to check the state when we’re processing the incoming webhook, and mark the tool call as approved (some code omitted for brevity).&lt;/p&gt;\n            &lt;pre class=\&quot;language-TypeScript\&quot;&gt;&lt;code class=\&quot;language-TypeScript\&quot;&gt;export class AIAgent extends AIChatAgent {\n  async handleIncomingWebhook(body: any) {\n    const { toolkit } = await initializeToolkit(this);\n    const deferredToolCall = toolkit.handleMessageInteraction(body);\n    const toolCallId = result.toolCall.id;\n\n    // Make sure this is a tool call that can be processed\n    if (this.state.toolCalls[toolCallId] !== &amp;quot;requested&amp;quot;) {\n      return { error: &amp;quot;Tool call is not requested&amp;quot; };\n    }\n\n    if (result.interaction.status === &amp;quot;approved&amp;quot;) {\n      const toolCallResult = await toolkit.resumeToolExecution(result.toolCall);\n      this.setToolCallStatus(toolCallId, &amp;quot;approved&amp;quot;);\n      // ... rest as before\n    }\n  }\n}&lt;/pre&gt;&lt;/code&gt;\n            \n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;conclusion\&quot;&gt;Conclusion&lt;/h2&gt;\n            &lt;a href=\&quot;#conclusion\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;Using the Agents SDK and Knock, it’s easy to build advanced human-in-the-loop experiences that defer tool calls.&lt;/p&gt;&lt;p&gt;Knock’s workflow builder and notification engine gives you building blocks to create sophisticated cross-channel messaging for your agents. You can easily create escalation flows that send messages through SMS, push, email, or Slack that respect the notification preferences of your users. Knock also gives you complete visibility into the messages your users are receiving.&lt;/p&gt;&lt;p&gt;The Durable Object abstraction underneath the Agents SDK means that we get a globally addressable agent process that’s easy to yield and resume back to. The persistent storage in the Durable Object means we can retain the complete chat history per-user, and any other state that’s required in the agent process to resume the agent with (like our tool calls). Finally, the serverless nature of the underlying Durable Object means we’re able to horizontally scale to support a large number of users with no effort.&lt;/p&gt;&lt;p&gt;If you’re looking to build your own AI Agent chat experience with a multiplayer human-in-the-loop experience, you’ll find the complete code from this guide&lt;a href=\&quot;https://github.com/knocklabs/ai-agent-examples/tree/main/card-issue-agent\&quot;&gt; &lt;u&gt;available in GitHub&lt;/u&gt;&lt;/a&gt;.&lt;/p&gt;&quot;],&quot;published_at&quot;:[0,&quot;2025-06-03T14:00+01:00&quot;],&quot;updated_at&quot;:[0,&quot;2025-06-11T14:09:01.698Z&quot;],&quot;feature_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/4QDMGATQYFYtzw9CfEpZeA/b850ebb2dd2b22fd415807c4a7a09cf2/hero-knock-cloudflare-agents.png&quot;],&quot;tags&quot;:[1,[[0,{&quot;id&quot;:[0,&quot;6Foe3R8of95cWVnQwe5Toi&quot;],&quot;name&quot;:[0,&quot;AI&quot;],&quot;slug&quot;:[0,&quot;ai&quot;]}],[0,{&quot;id&quot;:[0,&quot;22RkiaggH3NV4u6qyMmC42&quot;],&quot;name&quot;:[0,&quot;Agents&quot;],&quot;slug&quot;:[0,&quot;agents&quot;]}],[0,{&quot;id&quot;:[0,&quot;6hbkItfupogJP3aRDAq6v8&quot;],&quot;name&quot;:[0,&quot;Cloudflare Workers&quot;],&quot;slug&quot;:[0,&quot;workers&quot;]}],[0,{&quot;id&quot;:[0,&quot;5v2UZdTRX1Rw9akmhexnxs&quot;],&quot;name&quot;:[0,&quot;Durable Objects&quot;],&quot;slug&quot;:[0,&quot;durable-objects&quot;]}],[0,{&quot;id&quot;:[0,&quot;3JAY3z7p7An94s6ScuSQPf&quot;],&quot;name&quot;:[0,&quot;Developer Platform&quot;],&quot;slug&quot;:[0,&quot;developer-platform&quot;]}],[0,{&quot;id&quot;:[0,&quot;4HIPcb68qM0e26fIxyfzwQ&quot;],&quot;name&quot;:[0,&quot;Developers&quot;],&quot;slug&quot;:[0,&quot;developers&quot;]}]]],&quot;relatedTags&quot;:[0],&quot;authors&quot;:[1,[[0,{&quot;name&quot;:[0,&quot;Chris Bell (Guest author)&quot;],&quot;slug&quot;:[0,&quot;Chris Bell (Guest author)&quot;],&quot;bio&quot;:[0],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1oACtpoGbOmqrsRXMO0Mgu/913b30bfa207cac04efee1e17df60d6e/Chris_Bell.png&quot;],&quot;location&quot;:[0],&quot;website&quot;:[0],&quot;twitter&quot;:[0,&quot;cjbell_&quot;],&quot;facebook&quot;:[0],&quot;publiclyIndex&quot;:[0,true]}]]],&quot;meta_description&quot;:[0,&quot;How Knock shipped an AI Agent with human-in-the-loop capabilities with Cloudflare’s Agents SDK and Cloudflare Workers.&quot;],&quot;primary_author&quot;:[0,{}],&quot;localeList&quot;:[0,{&quot;name&quot;:[0,&quot;blog-english-only&quot;],&quot;enUS&quot;:[0,&quot;English for Locale&quot;],&quot;zhCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhHansCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhTW&quot;:[0,&quot;No Page for Locale&quot;],&quot;frFR&quot;:[0,&quot;No Page for Locale&quot;],&quot;deDE&quot;:[0,&quot;No Page for Locale&quot;],&quot;itIT&quot;:[0,&quot;No Page for Locale&quot;],&quot;jaJP&quot;:[0,&quot;No Page for Locale&quot;],&quot;koKR&quot;:[0,&quot;No Page for Locale&quot;],&quot;ptBR&quot;:[0,&quot;No Page for Locale&quot;],&quot;esLA&quot;:[0,&quot;No Page for Locale&quot;],&quot;esES&quot;:[0,&quot;No Page for Locale&quot;],&quot;enAU&quot;:[0,&quot;No Page for Locale&quot;],&quot;enCA&quot;:[0,&quot;No Page for Locale&quot;],&quot;enIN&quot;:[0,&quot;No Page for Locale&quot;],&quot;enGB&quot;:[0,&quot;No Page for Locale&quot;],&quot;idID&quot;:[0,&quot;No Page for Locale&quot;],&quot;ruRU&quot;:[0,&quot;No Page for Locale&quot;],&quot;svSE&quot;:[0,&quot;No Page for Locale&quot;],&quot;viVN&quot;:[0,&quot;No Page for Locale&quot;],&quot;plPL&quot;:[0,&quot;No Page for Locale&quot;],&quot;arAR&quot;:[0,&quot;No Page for Locale&quot;],&quot;nlNL&quot;:[0,&quot;No Page for Locale&quot;],&quot;thTH&quot;:[0,&quot;No Page for Locale&quot;],&quot;trTR&quot;:[0,&quot;No Page for Locale&quot;],&quot;heIL&quot;:[0,&quot;No Page for Locale&quot;],&quot;lvLV&quot;:[0,&quot;No Page for Locale&quot;],&quot;etEE&quot;:[0,&quot;No Page for Locale&quot;],&quot;ltLT&quot;:[0,&quot;No Page for Locale&quot;]}],&quot;url&quot;:[0,&quot;https://blog.cloudflare.com/building-agents-at-knock-agents-sdk&quot;],&quot;metadata&quot;:[0,{&quot;title&quot;:[0,&quot;Building an AI Agent that puts humans in the loop with Knock and Cloudflare’s Agents SDK&quot;],&quot;description&quot;:[0,&quot;How Knock shipped an AI Agent with human-in-the-loop capabilities with Cloudflare’s Agents SDK and Cloudflare Workers.&quot;],&quot;imgPreview&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/4QDMGATQYFYtzw9CfEpZeA/b850ebb2dd2b22fd415807c4a7a09cf2/hero-knock-cloudflare-agents.png&quot;]}],&quot;publicly_index&quot;:[0,true]}],&quot;translations&quot;:[0,{&quot;posts.by&quot;:[0,&quot;By&quot;],&quot;footer.gdpr&quot;:[0,&quot;GDPR&quot;],&quot;lang_blurb1&quot;:[0,&quot;This post is also available in {lang1}.&quot;],&quot;lang_blurb2&quot;:[0,&quot;This post is also available in {lang1} and {lang2}.&quot;],&quot;lang_blurb3&quot;:[0,&quot;This post is also available in {lang1}, {lang2} and {lang3}.&quot;],&quot;footer.press&quot;:[0,&quot;Press&quot;],&quot;header.title&quot;:[0,&quot;The Cloudflare Blog&quot;],&quot;search.clear&quot;:[0,&quot;Clear&quot;],&quot;search.filter&quot;:[0,&quot;Filter&quot;],&quot;search.source&quot;:[0,&quot;Source&quot;],&quot;footer.careers&quot;:[0,&quot;Careers&quot;],&quot;footer.company&quot;:[0,&quot;Company&quot;],&quot;footer.support&quot;:[0,&quot;Support&quot;],&quot;footer.the_net&quot;:[0,&quot;theNet&quot;],&quot;search.filters&quot;:[0,&quot;Filters&quot;],&quot;footer.our_team&quot;:[0,&quot;Our team&quot;],&quot;footer.webinars&quot;:[0,&quot;Webinars&quot;],&quot;page.more_posts&quot;:[0,&quot;More posts&quot;],&quot;posts.time_read&quot;:[0,&quot;{time} min read&quot;],&quot;search.language&quot;:[0,&quot;Language&quot;],&quot;footer.community&quot;:[0,&quot;Community&quot;],&quot;footer.resources&quot;:[0,&quot;Resources&quot;],&quot;footer.solutions&quot;:[0,&quot;Solutions&quot;],&quot;footer.trademark&quot;:[0,&quot;Trademark&quot;],&quot;header.subscribe&quot;:[0,&quot;Subscribe&quot;],&quot;footer.compliance&quot;:[0,&quot;Compliance&quot;],&quot;footer.free_plans&quot;:[0,&quot;Free plans&quot;],&quot;footer.impact_ESG&quot;:[0,&quot;Impact/ESG&quot;],&quot;posts.follow_on_X&quot;:[0,&quot;Follow on X&quot;],&quot;footer.help_center&quot;:[0,&quot;Help center&quot;],&quot;footer.network_map&quot;:[0,&quot;Network Map&quot;],&quot;header.please_wait&quot;:[0,&quot;Please Wait&quot;],&quot;page.related_posts&quot;:[0,&quot;Related posts&quot;],&quot;search.result_stat&quot;:[0,&quot;Results &lt;strong&gt;{search_range}&lt;/strong&gt; of &lt;strong&gt;{search_total}&lt;/strong&gt; for &lt;strong&gt;{search_keyword}&lt;/strong&gt;&quot;],&quot;footer.case_studies&quot;:[0,&quot;Case Studies&quot;],&quot;footer.connect_2024&quot;:[0,&quot;Connect 2024&quot;],&quot;footer.terms_of_use&quot;:[0,&quot;Terms of Use&quot;],&quot;footer.white_papers&quot;:[0,&quot;White Papers&quot;],&quot;footer.cloudflare_tv&quot;:[0,&quot;Cloudflare TV&quot;],&quot;footer.community_hub&quot;:[0,&quot;Community Hub&quot;],&quot;footer.compare_plans&quot;:[0,&quot;Compare plans&quot;],&quot;footer.contact_sales&quot;:[0,&quot;Contact Sales&quot;],&quot;header.contact_sales&quot;:[0,&quot;Contact Sales&quot;],&quot;header.email_address&quot;:[0,&quot;Email Address&quot;],&quot;page.error.not_found&quot;:[0,&quot;Page not found&quot;],&quot;footer.developer_docs&quot;:[0,&quot;Developer docs&quot;],&quot;footer.privacy_policy&quot;:[0,&quot;Privacy Policy&quot;],&quot;footer.request_a_demo&quot;:[0,&quot;Request a demo&quot;],&quot;page.continue_reading&quot;:[0,&quot;Continue reading&quot;],&quot;footer.analysts_report&quot;:[0,&quot;Analyst reports&quot;],&quot;footer.for_enterprises&quot;:[0,&quot;For enterprises&quot;],&quot;footer.getting_started&quot;:[0,&quot;Getting Started&quot;],&quot;footer.learning_center&quot;:[0,&quot;Learning Center&quot;],&quot;footer.project_galileo&quot;:[0,&quot;Project Galileo&quot;],&quot;pagination.newer_posts&quot;:[0,&quot;Newer Posts&quot;],&quot;pagination.older_posts&quot;:[0,&quot;Older Posts&quot;],&quot;posts.social_buttons.x&quot;:[0,&quot;Discuss on X&quot;],&quot;search.icon_aria_label&quot;:[0,&quot;Search&quot;],&quot;search.source_location&quot;:[0,&quot;Source/Location&quot;],&quot;footer.about_cloudflare&quot;:[0,&quot;About Cloudflare&quot;],&quot;footer.athenian_project&quot;:[0,&quot;Athenian Project&quot;],&quot;footer.become_a_partner&quot;:[0,&quot;Become a partner&quot;],&quot;footer.cloudflare_radar&quot;:[0,&quot;Cloudflare Radar&quot;],&quot;footer.network_services&quot;:[0,&quot;Network services&quot;],&quot;footer.trust_and_safety&quot;:[0,&quot;Trust &amp; Safety&quot;],&quot;header.get_started_free&quot;:[0,&quot;Get Started Free&quot;],&quot;page.search.placeholder&quot;:[0,&quot;Search Cloudflare&quot;],&quot;footer.cloudflare_status&quot;:[0,&quot;Cloudflare Status&quot;],&quot;footer.cookie_preference&quot;:[0,&quot;Cookie Preferences&quot;],&quot;header.valid_email_error&quot;:[0,&quot;Must be valid email.&quot;],&quot;search.result_stat_empty&quot;:[0,&quot;Results &lt;strong&gt;{search_range}&lt;/strong&gt; of &lt;strong&gt;{search_total}&lt;/strong&gt;&quot;],&quot;footer.connectivity_cloud&quot;:[0,&quot;Connectivity cloud&quot;],&quot;footer.developer_services&quot;:[0,&quot;Developer services&quot;],&quot;footer.investor_relations&quot;:[0,&quot;Investor relations&quot;],&quot;page.not_found.error_code&quot;:[0,&quot;Error Code: 404&quot;],&quot;search.autocomplete_title&quot;:[0,&quot;Insert a query. Press enter to send&quot;],&quot;footer.logos_and_press_kit&quot;:[0,&quot;Logos &amp; press kit&quot;],&quot;footer.application_services&quot;:[0,&quot;Application services&quot;],&quot;footer.get_a_recommendation&quot;:[0,&quot;Get a recommendation&quot;],&quot;posts.social_buttons.reddit&quot;:[0,&quot;Discuss on Reddit&quot;],&quot;footer.sse_and_sase_services&quot;:[0,&quot;SSE and SASE services&quot;],&quot;page.not_found.outdated_link&quot;:[0,&quot;You may have used an outdated link, or you may have typed the address incorrectly.&quot;],&quot;footer.report_security_issues&quot;:[0,&quot;Report Security Issues&quot;],&quot;page.error.error_message_page&quot;:[0,&quot;Sorry, we can&#39;t find the page you are looking for.&quot;],&quot;header.subscribe_notifications&quot;:[0,&quot;Subscribe to receive notifications of new posts:&quot;],&quot;footer.cloudflare_for_campaigns&quot;:[0,&quot;Cloudflare for Campaigns&quot;],&quot;header.subscription_confimation&quot;:[0,&quot;Subscription confirmed. Thank you for subscribing!&quot;],&quot;posts.social_buttons.hackernews&quot;:[0,&quot;Discuss on Hacker News&quot;],&quot;footer.diversity_equity_inclusion&quot;:[0,&quot;Diversity, equity &amp; inclusion&quot;],&quot;footer.critical_infrastructure_defense_project&quot;:[0,&quot;Critical Infrastructure Defense Project&quot;]}]}" ssr client="load" opts="{&quot;name&quot;:&quot;PostCard&quot;,&quot;value&quot;:true}" await-children><article class="w-100 featured-post  flex flex-row flex-wrap mb4 items-center bb b--gray8 bn-l  mt4 mt2-l mb4 ph3 bb b--gray8 bn-l"><div class="w-50-l"><a href="/building-agents-at-knock-agents-sdk/" class="fw5 no-underline gray1" data-testid="post-title"><h2 class="fw5 mt2">Building an AI Agent that puts humans in the loop with Knock and Cloudflare’s Agents SDK</h2></a><p class="f3 fw5 gray5 my" data-testid="post-date">2025-06-03</p><p class="f4 fw3 lh-copy " data-testid="post-content">How Knock shipped an AI Agent with human-in-the-loop capabilities with Cloudflare’s Agents SDK and Cloudflare Workers.<!-- -->...</p><a href="/building-agents-at-knock-agents-sdk/" class="no-underline gray1 f4 lh-copy fw3 underline-hover" data-testid="post-continue-reading">Continue reading »</a><ul class="author-lists flex pl0"><li class="list flex items-center pr2 mb3"><a href="/author/Chris Bell (Guest author)/" class="static-avatar pr1"><img class="author-profile-image br-100 mr2" src="https://blog.cloudflare.com/cdn-cgi/image/format=auto,dpr=3,width=64,height=64,gravity=face,fit=crop,zoom=0.5/https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1oACtpoGbOmqrsRXMO0Mgu/913b30bfa207cac04efee1e17df60d6e/Chris_Bell.png" alt="Chris Bell (Guest author)" width="62" height="62"/></a><div class="author-name-tooltip"><a href="/author/Chris Bell (Guest author)/" class="fw5 f4 no-underline black">Chris Bell (Guest author)</a></div></li></ul></div><div class="w-50-l"><img class="dn di-l " src="https://cf-assets.www.cloudflare.com/zkvhlag99gkb/4QDMGATQYFYtzw9CfEpZeA/b850ebb2dd2b22fd415807c4a7a09cf2/hero-knock-cloudflare-agents.png" alt="Building an AI Agent that puts humans in the loop with Knock and Cloudflare’s Agents SDK"/></div></article><!--astro:end--></astro-island><astro-island uid="wdonm" prefix="r1" component-url="/_astro/PostCard.DalyEN7z.js" component-export="PostCard" renderer-url="/_astro/client.DLO1yDVm.js" props="{&quot;currentPage&quot;:[0,1],&quot;isFeaturedImageFirstPost&quot;:[0,false],&quot;post&quot;:[0,{&quot;id&quot;:[0,&quot;2dJV7VMudIGAhdS2pL32lv&quot;],&quot;title&quot;:[0,&quot;Let’s DO this: detecting Workers Builds errors across 1 million Durable Objects&quot;],&quot;slug&quot;:[0,&quot;detecting-workers-builds-errors-across-1-million-durable-durable-objects&quot;],&quot;excerpt&quot;:[0,&quot;Workers Builds, our CI/CD product for deploying Workers, monitors build issues by analyzing build failure metadata spread across over one million Durable Objects.&quot;],&quot;featured&quot;:[0,false],&quot;html&quot;:[0,&quot;&lt;p&gt;Cloudflare Workers Builds is our &lt;a href=\&quot;https://en.wikipedia.org/wiki/CI/CD\&quot;&gt;&lt;u&gt;CI/CD&lt;/u&gt;&lt;/a&gt; product that makes it easy to build and deploy Workers applications every time code is pushed to GitHub or GitLab. What makes Workers Builds special is that projects can be built and deployed with minimal configuration.&lt;a href=\&quot;https://developers.cloudflare.com/workers/ci-cd/builds/#get-started\&quot;&gt; &lt;u&gt;Just hook up your project and let us take care of the rest!&lt;/u&gt;&lt;/a&gt;&lt;/p&gt;&lt;p&gt;But what happens when things go wrong, such as failing to install tools or dependencies? What usually happens is that we don’t fix the problem until a customer contacts us about it, at which point many other customers have likely faced the same issue. This can be a frustrating experience for both us and our customers because of the lag time between issues occurring and us fixing them.&lt;/p&gt;&lt;p&gt;We want Workers Builds to be reliable, fast, and easy to use so that developers can focus on building, not dealing with our bugs. That’s why we recently started building an error detection system that can detect, categorize, and surface all build issues occurring on Workers Builds, enabling us to proactively fix issues and add missing features.&lt;/p&gt;&lt;p&gt;It’s also no secret that we’re big fans of being “Customer Zero” at Cloudflare, and Workers Builds is itself a product that’s built end-to-end on our &lt;a href=\&quot;https://www.cloudflare.com/developer-platform/\&quot;&gt;&lt;u&gt;Developer Platform&lt;/u&gt;&lt;/a&gt; using &lt;a href=\&quot;https://developers.cloudflare.com/workers/\&quot;&gt;&lt;u&gt;Workers&lt;/u&gt;&lt;/a&gt;, &lt;a href=\&quot;https://developers.cloudflare.com/durable-objects/\&quot;&gt;&lt;u&gt;Durable Objects&lt;/u&gt;&lt;/a&gt;, &lt;a href=\&quot;https://developers.cloudflare.com/hyperdrive/\&quot;&gt;&lt;u&gt;Hyperdrive&lt;/u&gt;&lt;/a&gt;, &lt;a href=\&quot;https://blog.cloudflare.com/cloudflare-containers-coming-2025/\&quot;&gt;&lt;u&gt;Containers&lt;/u&gt;&lt;/a&gt;, &lt;a href=\&quot;https://developers.cloudflare.com/queues/\&quot;&gt;&lt;u&gt;Queues&lt;/u&gt;&lt;/a&gt;, &lt;a href=\&quot;https://developers.cloudflare.com/kv/\&quot;&gt;&lt;u&gt;Workers KV&lt;/u&gt;&lt;/a&gt;, &lt;a href=\&quot;https://developers.cloudflare.com/r2/\&quot;&gt;&lt;u&gt;R2&lt;/u&gt;&lt;/a&gt;, and &lt;a href=\&quot;https://developers.cloudflare.com/workers/observability/\&quot;&gt;&lt;u&gt;Workers Observability&lt;/u&gt;&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;In this post, we will dive into how we used the Cloudflare Developer Platform to check for issues across more than &lt;b&gt;1 million Durable Objects&lt;/b&gt;.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;background-workers-builds-architecture\&quot;&gt;Background: Workers Builds architecture&lt;/h2&gt;\n            &lt;a href=\&quot;#background-workers-builds-architecture\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;Back in October 2024, we wrote about&lt;a href=\&quot;https://blog.cloudflare.com/workers-builds-integrated-ci-cd-built-on-the-workers-platform/\&quot;&gt; &lt;u&gt;how we built Workers Builds entirely on the Workers platform&lt;/u&gt;&lt;/a&gt;. To recap, Builds is built using Workers, Durable Objects, Workers KV, R2, Queues, Hyperdrive, and a Postgres database. Some of these things were not present when launched back in October (for example, Queues and KV). But the core of the architecture is the same.&lt;/p&gt;&lt;p&gt;A client Worker receives GitHub/GitLab webhooks and stores build metadata in Postgres (via Hyperdrive). A build management Worker uses two Durable Object classes: a Scheduler class to find builds in Postgres that need scheduling, and a class called BuildBuddy to manage the lifecycle of a build. When a build needs to be started, Scheduler creates a new BuildBuddy instance which is responsible for creating a container for the build (using&lt;a href=\&quot;https://blog.cloudflare.com/container-platform-preview/\&quot;&gt; &lt;u&gt;Cloudflare Containers&lt;/u&gt;&lt;/a&gt;), monitoring the container with health checks, and receiving build logs so that they can be viewed in the Cloudflare Dashboard.&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/2Zf6QSXafUJOxn6isLsqar/fd8eaa3428185c3da2ef96ddd1fdc43c/image2.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1999\&quot; height=\&quot;1112\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;In addition to this core scheduling logic, we have several Workers Queues for background work such as sending PR comments to GitHub/GitLab.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;the-problem-builds-are-failing\&quot;&gt;The problem: builds are failing&lt;/h2&gt;\n            &lt;a href=\&quot;#the-problem-builds-are-failing\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;While this architecture has worked well for us so far, we found ourselves with a problem: compared to&lt;a href=\&quot;https://developers.cloudflare.com/pages/\&quot;&gt; &lt;u&gt;Cloudflare Pages&lt;/u&gt;&lt;/a&gt;, a concerning percentage of builds were failing. We needed to dig deeper and figure out what was wrong, and understand how we could improve Workers Builds so that developers can focus more on shipping instead of build failures.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;types-of-build-failures\&quot;&gt;Types of build failures&lt;/h2&gt;\n            &lt;a href=\&quot;#types-of-build-failures\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;Not all build failures are the same. We have several categories of failures that we monitor:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;Initialization failures: when the container fails to start.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Clone failures: failing to clone the repository from GitHub/GitLab.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Build timeouts: builds that ran past the limit and were terminated by BuildBuddy.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Builds failing health checks: the container stopped responding to health checks, e.g. the container crashed for an unknown reason.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Failure to install tools or dependencies.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Failed user build/deploy commands.&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;The first few failure types were straightforward, and we’ve been able to track down and fix issues in our build system and control plane to improve what we call “build completion rate”. We define build completion as the following:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;&lt;p&gt;We successfully started the build.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;We attempted to install tools/dependencies (considering failures as “user error”).&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;We attempted to run the user-defined build/deploy commands (again, considering failures as “user error”).&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;We successfully marked the build as stopped in our database.&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;For example, we had a bug where builds for a deleted Worker would attempt to run and continuously fail, which affected our build completion rate metric.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;user-error\&quot;&gt;User error&lt;/h3&gt;\n            &lt;a href=\&quot;#user-error\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;We’ve made a lot of progress improving the reliability of build and container orchestration, but we had a significant percentage of build failures in the “user error” metric. We started asking ourselves “is this actually user error? Or is there a problem with the product itself?”&lt;/p&gt;&lt;p&gt;This presented a challenge because questions like “did the build command fail due to a bug in the build system, or user error?” are a lot harder to answer than pass/fail issues like failing to create a container for the build. To answer these questions, we had to build something new, something smarter.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;build-logs\&quot;&gt;Build logs&lt;/h3&gt;\n            &lt;a href=\&quot;#build-logs\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;The most obvious way to determine why a build failed is to look at its logs. When spot-checking build failures, we can typically identify what went wrong. For example, some builds fail to install dependencies because of an out of date lockfile (e.g. package-lock.json out of date with package.json). But looking through build failures one by one doesn’t scale. We didn’t want engineers looking through customer build logs without at least suspecting that there was an issue with our build system that we could fix.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;automating-error-detection\&quot;&gt;Automating error detection&lt;/h2&gt;\n            &lt;a href=\&quot;#automating-error-detection\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;At this point, next steps were clear: we needed an automated way to identify why a build failed based on build logs, and provide a way for engineers to see what the top issues were while ensuring privacy (e.g. removing account-specific identifiers and file paths from the aggregate data).&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;detecting-errors-in-build-logs-using-workers-queues\&quot;&gt;Detecting errors in build logs using Workers Queues&lt;/h3&gt;\n            &lt;a href=\&quot;#detecting-errors-in-build-logs-using-workers-queues\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;The first thing we needed was a way to categorize build errors after a build fails. To do this, we created a queue named BuildErrorsQueue to process builds and look for errors. After a build fails, BuildBuddy will send the build ID to BuildErrorsQueue which fetches the logs, checks for issues, and saves results to Postgres.&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/3423WCenScTudEv27TCMnJ/86b621a957d4249449c99db43a43bb9a/image7.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1968\&quot; height=\&quot;1386\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;We started out with a few static patterns to match things like Wrangler errors in log lines:&lt;/p&gt;\n            &lt;pre class=\&quot;language-JavaScript\&quot;&gt;&lt;code class=\&quot;language-JavaScript\&quot;&gt;export const DetectedErrorCodes = {\n  wrangler_error: {\n    detect: async (lines: LogLines) =&amp;gt; {\n      const errors: DetectedError[] = []\n      for (const line of lines) {\n        if (line[2].trim().startsWith(&amp;#039;✘ [ERROR]&amp;#039;)) {\n          errors.push({\n            error_code: &amp;#039;wrangler_error&amp;#039;,\n            error_group: getWranglerLogGroupFromLogLine(line, wranglerRegexMatchers),\n            detected_on: new Date(),\n            lines_matched: [line],\n          })\n        }\n      }\n      return errors\n    },\n  },\n  installing_tools_or_dependencies_failed: { ... },\n}&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;It wouldn’t be useful if all Wrangler errors were grouped under a single generic “wrangler_error” code, so we further grouped them by normalizing the log lines into groups:&lt;/p&gt;\n            &lt;pre class=\&quot;language-JavaScript\&quot;&gt;&lt;code class=\&quot;language-JavaScript\&quot;&gt;function getWranglerLogGroupFromLogLine(\n  logLine: LogLine,\n  regexMatchers: RegexMatcher[]\n): string {\n  const original = logLine[2].trim().replaceAll(/[\\t\\n\\r]+/g, &amp;#039; &amp;#039;)\n  let message = original\n  let group = original\n  for (const { mustMatch, patterns, stopOnMatch, name, useNameAsGroup } of regexMatchers) {\n    if (mustMatch !== undefined) {\n      const matched = matchLineToRegexes(message, mustMatch)\n      if (!matched) continue\n    }\n    if (patterns) {\n      for (const [pattern, mask] of patterns) {\n        message = message.replaceAll(pattern, mask)\n      }\n    }\n    if (useNameAsGroup === true) {\n      group = name\n    } else {\n      group = message\n    }\n    if (Boolean(stopOnMatch) &amp;amp;&amp;amp; message !== original) break\n  }\n  return group\n}\n\nconst wranglerRegexMatchers: RegexMatcher[] = [\n  {\n    name: &amp;#039;could_not_resolve&amp;#039;,\n    // ✘ [ERROR] Could not resolve &amp;quot;./balance&amp;quot;\n    // ✘ [ERROR] Could not resolve &amp;quot;node:string_decoder&amp;quot; (originally &amp;quot;string_decoder/&amp;quot;)\n    mustMatch: [/^✘ \\[ERROR\\] Could not resolve &amp;quot;[@\\w :/\\\\.-]*&amp;quot;/i],\n    stopOnMatch: true,\n    patterns: [\n      [/(?&amp;lt;=^✘ \\[ERROR\\] Could not resolve &amp;quot;)[@\\w :/\\\\.-]*(?=&amp;quot;)/gi, &amp;#039;&amp;lt;MODULE&amp;gt;&amp;#039;],\n      [/(?&amp;lt;=\\(originally &amp;quot;)[@\\w :/\\\\.-]*(?=&amp;quot;)/gi, &amp;#039;&amp;lt;MODULE&amp;gt;&amp;#039;],\n    ],\n  },\n  {\n    name: &amp;#039;no_matching_export_for_import&amp;#039;,\n    // ✘ [ERROR] No matching export in &amp;quot;src/db/schemas/index.ts&amp;quot; for import &amp;quot;someCoolTable&amp;quot;\n    mustMatch: [/^✘ \\[ERROR\\] No matching export in &amp;quot;/i],\n    stopOnMatch: true,\n    patterns: [\n      [/(?&amp;lt;=^✘ \\[ERROR\\] No matching export in &amp;quot;)[@~\\w:/\\\\.-]*(?=&amp;quot;)/gi, &amp;#039;&amp;lt;MODULE&amp;gt;&amp;#039;],\n      [/(?&amp;lt;=&amp;quot; for import &amp;quot;)[\\w-]*(?=&amp;quot;)/gi, &amp;#039;&amp;lt;IMPORT&amp;gt;&amp;#039;],\n    ],\n  },\n  // ...many more added over time\n]&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;Once we had our error detection matchers and normalizing logic in place, implementing the BuildErrorsQueue consumer was easy:&lt;/p&gt;\n            &lt;pre class=\&quot;language-JavaScript\&quot;&gt;&lt;code class=\&quot;language-JavaScript\&quot;&gt;export async function handleQueue(\n  batch: MessageBatch,\n  env: Bindings,\n  ctx: ExecutionContext\n): Promise&amp;lt;void&amp;gt; {\n  ...\n  await pMap(batch.messages, async (msg) =&amp;gt; {\n    try {\n      const { build_id } = BuildErrorsQueueMessageBody.parse(msg.body)\n      await store.buildErrors.deleteErrorsByBuildId({ build_id })\n      const bb = getBuildBuddy(env, build_id)\n      const errors: DetectedError[] = []\n      let cursor: LogsCursor | undefined\n      let hasMore = false\n\n      do {\n        using maybeNewLogs = await bb.getLogs(cursor, false)\n        const newLogs = LogsWithCursor.parse(maybeNewLogs)\n        cursor = newLogs.cursor\n        const newErrors = await detectErrorsInLogLines(newLogs.lines)\n        errors.push(...newErrors)\n        hasMore = Boolean(cursor) &amp;amp;&amp;amp; newLogs.lines.length &amp;gt; 0\n      } while (hasMore)\n\n      if (errors.length &amp;gt; 0) {\n        await store.buildErrors.insertErrors(\n          errors.map((e) =&amp;gt; ({\n            build_id,\n            error_code: e.error_code,\n            error_group: e.error_group,\n          }))\n        )\n      }\n      msg.ack()\n    } catch (e) {\n      msg.retry()\n      sentry.captureException(e)\n    }\n  })\n}&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;Here, we’re fetching logs from each build’s BuildBuddy Durable Object, detecting why it failed using the matchers we wrote, and saving errors to the Postgres DB. We also delete any existing errors for when we improve our error detection patterns to prevent subsequent runs from adding duplicate data to our database.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;what-about-historical-builds\&quot;&gt;What about historical builds?&lt;/h2&gt;\n            &lt;a href=\&quot;#what-about-historical-builds\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;The BuildErrorsQueue was great for new builds, but this meant we still didn’t know why all the previous build failures happened other than “user error”. We considered only tracking errors in new builds, but this was unacceptable because it would significantly slow down our ability to improve our error detection system because each iteration would require us to wait days to identify issues we need to prioritize.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;problem-logs-are-stored-across-one-million-durable-objects\&quot;&gt;Problem: logs are stored across one million+ Durable Objects&lt;/h3&gt;\n            &lt;a href=\&quot;#problem-logs-are-stored-across-one-million-durable-objects\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Remember how every build has an associated BuildBuddy DO to store logs? This is a great design for ensuring our logging pipeline scales with our customers, but it presented a challenge when trying to aggregate issues based on logs because something would need to go through all historical builds (&amp;gt;1 million at the time) to fetch logs and detect why they failed.&lt;/p&gt;&lt;p&gt;If we were using Go and Kubernetes, we might solve this using a long-running container that goes through all builds and runs our error detection. But how do we solve this in Workers?&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;how-do-we-backfill-errors-for-historical-builds\&quot;&gt;How do we backfill errors for historical builds?&lt;/h3&gt;\n            &lt;a href=\&quot;#how-do-we-backfill-errors-for-historical-builds\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;At this point, we already had the Queue to process new builds. If we could somehow send all of the old build IDs to the queue, it could scan them all quickly using&lt;a href=\&quot;https://developers.cloudflare.com/queues/configuration/consumer-concurrency/\&quot;&gt; &lt;u&gt;Queues concurrent consumers&lt;/u&gt;&lt;/a&gt; to quickly work through all builds. We thought about hacking together a local script to fetch all of the log IDs and sending them to an API to put them on a queue. But we wanted something more secure and easier to use so that running a new backfill was as simple as an API call.&lt;/p&gt;&lt;p&gt;That’s when an idea hit us: what if we used a Durable Object with alarms to fetch a range of builds and send them to BuildErrorsQueue? At first, it seemed far-fetched, given that Durable Object alarms have a limited amount of work they can do per invocation. But wait, if&lt;a href=\&quot;https://agents.cloudflare.com/\&quot;&gt; &lt;u&gt;AI Agents built on Durable Objects&lt;/u&gt;&lt;/a&gt; can manage background tasks, why can’t we fetch millions of build IDs and forward them to queues?&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;building-a-build-errors-agent-with-durable-objects\&quot;&gt;Building a Build Errors Agent with Durable Objects&lt;/h3&gt;\n            &lt;a href=\&quot;#building-a-build-errors-agent-with-durable-objects\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;The idea was simple: create a Durable Object class named BuildErrorsAgent and run a single instance that loops through the specified range of builds in the database and sends them to BuildErrorsQueue.&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/3kmsS4LACzLUUoECSJT08g/b6a9ccffcbe8a41c300a74546a17ba85/image5.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1999\&quot; height=\&quot;1119\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;The first thing we did was set up an RPC method to start a backfill and save the parameters in&lt;a href=\&quot;https://developers.cloudflare.com/durable-objects/api/storage-api/#kv-api\&quot;&gt; &lt;u&gt;Durable Object KV storage&lt;/u&gt;&lt;/a&gt; so that it can be read each time the alarm executes:&lt;/p&gt;\n            &lt;pre class=\&quot;language-JavaScript\&quot;&gt;&lt;code class=\&quot;language-JavaScript\&quot;&gt;async start({\n  min_build_id,\n  max_build_id,\n}: {\n  min_build_id: BuildRecord[&amp;#039;build_id&amp;#039;]\n  max_build_id: BuildRecord[&amp;#039;build_id&amp;#039;]\n}): Promise&amp;lt;void&amp;gt; {\n  logger.setTags({ handler: &amp;#039;start&amp;#039;, environment: this.env.ENVIRONMENT })\n  try {\n    if (min_build_id &amp;lt; 0) throw new Error(&amp;#039;min_build_id cannot be negative&amp;#039;)\n    if (max_build_id &amp;lt; min_build_id) {\n      throw new Error(&amp;#039;max_build_id cannot be less than min_build_id&amp;#039;)\n    }\n    const [started_on, stopped_on] = await Promise.all([\n      this.kv.get(&amp;#039;started_on&amp;#039;),\n      this.kv.get(&amp;#039;stopped_on&amp;#039;),\n    ])\n    await match({ started_on, stopped_on })\n      .with({ started_on: P.not(null), stopped_on: P.nullish }, () =&amp;gt; {\n        throw new Error(&amp;#039;BuildErrorsAgent is already running&amp;#039;)\n      })\n      .otherwise(async () =&amp;gt; {\n        // delete all existing data and start queueing failed builds\n        await this.state.storage.deleteAlarm()\n        await this.state.storage.deleteAll()\n        this.kv.put(&amp;#039;started_on&amp;#039;, new Date())\n        this.kv.put(&amp;#039;config&amp;#039;, { min_build_id, max_build_id })\n        void this.state.storage.setAlarm(this.getNextAlarmDate())\n      })\n  } catch (e) {\n    this.sentry.captureException(e)\n    throw e\n  }\n}&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;The most important part of the implementation is the alarm that runs every second until the job is complete. Each alarm invocation has the following steps:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;&lt;p&gt;Set a new alarm (always first to ensure an error doesn’t cause it to stop).&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Retrieve state from KV.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Validate that the agent is supposed to be running:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;&lt;p&gt;Ensure the agent is supposed to be running.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Ensure we haven’t reached the max build ID set in the config.&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Finally, queue up another batch of builds by querying Postgres and sending to the BuildErrorsQueue.&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/6Ab6VC49luyio3t5QamgMD/273c77158ff4ac7af662669360d5f485/image6.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1999\&quot; height=\&quot;1666\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;\n            &lt;pre class=\&quot;language-JavaScript\&quot;&gt;&lt;code class=\&quot;language-JavaScript\&quot;&gt;async alarm(): Promise&amp;lt;void&amp;gt; {\n  logger.setTags({ handler: &amp;#039;alarm&amp;#039;, environment: this.env.ENVIRONMENT })\n  try {\n    void this.state.storage.setAlarm(Date.now() + 1000)\n    const kvState = await this.getKVState()\n    this.sentry.setContext(&amp;#039;BuildErrorsAgent&amp;#039;, kvState)\n    const ctxLogger = logger.withFields({ state: JSON.stringify(kvState) })\n\n    await match(kvState)\n      .with({ started_on: P.nullish }, async () =&amp;gt; {\n        ctxLogger.info(&amp;#039;BuildErrorsAgent is not started, cancelling alarm&amp;#039;)\n        await this.state.storage.deleteAlarm()\n      })\n      .with({ stopped_on: P.not(null) }, async () =&amp;gt; {\n        ctxLogger.info(&amp;#039;BuildErrorsAgent is stopped, cancelling alarm&amp;#039;)\n        await this.state.storage.deleteAlarm()\n      })\n      .with(\n        // we should never have started_on set without config set, but just in case\n        { started_on: P.not(null), config: P.nullish },\n        async () =&amp;gt; {\n          const msg =\n            &amp;#039;BuildErrorsAgent started but config is empty, stopping and cancelling alarm&amp;#039;\n          ctxLogger.error(msg)\n          this.sentry.captureException(new Error(msg))\n          this.kv.put(&amp;#039;stopped_on&amp;#039;, new Date())\n          await this.state.storage.deleteAlarm()\n        }\n      )\n      .when(\n        // make sure there are still builds to enqueue\n        (s) =&amp;gt;\n          s.latest_build_id !== null &amp;amp;&amp;amp;\n          s.config !== null &amp;amp;&amp;amp;\n          s.latest_build_id &amp;gt;= s.config.max_build_id,\n        async () =&amp;gt; {\n          ctxLogger.info(&amp;#039;BuildErrorsAgent job complete, cancelling alarm&amp;#039;)\n          this.kv.put(&amp;#039;stopped_on&amp;#039;, new Date())\n          await this.state.storage.deleteAlarm()\n        }\n      )\n      .with(\n        {\n          started_on: P.not(null),\n          stopped_on: P.nullish,\n          config: P.not(null),\n          latest_build_id: P.any,\n        },\n        async ({ config, latest_build_id }) =&amp;gt; {\n          // 1. select batch of ~1000 builds\n          // 2. send them to Queues 100 at a time, updating\n          //    latest_build_id after each batch is sent\n          const failedBuilds = await this.store.builds.selectFailedBuilds({\n            min_build_id: latest_build_id !== null ? latest_build_id + 1 : config.min_build_id,\n            max_build_id: config.max_build_id,\n            limit: 1000,\n          })\n          if (failedBuilds.length === 0) {\n            ctxLogger.info(`BuildErrorsAgent: ran out of builds, stopping and cancelling alarm`)\n            this.kv.put(&amp;#039;stopped_on&amp;#039;, new Date())\n            await this.state.storage.deleteAlarm()\n          }\n\n          for (\n            let i = 0;\n            i &amp;lt; BUILDS_PER_ALARM_RUN &amp;amp;&amp;amp; i &amp;lt; failedBuilds.length;\n            i += QUEUES_BATCH_SIZE\n          ) {\n            const batch = failedBuilds\n              .slice(i, QUEUES_BATCH_SIZE)\n              .map((build) =&amp;gt; ({ body: build }))\n\n            if (batch.length === 0) {\n              ctxLogger.info(`BuildErrorsAgent: ran out of builds in current batch`)\n              break\n            }\n            ctxLogger.info(\n              `BuildErrorsAgent: sending ${batch.length} builds to build errors queue`\n            )\n            await this.env.BUILD_ERRORS_QUEUE.sendBatch(batch)\n            this.kv.put(\n              &amp;#039;latest_build_id&amp;#039;,\n              Math.max(...batch.map((m) =&amp;gt; m.body.build_id).concat(latest_build_id ?? 0))\n            )\n\n            this.kv.put(\n              &amp;#039;total_builds_processed&amp;#039;,\n              ((await this.kv.get(&amp;#039;total_builds_processed&amp;#039;)) ?? 0) + batch.length\n            )\n          }\n        }\n      )\n      .otherwise(() =&amp;gt; {\n        const msg = &amp;#039;BuildErrorsAgent has nothing to do - this should never happen&amp;#039;\n        this.sentry.captureException(msg)\n        ctxLogger.info(msg)\n      })\n  } catch (e) {\n    this.sentry.captureException(e)\n    throw e\n  }\n}&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;Using pattern matching with &lt;a href=\&quot;https://github.com/gvergnaud/ts-pattern\&quot;&gt;&lt;u&gt;ts-pattern&lt;/u&gt;&lt;/a&gt; made it much easier to understand what states we were expecting and what will happen compared to procedural code. We considered using a more powerful library like &lt;a href=\&quot;https://stately.ai/docs/xstate\&quot;&gt;&lt;u&gt;XState&lt;/u&gt;&lt;/a&gt;, but decided on ts-pattern due to its simplicity.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;running-the-backfill\&quot;&gt;Running the backfill&lt;/h3&gt;\n            &lt;a href=\&quot;#running-the-backfill\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Once everything rolled out, we were able to trigger an errors backfill for over a million failed builds in a couple of hours with a single API call, categorizing 80% of failed builds on the first run. With a fast backfill process, we were able to iterate on our regex matchers to further refine our error detection and improve error grouping. Here’s what the error list looks like in our staging environment:&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/5rdNvB1SpjGpeiCOCs86Tj/74141402e67fbd9ced673a98cb3c57f6/image4.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1999\&quot; height=\&quot;537\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;fixes-and-improvements\&quot;&gt;Fixes and improvements&lt;/h2&gt;\n            &lt;a href=\&quot;#fixes-and-improvements\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;Having a better understanding of what’s going wrong has already enabled us to make several improvements:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;Wrangler now shows a&lt;a href=\&quot;https://github.com/cloudflare/workers-sdk/pull/8534\&quot;&gt; &lt;u&gt;clearer error message when no config file is found&lt;/u&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Fixed multiple edge-cases where the wrong package manager was used in TypeScript/JavaScript projects.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Added support for bun.lock (previously only checked for bun.lockb).&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Fixed several edge cases where build caching did not work in monorepos.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Projects that use a runtime.txt file to specify a Python version no longer fail.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;….and more!&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;We’re still working on fixing other bugs we’ve found, but we’re making steady progress. Reliability is a feature we’re striving for in Workers Builds, and this project has helped us make meaningful progress towards that goal. Instead of waiting for people to contact support for issues, we’re able to proactively identify and fix issues (and catch regressions more easily).&lt;/p&gt;&lt;p&gt;One of the great things about building on the Developer Platform is how easy it is to ship things. The core of this error detection pipeline (the Queue and Durable Object) &lt;b&gt;only took two days to build&lt;/b&gt;, which meant we could spend more time working on improving Workers Builds instead of spending weeks on the error detection pipeline itself.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;whats-next\&quot;&gt;What’s next?&lt;/h2&gt;\n            &lt;a href=\&quot;#whats-next\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;In addition to continuing to improve build reliability and speed, we’ve also started thinking about other ways to help developers build their applications on Workers. For example, we built a&lt;a href=\&quot;https://github.com/cloudflare/mcp-server-cloudflare/tree/main/apps/workers-builds\&quot;&gt; &lt;u&gt;Builds MCP server&lt;/u&gt;&lt;/a&gt; that allows users to debug builds directly in Cursor/Claude/etc. We’re also thinking about ways we can expose these detected issues in the Cloudflare Dashboard so that users can identify issues more easily without scrolling through hundreds of logs.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;ready-to-get-started\&quot;&gt;Ready to get started?&lt;/h2&gt;\n            &lt;a href=\&quot;#ready-to-get-started\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;Building applications on Workers has never been easier! Try deploying a Durable Object-backed &lt;a href=\&quot;https://github.com/cloudflare/templates/tree/main/durable-chat-template\&quot;&gt;&lt;u&gt;chat application&lt;/u&gt;&lt;/a&gt; with Workers Builds: &lt;/p&gt;&lt;a href=\&quot;https://deploy.workers.cloudflare.com/?url=https://github.com/cloudflare/templates/tree/main/durable-chat-template\&quot;&gt;&lt;img src=\&quot;https://deploy.workers.cloudflare.com/button\&quot; alt=\&quot;Deploy to Cloudflare\&quot;/&gt;&lt;/a&gt;&lt;p&gt;&lt;/p&gt;&quot;],&quot;published_at&quot;:[0,&quot;2025-05-29T14:00+01:00&quot;],&quot;updated_at&quot;:[0,&quot;2025-05-29T17:54:30.954Z&quot;],&quot;feature_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/5S97X9X0Cv2pBhrhD8NfTw/bef505a8d29d024f0cf4e89c7491e349/image3.png&quot;],&quot;tags&quot;:[1,[[0,{&quot;id&quot;:[0,&quot;6hbkItfupogJP3aRDAq6v8&quot;],&quot;name&quot;:[0,&quot;Cloudflare Workers&quot;],&quot;slug&quot;:[0,&quot;workers&quot;]}],[0,{&quot;id&quot;:[0,&quot;5v2UZdTRX1Rw9akmhexnxs&quot;],&quot;name&quot;:[0,&quot;Durable Objects&quot;],&quot;slug&quot;:[0,&quot;durable-objects&quot;]}],[0,{&quot;id&quot;:[0,&quot;4a93Z8FeOvcDI3HEoiIiXI&quot;],&quot;name&quot;:[0,&quot;Dogfooding&quot;],&quot;slug&quot;:[0,&quot;dogfooding&quot;]}]]],&quot;relatedTags&quot;:[0],&quot;authors&quot;:[1,[[0,{&quot;name&quot;:[0,&quot;Jacob Hands&quot;],&quot;slug&quot;:[0,&quot;jacob-hands&quot;],&quot;bio&quot;:[0,null],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1u48WVfES8uNb77aB2z9bk/9bfef685adbdef1298e57959119d5931/jacob-hands.jpeg&quot;],&quot;location&quot;:[0,null],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,&quot;@jachands&quot;],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}]]],&quot;meta_description&quot;:[0,&quot;Workers Builds, our CI/CD product for deploying Workers, monitors build issues by analyzing build failure metadata spread across over one million Durable Objects.&quot;],&quot;primary_author&quot;:[0,{}],&quot;localeList&quot;:[0,{&quot;name&quot;:[0,&quot;blog-english-only&quot;],&quot;enUS&quot;:[0,&quot;English for Locale&quot;],&quot;zhCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhHansCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhTW&quot;:[0,&quot;No Page for Locale&quot;],&quot;frFR&quot;:[0,&quot;No Page for Locale&quot;],&quot;deDE&quot;:[0,&quot;No Page for Locale&quot;],&quot;itIT&quot;:[0,&quot;No Page for Locale&quot;],&quot;jaJP&quot;:[0,&quot;No Page for Locale&quot;],&quot;koKR&quot;:[0,&quot;No Page for Locale&quot;],&quot;ptBR&quot;:[0,&quot;No Page for Locale&quot;],&quot;esLA&quot;:[0,&quot;No Page for Locale&quot;],&quot;esES&quot;:[0,&quot;No Page for Locale&quot;],&quot;enAU&quot;:[0,&quot;No Page for Locale&quot;],&quot;enCA&quot;:[0,&quot;No Page for Locale&quot;],&quot;enIN&quot;:[0,&quot;No Page for Locale&quot;],&quot;enGB&quot;:[0,&quot;No Page for Locale&quot;],&quot;idID&quot;:[0,&quot;No Page for Locale&quot;],&quot;ruRU&quot;:[0,&quot;No Page for Locale&quot;],&quot;svSE&quot;:[0,&quot;No Page for Locale&quot;],&quot;viVN&quot;:[0,&quot;No Page for Locale&quot;],&quot;plPL&quot;:[0,&quot;No Page for Locale&quot;],&quot;arAR&quot;:[0,&quot;No Page for Locale&quot;],&quot;nlNL&quot;:[0,&quot;No Page for Locale&quot;],&quot;thTH&quot;:[0,&quot;No Page for Locale&quot;],&quot;trTR&quot;:[0,&quot;No Page for Locale&quot;],&quot;heIL&quot;:[0,&quot;No Page for Locale&quot;],&quot;lvLV&quot;:[0,&quot;No Page for Locale&quot;],&quot;etEE&quot;:[0,&quot;No Page for Locale&quot;],&quot;ltLT&quot;:[0,&quot;No Page for Locale&quot;]}],&quot;url&quot;:[0,&quot;https://blog.cloudflare.com/detecting-workers-builds-errors-across-1-million-durable-durable-objects&quot;],&quot;metadata&quot;:[0,{&quot;title&quot;:[0,&quot;Let’s DO this: detecting Workers Builds errors across 1 million Durable Objects&quot;],&quot;description&quot;:[0,&quot;Workers Builds, our CI/CD product for deploying Workers, monitors build issues by analyzing build failure metadata spread across over one million Durable Objects.&quot;],&quot;imgPreview&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/GRE2R7EEIitm7wTKct6Lo/ab0c8a86937384dca8bb41fd9c07eaa0/Let%C3%A2__s_DO_this-_detecting_Workers_Builds_errors_across_1_million_Durable_Objects-OG.png&quot;]}],&quot;publicly_index&quot;:[0,true]}],&quot;translations&quot;:[0,{&quot;posts.by&quot;:[0,&quot;By&quot;],&quot;footer.gdpr&quot;:[0,&quot;GDPR&quot;],&quot;lang_blurb1&quot;:[0,&quot;This post is also available in {lang1}.&quot;],&quot;lang_blurb2&quot;:[0,&quot;This post is also available in {lang1} and {lang2}.&quot;],&quot;lang_blurb3&quot;:[0,&quot;This post is also available in {lang1}, {lang2} and {lang3}.&quot;],&quot;footer.press&quot;:[0,&quot;Press&quot;],&quot;header.title&quot;:[0,&quot;The Cloudflare Blog&quot;],&quot;search.clear&quot;:[0,&quot;Clear&quot;],&quot;search.filter&quot;:[0,&quot;Filter&quot;],&quot;search.source&quot;:[0,&quot;Source&quot;],&quot;footer.careers&quot;:[0,&quot;Careers&quot;],&quot;footer.company&quot;:[0,&quot;Company&quot;],&quot;footer.support&quot;:[0,&quot;Support&quot;],&quot;footer.the_net&quot;:[0,&quot;theNet&quot;],&quot;search.filters&quot;:[0,&quot;Filters&quot;],&quot;footer.our_team&quot;:[0,&quot;Our team&quot;],&quot;footer.webinars&quot;:[0,&quot;Webinars&quot;],&quot;page.more_posts&quot;:[0,&quot;More posts&quot;],&quot;posts.time_read&quot;:[0,&quot;{time} min read&quot;],&quot;search.language&quot;:[0,&quot;Language&quot;],&quot;footer.community&quot;:[0,&quot;Community&quot;],&quot;footer.resources&quot;:[0,&quot;Resources&quot;],&quot;footer.solutions&quot;:[0,&quot;Solutions&quot;],&quot;footer.trademark&quot;:[0,&quot;Trademark&quot;],&quot;header.subscribe&quot;:[0,&quot;Subscribe&quot;],&quot;footer.compliance&quot;:[0,&quot;Compliance&quot;],&quot;footer.free_plans&quot;:[0,&quot;Free plans&quot;],&quot;footer.impact_ESG&quot;:[0,&quot;Impact/ESG&quot;],&quot;posts.follow_on_X&quot;:[0,&quot;Follow on X&quot;],&quot;footer.help_center&quot;:[0,&quot;Help center&quot;],&quot;footer.network_map&quot;:[0,&quot;Network Map&quot;],&quot;header.please_wait&quot;:[0,&quot;Please Wait&quot;],&quot;page.related_posts&quot;:[0,&quot;Related posts&quot;],&quot;search.result_stat&quot;:[0,&quot;Results &lt;strong&gt;{search_range}&lt;/strong&gt; of &lt;strong&gt;{search_total}&lt;/strong&gt; for &lt;strong&gt;{search_keyword}&lt;/strong&gt;&quot;],&quot;footer.case_studies&quot;:[0,&quot;Case Studies&quot;],&quot;footer.connect_2024&quot;:[0,&quot;Connect 2024&quot;],&quot;footer.terms_of_use&quot;:[0,&quot;Terms of Use&quot;],&quot;footer.white_papers&quot;:[0,&quot;White Papers&quot;],&quot;footer.cloudflare_tv&quot;:[0,&quot;Cloudflare TV&quot;],&quot;footer.community_hub&quot;:[0,&quot;Community Hub&quot;],&quot;footer.compare_plans&quot;:[0,&quot;Compare plans&quot;],&quot;footer.contact_sales&quot;:[0,&quot;Contact Sales&quot;],&quot;header.contact_sales&quot;:[0,&quot;Contact Sales&quot;],&quot;header.email_address&quot;:[0,&quot;Email Address&quot;],&quot;page.error.not_found&quot;:[0,&quot;Page not found&quot;],&quot;footer.developer_docs&quot;:[0,&quot;Developer docs&quot;],&quot;footer.privacy_policy&quot;:[0,&quot;Privacy Policy&quot;],&quot;footer.request_a_demo&quot;:[0,&quot;Request a demo&quot;],&quot;page.continue_reading&quot;:[0,&quot;Continue reading&quot;],&quot;footer.analysts_report&quot;:[0,&quot;Analyst reports&quot;],&quot;footer.for_enterprises&quot;:[0,&quot;For enterprises&quot;],&quot;footer.getting_started&quot;:[0,&quot;Getting Started&quot;],&quot;footer.learning_center&quot;:[0,&quot;Learning Center&quot;],&quot;footer.project_galileo&quot;:[0,&quot;Project Galileo&quot;],&quot;pagination.newer_posts&quot;:[0,&quot;Newer Posts&quot;],&quot;pagination.older_posts&quot;:[0,&quot;Older Posts&quot;],&quot;posts.social_buttons.x&quot;:[0,&quot;Discuss on X&quot;],&quot;search.icon_aria_label&quot;:[0,&quot;Search&quot;],&quot;search.source_location&quot;:[0,&quot;Source/Location&quot;],&quot;footer.about_cloudflare&quot;:[0,&quot;About Cloudflare&quot;],&quot;footer.athenian_project&quot;:[0,&quot;Athenian Project&quot;],&quot;footer.become_a_partner&quot;:[0,&quot;Become a partner&quot;],&quot;footer.cloudflare_radar&quot;:[0,&quot;Cloudflare Radar&quot;],&quot;footer.network_services&quot;:[0,&quot;Network services&quot;],&quot;footer.trust_and_safety&quot;:[0,&quot;Trust &amp; Safety&quot;],&quot;header.get_started_free&quot;:[0,&quot;Get Started Free&quot;],&quot;page.search.placeholder&quot;:[0,&quot;Search Cloudflare&quot;],&quot;footer.cloudflare_status&quot;:[0,&quot;Cloudflare Status&quot;],&quot;footer.cookie_preference&quot;:[0,&quot;Cookie Preferences&quot;],&quot;header.valid_email_error&quot;:[0,&quot;Must be valid email.&quot;],&quot;search.result_stat_empty&quot;:[0,&quot;Results &lt;strong&gt;{search_range}&lt;/strong&gt; of &lt;strong&gt;{search_total}&lt;/strong&gt;&quot;],&quot;footer.connectivity_cloud&quot;:[0,&quot;Connectivity cloud&quot;],&quot;footer.developer_services&quot;:[0,&quot;Developer services&quot;],&quot;footer.investor_relations&quot;:[0,&quot;Investor relations&quot;],&quot;page.not_found.error_code&quot;:[0,&quot;Error Code: 404&quot;],&quot;search.autocomplete_title&quot;:[0,&quot;Insert a query. Press enter to send&quot;],&quot;footer.logos_and_press_kit&quot;:[0,&quot;Logos &amp; press kit&quot;],&quot;footer.application_services&quot;:[0,&quot;Application services&quot;],&quot;footer.get_a_recommendation&quot;:[0,&quot;Get a recommendation&quot;],&quot;posts.social_buttons.reddit&quot;:[0,&quot;Discuss on Reddit&quot;],&quot;footer.sse_and_sase_services&quot;:[0,&quot;SSE and SASE services&quot;],&quot;page.not_found.outdated_link&quot;:[0,&quot;You may have used an outdated link, or you may have typed the address incorrectly.&quot;],&quot;footer.report_security_issues&quot;:[0,&quot;Report Security Issues&quot;],&quot;page.error.error_message_page&quot;:[0,&quot;Sorry, we can&#39;t find the page you are looking for.&quot;],&quot;header.subscribe_notifications&quot;:[0,&quot;Subscribe to receive notifications of new posts:&quot;],&quot;footer.cloudflare_for_campaigns&quot;:[0,&quot;Cloudflare for Campaigns&quot;],&quot;header.subscription_confimation&quot;:[0,&quot;Subscription confirmed. Thank you for subscribing!&quot;],&quot;posts.social_buttons.hackernews&quot;:[0,&quot;Discuss on Hacker News&quot;],&quot;footer.diversity_equity_inclusion&quot;:[0,&quot;Diversity, equity &amp; inclusion&quot;],&quot;footer.critical_infrastructure_defense_project&quot;:[0,&quot;Critical Infrastructure Defense Project&quot;]}]}" ssr client="load" opts="{&quot;name&quot;:&quot;PostCard&quot;,&quot;value&quot;:true}" await-children><article class="w-50-l  mt4 mt2-l mb4 ph3 bb b--gray8 bn-l"><div class="w-100"><a href="/detecting-workers-builds-errors-across-1-million-durable-durable-objects/" class="fw5 no-underline gray1" data-testid="post-title"><h2 class="fw5 mt2">Let’s DO this: detecting Workers Builds errors across 1 million Durable Objects</h2></a><p class="f3 fw5 gray5 my" data-testid="post-date">2025-05-29</p><div class=""><a href="/tag/workers/" class="dib pl2 pr2 pt1 pb1 mb2 bg-gray8 no-underline blue3 f2 mr1" data-testid="post-tag">Cloudflare Workers</a><a href="/tag/durable-objects/" class="dib pl2 pr2 pt1 pb1 mb2 bg-gray8 no-underline blue3 f2 mr1" data-testid="post-tag">Durable Objects</a><a href="/tag/dogfooding/" class="dib pl2 pr2 pt1 pb1 mb2 bg-gray8 no-underline blue3 f2 mr1" data-testid="post-tag">Dogfooding</a></div><p class="f3 fw4 gray1 lh-copy " data-testid="post-content">Workers Builds, our CI/CD product for deploying Workers, monitors build issues by analyzing build failure metadata spread across over one million Durable Objects.<!-- -->...</p><ul class="author-lists flex pl0"><li class="list flex items-center pr2 mb3"><a href="/author/jacob-hands/" class="static-avatar pr1"><img class="author-profile-image br-100 mr2" src="https://blog.cloudflare.com/cdn-cgi/image/format=auto,dpr=3,width=64,height=64,gravity=face,fit=crop,zoom=0.5/https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1u48WVfES8uNb77aB2z9bk/9bfef685adbdef1298e57959119d5931/jacob-hands.jpeg" alt="Jacob Hands" width="62" height="62"/></a><div class="author-name-tooltip"><a href="/author/jacob-hands/" class="fw4 f3 no-underline black">Jacob Hands</a></div></li></ul></div></article><!--astro:end--></astro-island><astro-island uid="1gvO1q" prefix="r2" component-url="/_astro/PostCard.DalyEN7z.js" component-export="PostCard" renderer-url="/_astro/client.DLO1yDVm.js" props="{&quot;currentPage&quot;:[0,1],&quot;isFeaturedImageFirstPost&quot;:[0,false],&quot;post&quot;:[0,{&quot;id&quot;:[0,&quot;5BMzZem6hjKhNsSnI5l3BZ&quot;],&quot;title&quot;:[0,&quot;Bringing streamable HTTP transport and Python language support to MCP servers&quot;],&quot;slug&quot;:[0,&quot;streamable-http-mcp-servers-python&quot;],&quot;excerpt&quot;:[0,&quot;We&#39;re continuing to make it easier for developers to bring their services into the AI ecosystem with the Model Context Protocol (MCP) with two new updates.&quot;],&quot;featured&quot;:[0,false],&quot;html&quot;:[0,&quot;&lt;p&gt;We’re &lt;a href=\&quot;https://blog.cloudflare.com/building-ai-agents-with-mcp-authn-authz-and-durable-objects/\&quot;&gt;&lt;u&gt;continuing&lt;/u&gt;&lt;/a&gt; to make it easier for developers to &lt;a href=\&quot;https://blog.cloudflare.com/remote-model-context-protocol-servers-mcp/\&quot;&gt;&lt;u&gt;bring their services into the AI ecosystem&lt;/u&gt;&lt;/a&gt; with the &lt;a href=\&quot;https://www.cloudflare.com/learning/ai/what-is-model-context-protocol-mcp/\&quot;&gt;Model Context Protocol&lt;/a&gt; (MCP). Today, we’re announcing two new capabilities:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;&lt;b&gt;Streamable HTTP Transport&lt;/b&gt;: The &lt;a href=\&quot;https://agents.cloudflare.com/\&quot;&gt;&lt;u&gt;Agents SDK&lt;/u&gt;&lt;/a&gt; now supports the &lt;a href=\&quot;https://modelcontextprotocol.io/specification/2025-03-26/basic/transports#streamable-http\&quot;&gt;&lt;u&gt;new Streamable HTTP transport&lt;/u&gt;&lt;/a&gt;, allowing you to future-proof your MCP server. &lt;a href=\&quot;https://developers.cloudflare.com/agents/model-context-protocol/transport/\&quot;&gt;&lt;u&gt;Our implementation&lt;/u&gt;&lt;/a&gt; allows your MCP server to simultaneously handle both the new Streamable HTTP transport and the existing SSE transport, maintaining backward compatibility with all remote MCP clients.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;b&gt;Deploy MCP servers written in Python&lt;/b&gt;: In 2024, we &lt;a href=\&quot;https://blog.cloudflare.com/python-workers/\&quot;&gt;&lt;u&gt;introduced first-class Python language support&lt;/u&gt;&lt;/a&gt; in Cloudflare Workers, and now you can build MCP servers on Cloudflare that are entirely written in Python.&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;Click “Deploy to Cloudflare” to &lt;a href=\&quot;https://developers.cloudflare.com/agents/guides/remote-mcp-server/\&quot;&gt;&lt;u&gt;get started&lt;/u&gt;&lt;/a&gt; with a &lt;a href=\&quot;https://github.com/cloudflare/ai/tree/main/demos/remote-mcp-authless\&quot;&gt;&lt;u&gt;remote MCP server&lt;/u&gt;&lt;/a&gt; that supports the new Streamable HTTP transport method, with backwards compatibility with the SSE transport. &lt;/p&gt;&lt;a href=\&quot;https://deploy.workers.cloudflare.com/?url=https://github.com/cloudflare/ai/tree/main/demos/remote-mcp-authless\&quot;&gt;&lt;img src=\&quot;https://deploy.workers.cloudflare.com/button\&quot; alt=\&quot;Deploy to Cloudflare\&quot;/&gt;&lt;/a&gt;\n&lt;p&gt;&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;streamable-http-a-simpler-way-for-ai-agents-to-communicate-with-services-via-mcp\&quot;&gt;Streamable HTTP: A simpler way for AI agents to communicate with services via MCP&lt;/h3&gt;\n            &lt;a href=\&quot;#streamable-http-a-simpler-way-for-ai-agents-to-communicate-with-services-via-mcp\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;&lt;a href=\&quot;https://spec.modelcontextprotocol.io/specification/2025-03-26/\&quot;&gt;&lt;u&gt;The MCP spec&lt;/u&gt;&lt;/a&gt; was &lt;a href=\&quot;https://spec.modelcontextprotocol.io/specification/2025-03-26/basic/transports/\&quot;&gt;&lt;u&gt;updated&lt;/u&gt;&lt;/a&gt; on March 26 to introduce a new transport mechanism for remote MCP, called &lt;a href=\&quot;https://spec.modelcontextprotocol.io/specification/2025-03-26/basic/transports/#streamable-http\&quot;&gt;&lt;u&gt;Streamable HTTP&lt;/u&gt;&lt;/a&gt;. The new transport simplifies how &lt;a href=\&quot;https://www.cloudflare.com/learning/ai/what-is-agentic-ai/\&quot;&gt;AI agents&lt;/a&gt; can interact with services by using a single HTTP endpoint for sending and receiving responses between the client and the server, replacing the need to implement separate endpoints for initializing the connection and for sending messages. &lt;/p&gt;&lt;h4&gt;Upgrading your MCP server to use the new transport method&lt;/h4&gt;&lt;p&gt;If you&amp;#39;ve already built a remote MCP server on Cloudflare using the Cloudflare Agents SDK, then &lt;a href=\&quot;https://developers.cloudflare.com/agents/model-context-protocol/transport/\&quot;&gt;&lt;u&gt;adding support for Streamable HTTP&lt;/u&gt;&lt;/a&gt; is straightforward. The SDK has been updated to support both the existing Server-Sent Events (SSE) transport and the new Streamable HTTP transport concurrently. &lt;/p&gt;&lt;p&gt;Here&amp;#39;s how you can configure your server to handle both transports:​&lt;/p&gt;\n            &lt;pre class=\&quot;language-JavaScript\&quot;&gt;&lt;code class=\&quot;language-JavaScript\&quot;&gt;export default {\n  fetch(request: Request, env: Env, ctx: ExecutionContext) {\n    const { pathname }  = new URL(request.url);\n    if (pathname.startsWith(&amp;#039;/sse&amp;#039;)) {\n      return MyMcpAgent.serveSSE(&amp;#039;/sse&amp;#039;).fetch(request, env, ctx);\n    }\n    if (pathname.startsWith(&amp;#039;/mcp&amp;#039;)) {\n      return MyMcpAgent.serve(&amp;#039;/mcp&amp;#039;).fetch(request, env, ctx);\n    }\n  },\n};&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;Or, if you’re using Hono:&lt;/p&gt;\n            &lt;pre class=\&quot;language-JavaScript\&quot;&gt;&lt;code class=\&quot;language-JavaScript\&quot;&gt;const app = new Hono()\napp.mount(&amp;#039;/sse&amp;#039;, MyMCP.serveSSE(&amp;#039;/sse&amp;#039;).fetch, { replaceRequest: false })\napp.mount(&amp;#039;/mcp&amp;#039;, MyMCP.serve(&amp;#039;/mcp&amp;#039;).fetch, { replaceRequest: false )\nexport default app&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;Or if your MCP server implements &lt;a href=\&quot;https://developers.cloudflare.com/agents/model-context-protocol/authorization/\&quot;&gt;&lt;u&gt;authentication &amp;amp; authorization&lt;/u&gt;&lt;/a&gt; using the Workers &lt;a href=\&quot;https://github.com/cloudflare/workers-oauth-provider\&quot;&gt;&lt;u&gt;OAuth Provider Library&lt;/u&gt;&lt;/a&gt;: &lt;/p&gt;\n            &lt;pre class=\&quot;language-JavaScript\&quot;&gt;&lt;code class=\&quot;language-JavaScript\&quot;&gt;export default new OAuthProvider({\n apiHandlers: {\n   &amp;#039;/sse&amp;#039;: MyMCP.serveSSE(&amp;#039;/sse&amp;#039;),\n   &amp;#039;/mcp&amp;#039;: MyMCP.serve(&amp;#039;/mcp&amp;#039;),\n },\n // ...\n})&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;The key changes are: &lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;Use &lt;code&gt;MyMcpAgent.serveSSE(&amp;#39;/sse&amp;#39;)&lt;/code&gt; for the existing SSE transport. Previously, this would have been &lt;code&gt;MyMcpAgent.mount(&amp;#39;/sse&amp;#39;)&lt;/code&gt;, which has been kept as an alias.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Add a new path with &lt;code&gt;MyMcpAgent.serve(&amp;#39;/mcp&amp;#39;)&lt;/code&gt; to support the new Streamable HTTP transport&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;That&amp;#39;s it! With these few lines of code, your MCP server will support both transport methods, making it compatible with both existing and new clients.&lt;/p&gt;&lt;h4&gt;Using Streamable HTTP from an MCP client&lt;/h4&gt;&lt;p&gt;While most MCP clients haven’t yet adopted the new Streamable HTTP transport, you can start testing it today using&lt;a href=\&quot;https://www.npmjs.com/package/mcp-remote\&quot;&gt; mcp-remote&lt;/a&gt;, an adapter that lets MCP clients like Claude Desktop that otherwise only support local connections work with remote MCP servers. This tool allows any MCP client to connect to remote MCP servers via either SSE or Streamable HTTP, even if the client doesn&amp;#39;t natively support remote connections or the new transport method. &lt;/p&gt;&lt;h4&gt;So, what’s new with Streamable HTTP? &lt;/h4&gt;&lt;p&gt;Initially, remote MCP communication between AI agents and services used a single connection but required interactions with two different endpoints: one endpoint (&lt;code&gt;/sse&lt;/code&gt;) to establish a persistent Server-Sent Events (SSE) connection that the client keeps open for receiving responses and updates from the server, and another endpoint (&lt;code&gt;/sse/messages&lt;/code&gt;) where the client sends requests for tool calls. &lt;/p&gt;&lt;p&gt;While this works, it&amp;#39;s like having a conversation with two phones, one for listening and one for speaking. This adds complexity to the setup, makes it harder to scale, and requires connections to be kept open for long periods of time. This is because SSE operates as a persistent one-way channel where servers push updates to clients. If this connection closes prematurely, clients will miss responses or updates sent from the MCP server during long-running operations. &lt;/p&gt;&lt;p&gt;The new Streamable HTTP transport addresses these challenges by enabling: &lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;&lt;b&gt;Communication through a single endpoint: &lt;/b&gt;All MCP interactions now flow through one endpoint, eliminating the need to manage separate endpoints for requests and responses, reducing complexity.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;b&gt;Bi-directional communication: &lt;/b&gt;Servers can send notifications and requests back to clients on the same connection, enabling the server to prompt for additional information or provide real-time updates. &lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;b&gt;Automatic connection upgrades: &lt;/b&gt;Connections start as standard HTTP requests, but can dynamically upgrade to SSE (Server-Sent Events) to stream responses during long-running tasks.&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;Now, when an AI agent wants to call a tool on a remote MCP server, it can do so with a single &lt;code&gt;POST&lt;/code&gt; request to one endpoint (&lt;code&gt;/mcp&lt;/code&gt;). Depending on the tool call, the server will either respond immediately or decide to upgrade the connection to use SSE to stream responses or notifications as they become available — all over the same request.&lt;/p&gt;&lt;p&gt;Our current implementation of Streamable HTTP provides feature parity with the previous SSE transport. We&amp;#39;re actively working to implement the full capabilities defined in the specification, including &lt;a href=\&quot;https://modelcontextprotocol.io/specification/2025-03-26/basic/transports#resumability-and-redelivery\&quot;&gt;&lt;u&gt;resumability&lt;/u&gt;&lt;/a&gt;, cancellability, and &lt;a href=\&quot;https://modelcontextprotocol.io/specification/2025-03-26/basic/transports#session-management\&quot;&gt;&lt;u&gt;session management&lt;/u&gt;&lt;/a&gt; to enable more complex, reliable, and scalable agent-to-agent interactions. &lt;/p&gt;&lt;h4&gt;What’s coming next? &lt;/h4&gt;&lt;p&gt;The &lt;a href=\&quot;https://modelcontextprotocol.io/specification/2025-03-26\&quot;&gt;&lt;u&gt;MCP specification&lt;/u&gt;&lt;/a&gt; is rapidly evolving, and we&amp;#39;re committed to bringing these changes to the Agents SDK to keep your MCP server compatible with all clients. We&amp;#39;re actively tracking developments across both transport and authorization, adding support as they land, and maintaining backward compatibility to prevent breaking changes as adoption grows. Our goal is to handle the complexity behind the scenes, so you can stay focused on building great agent experiences.&lt;/p&gt;&lt;p&gt;On the transport side, here are some of the improvements coming soon to the Agents SDK:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;&lt;b&gt;Resumability:&lt;/b&gt; If a connection drops during a long-running operation, clients will be able to resume exactly where they left off without missing any responses. This eliminates the need to keep connections open continuously, making it ideal for AI agents that run for hours.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;b&gt;Cancellability&lt;/b&gt;: Clients will have explicit mechanisms to cancel operations, enabling cleaner termination of long-running processes.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;b&gt;Session management&lt;/b&gt;: We&amp;#39;re implementing secure session handling with unique session IDs that maintain state across multiple connections, helping build more sophisticated agent-to-agent communication patterns.&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;deploying-python-mcp-servers-on-cloudflare\&quot;&gt;Deploying Python MCP Servers on Cloudflare&lt;/h3&gt;\n            &lt;a href=\&quot;#deploying-python-mcp-servers-on-cloudflare\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;In 2024, we &lt;a href=\&quot;https://blog.cloudflare.com/python-workers/\&quot;&gt;&lt;u&gt;introduced Python Workers&lt;/u&gt;&lt;/a&gt;, which lets you write Cloudflare Workers entirely in Python. Now, you can use them to build and deploy remote MCP servers powered by the &lt;a href=\&quot;https://github.com/modelcontextprotocol/python-sdk\&quot;&gt;&lt;u&gt;Python MCP SDK&lt;/u&gt;&lt;/a&gt; — a library for defining tools and resources using regular Python functions.&lt;/p&gt;&lt;p&gt;You can deploy a Python MCP server to your Cloudflare account with the button below, or read the code &lt;a href=\&quot;https://github.com/cloudflare/ai/tree/main/demos/python-workers-mcp\&quot;&gt;&lt;u&gt;here&lt;/u&gt;&lt;/a&gt;. &lt;/p&gt;&lt;a href=\&quot;https://deploy.workers.cloudflare.com/?url=https://github.com/cloudflare/ai/tree/main/demos/python-workers-mcp\&quot;&gt;&lt;img src=\&quot;https://deploy.workers.cloudflare.com/button\&quot; alt=\&quot;Deploy to Cloudflare\&quot;/&gt;&lt;/a&gt;\n&lt;p&gt;&lt;/p&gt;&lt;p&gt;Here’s how you can define tools and resources in the MCP server:&lt;/p&gt;\n            &lt;pre class=\&quot;language-JavaScript\&quot;&gt;&lt;code class=\&quot;language-JavaScript\&quot;&gt;class FastMCPServer(DurableObject):\n    def __init__(self, ctx, env):\n        self.ctx = ctx\n        self.env = env\n        from mcp.server.fastmcp import FastMCP\n        self.mcp = FastMCP(&amp;quot;Demo&amp;quot;)\n\n        @mcp.tool()\n        def calculate_bmi(weight_kg: float, height_m: float) -&amp;gt; float:\n            &amp;quot;&amp;quot;&amp;quot;Calculate BMI given weight in kg and height in meters&amp;quot;&amp;quot;&amp;quot;\n            return weight_kg / (height_m**2)\n\n        @mcp.resource(&amp;quot;greeting://{name}&amp;quot;)\n        def get_greeting(name: str) -&amp;gt; str:\n            &amp;quot;&amp;quot;&amp;quot;Get a personalized greeting&amp;quot;&amp;quot;&amp;quot;\n            return f&amp;quot;Hello, {name}!&amp;quot;\n\n        self.app = mcp.sse_app()\n\n    async def call(self, request):\n        import asgi\n        return await asgi.fetch(self.app, request, self.env, self.ctx)\n\n\n\nasync def on_fetch(request, env):\n    id = env.ns.idFromName(&amp;quot;example&amp;quot;)\n    obj = env.ns.get(id)\n    return await obj.call(request)&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;If you&amp;#39;re already building APIs with&lt;a href=\&quot;https://fastapi.tiangolo.com/\&quot;&gt; &lt;u&gt;FastAPI&lt;/u&gt;&lt;/a&gt;, a popular Python package for quickly building high performance API servers, you can use &lt;a href=\&quot;https://github.com/cloudflare/ai/tree/main/packages/fastapi-mcp\&quot;&gt;&lt;u&gt;FastAPI-MCP&lt;/u&gt;&lt;/a&gt; to expose your existing endpoints as MCP tools. It handles the protocol boilerplate for you, making it easy to bring FastAPI-based services into the agent ecosystem.&lt;/p&gt;&lt;p&gt;With recent updates like &lt;a href=\&quot;https://blog.cloudflare.com/python-workers/\&quot;&gt;&lt;u&gt;support for Durable Objects&lt;/u&gt;&lt;/a&gt; and &lt;a href=\&quot;https://developers.cloudflare.com/changelog/2025-04-22-python-worker-cron-triggers/\&quot;&gt;&lt;u&gt;Cron Triggers in Python Workers&lt;/u&gt;&lt;/a&gt;, it’s now easier to run stateful logic and scheduled tasks directly in your MCP server. &lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;start-building-a-remote-mcp-server-today\&quot;&gt;Start building a remote MCP server today! &lt;/h3&gt;\n            &lt;a href=\&quot;#start-building-a-remote-mcp-server-today\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;On Cloudflare, &lt;a href=\&quot;https://developers.cloudflare.com/agents/guides/remote-mcp-server/\&quot;&gt;&lt;u&gt;you can start building today&lt;/u&gt;&lt;/a&gt;. We’re ready for you, and ready to help build with you. Email us at &lt;a href=\&quot;mailto:1800-mcp@cloudflare.com\&quot;&gt;&lt;u&gt;1800-mcp@cloudflare.com&lt;/u&gt;&lt;/a&gt;, and we’ll help get you going. There’s lots more to come with MCP, and we’re excited to see what you build.&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/77k853sJHhvZ1UQwrQWyy2/22264b8bda63bc40b6568f88ae99804c/image2.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1200\&quot; height=\&quot;267\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;&lt;/p&gt;&quot;],&quot;published_at&quot;:[0,&quot;2025-04-30T14:00+00:00&quot;],&quot;updated_at&quot;:[0,&quot;2025-06-06T20:30:54.618Z&quot;],&quot;feature_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/3uySbcr3ISTAxJH6jApKOt/5e8f724a4df5a32d2b43d0b872a8c691/image1.png&quot;],&quot;tags&quot;:[1,[[0,{&quot;id&quot;:[0,&quot;589rwGwdbZfLXEIy8OJnb7&quot;],&quot;name&quot;:[0,&quot;Phython&quot;],&quot;slug&quot;:[0,&quot;phython&quot;]}],[0,{&quot;id&quot;:[0,&quot;6Lfy7VaNvl5G8gOYMKFiux&quot;],&quot;name&quot;:[0,&quot;MCP&quot;],&quot;slug&quot;:[0,&quot;mcp&quot;]}],[0,{&quot;id&quot;:[0,&quot;6Foe3R8of95cWVnQwe5Toi&quot;],&quot;name&quot;:[0,&quot;AI&quot;],&quot;slug&quot;:[0,&quot;ai&quot;]}],[0,{&quot;id&quot;:[0,&quot;6hbkItfupogJP3aRDAq6v8&quot;],&quot;name&quot;:[0,&quot;Cloudflare Workers&quot;],&quot;slug&quot;:[0,&quot;workers&quot;]}],[0,{&quot;id&quot;:[0,&quot;5v2UZdTRX1Rw9akmhexnxs&quot;],&quot;name&quot;:[0,&quot;Durable Objects&quot;],&quot;slug&quot;:[0,&quot;durable-objects&quot;]}]]],&quot;relatedTags&quot;:[0],&quot;authors&quot;:[1,[[0,{&quot;name&quot;:[0,&quot;Jeremy Morrell&quot;],&quot;slug&quot;:[0,&quot;jeremy-morrell&quot;],&quot;bio&quot;:[0],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1bTSRmGBwGFG0vDpdtHNcf/a8485c64001d32c9b83e5168975a98bf/Jeremy_Morrell.jpg&quot;],&quot;location&quot;:[0],&quot;website&quot;:[0],&quot;twitter&quot;:[0],&quot;facebook&quot;:[0],&quot;publiclyIndex&quot;:[0,true]}],[0,{&quot;name&quot;:[0,&quot;Dan Lapid&quot;],&quot;slug&quot;:[0,&quot;dan-lapid&quot;],&quot;bio&quot;:[0],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/oBNxdamAbzN4vUeiCSLWu/e3f3bc3ce02ed15a4e5b793f62eaa7f2/Dan_Lapid.jpg&quot;],&quot;location&quot;:[0],&quot;website&quot;:[0],&quot;twitter&quot;:[0],&quot;facebook&quot;:[0],&quot;publiclyIndex&quot;:[0,true]}]]],&quot;meta_description&quot;:[0,&quot;We&#39;re continuing to make it easier for developers to bring their services into the AI ecosystem with the Model Context Protocol (MCP) with two new updates: support for the new Streamable HTTP transport in remote MCP servers and the ability to deploy Python-based MCP servers using FastAPI-MCP.&quot;],&quot;primary_author&quot;:[0,{}],&quot;localeList&quot;:[0,{&quot;name&quot;:[0,&quot;blog-english-only&quot;],&quot;enUS&quot;:[0,&quot;English for Locale&quot;],&quot;zhCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhHansCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhTW&quot;:[0,&quot;No Page for Locale&quot;],&quot;frFR&quot;:[0,&quot;No Page for Locale&quot;],&quot;deDE&quot;:[0,&quot;No Page for Locale&quot;],&quot;itIT&quot;:[0,&quot;No Page for Locale&quot;],&quot;jaJP&quot;:[0,&quot;No Page for Locale&quot;],&quot;koKR&quot;:[0,&quot;No Page for Locale&quot;],&quot;ptBR&quot;:[0,&quot;No Page for Locale&quot;],&quot;esLA&quot;:[0,&quot;No Page for Locale&quot;],&quot;esES&quot;:[0,&quot;No Page for Locale&quot;],&quot;enAU&quot;:[0,&quot;No Page for Locale&quot;],&quot;enCA&quot;:[0,&quot;No Page for Locale&quot;],&quot;enIN&quot;:[0,&quot;No Page for Locale&quot;],&quot;enGB&quot;:[0,&quot;No Page for Locale&quot;],&quot;idID&quot;:[0,&quot;No Page for Locale&quot;],&quot;ruRU&quot;:[0,&quot;No Page for Locale&quot;],&quot;svSE&quot;:[0,&quot;No Page for Locale&quot;],&quot;viVN&quot;:[0,&quot;No Page for Locale&quot;],&quot;plPL&quot;:[0,&quot;No Page for Locale&quot;],&quot;arAR&quot;:[0,&quot;No Page for Locale&quot;],&quot;nlNL&quot;:[0,&quot;No Page for Locale&quot;],&quot;thTH&quot;:[0,&quot;No Page for Locale&quot;],&quot;trTR&quot;:[0,&quot;No Page for Locale&quot;],&quot;heIL&quot;:[0,&quot;No Page for Locale&quot;],&quot;lvLV&quot;:[0,&quot;No Page for Locale&quot;],&quot;etEE&quot;:[0,&quot;No Page for Locale&quot;],&quot;ltLT&quot;:[0,&quot;No Page for Locale&quot;]}],&quot;url&quot;:[0,&quot;https://blog.cloudflare.com/streamable-http-mcp-servers-python&quot;],&quot;metadata&quot;:[0,{&quot;title&quot;:[0,&quot;Bringing streamable HTTP transport and Python language support to MCP servers  &quot;],&quot;description&quot;:[0,&quot;We&#39;re continuing to make it easier for developers to bring their services into the AI ecosystem with the Model Context Protocol (MCP) with two new updates: support for the new Streamable HTTP transport in remote MCP servers and the ability to deploy Python-based MCP servers using FastAPI-MCP.&quot;],&quot;imgPreview&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/6l1yNzthNNGgwKwid6C9mM/f2a669cd0bb75012c940d52c64d071d0/OG_Share_2024__51_.png&quot;]}],&quot;publicly_index&quot;:[0,true]}],&quot;translations&quot;:[0,{&quot;posts.by&quot;:[0,&quot;By&quot;],&quot;footer.gdpr&quot;:[0,&quot;GDPR&quot;],&quot;lang_blurb1&quot;:[0,&quot;This post is also available in {lang1}.&quot;],&quot;lang_blurb2&quot;:[0,&quot;This post is also available in {lang1} and {lang2}.&quot;],&quot;lang_blurb3&quot;:[0,&quot;This post is also available in {lang1}, {lang2} and {lang3}.&quot;],&quot;footer.press&quot;:[0,&quot;Press&quot;],&quot;header.title&quot;:[0,&quot;The Cloudflare Blog&quot;],&quot;search.clear&quot;:[0,&quot;Clear&quot;],&quot;search.filter&quot;:[0,&quot;Filter&quot;],&quot;search.source&quot;:[0,&quot;Source&quot;],&quot;footer.careers&quot;:[0,&quot;Careers&quot;],&quot;footer.company&quot;:[0,&quot;Company&quot;],&quot;footer.support&quot;:[0,&quot;Support&quot;],&quot;footer.the_net&quot;:[0,&quot;theNet&quot;],&quot;search.filters&quot;:[0,&quot;Filters&quot;],&quot;footer.our_team&quot;:[0,&quot;Our team&quot;],&quot;footer.webinars&quot;:[0,&quot;Webinars&quot;],&quot;page.more_posts&quot;:[0,&quot;More posts&quot;],&quot;posts.time_read&quot;:[0,&quot;{time} min read&quot;],&quot;search.language&quot;:[0,&quot;Language&quot;],&quot;footer.community&quot;:[0,&quot;Community&quot;],&quot;footer.resources&quot;:[0,&quot;Resources&quot;],&quot;footer.solutions&quot;:[0,&quot;Solutions&quot;],&quot;footer.trademark&quot;:[0,&quot;Trademark&quot;],&quot;header.subscribe&quot;:[0,&quot;Subscribe&quot;],&quot;footer.compliance&quot;:[0,&quot;Compliance&quot;],&quot;footer.free_plans&quot;:[0,&quot;Free plans&quot;],&quot;footer.impact_ESG&quot;:[0,&quot;Impact/ESG&quot;],&quot;posts.follow_on_X&quot;:[0,&quot;Follow on X&quot;],&quot;footer.help_center&quot;:[0,&quot;Help center&quot;],&quot;footer.network_map&quot;:[0,&quot;Network Map&quot;],&quot;header.please_wait&quot;:[0,&quot;Please Wait&quot;],&quot;page.related_posts&quot;:[0,&quot;Related posts&quot;],&quot;search.result_stat&quot;:[0,&quot;Results &lt;strong&gt;{search_range}&lt;/strong&gt; of &lt;strong&gt;{search_total}&lt;/strong&gt; for &lt;strong&gt;{search_keyword}&lt;/strong&gt;&quot;],&quot;footer.case_studies&quot;:[0,&quot;Case Studies&quot;],&quot;footer.connect_2024&quot;:[0,&quot;Connect 2024&quot;],&quot;footer.terms_of_use&quot;:[0,&quot;Terms of Use&quot;],&quot;footer.white_papers&quot;:[0,&quot;White Papers&quot;],&quot;footer.cloudflare_tv&quot;:[0,&quot;Cloudflare TV&quot;],&quot;footer.community_hub&quot;:[0,&quot;Community Hub&quot;],&quot;footer.compare_plans&quot;:[0,&quot;Compare plans&quot;],&quot;footer.contact_sales&quot;:[0,&quot;Contact Sales&quot;],&quot;header.contact_sales&quot;:[0,&quot;Contact Sales&quot;],&quot;header.email_address&quot;:[0,&quot;Email Address&quot;],&quot;page.error.not_found&quot;:[0,&quot;Page not found&quot;],&quot;footer.developer_docs&quot;:[0,&quot;Developer docs&quot;],&quot;footer.privacy_policy&quot;:[0,&quot;Privacy Policy&quot;],&quot;footer.request_a_demo&quot;:[0,&quot;Request a demo&quot;],&quot;page.continue_reading&quot;:[0,&quot;Continue reading&quot;],&quot;footer.analysts_report&quot;:[0,&quot;Analyst reports&quot;],&quot;footer.for_enterprises&quot;:[0,&quot;For enterprises&quot;],&quot;footer.getting_started&quot;:[0,&quot;Getting Started&quot;],&quot;footer.learning_center&quot;:[0,&quot;Learning Center&quot;],&quot;footer.project_galileo&quot;:[0,&quot;Project Galileo&quot;],&quot;pagination.newer_posts&quot;:[0,&quot;Newer Posts&quot;],&quot;pagination.older_posts&quot;:[0,&quot;Older Posts&quot;],&quot;posts.social_buttons.x&quot;:[0,&quot;Discuss on X&quot;],&quot;search.icon_aria_label&quot;:[0,&quot;Search&quot;],&quot;search.source_location&quot;:[0,&quot;Source/Location&quot;],&quot;footer.about_cloudflare&quot;:[0,&quot;About Cloudflare&quot;],&quot;footer.athenian_project&quot;:[0,&quot;Athenian Project&quot;],&quot;footer.become_a_partner&quot;:[0,&quot;Become a partner&quot;],&quot;footer.cloudflare_radar&quot;:[0,&quot;Cloudflare Radar&quot;],&quot;footer.network_services&quot;:[0,&quot;Network services&quot;],&quot;footer.trust_and_safety&quot;:[0,&quot;Trust &amp; Safety&quot;],&quot;header.get_started_free&quot;:[0,&quot;Get Started Free&quot;],&quot;page.search.placeholder&quot;:[0,&quot;Search Cloudflare&quot;],&quot;footer.cloudflare_status&quot;:[0,&quot;Cloudflare Status&quot;],&quot;footer.cookie_preference&quot;:[0,&quot;Cookie Preferences&quot;],&quot;header.valid_email_error&quot;:[0,&quot;Must be valid email.&quot;],&quot;search.result_stat_empty&quot;:[0,&quot;Results &lt;strong&gt;{search_range}&lt;/strong&gt; of &lt;strong&gt;{search_total}&lt;/strong&gt;&quot;],&quot;footer.connectivity_cloud&quot;:[0,&quot;Connectivity cloud&quot;],&quot;footer.developer_services&quot;:[0,&quot;Developer services&quot;],&quot;footer.investor_relations&quot;:[0,&quot;Investor relations&quot;],&quot;page.not_found.error_code&quot;:[0,&quot;Error Code: 404&quot;],&quot;search.autocomplete_title&quot;:[0,&quot;Insert a query. Press enter to send&quot;],&quot;footer.logos_and_press_kit&quot;:[0,&quot;Logos &amp; press kit&quot;],&quot;footer.application_services&quot;:[0,&quot;Application services&quot;],&quot;footer.get_a_recommendation&quot;:[0,&quot;Get a recommendation&quot;],&quot;posts.social_buttons.reddit&quot;:[0,&quot;Discuss on Reddit&quot;],&quot;footer.sse_and_sase_services&quot;:[0,&quot;SSE and SASE services&quot;],&quot;page.not_found.outdated_link&quot;:[0,&quot;You may have used an outdated link, or you may have typed the address incorrectly.&quot;],&quot;footer.report_security_issues&quot;:[0,&quot;Report Security Issues&quot;],&quot;page.error.error_message_page&quot;:[0,&quot;Sorry, we can&#39;t find the page you are looking for.&quot;],&quot;header.subscribe_notifications&quot;:[0,&quot;Subscribe to receive notifications of new posts:&quot;],&quot;footer.cloudflare_for_campaigns&quot;:[0,&quot;Cloudflare for Campaigns&quot;],&quot;header.subscription_confimation&quot;:[0,&quot;Subscription confirmed. Thank you for subscribing!&quot;],&quot;posts.social_buttons.hackernews&quot;:[0,&quot;Discuss on Hacker News&quot;],&quot;footer.diversity_equity_inclusion&quot;:[0,&quot;Diversity, equity &amp; inclusion&quot;],&quot;footer.critical_infrastructure_defense_project&quot;:[0,&quot;Critical Infrastructure Defense Project&quot;]}]}" ssr client="load" opts="{&quot;name&quot;:&quot;PostCard&quot;,&quot;value&quot;:true}" await-children><article class="w-50-l  mt4 mt2-l mb4 ph3 bb b--gray8 bn-l"><div class="w-100"><a href="/streamable-http-mcp-servers-python/" class="fw5 no-underline gray1" data-testid="post-title"><h2 class="fw5 mt2">Bringing streamable HTTP transport and Python language support to MCP servers</h2></a><p class="f3 fw5 gray5 my" data-testid="post-date">2025-04-30</p><div class=""><a href="/tag/phython/" class="dib pl2 pr2 pt1 pb1 mb2 bg-gray8 no-underline blue3 f2 mr1" data-testid="post-tag">Phython</a><a href="/tag/mcp/" class="dib pl2 pr2 pt1 pb1 mb2 bg-gray8 no-underline blue3 f2 mr1" data-testid="post-tag">MCP</a><a href="/tag/ai/" class="dib pl2 pr2 pt1 pb1 mb2 bg-gray8 no-underline blue3 f2 mr1" data-testid="post-tag">AI</a><a href="/tag/workers/" class="dib pl2 pr2 pt1 pb1 mb2 bg-gray8 no-underline blue3 f2 mr1" data-testid="post-tag">Cloudflare Workers</a><a href="/tag/durable-objects/" class="dib pl2 pr2 pt1 pb1 mb2 bg-gray8 no-underline blue3 f2 mr1" data-testid="post-tag">Durable Objects</a></div><p class="f3 fw4 gray1 lh-copy " data-testid="post-content">We&#x27;re continuing to make it easier for developers to bring their services into the AI ecosystem with the Model Context Protocol (MCP) with two new updates.<!-- -->...</p><ul class="author-lists flex pl0"><li class="list flex items-center pr2 mb3"><a href="/author/jeremy-morrell/" class="static-avatar pr1"><img class="author-profile-image br-100 mr2" src="https://blog.cloudflare.com/cdn-cgi/image/format=auto,dpr=3,width=64,height=64,gravity=face,fit=crop,zoom=0.5/https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1bTSRmGBwGFG0vDpdtHNcf/a8485c64001d32c9b83e5168975a98bf/Jeremy_Morrell.jpg" alt="Jeremy Morrell" width="62" height="62"/></a><div class="author-name-tooltip"><a href="/author/jeremy-morrell/" class="fw4 f3 no-underline black">Jeremy Morrell</a></div></li><li class="list flex items-center pr2 mb3"><a href="/author/dan-lapid/" class="static-avatar pr1"><img class="author-profile-image br-100 mr2" src="https://blog.cloudflare.com/cdn-cgi/image/format=auto,dpr=3,width=64,height=64,gravity=face,fit=crop,zoom=0.5/https://cf-assets.www.cloudflare.com/zkvhlag99gkb/oBNxdamAbzN4vUeiCSLWu/e3f3bc3ce02ed15a4e5b793f62eaa7f2/Dan_Lapid.jpg" alt="Dan Lapid" width="62" height="62"/></a><div class="author-name-tooltip"><a href="/author/dan-lapid/" class="fw4 f3 no-underline black">Dan Lapid</a></div></li></ul></div></article><!--astro:end--></astro-island><astro-island uid="ZyV6co" prefix="r3" component-url="/_astro/PostCard.DalyEN7z.js" component-export="PostCard" renderer-url="/_astro/client.DLO1yDVm.js" props="{&quot;currentPage&quot;:[0,1],&quot;isFeaturedImageFirstPost&quot;:[0,false],&quot;post&quot;:[0,{&quot;id&quot;:[0,&quot;12YmRoxQrsnW1ZVtEKBdht&quot;],&quot;title&quot;:[0,&quot;Making Super Slurper 5x faster with Workers, Durable Objects, and Queues&quot;],&quot;slug&quot;:[0,&quot;making-super-slurper-five-times-faster&quot;],&quot;excerpt&quot;:[0,&quot;We re-architected Super Slurper from the ground up using our Developer Platform — leveraging Cloudflare Workers, Durable Objects, and Queues — and improved transfer speeds by up to 5x.&quot;],&quot;featured&quot;:[0,false],&quot;html&quot;:[0,&quot;&lt;p&gt;&lt;a href=\&quot;https://developers.cloudflare.com/r2/data-migration/super-slurper/\&quot;&gt;&lt;u&gt;Super Slurper&lt;/u&gt;&lt;/a&gt; is Cloudflare’s data migration tool that is designed to make large-scale data transfers between cloud object storage providers and &lt;a href=\&quot;https://developers.cloudflare.com/r2/\&quot;&gt;&lt;u&gt;Cloudflare R2&lt;/u&gt;&lt;/a&gt; easy. Since its launch, thousands of developers have used Super Slurper to move petabytes of data from AWS S3, Google Cloud Storage, and &lt;a href=\&quot;https://developers.cloudflare.com/r2/data-migration/super-slurper/#supported-cloud-storage-providers\&quot;&gt;&lt;u&gt;other S3-compatible services&lt;/u&gt;&lt;/a&gt; to R2.&lt;/p&gt;&lt;p&gt;But we saw an opportunity to make it even faster. We rearchitected Super Slurper from the ground up using our Developer Platform — building on &lt;a href=\&quot;https://developers.cloudflare.com/workers/\&quot;&gt;&lt;u&gt;Cloudflare Workers&lt;/u&gt;&lt;/a&gt;, &lt;a href=\&quot;https://developers.cloudflare.com/durable-objects/\&quot;&gt;&lt;u&gt;Durable Objects&lt;/u&gt;&lt;/a&gt;, and &lt;a href=\&quot;https://developers.cloudflare.com/queues/\&quot;&gt;&lt;u&gt;Queues&lt;/u&gt;&lt;/a&gt; — and improved transfer speeds by up to 5x. In this post, we’ll dive into the original architecture, the performance bottlenecks we identified, how we solved them, and the real-world impact of these improvements.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;initial-architecture-and-performance-bottlenecks\&quot;&gt;Initial architecture and performance bottlenecks&lt;/h2&gt;\n            &lt;a href=\&quot;#initial-architecture-and-performance-bottlenecks\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;Super Slurper originally shared its architecture with &lt;a href=\&quot;https://developers.cloudflare.com/images/upload-images/sourcing-kit/\&quot;&gt;&lt;u&gt;SourcingKit&lt;/u&gt;&lt;/a&gt;, a tool built to bulk import images from AWS S3 into &lt;a href=\&quot;https://developers.cloudflare.com/images/\&quot;&gt;&lt;u&gt;Cloudflare Images&lt;/u&gt;&lt;/a&gt;. SourcingKit was deployed on Kubernetes and ran alongside the &lt;a href=\&quot;https://developers.cloudflare.com/images/\&quot;&gt;&lt;u&gt;Images&lt;/u&gt;&lt;/a&gt; service. When we started building Super Slurper, we split it into its own Kubernetes namespace and introduced a few new APIs to make it easier to use for the object storage use case. This setup worked well and helped thousands of developers move data to R2.&lt;/p&gt;&lt;p&gt;However, it wasn’t without its challenges. SourcingKit wasn’t designed to handle the scale required for large, petabytes-scale transfers. SourcingKit, and by extension Super Slurper, operated on Kubernetes clusters located in one of our core data centers, meaning it had to share compute resources and bandwidth with Cloudflare’s control plane, analytics, and other services. As the number of migrations grew, these resource constraints became a clear bottleneck.&lt;/p&gt;&lt;p&gt;For a service transferring data between object storage providers, the job is simple: list objects from the source, copy them to the destination, and repeat. This is exactly how the original Super Slurper worked. We listed objects from the source bucket, pushed that list to a Postgres-based queue (&lt;code&gt;pg_queue&lt;/code&gt;), and then pulled from this queue at a steady pace to copy objects over. Given the scale of object storage migrations, bandwidth usage was inevitably going to be high. This made it challenging to scale.&lt;/p&gt;&lt;p&gt;To address the bandwidth constraints operating solely in our core data center, we introduced &lt;a href=\&quot;https://developers.cloudflare.com/workers/\&quot;&gt;&lt;u&gt;Cloudflare Workers&lt;/u&gt;&lt;/a&gt; into the mix. Instead of handling the copying of data in our core data center, we started calling out to a Worker to do the actual copying:&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1EgtILMnu88y3VzUvYLlPl/479e2f99a62155f7bd8047f98a2a9cd2/1_.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1284\&quot; height=\&quot;894\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;As Super Slurper’s usage grew, so did our Kubernetes resource consumption. A significant amount of time during data transfers was spent waiting on network I/O or storage, and not actually doing compute-intensive tasks. So we didn’t need more memory or more CPU, we needed more concurrency.&lt;/p&gt;&lt;p&gt;To keep up with demand, we kept increasing the replica count. But eventually, we hit a wall. We were dealing with scalability challenges when running on the order of tens of pods when we wanted multiple orders of magnitude more.&lt;/p&gt;&lt;p&gt;We decided to rethink the entire approach from first principles, instead of leaning on the architecture we had inherited. In about a week, we built a rough proof of concept using &lt;a href=\&quot;https://developers.cloudflare.com/workers/\&quot;&gt;&lt;u&gt;Cloudflare Workers&lt;/u&gt;&lt;/a&gt;, &lt;a href=\&quot;https://developers.cloudflare.com/durable-objects/\&quot;&gt;&lt;u&gt;Durable Objects&lt;/u&gt;&lt;/a&gt;, and &lt;a href=\&quot;https://developers.cloudflare.com/queues/\&quot;&gt;&lt;u&gt;Queues&lt;/u&gt;&lt;/a&gt;. We listed objects from the source bucket, pushed them into a queue, and then consumed messages from the queue to initiate transfers. Although this sounds very similar to what we did in the original implementation, building on our Developer Platform allowed us to automatically scale an order of magnitude higher than before.&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;&lt;b&gt;Cloudflare Queues&lt;/b&gt;: Enables asynchronous object transfers and auto-scales to meet the number of objects being migrated.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;b&gt;Cloudflare Workers&lt;/b&gt;: Runs lightweight compute tasks without the overhead of Kubernetes and optimizes where in the world each part of the process runs&lt;b&gt; &lt;/b&gt;for lower latency and better performance.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;b&gt;SQLite-backed Durable Objects (DOs)&lt;/b&gt;: Acts as a fully distributed database, eliminating the limitations of a single PostgreSQL instance.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;b&gt;Hyperdrive&lt;/b&gt;: Provides fast access to historical job data from the original PostgreSQL database, keeping it as an archive store.&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;We ran a few tests and found that our proof of concept was slower than the original implementation for small transfers (a few hundred objects), but it matched and eventually exceeded the performance of the original as transfers scaled into the millions of objects. That was the signal we needed to invest the time to take our proof of concept to production.&lt;/p&gt;&lt;p&gt;We removed our proof of concept hacks, worked on stability, and found new ways to make transfers scale to even higher concurrency. After a few iterations, we landed on something we were happy with.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;new-architecture-workers-queues-and-durable-objects\&quot;&gt;New architecture: Workers, Queues, and Durable Objects&lt;/h2&gt;\n            &lt;a href=\&quot;#new-architecture-workers-queues-and-durable-objects\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;h4&gt;Processing layer: managing the flow of migration&lt;/h4&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/ieLgJoWErEYEEa90QaXLC/81470021a99486a974753301d2d2f809/2.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1999\&quot; height=\&quot;703\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;At the heart of our processing layer are &lt;b&gt;queues, consumers, and workers&lt;/b&gt;. Here’s what the process looks like:&lt;/p&gt;&lt;h4&gt;Kicking off a migration&lt;/h4&gt;&lt;p&gt;When a client triggers a migration, it starts with a request sent to our &lt;b&gt;API Worker&lt;/b&gt;. This worker takes the details of the migration, stores them in the database, and adds a message to the &lt;b&gt;List Queue&lt;/b&gt; to start the process.&lt;/p&gt;&lt;h4&gt;Listing source bucket objects&lt;/h4&gt;&lt;p&gt;The &lt;b&gt;List Queue Consumer&lt;/b&gt; is where things start to pick up. It pulls messages from the queue, retrieves object listings from the source bucket, applies any necessary filters, and stores important metadata in the database. Then, it creates new tasks by enqueuing object transfer messages into the &lt;b&gt;Transfer Queue&lt;/b&gt;.&lt;/p&gt;&lt;p&gt;We immediately queue new batches of work, maximizing concurrency. A built-in throttling mechanism prevents us from adding more messages to our queues when unexpected failures occur, such as dependent systems going down. This helps maintain stability and prevents overload during disruptions.&lt;/p&gt;&lt;h4&gt;Efficient object transfers&lt;/h4&gt;&lt;p&gt;The &lt;b&gt;Transfer Queue Consumer&lt;/b&gt; Workers pull object transfer messages from the queue, ensuring that each object is processed only once by locking the object key in the database. When the transfer finishes, the object is unlocked. For larger objects, we break them into manageable chunks and transfer them as multipart uploads.&lt;/p&gt;&lt;h4&gt;Handling failures gracefully&lt;/h4&gt;&lt;p&gt;Failures are inevitable in any distributed system, and we had to make sure we accounted for that. We implemented automatic retries for transient failures, so issues don’t interrupt the flow of the migration. But if something can’t be resolved with retries, the message goes into the &lt;b&gt;Dead Letter Queue (DLQ)&lt;/b&gt;, where it is logged for later review and resolution.&lt;/p&gt;&lt;h4&gt;Job completion &amp;amp; lifecycle management&lt;/h4&gt;&lt;p&gt;Once all the objects are listed and the transfers are in progress, the &lt;b&gt;Lifecycle Queue Consumer&lt;/b&gt; keeps an eye on everything. It monitors the ongoing transfers, ensuring that no object is left behind. When all the transfers are complete, the job is marked as finished and the migration process wraps up.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;database-layer-durable-storage-legacy-data-retrieval\&quot;&gt;Database layer: durable storage &amp;amp; legacy data retrieval&lt;/h3&gt;\n            &lt;a href=\&quot;#database-layer-durable-storage-legacy-data-retrieval\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        \n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/4OhENQndBrRkVLNmWQ4mWP/815173a64ec1943b7b626b02247d4887/3.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1999\&quot; height=\&quot;1339\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;When building our new architecture, we knew we needed a robust solution to handle massive datasets while ensuring retrieval of historical job data. That&amp;#39;s where our combination of &lt;b&gt;Durable Objects (DOs)&lt;/b&gt; and &lt;b&gt;Hyperdrive&lt;/b&gt; came in.&lt;/p&gt;&lt;h4&gt;Durable Objects&lt;/h4&gt;&lt;p&gt;We gave each account a dedicated Durable Object to track migration jobs. Each &lt;b&gt;job’s DO&lt;/b&gt; stores vital details, such as bucket names, user options, and job state. This ensured everything stayed organized and easy to manage. To support large migrations, we also added a &lt;b&gt;Batch DO&lt;/b&gt; that manages all the objects queued for transfer, storing their transfer state, object keys, and any extra metadata.&lt;/p&gt;&lt;p&gt;As migrations scaled up to &lt;b&gt;billions of objects&lt;/b&gt;, we had to get creative with storage. We implemented a sharding strategy to distribute request loads, preventing bottlenecks and working around &lt;b&gt;SQLite DO’s 10 GB&lt;/b&gt; storage limit. As objects are transferred, we clean up their details, optimizing storage space along the way. It’s surprising how much storage a billion object keys can require!&lt;/p&gt;&lt;h4&gt;Hyperdrive&lt;/h4&gt;&lt;p&gt;Since we were rebuilding a system with years of migration history, we needed a way to preserve and access every past migration detail. Hyperdrive serves as a bridge to our legacy systems, enabling seamless retrieval of historical job data from our core &lt;b&gt;PostgreSQL&lt;/b&gt; database. It&amp;#39;s not just a data retrieval mechanism, but an archive for complex migration scenarios.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;results-super-slurper-now-transfers-data-to-r2-up-to-5x-faster\&quot;&gt;Results: Super Slurper now transfers data to R2 up to 5x faster&lt;/h2&gt;\n            &lt;a href=\&quot;#results-super-slurper-now-transfers-data-to-r2-up-to-5x-faster\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;So, after all of that, did we actually achieve our goal of making transfers faster?&lt;/p&gt;&lt;p&gt;We ran a test migration of 75,000 objects from AWS S3 to R2. With the original implementation, the transfer took 15 minutes and 30 seconds. After our performance improvements, the same migration completed in just 3 minutes and 25 seconds.&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/57Pmt9tVNGYWvmRQQyvYE9/43443656bc81743485c3bb0f7d65b134/4.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1003\&quot; height=\&quot;505\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;When production migrations started using the new service in February, we saw even greater improvements in some cases, especially depending on the distribution of object sizes. Super Slurper has been around &lt;a href=\&quot;https://blog.cloudflare.com/r2-super-slurper-ga/\&quot;&gt;&lt;u&gt;for about two years&lt;/u&gt;&lt;/a&gt;. But the improved performance has led to it being able to move much more data — 35% of all objects copied by Super Slurper happened just in the last two months.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;challenges\&quot;&gt;Challenges&lt;/h2&gt;\n            &lt;a href=\&quot;#challenges\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;One of the biggest challenges we faced with the new architecture was handling duplicate messages. There were a couple of ways duplicates could occur:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;Queues provides at-least-once delivery, which means consumers may receive the same message more than once to guarantee delivery.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Failures and retries could also create apparent duplicates. For example, if a request to a Durable Object fails after the object has already been transferred, the retry could reprocess the same object.&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;If not handled correctly, this could result in the same object being transferred multiple times. To solve this, we implemented several strategies to ensure each object was accurately accounted for and only transferred once:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;&lt;p&gt;Since listing is sequential (e.g., to get object 2, you need the continuation token from listing object 1), we assign a sequence ID to each listing operation. This allows us to detect duplicate listings and prevent multiple processes from starting simultaneously. This is particularly useful because we don’t wait for database and queue operations to complete before listing the next batch. If listing 2 fails, we can retry it, and if listing 3 has already started, we can short-circuit unnecessary retries.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Each object is locked when its transfer begins, preventing parallel transfers of the same object. Once successfully transferred, the object is unlocked by deleting its key from the database. If a message for that object reappears later, we can safely assume it has already been transferred if the key no longer exists.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;We rely on database transactions to keep our counts accurate. If an object fails to unlock, its count remains unchanged. Similarly, if an object key fails to be added to the database, the count isn’t updated, and the operation will be retried later.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;As a last failsafe, we check whether the object already exists in the target bucket and was published after the start of our migration. If so, we assume it was transferred by our process (or another) and safely skip it.&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/17zkULEDjrPDlG6mNIpomw/5c95bde32595daf0684a558729ee055a/5.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1200\&quot; height=\&quot;383\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;whats-next-for-super-slurper\&quot;&gt;What’s next for Super Slurper?&lt;/h2&gt;\n            &lt;a href=\&quot;#whats-next-for-super-slurper\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;We’re always exploring ways to make Super Slurper faster, more scalable, and even easier to use — this is just the beginning.&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;We recently launched the ability to migrate from any &lt;a href=\&quot;https://developers.cloudflare.com/changelog/2025-02-24-r2-super-slurper-s3-compatible-support/\&quot;&gt;&lt;u&gt;S3 compatible storage provider&lt;/u&gt;&lt;/a&gt;!&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Data migrations are still currently limited to 3 concurrent migrations per account, but we want to increase that limit. This will allow object prefixes to be split up into separate migrations and run in parallel, drastically increasing the speed at which a bucket can be migrated. For more information on Super Slurper and how to migrate data from existing object storage to R2, refer to our &lt;a href=\&quot;https://developers.cloudflare.com/r2/data-migration/super-slurper/\&quot;&gt;&lt;u&gt;documentation&lt;/u&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;P.S. As part of this update, we made the API much simpler to interact with, so migrations can now be &lt;a href=\&quot;https://developers.cloudflare.com/api/resources/r2/subresources/super_slurper/\&quot;&gt;&lt;u&gt;managed programmatically&lt;/u&gt;&lt;/a&gt;!&lt;/p&gt;&quot;],&quot;published_at&quot;:[0,&quot;2025-04-10T14:05+00:00&quot;],&quot;updated_at&quot;:[0,&quot;2025-04-16T06:03:40.137Z&quot;],&quot;feature_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/IUEyoRTrUQ9O1wJzOyPQ3/1c1633d8685719af94afc3dd732533fa/Feature_Image.png&quot;],&quot;tags&quot;:[1,[[0,{&quot;id&quot;:[0,&quot;2xCnBweKwOI3VXdYsGVbMe&quot;],&quot;name&quot;:[0,&quot;Developer Week&quot;],&quot;slug&quot;:[0,&quot;developer-week&quot;]}],[0,{&quot;id&quot;:[0,&quot;2xIsKr1TRCFpGYI7ueMg6&quot;],&quot;name&quot;:[0,&quot;R2 Super Slurper&quot;],&quot;slug&quot;:[0,&quot;r2-super-slurper&quot;]}],[0,{&quot;id&quot;:[0,&quot;6hbkItfupogJP3aRDAq6v8&quot;],&quot;name&quot;:[0,&quot;Cloudflare Workers&quot;],&quot;slug&quot;:[0,&quot;workers&quot;]}],[0,{&quot;id&quot;:[0,&quot;5v2UZdTRX1Rw9akmhexnxs&quot;],&quot;name&quot;:[0,&quot;Durable Objects&quot;],&quot;slug&quot;:[0,&quot;durable-objects&quot;]}],[0,{&quot;id&quot;:[0,&quot;7p9V4sEnUw2qMWnn5Jzsp9&quot;],&quot;name&quot;:[0,&quot;Cloudflare Queues&quot;],&quot;slug&quot;:[0,&quot;cloudflare-queues&quot;]}],[0,{&quot;id&quot;:[0,&quot;5LsABrpgAC1MKuVeegqTvS&quot;],&quot;name&quot;:[0,&quot;Queues&quot;],&quot;slug&quot;:[0,&quot;queues&quot;]}]]],&quot;relatedTags&quot;:[0],&quot;authors&quot;:[1,[[0,{&quot;name&quot;:[0,&quot;Connor Maddox&quot;],&quot;slug&quot;:[0,&quot;connor-maddox&quot;],&quot;bio&quot;:[0],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1NvewTPZZTRZxrIvTK2MOd/af3069a3db49a6801c2deed0faa6d2d9/Connor_Maddox.jpg&quot;],&quot;location&quot;:[0],&quot;website&quot;:[0],&quot;twitter&quot;:[0],&quot;facebook&quot;:[0],&quot;publiclyIndex&quot;:[0,true]}],[0,{&quot;name&quot;:[0,&quot;Siddhant Sinha&quot;],&quot;slug&quot;:[0,&quot;siddhant&quot;],&quot;bio&quot;:[0,null],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1vq92TZAtrQDTkxRNUoh3u/896e53442514c2062d025a508205444c/siddhant.jpg&quot;],&quot;location&quot;:[0,null],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,null],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}],[0,{&quot;name&quot;:[0,&quot;Prasanna Sai Puvvada&quot;],&quot;slug&quot;:[0,&quot;prasanna-sai-puvvada&quot;],&quot;bio&quot;:[0],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1lqkLD6POrxTMq4S7WAxRk/3c77cc661e9923c01d463e6e92ad2f61/Prasanna_Sai_Puvvada.jpg&quot;],&quot;location&quot;:[0],&quot;website&quot;:[0],&quot;twitter&quot;:[0],&quot;facebook&quot;:[0],&quot;publiclyIndex&quot;:[0,true]}]]],&quot;meta_description&quot;:[0,&quot;We re-architected Super Slurper from the ground up using our Developer Platform — leveraging Cloudflare Workers, Durable Objects, and Queues — and improved transfer speeds by up to 5x.&quot;],&quot;primary_author&quot;:[0,{}],&quot;localeList&quot;:[0,{&quot;name&quot;:[0,&quot;LOC Blog (Innovation Weeks): DE, FR, JA, KO, CN, TW, ES&quot;],&quot;enUS&quot;:[0,&quot;English for Locale&quot;],&quot;zhCN&quot;:[0,&quot;Translated for Locale&quot;],&quot;zhHansCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhTW&quot;:[0,&quot;Translated for Locale&quot;],&quot;frFR&quot;:[0,&quot;Translated for Locale&quot;],&quot;deDE&quot;:[0,&quot;Translated for Locale&quot;],&quot;itIT&quot;:[0,&quot;No Page for Locale&quot;],&quot;jaJP&quot;:[0,&quot;Translated for Locale&quot;],&quot;koKR&quot;:[0,&quot;Translated for Locale&quot;],&quot;ptBR&quot;:[0,&quot;No Page for Locale&quot;],&quot;esLA&quot;:[0,&quot;No Page for Locale&quot;],&quot;esES&quot;:[0,&quot;Translated for Locale&quot;],&quot;enAU&quot;:[0,&quot;No Page for Locale&quot;],&quot;enCA&quot;:[0,&quot;No Page for Locale&quot;],&quot;enIN&quot;:[0,&quot;No Page for Locale&quot;],&quot;enGB&quot;:[0,&quot;No Page for Locale&quot;],&quot;idID&quot;:[0,&quot;No Page for Locale&quot;],&quot;ruRU&quot;:[0,&quot;No Page for Locale&quot;],&quot;svSE&quot;:[0,&quot;No Page for Locale&quot;],&quot;viVN&quot;:[0,&quot;No Page for Locale&quot;],&quot;plPL&quot;:[0,&quot;No Page for Locale&quot;],&quot;arAR&quot;:[0,&quot;No Page for Locale&quot;],&quot;nlNL&quot;:[0,&quot;No Page for Locale&quot;],&quot;thTH&quot;:[0,&quot;No Page for Locale&quot;],&quot;trTR&quot;:[0,&quot;No Page for Locale&quot;],&quot;heIL&quot;:[0,&quot;No Page for Locale&quot;],&quot;lvLV&quot;:[0,&quot;No Page for Locale&quot;],&quot;etEE&quot;:[0,&quot;No Page for Locale&quot;],&quot;ltLT&quot;:[0,&quot;No Page for Locale&quot;]}],&quot;url&quot;:[0,&quot;https://blog.cloudflare.com/making-super-slurper-five-times-faster&quot;],&quot;metadata&quot;:[0,{&quot;title&quot;:[0,&quot;Making Super Slurper 5x faster with Workers, Durable Objects, and Queues&quot;],&quot;description&quot;:[0,&quot;We re-architected Super Slurper from the ground up using our Developer Platform — leveraging Cloudflare Workers, Durable Objects, and Queues — and improved transfer speeds by up to 5x.&quot;],&quot;imgPreview&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/6DndD4zbnsrwlVNmu7qH6N/41285e2458613700ed7054045c9ab620/OG_Share_2024__37_.png&quot;]}],&quot;publicly_index&quot;:[0,true]}],&quot;translations&quot;:[0,{&quot;posts.by&quot;:[0,&quot;By&quot;],&quot;footer.gdpr&quot;:[0,&quot;GDPR&quot;],&quot;lang_blurb1&quot;:[0,&quot;This post is also available in {lang1}.&quot;],&quot;lang_blurb2&quot;:[0,&quot;This post is also available in {lang1} and {lang2}.&quot;],&quot;lang_blurb3&quot;:[0,&quot;This post is also available in {lang1}, {lang2} and {lang3}.&quot;],&quot;footer.press&quot;:[0,&quot;Press&quot;],&quot;header.title&quot;:[0,&quot;The Cloudflare Blog&quot;],&quot;search.clear&quot;:[0,&quot;Clear&quot;],&quot;search.filter&quot;:[0,&quot;Filter&quot;],&quot;search.source&quot;:[0,&quot;Source&quot;],&quot;footer.careers&quot;:[0,&quot;Careers&quot;],&quot;footer.company&quot;:[0,&quot;Company&quot;],&quot;footer.support&quot;:[0,&quot;Support&quot;],&quot;footer.the_net&quot;:[0,&quot;theNet&quot;],&quot;search.filters&quot;:[0,&quot;Filters&quot;],&quot;footer.our_team&quot;:[0,&quot;Our team&quot;],&quot;footer.webinars&quot;:[0,&quot;Webinars&quot;],&quot;page.more_posts&quot;:[0,&quot;More posts&quot;],&quot;posts.time_read&quot;:[0,&quot;{time} min read&quot;],&quot;search.language&quot;:[0,&quot;Language&quot;],&quot;footer.community&quot;:[0,&quot;Community&quot;],&quot;footer.resources&quot;:[0,&quot;Resources&quot;],&quot;footer.solutions&quot;:[0,&quot;Solutions&quot;],&quot;footer.trademark&quot;:[0,&quot;Trademark&quot;],&quot;header.subscribe&quot;:[0,&quot;Subscribe&quot;],&quot;footer.compliance&quot;:[0,&quot;Compliance&quot;],&quot;footer.free_plans&quot;:[0,&quot;Free plans&quot;],&quot;footer.impact_ESG&quot;:[0,&quot;Impact/ESG&quot;],&quot;posts.follow_on_X&quot;:[0,&quot;Follow on X&quot;],&quot;footer.help_center&quot;:[0,&quot;Help center&quot;],&quot;footer.network_map&quot;:[0,&quot;Network Map&quot;],&quot;header.please_wait&quot;:[0,&quot;Please Wait&quot;],&quot;page.related_posts&quot;:[0,&quot;Related posts&quot;],&quot;search.result_stat&quot;:[0,&quot;Results &lt;strong&gt;{search_range}&lt;/strong&gt; of &lt;strong&gt;{search_total}&lt;/strong&gt; for &lt;strong&gt;{search_keyword}&lt;/strong&gt;&quot;],&quot;footer.case_studies&quot;:[0,&quot;Case Studies&quot;],&quot;footer.connect_2024&quot;:[0,&quot;Connect 2024&quot;],&quot;footer.terms_of_use&quot;:[0,&quot;Terms of Use&quot;],&quot;footer.white_papers&quot;:[0,&quot;White Papers&quot;],&quot;footer.cloudflare_tv&quot;:[0,&quot;Cloudflare TV&quot;],&quot;footer.community_hub&quot;:[0,&quot;Community Hub&quot;],&quot;footer.compare_plans&quot;:[0,&quot;Compare plans&quot;],&quot;footer.contact_sales&quot;:[0,&quot;Contact Sales&quot;],&quot;header.contact_sales&quot;:[0,&quot;Contact Sales&quot;],&quot;header.email_address&quot;:[0,&quot;Email Address&quot;],&quot;page.error.not_found&quot;:[0,&quot;Page not found&quot;],&quot;footer.developer_docs&quot;:[0,&quot;Developer docs&quot;],&quot;footer.privacy_policy&quot;:[0,&quot;Privacy Policy&quot;],&quot;footer.request_a_demo&quot;:[0,&quot;Request a demo&quot;],&quot;page.continue_reading&quot;:[0,&quot;Continue reading&quot;],&quot;footer.analysts_report&quot;:[0,&quot;Analyst reports&quot;],&quot;footer.for_enterprises&quot;:[0,&quot;For enterprises&quot;],&quot;footer.getting_started&quot;:[0,&quot;Getting Started&quot;],&quot;footer.learning_center&quot;:[0,&quot;Learning Center&quot;],&quot;footer.project_galileo&quot;:[0,&quot;Project Galileo&quot;],&quot;pagination.newer_posts&quot;:[0,&quot;Newer Posts&quot;],&quot;pagination.older_posts&quot;:[0,&quot;Older Posts&quot;],&quot;posts.social_buttons.x&quot;:[0,&quot;Discuss on X&quot;],&quot;search.icon_aria_label&quot;:[0,&quot;Search&quot;],&quot;search.source_location&quot;:[0,&quot;Source/Location&quot;],&quot;footer.about_cloudflare&quot;:[0,&quot;About Cloudflare&quot;],&quot;footer.athenian_project&quot;:[0,&quot;Athenian Project&quot;],&quot;footer.become_a_partner&quot;:[0,&quot;Become a partner&quot;],&quot;footer.cloudflare_radar&quot;:[0,&quot;Cloudflare Radar&quot;],&quot;footer.network_services&quot;:[0,&quot;Network services&quot;],&quot;footer.trust_and_safety&quot;:[0,&quot;Trust &amp; Safety&quot;],&quot;header.get_started_free&quot;:[0,&quot;Get Started Free&quot;],&quot;page.search.placeholder&quot;:[0,&quot;Search Cloudflare&quot;],&quot;footer.cloudflare_status&quot;:[0,&quot;Cloudflare Status&quot;],&quot;footer.cookie_preference&quot;:[0,&quot;Cookie Preferences&quot;],&quot;header.valid_email_error&quot;:[0,&quot;Must be valid email.&quot;],&quot;search.result_stat_empty&quot;:[0,&quot;Results &lt;strong&gt;{search_range}&lt;/strong&gt; of &lt;strong&gt;{search_total}&lt;/strong&gt;&quot;],&quot;footer.connectivity_cloud&quot;:[0,&quot;Connectivity cloud&quot;],&quot;footer.developer_services&quot;:[0,&quot;Developer services&quot;],&quot;footer.investor_relations&quot;:[0,&quot;Investor relations&quot;],&quot;page.not_found.error_code&quot;:[0,&quot;Error Code: 404&quot;],&quot;search.autocomplete_title&quot;:[0,&quot;Insert a query. Press enter to send&quot;],&quot;footer.logos_and_press_kit&quot;:[0,&quot;Logos &amp; press kit&quot;],&quot;footer.application_services&quot;:[0,&quot;Application services&quot;],&quot;footer.get_a_recommendation&quot;:[0,&quot;Get a recommendation&quot;],&quot;posts.social_buttons.reddit&quot;:[0,&quot;Discuss on Reddit&quot;],&quot;footer.sse_and_sase_services&quot;:[0,&quot;SSE and SASE services&quot;],&quot;page.not_found.outdated_link&quot;:[0,&quot;You may have used an outdated link, or you may have typed the address incorrectly.&quot;],&quot;footer.report_security_issues&quot;:[0,&quot;Report Security Issues&quot;],&quot;page.error.error_message_page&quot;:[0,&quot;Sorry, we can&#39;t find the page you are looking for.&quot;],&quot;header.subscribe_notifications&quot;:[0,&quot;Subscribe to receive notifications of new posts:&quot;],&quot;footer.cloudflare_for_campaigns&quot;:[0,&quot;Cloudflare for Campaigns&quot;],&quot;header.subscription_confimation&quot;:[0,&quot;Subscription confirmed. Thank you for subscribing!&quot;],&quot;posts.social_buttons.hackernews&quot;:[0,&quot;Discuss on Hacker News&quot;],&quot;footer.diversity_equity_inclusion&quot;:[0,&quot;Diversity, equity &amp; inclusion&quot;],&quot;footer.critical_infrastructure_defense_project&quot;:[0,&quot;Critical Infrastructure Defense Project&quot;]}]}" ssr client="load" opts="{&quot;name&quot;:&quot;PostCard&quot;,&quot;value&quot;:true}" await-children><article class="w-50-l  mt4 mt2-l mb4 ph3 bb b--gray8 bn-l"><div class="w-100"><a href="/making-super-slurper-five-times-faster/" class="fw5 no-underline gray1" data-testid="post-title"><h2 class="fw5 mt2">Making Super Slurper 5x faster with Workers, Durable Objects, and Queues</h2></a><p class="f3 fw5 gray5 my" data-testid="post-date">2025-04-10</p><div class=""><a href="/tag/developer-week/" class="dib pl2 pr2 pt1 pb1 mb2 bg-gray8 no-underline blue3 f2 mr1" data-testid="post-tag">Developer Week</a><a href="/tag/r2-super-slurper/" class="dib pl2 pr2 pt1 pb1 mb2 bg-gray8 no-underline blue3 f2 mr1" data-testid="post-tag">R2 Super Slurper</a><a href="/tag/workers/" class="dib pl2 pr2 pt1 pb1 mb2 bg-gray8 no-underline blue3 f2 mr1" data-testid="post-tag">Cloudflare Workers</a><a href="/tag/durable-objects/" class="dib pl2 pr2 pt1 pb1 mb2 bg-gray8 no-underline blue3 f2 mr1" data-testid="post-tag">Durable Objects</a><a href="/tag/cloudflare-queues/" class="dib pl2 pr2 pt1 pb1 mb2 bg-gray8 no-underline blue3 f2 mr1" data-testid="post-tag">Cloudflare Queues</a><a href="/tag/queues/" class="dib pl2 pr2 pt1 pb1 mb2 bg-gray8 no-underline blue3 f2 mr1" data-testid="post-tag">Queues</a></div><p class="f3 fw4 gray1 lh-copy " data-testid="post-content">We re-architected Super Slurper from the ground up using our Developer Platform — leveraging Cloudflare Workers, Durable Objects, and Queues — and improved transfer speeds by up to 5x.<!-- -->...</p><ul class="author-lists flex pl0"><li class="list flex items-center pr2 mb3"><a href="/author/connor-maddox/" class="static-avatar pr1"><img class="author-profile-image br-100 mr2" src="https://blog.cloudflare.com/cdn-cgi/image/format=auto,dpr=3,width=64,height=64,gravity=face,fit=crop,zoom=0.5/https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1NvewTPZZTRZxrIvTK2MOd/af3069a3db49a6801c2deed0faa6d2d9/Connor_Maddox.jpg" alt="Connor Maddox" width="62" height="62"/></a><div class="author-name-tooltip"><a href="/author/connor-maddox/" class="fw4 f3 no-underline black">Connor Maddox</a></div></li><li class="list flex items-center pr2 mb3"><a href="/author/siddhant/" class="static-avatar pr1"><img class="author-profile-image br-100 mr2" src="https://blog.cloudflare.com/cdn-cgi/image/format=auto,dpr=3,width=64,height=64,gravity=face,fit=crop,zoom=0.5/https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1vq92TZAtrQDTkxRNUoh3u/896e53442514c2062d025a508205444c/siddhant.jpg" alt="Siddhant Sinha" width="62" height="62"/></a><div class="author-name-tooltip"><a href="/author/siddhant/" class="fw4 f3 no-underline black">Siddhant Sinha</a></div></li><li class="list flex items-center pr2 mb3"><a href="/author/prasanna-sai-puvvada/" class="static-avatar pr1"><img class="author-profile-image br-100 mr2" src="https://blog.cloudflare.com/cdn-cgi/image/format=auto,dpr=3,width=64,height=64,gravity=face,fit=crop,zoom=0.5/https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1lqkLD6POrxTMq4S7WAxRk/3c77cc661e9923c01d463e6e92ad2f61/Prasanna_Sai_Puvvada.jpg" alt="Prasanna Sai Puvvada" width="62" height="62"/></a><div class="author-name-tooltip"><a href="/author/prasanna-sai-puvvada/" class="fw4 f3 no-underline black">Prasanna Sai Puvvada</a></div></li></ul></div></article><!--astro:end--></astro-island><astro-island uid="Tbz5q" prefix="r4" component-url="/_astro/PostCard.DalyEN7z.js" component-export="PostCard" renderer-url="/_astro/client.DLO1yDVm.js" props="{&quot;currentPage&quot;:[0,1],&quot;isFeaturedImageFirstPost&quot;:[0,false],&quot;post&quot;:[0,{&quot;id&quot;:[0,&quot;4Epls86yTVhCR1tmlP4u67&quot;],&quot;title&quot;:[0,&quot;Cloudflare acquires Outerbase to expand database and agent developer experience capabilities&quot;],&quot;slug&quot;:[0,&quot;cloudflare-acquires-outerbase-database-dx&quot;],&quot;excerpt&quot;:[0,&quot;Cloudflare has acquired Outerbase, expanding our database and agent developer experience capabilities.&quot;],&quot;featured&quot;:[0,false],&quot;html&quot;:[0,&quot;&lt;p&gt;I’m thrilled to share that Cloudflare has acquired &lt;a href=\&quot;https://www.outerbase.com/\&quot;&gt;&lt;u&gt;Outerbase&lt;/u&gt;&lt;/a&gt;. This is such an amazing opportunity for us, and I want to explain how we got here, what we’ve built so far, and why we are so excited about becoming part of the Cloudflare team.&lt;/p&gt;&lt;p&gt;Databases are key to building almost any production application: you need to persist state for your users (or agents), be able to query it from a number of different clients, and you want it to be fast. But databases aren’t always easy to use: designing a good schema, writing performant queries, creating indexes, and optimizing your access patterns tends to require a lot of experience. Add that to exposing your data through easy-to-grok APIs that make the ‘right’ way to do things obvious, a great developer experience (from dashboard to CLI), and well… there’s a lot of work involved.&lt;/p&gt;&lt;p&gt;The Outerbase team is already getting to work on some big changes to how databases (and your data) are viewed, edited, and visualized from within &lt;a href=\&quot;https://developers.cloudflare.com/workers/\&quot;&gt;&lt;u&gt;Workers&lt;/u&gt;&lt;/a&gt;, and we’re excited to give you a few sneak peeks into what we’ll be landing as we get to work.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;database-dx\&quot;&gt;Database DX&lt;/h3&gt;\n            &lt;a href=\&quot;#database-dx\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;When we first started Outerbase, we saw how complicated databases could be. Even experienced developers struggled with writing queries, indexing data, and locking down their data. Meanwhile, non-developers often felt locked out and that they couldn’t access the data they needed. We believed there had to be a better way. From day one, our goal was to make data accessible to everyone, no matter their skill level. While it started out by simply building a better database interface, it quickly evolved into something much more special.&lt;/p&gt;&lt;p&gt;Outerbase became a platform that helps you manage data in a way that feels natural. You can browse tables, edit rows, and run queries without having to deal with memorizing SQL structure. Even if you do know SQL, you can use Outerbase to dive in deeper and share your knowledge with your team. We also added visualization features so entire teams, both technical and not, could see what’s happening with their data at a glance. Then, with the growth of AI, we realized we could use it to handle many of the more complicated tasks.&lt;/p&gt;&lt;p&gt;One of our more exciting offerings is Starbase, a SQLite-compatible database built on top of Cloudflare’s &lt;a href=\&quot;https://developers.cloudflare.com/durable-objects/\&quot;&gt;&lt;u&gt;Durable Objects&lt;/u&gt;&lt;/a&gt;. Our goal was never to simply wrap a legacy system in a shiny interface; we wanted to make it so easy to get started from day one with nothing, and Cloudflare’s Durable Objects gave us a way to easily manage and spin up databases for anyone who needed one. On top of them, we provided automatic REST APIs, row-level security, WebSocket support for streaming queries, and much more.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;1-1-3\&quot;&gt;1 + 1 = 3&lt;/h3&gt;\n            &lt;a href=\&quot;#1-1-3\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Our collaboration with Cloudflare first started last year, when we introduced a way for developers to import and manage their &lt;a href=\&quot;https://developers.cloudflare.com/d1/\&quot;&gt;&lt;u&gt;D1&lt;/u&gt;&lt;/a&gt; databases inside Outerbase. We were impressed with how powerful Cloudflare’s tools are for deploying and scaling applications. As we worked together, we quickly saw how well our missions aligned. Cloudflare was building the infrastructure we wished we’d had when we first started, and we were building the data experience that many Cloudflare developers were asking for. This eventually led to the seemingly obvious decision of Outerbase joining Cloudflare — it just made so much sense.&lt;/p&gt;&lt;p&gt;Going forward, we’ll integrate Outerbase’s core features into Cloudflare’s platform. If you’re a developer using D1 or Durable Objects, you’ll start seeing features from Outerbase show up in the Cloudflare dashboard. Expect to see our data explorer for browsing and editing tables, new REST APIs, query editor with type-ahead functionality, real-time data capture, and more of the other tooling we’ve been refining over the last couple of years show up inside the Cloudflare dashboard.&lt;/p&gt;&lt;p&gt;As part of this transition, the hosted Outerbase cloud will shut down on October 15, 2025, which is about six months from now. We know some of you rely on Outerbase as it stands today, so we’re leaving the open-source repositories as they are.&lt;/p&gt;&lt;p&gt;You will still be able to self-host Outerbase if you prefer, and we’ll provide guidance on how to do that within your own Cloudflare account. Our main goal will be to ensure that the best parts of Outerbase become part of the Cloudflare developer experience, so you no longer have to make a choice (it’ll be obvious!).&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;sneak-peek\&quot;&gt;Sneak peek&lt;/h3&gt;\n            &lt;a href=\&quot;#sneak-peek\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;We’ve already done a lot of thinking about how we’re going to bring the best parts of Outerbase into D1, Durable Objects, Workflows, and Agents, and we’re going to a share a little about what will be landing over the course of Q2 2025 as the Outerbase team gets to work.&lt;/p&gt;&lt;p&gt;Specifically, we’ll be heads-down focusing on:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;Adapting the powerful table viewer and query runner experiences to D1 and Durable Objects (amongst many other things!)&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Making it easier to get started with Durable Objects: improving the experience in Wrangler (our CLI tooling), the Cloudflare dashboard, and how you plug into them from your client applications&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Improvements to how you visualize the state of a Workflow and the (thousands to millions!) of Workflow instances you might have at any point in time&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Pre- and post-query hooks for D1 that allow you to automatically register handlers that can act on your data&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Bringing the &lt;a href=\&quot;https://starbasedb.com/\&quot;&gt;&lt;u&gt;Starbase&lt;/u&gt;&lt;/a&gt; API to D1, expanding D1’s existing REST API, and adding WebSockets support — making it easier to use D1, even for applications hosted outside of Workers.&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;We have already started laying the groundwork for these changes. In the coming weeks, we’ll release a unified data explorer for D1 and Durable Objects that borrows heavily from the Outerbase interface you know. &lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/FHinAqMr5I8ukmIZLln3a/a34734a3ed680556b01794c6de5e1f63/image2.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1999\&quot; height=\&quot;1191\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;&lt;i&gt;&lt;sup&gt;Bringing Outerbase’s Data Explorer into the Cloudflare Dashboard&lt;/sup&gt;&lt;/i&gt;&lt;/p&gt;&lt;p&gt;We’ll also tie some of Starbase’s features directly into Cloudflare’s platform, so you can tap into its unique offerings like pre- and post-query hooks or row-level security right from your existing D1 databases and Durable Objects:&lt;/p&gt;\n            &lt;pre class=\&quot;language-JavaScript\&quot;&gt;&lt;code class=\&quot;language-JavaScript\&quot;&gt;const beforeQuery = ({ sql, params }) =&amp;gt; {\n    // Prevent unauthorized queries\n    if (!isAllowedQuery(sql)) throw new Error(&amp;#039;Query not allowed&amp;#039;);\n};\n\nconst afterQuery = ({ sql, result }) =&amp;gt; {\n    // Basic PII masking example\n    for (const row of result) {\n        if (&amp;#039;email&amp;#039; in row) row.email = &amp;#039;[redacted]&amp;#039;;\n    }\n};\n\n// Execute the query with pre- and post- query hooks\nconst { results } = await env.DB.prepare(&amp;quot;SELECT * FROM users;&amp;quot;, beforeQuery, afterQuery);&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;&lt;i&gt;&lt;sup&gt;Define hooks on your D1 queries that can be re-used, shared and automatically executed before or after your queries run.&lt;/sup&gt;&lt;/i&gt;&lt;/p&gt;&lt;p&gt;This should give you more clarity and control over your data, as well as new ways to secure and optimize it.&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/6W2C3WRqP13ghnHYnZsJHl/fecc1a6f8e92b6cac9499716ab5d7bc4/image1.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1608\&quot; height=\&quot;970\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;&lt;sup&gt;&lt;i&gt;Rethinking the Durable Objects getting started experience&lt;/i&gt;&lt;/sup&gt;&lt;/p&gt;&lt;p&gt;We have even begun optimizing the Cloudflare dashboard experience around Durable Objects and D1 to improve the empty state, provide more Getting Started resources, and overall, make managing and tracking your database resources even easier.\n\nFor those of you who’ve supported us, given us feedback, and stuck with us as we grew: thank you. You have helped shape Outerbase into what it is today. This acquisition means we can pour even more resources and attention into building the data experience we’ve always wanted to deliver. Our hope is that, by working as part of Cloudflare, we can help reach even more developers by building intuitive experiences, accelerating the speed of innovation, and creating tools that naturally fit into your workflows.&lt;/p&gt;&lt;p&gt;This is a big step for Outerbase, and we couldn’t be more excited. Thank you for being part of our journey so far. We can’t wait to show you what we’ve got in store as we continue to make data more accessible, intuitive, and powerful — together with Cloudflare.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;whats-next\&quot;&gt;What’s next?&lt;/h3&gt;\n            &lt;a href=\&quot;#whats-next\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;We’re planning to get to work on some of the big changes to how you interact with your data on Cloudflare, starting with D1 and Durable Objects.&lt;/p&gt;&lt;p&gt;We’ll also be ensuring we bring a great developer experience to the broader database &amp;amp; storage platform on Cloudflare, including how you access data in &lt;a href=\&quot;https://developers.cloudflare.com/kv/\&quot;&gt;&lt;u&gt;Workers KV&lt;/u&gt;&lt;/a&gt;, &lt;a href=\&quot;https://developers.cloudflare.com/r2/\&quot;&gt;&lt;u&gt;R2&lt;/u&gt;&lt;/a&gt;, &lt;a href=\&quot;https://developers.cloudflare.com/workflows/\&quot;&gt;&lt;u&gt;Workflows&lt;/u&gt;&lt;/a&gt; and even your &lt;a href=\&quot;https://developers.cloudflare.com/agents/\&quot;&gt;&lt;u&gt;AI Agents&lt;/u&gt;&lt;/a&gt; (just to name a few).&lt;/p&gt;&lt;p&gt;To keep up, follow the new &lt;a href=\&quot;https://developers.cloudflare.com/changelog/\&quot;&gt;&lt;u&gt;Cloudflare Changelog&lt;/u&gt;&lt;/a&gt; and join our &lt;a href=\&quot;http://discord.cloudflare.com/\&quot;&gt;&lt;u&gt;Developer Discord&lt;/u&gt;&lt;/a&gt; to chat with the team and see early previews before they land.&lt;/p&gt;&quot;],&quot;published_at&quot;:[0,&quot;2025-04-07T14:00+00:00&quot;],&quot;updated_at&quot;:[0,&quot;2025-04-10T08:46:36.901Z&quot;],&quot;feature_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/5MvFdMXLBUAHvXJjVcSSJJ/f956f874b1e62e667b3f2457c68b1762/image3.png&quot;],&quot;tags&quot;:[1,[[0,{&quot;id&quot;:[0,&quot;2xCnBweKwOI3VXdYsGVbMe&quot;],&quot;name&quot;:[0,&quot;Developer Week&quot;],&quot;slug&quot;:[0,&quot;developer-week&quot;]}],[0,{&quot;id&quot;:[0,&quot;UKt2GEAUQsbObsNqZ3Pr7&quot;],&quot;name&quot;:[0,&quot;D1&quot;],&quot;slug&quot;:[0,&quot;d1&quot;]}],[0,{&quot;id&quot;:[0,&quot;5v2UZdTRX1Rw9akmhexnxs&quot;],&quot;name&quot;:[0,&quot;Durable Objects&quot;],&quot;slug&quot;:[0,&quot;durable-objects&quot;]}],[0,{&quot;id&quot;:[0,&quot;3JAY3z7p7An94s6ScuSQPf&quot;],&quot;name&quot;:[0,&quot;Developer Platform&quot;],&quot;slug&quot;:[0,&quot;developer-platform&quot;]}],[0,{&quot;id&quot;:[0,&quot;6hbkItfupogJP3aRDAq6v8&quot;],&quot;name&quot;:[0,&quot;Cloudflare Workers&quot;],&quot;slug&quot;:[0,&quot;workers&quot;]}]]],&quot;relatedTags&quot;:[0],&quot;authors&quot;:[1,[[0,{&quot;name&quot;:[0,&quot;Brandon Strittmatter&quot;],&quot;slug&quot;:[0,&quot;brandon-strittmatter&quot;],&quot;bio&quot;:[0],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/3viCDHdRdgbirjk7W1OqS5/10437b1d8ddeadc34fee3796dbfefa7e/Brandon_Strittmatter.webp&quot;],&quot;location&quot;:[0],&quot;website&quot;:[0],&quot;twitter&quot;:[0],&quot;facebook&quot;:[0],&quot;publiclyIndex&quot;:[0,true]}],[0,{&quot;name&quot;:[0,&quot;Matt Silverlock&quot;],&quot;slug&quot;:[0,&quot;silverlock&quot;],&quot;bio&quot;:[0,&quot;Director of Product at Cloudflare.&quot;],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/7xP5qePZD9eyVtwIesXYxh/e714aaa573161ec9eb48d59bd1aa6225/silverlock.jpeg&quot;],&quot;location&quot;:[0,null],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,&quot;@elithrar&quot;],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}]]],&quot;meta_description&quot;:[0,&quot;Cloudflare has acquired Outerbase, expanding our database and agent developer experience capabilities.&quot;],&quot;primary_author&quot;:[0,{}],&quot;localeList&quot;:[0,{&quot;name&quot;:[0,&quot;Blog Locale (Press Release): DE, FR, JA, KO, ESLA, NL, CN, TW&quot;],&quot;enUS&quot;:[0,&quot;English for Locale&quot;],&quot;zhCN&quot;:[0,&quot;Translated for Locale&quot;],&quot;zhHansCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhTW&quot;:[0,&quot;Translated for Locale&quot;],&quot;frFR&quot;:[0,&quot;Translated for Locale&quot;],&quot;deDE&quot;:[0,&quot;Translated for Locale&quot;],&quot;itIT&quot;:[0,&quot;No Page for Locale&quot;],&quot;jaJP&quot;:[0,&quot;Translated for Locale&quot;],&quot;koKR&quot;:[0,&quot;Translated for Locale&quot;],&quot;ptBR&quot;:[0,&quot;No Page for Locale&quot;],&quot;esLA&quot;:[0,&quot;Translated for Locale&quot;],&quot;esES&quot;:[0,&quot;No Page for Locale&quot;],&quot;enAU&quot;:[0,&quot;No Page for Locale&quot;],&quot;enCA&quot;:[0,&quot;No Page for Locale&quot;],&quot;enIN&quot;:[0,&quot;No Page for Locale&quot;],&quot;enGB&quot;:[0,&quot;No Page for Locale&quot;],&quot;idID&quot;:[0,&quot;No Page for Locale&quot;],&quot;ruRU&quot;:[0,&quot;No Page for Locale&quot;],&quot;svSE&quot;:[0,&quot;No Page for Locale&quot;],&quot;viVN&quot;:[0,&quot;No Page for Locale&quot;],&quot;plPL&quot;:[0,&quot;No Page for Locale&quot;],&quot;arAR&quot;:[0,&quot;No Page for Locale&quot;],&quot;nlNL&quot;:[0,&quot;Translated for Locale&quot;],&quot;thTH&quot;:[0,&quot;No Page for Locale&quot;],&quot;trTR&quot;:[0,&quot;No Page for Locale&quot;],&quot;heIL&quot;:[0,&quot;No Page for Locale&quot;],&quot;lvLV&quot;:[0,&quot;No Page for Locale&quot;],&quot;etEE&quot;:[0,&quot;No Page for Locale&quot;],&quot;ltLT&quot;:[0,&quot;No Page for Locale&quot;]}],&quot;url&quot;:[0,&quot;https://blog.cloudflare.com/cloudflare-acquires-outerbase-database-dx&quot;],&quot;metadata&quot;:[0,{&quot;title&quot;:[0,&quot;Cloudflare acquires Outerbase to expand database and agent developer experience capabilities&quot;],&quot;description&quot;:[0,&quot;Cloudflare has acquired Outerbase, expanding our database and agent developer experience capabilities.&quot;],&quot;imgPreview&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/5MvFdMXLBUAHvXJjVcSSJJ/f956f874b1e62e667b3f2457c68b1762/image3.png&quot;]}],&quot;publicly_index&quot;:[0,true]}],&quot;translations&quot;:[0,{&quot;posts.by&quot;:[0,&quot;By&quot;],&quot;footer.gdpr&quot;:[0,&quot;GDPR&quot;],&quot;lang_blurb1&quot;:[0,&quot;This post is also available in {lang1}.&quot;],&quot;lang_blurb2&quot;:[0,&quot;This post is also available in {lang1} and {lang2}.&quot;],&quot;lang_blurb3&quot;:[0,&quot;This post is also available in {lang1}, {lang2} and {lang3}.&quot;],&quot;footer.press&quot;:[0,&quot;Press&quot;],&quot;header.title&quot;:[0,&quot;The Cloudflare Blog&quot;],&quot;search.clear&quot;:[0,&quot;Clear&quot;],&quot;search.filter&quot;:[0,&quot;Filter&quot;],&quot;search.source&quot;:[0,&quot;Source&quot;],&quot;footer.careers&quot;:[0,&quot;Careers&quot;],&quot;footer.company&quot;:[0,&quot;Company&quot;],&quot;footer.support&quot;:[0,&quot;Support&quot;],&quot;footer.the_net&quot;:[0,&quot;theNet&quot;],&quot;search.filters&quot;:[0,&quot;Filters&quot;],&quot;footer.our_team&quot;:[0,&quot;Our team&quot;],&quot;footer.webinars&quot;:[0,&quot;Webinars&quot;],&quot;page.more_posts&quot;:[0,&quot;More posts&quot;],&quot;posts.time_read&quot;:[0,&quot;{time} min read&quot;],&quot;search.language&quot;:[0,&quot;Language&quot;],&quot;footer.community&quot;:[0,&quot;Community&quot;],&quot;footer.resources&quot;:[0,&quot;Resources&quot;],&quot;footer.solutions&quot;:[0,&quot;Solutions&quot;],&quot;footer.trademark&quot;:[0,&quot;Trademark&quot;],&quot;header.subscribe&quot;:[0,&quot;Subscribe&quot;],&quot;footer.compliance&quot;:[0,&quot;Compliance&quot;],&quot;footer.free_plans&quot;:[0,&quot;Free plans&quot;],&quot;footer.impact_ESG&quot;:[0,&quot;Impact/ESG&quot;],&quot;posts.follow_on_X&quot;:[0,&quot;Follow on X&quot;],&quot;footer.help_center&quot;:[0,&quot;Help center&quot;],&quot;footer.network_map&quot;:[0,&quot;Network Map&quot;],&quot;header.please_wait&quot;:[0,&quot;Please Wait&quot;],&quot;page.related_posts&quot;:[0,&quot;Related posts&quot;],&quot;search.result_stat&quot;:[0,&quot;Results &lt;strong&gt;{search_range}&lt;/strong&gt; of &lt;strong&gt;{search_total}&lt;/strong&gt; for &lt;strong&gt;{search_keyword}&lt;/strong&gt;&quot;],&quot;footer.case_studies&quot;:[0,&quot;Case Studies&quot;],&quot;footer.connect_2024&quot;:[0,&quot;Connect 2024&quot;],&quot;footer.terms_of_use&quot;:[0,&quot;Terms of Use&quot;],&quot;footer.white_papers&quot;:[0,&quot;White Papers&quot;],&quot;footer.cloudflare_tv&quot;:[0,&quot;Cloudflare TV&quot;],&quot;footer.community_hub&quot;:[0,&quot;Community Hub&quot;],&quot;footer.compare_plans&quot;:[0,&quot;Compare plans&quot;],&quot;footer.contact_sales&quot;:[0,&quot;Contact Sales&quot;],&quot;header.contact_sales&quot;:[0,&quot;Contact Sales&quot;],&quot;header.email_address&quot;:[0,&quot;Email Address&quot;],&quot;page.error.not_found&quot;:[0,&quot;Page not found&quot;],&quot;footer.developer_docs&quot;:[0,&quot;Developer docs&quot;],&quot;footer.privacy_policy&quot;:[0,&quot;Privacy Policy&quot;],&quot;footer.request_a_demo&quot;:[0,&quot;Request a demo&quot;],&quot;page.continue_reading&quot;:[0,&quot;Continue reading&quot;],&quot;footer.analysts_report&quot;:[0,&quot;Analyst reports&quot;],&quot;footer.for_enterprises&quot;:[0,&quot;For enterprises&quot;],&quot;footer.getting_started&quot;:[0,&quot;Getting Started&quot;],&quot;footer.learning_center&quot;:[0,&quot;Learning Center&quot;],&quot;footer.project_galileo&quot;:[0,&quot;Project Galileo&quot;],&quot;pagination.newer_posts&quot;:[0,&quot;Newer Posts&quot;],&quot;pagination.older_posts&quot;:[0,&quot;Older Posts&quot;],&quot;posts.social_buttons.x&quot;:[0,&quot;Discuss on X&quot;],&quot;search.icon_aria_label&quot;:[0,&quot;Search&quot;],&quot;search.source_location&quot;:[0,&quot;Source/Location&quot;],&quot;footer.about_cloudflare&quot;:[0,&quot;About Cloudflare&quot;],&quot;footer.athenian_project&quot;:[0,&quot;Athenian Project&quot;],&quot;footer.become_a_partner&quot;:[0,&quot;Become a partner&quot;],&quot;footer.cloudflare_radar&quot;:[0,&quot;Cloudflare Radar&quot;],&quot;footer.network_services&quot;:[0,&quot;Network services&quot;],&quot;footer.trust_and_safety&quot;:[0,&quot;Trust &amp; Safety&quot;],&quot;header.get_started_free&quot;:[0,&quot;Get Started Free&quot;],&quot;page.search.placeholder&quot;:[0,&quot;Search Cloudflare&quot;],&quot;footer.cloudflare_status&quot;:[0,&quot;Cloudflare Status&quot;],&quot;footer.cookie_preference&quot;:[0,&quot;Cookie Preferences&quot;],&quot;header.valid_email_error&quot;:[0,&quot;Must be valid email.&quot;],&quot;search.result_stat_empty&quot;:[0,&quot;Results &lt;strong&gt;{search_range}&lt;/strong&gt; of &lt;strong&gt;{search_total}&lt;/strong&gt;&quot;],&quot;footer.connectivity_cloud&quot;:[0,&quot;Connectivity cloud&quot;],&quot;footer.developer_services&quot;:[0,&quot;Developer services&quot;],&quot;footer.investor_relations&quot;:[0,&quot;Investor relations&quot;],&quot;page.not_found.error_code&quot;:[0,&quot;Error Code: 404&quot;],&quot;search.autocomplete_title&quot;:[0,&quot;Insert a query. Press enter to send&quot;],&quot;footer.logos_and_press_kit&quot;:[0,&quot;Logos &amp; press kit&quot;],&quot;footer.application_services&quot;:[0,&quot;Application services&quot;],&quot;footer.get_a_recommendation&quot;:[0,&quot;Get a recommendation&quot;],&quot;posts.social_buttons.reddit&quot;:[0,&quot;Discuss on Reddit&quot;],&quot;footer.sse_and_sase_services&quot;:[0,&quot;SSE and SASE services&quot;],&quot;page.not_found.outdated_link&quot;:[0,&quot;You may have used an outdated link, or you may have typed the address incorrectly.&quot;],&quot;footer.report_security_issues&quot;:[0,&quot;Report Security Issues&quot;],&quot;page.error.error_message_page&quot;:[0,&quot;Sorry, we can&#39;t find the page you are looking for.&quot;],&quot;header.subscribe_notifications&quot;:[0,&quot;Subscribe to receive notifications of new posts:&quot;],&quot;footer.cloudflare_for_campaigns&quot;:[0,&quot;Cloudflare for Campaigns&quot;],&quot;header.subscription_confimation&quot;:[0,&quot;Subscription confirmed. Thank you for subscribing!&quot;],&quot;posts.social_buttons.hackernews&quot;:[0,&quot;Discuss on Hacker News&quot;],&quot;footer.diversity_equity_inclusion&quot;:[0,&quot;Diversity, equity &amp; inclusion&quot;],&quot;footer.critical_infrastructure_defense_project&quot;:[0,&quot;Critical Infrastructure Defense Project&quot;]}]}" ssr client="load" opts="{&quot;name&quot;:&quot;PostCard&quot;,&quot;value&quot;:true}" await-children><article class="w-50-l  mt4 mt2-l mb4 ph3 bb b--gray8 bn-l"><div class="w-100"><a href="/cloudflare-acquires-outerbase-database-dx/" class="fw5 no-underline gray1" data-testid="post-title"><h2 class="fw5 mt2">Cloudflare acquires Outerbase to expand database and agent developer experience capabilities</h2></a><p class="f3 fw5 gray5 my" data-testid="post-date">2025-04-07</p><div class=""><a href="/tag/developer-week/" class="dib pl2 pr2 pt1 pb1 mb2 bg-gray8 no-underline blue3 f2 mr1" data-testid="post-tag">Developer Week</a><a href="/tag/d1/" class="dib pl2 pr2 pt1 pb1 mb2 bg-gray8 no-underline blue3 f2 mr1" data-testid="post-tag">D1</a><a href="/tag/durable-objects/" class="dib pl2 pr2 pt1 pb1 mb2 bg-gray8 no-underline blue3 f2 mr1" data-testid="post-tag">Durable Objects</a><a href="/tag/developer-platform/" class="dib pl2 pr2 pt1 pb1 mb2 bg-gray8 no-underline blue3 f2 mr1" data-testid="post-tag">Developer Platform</a><a href="/tag/workers/" class="dib pl2 pr2 pt1 pb1 mb2 bg-gray8 no-underline blue3 f2 mr1" data-testid="post-tag">Cloudflare Workers</a></div><p class="f3 fw4 gray1 lh-copy " data-testid="post-content">Cloudflare has acquired Outerbase, expanding our database and agent developer experience capabilities.<!-- -->...</p><ul class="author-lists flex pl0"><li class="list flex items-center pr2 mb3"><a href="/author/brandon-strittmatter/" class="static-avatar pr1"><img class="author-profile-image br-100 mr2" src="https://blog.cloudflare.com/cdn-cgi/image/format=auto,dpr=3,width=64,height=64,gravity=face,fit=crop,zoom=0.5/https://cf-assets.www.cloudflare.com/zkvhlag99gkb/3viCDHdRdgbirjk7W1OqS5/10437b1d8ddeadc34fee3796dbfefa7e/Brandon_Strittmatter.webp" alt="Brandon Strittmatter" width="62" height="62"/></a><div class="author-name-tooltip"><a href="/author/brandon-strittmatter/" class="fw4 f3 no-underline black">Brandon Strittmatter</a></div></li><li class="list flex items-center pr2 mb3"><a href="/author/silverlock/" class="static-avatar pr1"><img class="author-profile-image br-100 mr2" src="https://blog.cloudflare.com/cdn-cgi/image/format=auto,dpr=3,width=64,height=64,gravity=face,fit=crop,zoom=0.5/https://cf-assets.www.cloudflare.com/zkvhlag99gkb/7xP5qePZD9eyVtwIesXYxh/e714aaa573161ec9eb48d59bd1aa6225/silverlock.jpeg" alt="Matt Silverlock" width="62" height="62"/></a><div class="author-name-tooltip"><a href="/author/silverlock/" class="fw4 f3 no-underline black">Matt Silverlock</a></div></li></ul></div></article><!--astro:end--></astro-island> <astro-island uid="1SgbFq" prefix="r5" component-url="/_astro/MorePosts.DyRVOquy.js" component-export="default" renderer-url="/_astro/client.DLO1yDVm.js" props="{&quot;locale&quot;:[0,&quot;en-us&quot;],&quot;posts&quot;:[1,[[0,{&quot;id&quot;:[0,&quot;1k3ytqqRxQ9SsiYLMSBDfO&quot;],&quot;title&quot;:[0,&quot;Making Cloudflare the best platform for building AI Agents&quot;],&quot;slug&quot;:[0,&quot;build-ai-agents-on-cloudflare&quot;],&quot;excerpt&quot;:[0,&quot;Today we’re excited to share a few announcements on how we’re making it even easier to build AI agents on Cloudflare.&quot;],&quot;featured&quot;:[0,false],&quot;html&quot;:[0,&quot;&lt;p&gt;As engineers, we’re obsessed with efficiency and automating anything we find ourselves doing more than twice. If you’ve ever done this, you know that the happy path is always easy, but the second the inputs get complex, automation becomes really hard. This is because computers have traditionally required extremely specific instructions in order to execute.&lt;/p&gt;&lt;p&gt;The state of AI models available to us today has changed that. We now have access to computers that can reason, and make judgement calls in lieu of specifying every edge case under the sun.&lt;/p&gt;&lt;p&gt;That’s what &lt;a href=\&quot;https://www.cloudflare.com/learning/ai/what-is-agentic-ai/\&quot;&gt;AI agents&lt;/a&gt; are all about.&lt;/p&gt;&lt;p&gt;Today we’re excited to share a few announcements on how we’re making it &lt;i&gt;even&lt;/i&gt; &lt;i&gt;easier&lt;/i&gt; to build AI agents on Cloudflare, including:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;&lt;code&gt;agents-sdk&lt;/code&gt; — a new JavaScript framework for building AI agents&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Updates to Workers AI: structured outputs, tool calling, and longer context windows for &lt;a href=\&quot;https://developers.cloudflare.com/workers-ai/\&quot;&gt;&lt;u&gt;Workers AI&lt;/u&gt;&lt;/a&gt;, Cloudflare’s serverless inference engine&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;An update to the &lt;a href=\&quot;https://github.com/cloudflare/workers-ai-provider\&quot;&gt;&lt;u&gt;workers-ai-provider&lt;/u&gt;&lt;/a&gt; for the AI SDK&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;We truly believe that Cloudflare is the ideal platform for building Agents and AI applications (more on why below), and we’re constantly working to make it better — you can expect to see more announcements from us in this space in the future.&lt;/p&gt;&lt;p&gt;Before we dive deep into the announcements, we wanted to give you a quick primer on agents. If you are familiar with agents, feel free to skip ahead. &lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;what-are-agents\&quot;&gt;What are agents?&lt;/h2&gt;\n            &lt;a href=\&quot;#what-are-agents\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;Agents are AI systems that can autonomously execute tasks by making decisions about tool usage and process flow. Unlike traditional automation that follows predefined paths, agents can dynamically adapt their approach based on context and intermediate results. Agents are also distinct from co-pilots (e.g. traditional chat applications) in that they can fully automate a task, as opposed to simply augmenting and extending human input.&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;Agents → non-linear, non-deterministic (can change from run to run)&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Workflows → linear, deterministic execution paths&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Co-pilots → augmentative AI assistance requiring human intervention&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;example-booking-vacations\&quot;&gt;Example: booking vacations&lt;/h3&gt;\n            &lt;a href=\&quot;#example-booking-vacations\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;If this is your first time working with, or interacting with agents, this example will illustrate how an agent works within a context like booking a vacation.&lt;/p&gt;&lt;p&gt;Imagine you&amp;#39;re trying to book a vacation. You need to research flights, find hotels, check restaurant reviews, and keep track of your budget.&lt;/p&gt;&lt;p&gt;&lt;b&gt;Traditional workflow automation&lt;/b&gt;&lt;/p&gt;&lt;p&gt;A traditional automation system follows a predetermined sequence: it can take inputs such as dates, location, and budget, and make calls to predefined APIs in a fixed order. However, if any unexpected situations arise, such as flights being sold out, or the specified hotels being unavailable, it cannot adapt. &lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/7fHwj0r4JgRDawOQnNN618/2f369a5224dee288d3baf656d5952469/image1.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1322\&quot; height=\&quot;318\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;&lt;b&gt;AI co-pilot&lt;/b&gt;&lt;/p&gt;&lt;p&gt;A co-pilot acts as an intelligent assistant that can provide hotel and itinerary recommendations based on your preferences. If you have questions, it can understand and respond to natural language queries and offer guidance and suggestions. However, it is unable to take the next steps to execute the end-to-end action on its own. &lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/24e3EQSLKo3CJsKv0gFban/6a23620857c6bca8a873da185ee5be56/image2.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1048\&quot; height=\&quot;314\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;&lt;b&gt;Agent&lt;/b&gt;&lt;/p&gt;&lt;p&gt;An agent combines AI&amp;#39;s ability to make judgements and call the relevant tools to execute the task. An agent&amp;#39;s output will be nondeterministic given: real-time availability and pricing changes, dynamic prioritization of constraints, ability to recover from failures, and adaptive decision-making based on intermediate results. In other words, if flights or hotels are unavailable, an agent can reassess and suggest a new itinerary with altered dates or locations, and continue executing your travel booking.&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/30QFnfkVyFm1tyV9B2QvXU/ac79ff6ac70ba609d4ecf714d34f0146/image3.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1056\&quot; height=\&quot;708\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;agents-sdk-the-framework-for-building-agents\&quot;&gt;agents-sdk — the framework for building agents&lt;/h2&gt;\n            &lt;a href=\&quot;#agents-sdk-the-framework-for-building-agents\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;You can now add agent powers to any existing Workers project with just one command:&lt;/p&gt;\n            &lt;pre class=\&quot;language-Rust\&quot;&gt;&lt;code class=\&quot;language-Rust\&quot;&gt;$ npm i agents-sdk&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;… or if you want to build something from scratch, you can bootstrap your project with the &lt;a href=\&quot;https://github.com/cloudflare/agents-starter\&quot;&gt;&lt;u&gt;agents-starter template&lt;/u&gt;&lt;/a&gt;:&lt;/p&gt;\n            &lt;pre class=\&quot;language-Rust\&quot;&gt;&lt;code class=\&quot;language-Rust\&quot;&gt;$ npm create cloudflare@latest -- --template cloudflare/agents-starter\n// ... and then deploy it\n$ npm run deploy&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;&lt;code&gt;agents-sdk&lt;/code&gt; is a framework that allows you to build agents —  software that can autonomously execute tasks — and deploy them directly into production on Cloudflare Workers.&lt;/p&gt;&lt;p&gt;Your agent can start with the basics and act on HTTP requests…&lt;/p&gt;\n            &lt;pre class=\&quot;language-JavaScript\&quot;&gt;&lt;code class=\&quot;language-JavaScript\&quot;&gt;import { Agent } from &amp;quot;agents-sdk&amp;quot;;\n\nexport class IntelligentAgent extends Agent {\n  async onRequest(request) {\n    // Transform intention into response\n    return new Response(&amp;quot;Ready to assist.&amp;quot;);\n  }\n}&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;Although this is just the initial release of &lt;code&gt;agents-sdk&lt;/code&gt;, we wanted to ship more than just a thin wrapper over an existing library. Agents can communicate with clients in real time, persist state, execute long-running tasks on a schedule, send emails, run asynchronous workflows, browse the web, query data from your Postgres database, call AI models, and support human-in-the-loop use-cases. All of this works today, out of the box.&lt;/p&gt;&lt;p&gt;For example, you can build a powerful chat agent with the &lt;code&gt;AIChatAgent&lt;/code&gt; class:&lt;/p&gt;\n            &lt;pre class=\&quot;language-JavaScript\&quot;&gt;&lt;code class=\&quot;language-JavaScript\&quot;&gt;// src/index.ts\nexport class Chat extends AIChatAgent&amp;lt;Env&amp;gt; {\n  /**\n   * Handles incoming chat messages and manages the response stream\n   * @param onFinish - Callback function executed when streaming completes\n   */\n  async onChatMessage(onFinish: StreamTextOnFinishCallback&amp;lt;any&amp;gt;) {\n    // Create a streaming response that handles both text and tool outputs\n    return agentContext.run(this, async () =&amp;gt; {\n      const dataStreamResponse = createDataStreamResponse({\n        execute: async (dataStream) =&amp;gt; {\n          // Process any pending tool calls from previous messages\n          // This handles human-in-the-loop confirmations for tools\n          const processedMessages = await processToolCalls({\n            messages: this.messages,\n            dataStream,\n            tools,\n            executions,\n          });\n\n          // Initialize OpenAI client with API key from environment\n          const openai = createOpenAI({\n            apiKey: this.env.OPENAI_API_KEY,\n          });\n\n          // Cloudflare AI Gateway\n          // const openai = createOpenAI({\n          //   apiKey: this.env.OPENAI_API_KEY,\n          //   baseURL: this.env.GATEWAY_BASE_URL,\n          // });\n\n          // Stream the AI response using GPT-4\n          const result = streamText({\n            model: openai(&amp;quot;gpt-4o-2024-11-20&amp;quot;),\n            system: `\n              You are a helpful assistant that can do various tasks. If the user asks, then you can also schedule tasks to be executed later. The input may have a date/time/cron pattern to be input as an object into a scheduler The time is now: ${new Date().toISOString()}.\n              `,\n            messages: processedMessages,\n            tools,\n            onFinish,\n            maxSteps: 10,\n          });\n\n          // Merge the AI response stream with tool execution outputs\n          result.mergeIntoDataStream(dataStream);\n        },\n      });\n\n      return dataStreamResponse;\n    });\n  }\n  async executeTask(description: string, task: Schedule&amp;lt;string&amp;gt;) {\n    await this.saveMessages([\n      ...this.messages,\n      {\n        id: generateId(),\n        role: &amp;quot;user&amp;quot;,\n        content: `scheduled message: ${description}`,\n      },\n    ]);\n  }\n}\n\nexport default {\n  async fetch(request: Request, env: Env, ctx: ExecutionContext) {\n    if (!env.OPENAI_API_KEY) {\n      console.error(\n        &amp;quot;OPENAI_API_KEY is not set, don&amp;#039;t forget to set it locally in .dev.vars, and use `wrangler secret bulk .dev.vars` to upload it to production&amp;quot;\n      );\n      return new Response(&amp;quot;OPENAI_API_KEY is not set&amp;quot;, { status: 500 });\n    }\n    return (\n      // Route the request to our agent or return 404 if not found\n      (await routeAgentRequest(request, env)) ||\n      new Response(&amp;quot;Not found&amp;quot;, { status: 404 })\n    );\n  },\n} satisfies ExportedHandler&amp;lt;Env&amp;gt;;&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;… and connect to your Agent with any React-based front-end with the &lt;a href=\&quot;https://github.com/cloudflare/agents-starter/blob/main/src/app.tsx\&quot;&gt;&lt;code&gt;&lt;u&gt;useAgent&lt;/u&gt;&lt;/code&gt;&lt;/a&gt; hook that can automatically establish a bidirectional WebSocket, sync client state, and allow you to build Agent-based applications without a mountain of bespoke code:&lt;/p&gt;\n            &lt;pre class=\&quot;language-JavaScript\&quot;&gt;&lt;code class=\&quot;language-JavaScript\&quot;&gt;// src/app.tsx\nimport { useAgent } from &amp;quot;agents-sdk/react&amp;quot;;  \n\nconst agent = useAgent({\n  agent: &amp;quot;chat&amp;quot;,\n});&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;We spent some time thinking about the production story here too: an agent framework that absolves itself of the hard parts — durably persisting state, handling long-running tasks &amp;amp; loops, and horizontal scale — is only going to get you so far. Agents built with &lt;code&gt;agents-sdk&lt;/code&gt; can be deployed directly to Cloudflare and run on top of &lt;a href=\&quot;https://developers.cloudflare.com/durable-objects/\&quot;&gt;&lt;u&gt;Durable Objects&lt;/u&gt;&lt;/a&gt; — which you can think of as stateful micro-servers that can scale to tens of millions — and are able to run wherever they need to. Close to a user for low-latency, close to your data, and/or anywhere in between.&lt;/p&gt;&lt;p&gt;&lt;code&gt;agents-sdk&lt;/code&gt; also exposes:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;Integration with React applications via a &lt;code&gt;useAgent&lt;/code&gt; hook that can automatically set up a WebSocket connection between your app and an agent&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;An &lt;code&gt;AIChatAgent&lt;/code&gt; extension that makes it easier to build intelligent chat agents&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;State management APIs via &lt;code&gt;this.setState&lt;/code&gt; as well as a native &lt;code&gt;sql&lt;/code&gt; API for writing and querying data within each Agent&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;State synchronization between frontend applications and the agent state&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Agent routing, enabling agent-per-user or agent-per-workflow use-cases. Spawn millions (or tens of millions) of agents without having to think about how to make the infrastructure work, provision CPU, or scale out storage.&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;Over the coming weeks, expect to see even more here: tighter integration with email APIs to enable more human-in-the-loop use-cases, hooks into WebRTC for voice &amp;amp; video interactivity, a built-in evaluation (evals) framework, and the ability to self-host agents on your own infrastructure.&lt;/p&gt;&lt;p&gt;We’re aiming high here: we think this is just the beginning of what agents are capable of, and we think we can make Workers the best place (but not the only place) to build &amp;amp; run them.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;json-mode-longer-context-windows-and-improved-tool-calling-in-workers-ai\&quot;&gt;JSON mode, longer context windows, and improved tool calling in Workers AI&lt;/h2&gt;\n            &lt;a href=\&quot;#json-mode-longer-context-windows-and-improved-tool-calling-in-workers-ai\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;When users express needs conversationally, tool calling converts these requests into structured formats like JSON that APIs can understand and process, allowing the AI to interact with databases, services, and external systems. This is essential for building agents, as it allows users to express complex intentions in natural language, and AI to decompose these requests, call appropriate tools, evaluate responses and deliver meaningful outcomes.&lt;/p&gt;&lt;p&gt;When using tool calling or building AI agents, the text generation model must respond with valid JSON objects rather than natural language. Today, we&amp;#39;re adding JSON mode support to Workers AI, enabling applications to request a structured output response when interacting with AI models. Here&amp;#39;s a request to &lt;code&gt;@cf/meta/llama-3.1-8b-instruct-fp8-fast&lt;/code&gt; using JSON mode:&lt;/p&gt;\n            &lt;pre class=\&quot;language-JavaScript\&quot;&gt;&lt;code class=\&quot;language-JavaScript\&quot;&gt;{\n  &amp;quot;messages&amp;quot;: [\n    {\n      &amp;quot;role&amp;quot;: &amp;quot;system&amp;quot;,\n      &amp;quot;content&amp;quot;: &amp;quot;Extract data about a country.&amp;quot;\n    },\n    {\n      &amp;quot;role&amp;quot;: &amp;quot;user&amp;quot;,\n      &amp;quot;content&amp;quot;: &amp;quot;Tell me about India.&amp;quot;\n    }\n  ],\n  &amp;quot;response_format&amp;quot;: {\n    &amp;quot;type&amp;quot;: &amp;quot;json_schema&amp;quot;,\n    &amp;quot;json_schema&amp;quot;: {\n      &amp;quot;type&amp;quot;: &amp;quot;object&amp;quot;,\n      &amp;quot;properties&amp;quot;: {\n        &amp;quot;name&amp;quot;: {\n          &amp;quot;type&amp;quot;: &amp;quot;string&amp;quot;\n        },\n        &amp;quot;capital&amp;quot;: {\n          &amp;quot;type&amp;quot;: &amp;quot;string&amp;quot;\n        },\n        &amp;quot;languages&amp;quot;: {\n          &amp;quot;type&amp;quot;: &amp;quot;array&amp;quot;,\n          &amp;quot;items&amp;quot;: {\n            &amp;quot;type&amp;quot;: &amp;quot;string&amp;quot;\n          }\n        }\n      },\n      &amp;quot;required&amp;quot;: [\n        &amp;quot;name&amp;quot;,\n        &amp;quot;capital&amp;quot;,\n        &amp;quot;languages&amp;quot;\n      ]\n    }\n  }\n}&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;And here’s how the model will respond:&lt;/p&gt;\n            &lt;pre class=\&quot;language-JavaScript\&quot;&gt;&lt;code class=\&quot;language-JavaScript\&quot;&gt;{\n  &amp;quot;response&amp;quot;: {\n    &amp;quot;name&amp;quot;: &amp;quot;India&amp;quot;,\n    &amp;quot;capital&amp;quot;: &amp;quot;New Delhi&amp;quot;,\n    &amp;quot;languages&amp;quot;: [\n      &amp;quot;Hindi&amp;quot;,\n      &amp;quot;English&amp;quot;,\n      &amp;quot;Bengali&amp;quot;,\n      &amp;quot;Telugu&amp;quot;,\n      &amp;quot;Marathi&amp;quot;,\n      &amp;quot;Tamil&amp;quot;,\n      &amp;quot;Gujarati&amp;quot;,\n      &amp;quot;Urdu&amp;quot;,\n      &amp;quot;Kannada&amp;quot;,\n      &amp;quot;Odia&amp;quot;,\n      &amp;quot;Malayalam&amp;quot;,\n      &amp;quot;Punjabi&amp;quot;,\n      &amp;quot;Sanskrit&amp;quot;\n    ]\n  }\n}&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;As you can see, the model is complying with the JSON schema definition in the request and responding with a validated JSON object. JSON mode is compatible with OpenAI’s &lt;code&gt;response_format&lt;/code&gt; implementation:&lt;/p&gt;\n            &lt;pre class=\&quot;language-JavaScript\&quot;&gt;&lt;code class=\&quot;language-JavaScript\&quot;&gt;response_format: {\n  title: &amp;quot;JSON Mode&amp;quot;,\n  type: &amp;quot;object&amp;quot;,\n  properties: {\n    type: {\n      type: &amp;quot;string&amp;quot;,\n      enum: [&amp;quot;json_object&amp;quot;, &amp;quot;json_schema&amp;quot;],\n    },\n    json_schema: {},\n  }\n}&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;This is the list of models that now support JSON mode:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;&lt;a href=\&quot;https://developers.cloudflare.com/workers-ai/models/llama-3.1-8b-instruct-fast/\&quot;&gt;&lt;u&gt;@cf/meta/llama-3.1-8b-instruct-fast&lt;/u&gt;&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;a href=\&quot;https://developers.cloudflare.com/workers-ai/models/llama-3.1-70b-instruct/\&quot;&gt;&lt;u&gt;@cf/meta/llama-3.1-70b-instruct&lt;/u&gt;&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;a href=\&quot;https://developers.cloudflare.com/workers-ai/models/llama-3.3-70b-instruct-fp8-fast/\&quot;&gt;&lt;u&gt;@cf/meta/llama-3.3-70b-instruct-fp8-fast&lt;/u&gt;&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;a href=\&quot;https://developers.cloudflare.com/workers-ai/models/deepseek-r1-distill-qwen-32b/\&quot;&gt;&lt;u&gt;@cf/deepseek-ai/deepseek-r1-distill-qwen-32b&lt;/u&gt;&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;a href=\&quot;https://developers.cloudflare.com/workers-ai/models/llama-3-8b-instruct/\&quot;&gt;&lt;u&gt;@cf/meta/llama-3-8b-instruct&lt;/u&gt;&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;a href=\&quot;https://developers.cloudflare.com/workers-ai/models/llama-3.1-8b-instruct/\&quot;&gt;&lt;u&gt;@cf/meta/llama-3.1-8b-instruct&lt;/u&gt;&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;a href=\&quot;https://developers.cloudflare.com/workers-ai/models/hermes-2-pro-mistral-7b/\&quot;&gt;&lt;u&gt;@hf/nousresearch/hermes-2-pro-mistral-7b&lt;/u&gt;&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;We will continue extending this list to keep up with new, and requested models.&lt;/p&gt;&lt;p&gt;Lastly, we are changing how we restrict the size of AI requests to text generation models, moving from byte-counts to token-counts, introducing the concept of &lt;b&gt;context window&lt;/b&gt; and raising the limits of the models in our catalog.&lt;/p&gt;&lt;p&gt;In generative AI, the context window is the sum of the number of input, reasoning, and completion or response tokens a model supports. You can now find the context window limit on each &lt;a href=\&quot;https://developers.cloudflare.com/workers-ai/models/llama-3.1-70b-instruct/\&quot;&gt;&lt;u&gt;model page&lt;/u&gt;&lt;/a&gt; in our developer documentation and decide which suits your requirements and use case.&lt;/p&gt;&lt;p&gt;JSON mode is also the perfect companion when using function calling. You can use structured JSON outputs with traditional function calling or the Vercel AI SDK via the &lt;code&gt;workers-ai-provider&lt;/code&gt;.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;0-1-1\&quot;&gt;&lt;a href=\&quot;https://github.com/cloudflare/workers-ai-provider\&quot;&gt;workers-ai-provider&lt;/a&gt; 0.1.1&lt;/h2&gt;\n            &lt;a href=\&quot;#0-1-1\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;One of the most common ways to build with AI tooling today is by using the popular &lt;a href=\&quot;https://sdk.vercel.ai/docs/introduction\&quot;&gt;&lt;u&gt;AI SDK&lt;/u&gt;&lt;/a&gt;. &lt;a href=\&quot;https://github.com/cloudflare/workers-ai-provider\&quot;&gt;&lt;u&gt;Cloudflare’s provider&lt;/u&gt;&lt;/a&gt; for the AI SDK makes it easy to use Workers AI the same way you would call any other LLM, directly from your code.&lt;/p&gt;&lt;p&gt;In the &lt;a href=\&quot;https://github.com/cloudflare/workers-ai-provider/tree/workers-ai-provider%400.1.1\&quot;&gt;&lt;u&gt;most recent version&lt;/u&gt;&lt;/a&gt;, we’ve shipped the following improvements: &lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;Tool calling enabled for generateText&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Streaming now works out of the box&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Usage statistics are now enabled&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;You can now use AI Gateway, even when streaming&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;A key part of building agents is using LLMs for routing, and making decisions on which tools to call next, and summarizing structured and unstructured data. All of these things need to happen quickly, as they are on the critical path of the user-facing experience.&lt;/p&gt;&lt;p&gt;Workers AI, with its globally distributed fleet of GPUs, is a perfect fit for smaller, low-latency LLMs, so we’re excited to make it easy to use with tools developers are already familiar with. &lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;why-build-agents-on-cloudflare\&quot;&gt;Why build agents on Cloudflare? &lt;/h2&gt;\n            &lt;a href=\&quot;#why-build-agents-on-cloudflare\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;Since launching Workers in 2017, we’ve been building a platform to allow developers to build applications that are fast, scalable, and cost-efficient from day one. We took a fundamentally different approach from the way code was previously run on servers, making a bet about what the future of applications was going to look like — isolates running on a global network, in a way that was truly serverless. No regions, no concurrency management, no managing or scaling infrastructure. &lt;/p&gt;&lt;p&gt;The release of Workers was just the beginning, and we continued shipping primitives to extend what developers could build. Some more familiar, like a key-value store (&lt;a href=\&quot;https://developers.cloudflare.com/kv/\&quot;&gt;&lt;u&gt;Workers KV&lt;/u&gt;&lt;/a&gt;), and some that we thought would play a role in enabling net new use cases like &lt;a href=\&quot;https://developers.cloudflare.com/durable-objects/\&quot;&gt;&lt;u&gt;Durable Objects&lt;/u&gt;&lt;/a&gt;. While we didn’t quite predict AI agents (though “Agents” was one of the proposed names for Durable Objects), we inadvertently created the perfect platform for building them. &lt;/p&gt;&lt;p&gt;What do we mean by that? &lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;a-platform-that-only-charges-you-for-what-you-use-regardless-of-how-long-it-takes\&quot;&gt;A platform that only charges you for what you use (regardless of how long it takes)&lt;/h3&gt;\n            &lt;a href=\&quot;#a-platform-that-only-charges-you-for-what-you-use-regardless-of-how-long-it-takes\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;To be able to run agents efficiently, you need a system that can seamlessly scale up and down to support the constant stop, go, wait patterns. Agents are basically long-running tasks, sometimes waiting on slow reasoning LLMs and external tools to execute. With Cloudflare, you don’t have to pay for long-running processes when your code is not executing. Cloudflare Workers is designed to scale down and &lt;a href=\&quot;https://blog.cloudflare.com/workers-pricing-scale-to-zero/\&quot;&gt;&lt;u&gt;only charge you for CPU time&lt;/u&gt;&lt;/a&gt;, as opposed to wall-clock time. &lt;/p&gt;&lt;p&gt;In many cases, especially when calling LLMs, the difference can be in orders of magnitude — e.g. 2–3 milliseconds of CPU vs. 10 seconds of wall-clock time. When building on Workers, we pass that difference on to you as cost savings. &lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;serverless-ai-inference\&quot;&gt;Serverless AI Inference&lt;/h3&gt;\n            &lt;a href=\&quot;#serverless-ai-inference\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;We took a similar serverless approach when it comes to inference itself. When you need to call an AI model, you need it to be instantaneously available. While the foundation model providers offer APIs that make it possible to just call the LLM, if you’re running open-source models, &lt;a href=\&quot;https://www.cloudflare.com/learning/ai/what-is-lora/\&quot;&gt;&lt;u&gt;LoRAs&lt;/u&gt;&lt;/a&gt;, or self-trained models, most cloud providers today require you to pre-provision resources for what your peak traffic will look like. This means that the rest of the time, you’re still paying for GPUs to sit there idle. With Workers AI, you can pay only when you’re calling our inference APIs, as opposed to unused infrastructure. In fact, you don’t have to think about infrastructure at all, which is the principle at the core of everything we do. &lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;a-platform-designed-for-durable-execution\&quot;&gt;A platform designed for durable execution&lt;/h3&gt;\n            &lt;a href=\&quot;#a-platform-designed-for-durable-execution\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;&lt;a href=\&quot;https://developers.cloudflare.com/durable-objects/\&quot;&gt;&lt;u&gt;Durable Objects&lt;/u&gt;&lt;/a&gt; and &lt;a href=\&quot;https://developers.cloudflare.com/workflows\&quot;&gt;&lt;u&gt;Workflows&lt;/u&gt;&lt;/a&gt; provide a robust programming model that ensures guaranteed execution for asynchronous tasks that require persistence and reliability. This makes them ideal for handling complex operations like long-running deep thinking LLM calls, human-in-the-loop approval processes, or interactions with unreliable third-party APIs. By maintaining state across requests and automatically handling retries, these tools create a resilient foundation for building sophisticated AI agents that can perform complex, multistep tasks without losing context or progress, even when operations take significant time to complete.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;lastly-new-and-updated-agents-documentation\&quot;&gt;Lastly, new and updated agents documentation&lt;/h2&gt;\n            &lt;a href=\&quot;#lastly-new-and-updated-agents-documentation\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;Did you catch all of that?&lt;/p&gt;&lt;p&gt;No worries if not: we’ve updated our &lt;a href=\&quot;https://developers.cloudflare.com/agents\&quot;&gt;&lt;u&gt;agents documentation&lt;/u&gt;&lt;/a&gt; to include everything we talked about above, from breaking down the basics of agents, to showing you how to tackle foundational examples of building with agents.&lt;/p&gt;&lt;p&gt;We’ve also updated our &lt;a href=\&quot;https://developers.cloudflare.com/workers/get-started/prompting/\&quot;&gt;&lt;u&gt;Workers prompt&lt;/u&gt;&lt;/a&gt; with knowledge of the agents-sdk library, so you can use Cursor, Windsurf, Zed, ChatGPT or Claude to help you build AI Agents and deploy them to Cloudflare.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;cant-wait-to-see-what-you-build\&quot;&gt;Can’t wait to see what you build! &lt;/h2&gt;\n            &lt;a href=\&quot;#cant-wait-to-see-what-you-build\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;We’re just getting started, and we love to see all that you build. Please join our &lt;a href=\&quot;https://discord.com/invite/cloudflaredev\&quot;&gt;&lt;u&gt;Discord&lt;/u&gt;&lt;/a&gt;, ask questions, and tell us what you’re building.&lt;/p&gt;&quot;],&quot;published_at&quot;:[0,&quot;2025-02-25T14:00+00:00&quot;],&quot;updated_at&quot;:[0,&quot;2025-06-06T20:24:38.593Z&quot;],&quot;feature_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/57zjl5TyJLzl0LDsZ8aKZc/5619952f43a307d29b849fa938bfa046/image4.png&quot;],&quot;tags&quot;:[1,[[0,{&quot;id&quot;:[0,&quot;6Foe3R8of95cWVnQwe5Toi&quot;],&quot;name&quot;:[0,&quot;AI&quot;],&quot;slug&quot;:[0,&quot;ai&quot;]}],[0,{&quot;id&quot;:[0,&quot;6hbkItfupogJP3aRDAq6v8&quot;],&quot;name&quot;:[0,&quot;Cloudflare Workers&quot;],&quot;slug&quot;:[0,&quot;workers&quot;]}],[0,{&quot;id&quot;:[0,&quot;5v2UZdTRX1Rw9akmhexnxs&quot;],&quot;name&quot;:[0,&quot;Durable Objects&quot;],&quot;slug&quot;:[0,&quot;durable-objects&quot;]}]]],&quot;relatedTags&quot;:[0],&quot;authors&quot;:[1,[[0,{&quot;name&quot;:[0,&quot;Rita Kozlov&quot;],&quot;slug&quot;:[0,&quot;rita&quot;],&quot;bio&quot;:[0,null],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/56u5zfWi9255rUocOgksl0/5eb2eb16e26893d259f7b00af85e8417/rita.png&quot;],&quot;location&quot;:[0,null],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,&quot;@ritakozlov_&quot;],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}],[0,{&quot;name&quot;:[0,&quot;Sunil Pai&quot;],&quot;slug&quot;:[0,&quot;sunil&quot;],&quot;bio&quot;:[0,&quot;JavaScript and Les Pauls.  Worked at Cloudflare once, left and created PartyKit, came back wiser.&quot;],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/2xnINigwFaBtTwOffppE85/596c43dfef6205e9c5b71c2caff4bea9/Sunil_Pai.png&quot;],&quot;location&quot;:[0,&quot;London&quot;],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,&quot;@threepointone&quot;],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}],[0,{&quot;name&quot;:[0,&quot;Matt Silverlock&quot;],&quot;slug&quot;:[0,&quot;silverlock&quot;],&quot;bio&quot;:[0,&quot;Director of Product at Cloudflare.&quot;],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/7xP5qePZD9eyVtwIesXYxh/e714aaa573161ec9eb48d59bd1aa6225/silverlock.jpeg&quot;],&quot;location&quot;:[0,null],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,&quot;@elithrar&quot;],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}]]],&quot;meta_description&quot;:[0,&quot;Today we’re excited to share a few announcements on how we’re making it even easier to build AI agents on Cloudflare, including a new agents-sdk, a new JavaScript agents framework, and updates to Workers AI. &quot;],&quot;primary_author&quot;:[0,{}],&quot;localeList&quot;:[0,{&quot;name&quot;:[0,&quot;blog-english-only&quot;],&quot;enUS&quot;:[0,&quot;English for Locale&quot;],&quot;zhCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhHansCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhTW&quot;:[0,&quot;No Page for Locale&quot;],&quot;frFR&quot;:[0,&quot;No Page for Locale&quot;],&quot;deDE&quot;:[0,&quot;No Page for Locale&quot;],&quot;itIT&quot;:[0,&quot;No Page for Locale&quot;],&quot;jaJP&quot;:[0,&quot;No Page for Locale&quot;],&quot;koKR&quot;:[0,&quot;No Page for Locale&quot;],&quot;ptBR&quot;:[0,&quot;No Page for Locale&quot;],&quot;esLA&quot;:[0,&quot;No Page for Locale&quot;],&quot;esES&quot;:[0,&quot;No Page for Locale&quot;],&quot;enAU&quot;:[0,&quot;No Page for Locale&quot;],&quot;enCA&quot;:[0,&quot;No Page for Locale&quot;],&quot;enIN&quot;:[0,&quot;No Page for Locale&quot;],&quot;enGB&quot;:[0,&quot;No Page for Locale&quot;],&quot;idID&quot;:[0,&quot;No Page for Locale&quot;],&quot;ruRU&quot;:[0,&quot;No Page for Locale&quot;],&quot;svSE&quot;:[0,&quot;No Page for Locale&quot;],&quot;viVN&quot;:[0,&quot;No Page for Locale&quot;],&quot;plPL&quot;:[0,&quot;No Page for Locale&quot;],&quot;arAR&quot;:[0,&quot;No Page for Locale&quot;],&quot;nlNL&quot;:[0,&quot;No Page for Locale&quot;],&quot;thTH&quot;:[0,&quot;No Page for Locale&quot;],&quot;trTR&quot;:[0,&quot;No Page for Locale&quot;],&quot;heIL&quot;:[0,&quot;No Page for Locale&quot;],&quot;lvLV&quot;:[0,&quot;No Page for Locale&quot;],&quot;etEE&quot;:[0,&quot;No Page for Locale&quot;],&quot;ltLT&quot;:[0,&quot;No Page for Locale&quot;]}],&quot;url&quot;:[0,&quot;https://blog.cloudflare.com/build-ai-agents-on-cloudflare&quot;],&quot;metadata&quot;:[0,{&quot;title&quot;:[0,&quot;Making Cloudflare the best platform for building AI Agents&quot;],&quot;description&quot;:[0,&quot;Today we’re excited to share a few announcements on how we’re making it even easier to build AI agents on Cloudflare, including a new agents-sdk, a new JavaScript agents framework, and updates to Workers AI. &quot;],&quot;imgPreview&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/7qCHaYOJHWsfpBxtkrnTyC/2fb575f8d393d894023f8f14be4ef5c4/Making_Cloudflare_the_best_platform_for_building_AI_Agents-OG.png&quot;]}],&quot;publicly_index&quot;:[0,true]}],[0,{&quot;id&quot;:[0,&quot;1YRfz7LKvAGrEMbRGhNrFP&quot;],&quot;title&quot;:[0,&quot;Build durable applications on Cloudflare Workers: you write the Workflows, we take care of the rest&quot;],&quot;slug&quot;:[0,&quot;building-workflows-durable-execution-on-workers&quot;],&quot;excerpt&quot;:[0,&quot;Cloudflare Workflows is now in open beta! Workflows allows you to build reliable, repeatable, long-lived multi-step applications that can automatically retry, persist state, and scale out. Read on to learn how Workflows works, how we built it on top of Durable Objects, and how you can deploy your first Workflows application.&quot;],&quot;featured&quot;:[0,false],&quot;html&quot;:[0,&quot;&lt;p&gt;Workflows, Cloudflare’s durable execution engine that allows you to build reliable, repeatable multi-step applications that scale for you, is now in open beta. Any developer with a free or paid &lt;a href=\&quot;https://workers.cloudflare.com/\&quot;&gt;&lt;u&gt;Workers&lt;/u&gt;&lt;/a&gt; plan can build and deploy a Workflow right now: no waitlist, no sign-up form, no fake line around-the-block.&lt;/p&gt;&lt;p&gt;If you learn by doing, you can create your first Workflow via a single command (or &lt;a href=\&quot;https://developers.cloudflare.com/workflows/get-started/guide/\&quot;&gt;&lt;u&gt;visit the docs for the full guide)&lt;/u&gt;&lt;/a&gt;:&lt;/p&gt;\n            &lt;pre class=\&quot;language-JavaScript\&quot;&gt;&lt;code class=\&quot;language-JavaScript\&quot;&gt;npm create cloudflare@latest workflows-starter -- \\\n  --template &amp;quot;cloudflare/workflows-starter&amp;quot;&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;Open the &lt;code&gt;src/index.ts&lt;/code&gt; file, poke around, start extending it, and deploy it with a quick &lt;code&gt;wrangler deploy&lt;/code&gt;.&lt;/p&gt;&lt;p&gt;If you want to learn more about how Workflows works, how you can use it to build applications, and how we built it, read on.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;workflows-durable-execution\&quot;&gt;Workflows? Durable Execution?&lt;/h2&gt;\n            &lt;a href=\&quot;#workflows-durable-execution\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;Workflows—which we &lt;a href=\&quot;https://blog.cloudflare.com/data-anywhere-events-pipelines-durable-execution-workflows/#durable-execution\&quot;&gt;&lt;u&gt;announced back during Developer Week&lt;/u&gt;&lt;/a&gt; earlier this year—is our take on the concept of “Durable Execution”: the ability to build and execute applications that are &lt;i&gt;durable&lt;/i&gt; in the face of errors, network issues, upstream API outages, rate limits, and (most importantly) infrastructure failure.&lt;/p&gt;&lt;p&gt;As &lt;a href=\&quot;https://cloudflare.tv/event/xvm4qdgm?startTime=8m5s\&quot;&gt;&lt;u&gt;over 2.4 million developers&lt;/u&gt;&lt;/a&gt; continue to build applications on top of Cloudflare Workers, R2, and Workers AI, we’ve noticed more developers building multi-step applications and workflows that process user data, transform unstructured data into structured, export metrics, persist state as they progress, and automatically retry &amp;amp; restart. But writing any non-trivial application and making it &lt;i&gt;durable&lt;/i&gt; in the face of failure is hard: this is where Workflows comes in. Workflows manages the retries, emitting the metrics, and durably storing the state (without you having to stand up your own database) as the Workflow progresses.&lt;/p&gt;&lt;p&gt;What makes Workflows different from other takes on “Durable Execution” is that we manage the underlying compute and storage infrastructure for you. You’re not left managing a compute cluster and hoping it scales both up (on a Monday morning) and down (during quieter periods) to manage costs, or ensuring that you have compute running in the right locations. Workflows is built on Cloudflare Workers — our job is to run your code and operate the infrastructure for you.&lt;/p&gt;&lt;p&gt;As an example of how Workflows can help you build durable applications, assume you want to post-process file uploads from your users that were uploaded to an R2 bucket directly via &lt;a href=\&quot;https://developers.cloudflare.com/r2/api/s3/presigned-urls/\&quot;&gt;&lt;u&gt;a pre-signed URL&lt;/u&gt;&lt;/a&gt;. That post-processing could involve multiple actions: text extraction via a &lt;a href=\&quot;https://developers.cloudflare.com/workers-ai/models/\&quot;&gt;&lt;u&gt;Workers AI model&lt;/u&gt;&lt;/a&gt;, calls to a third-party API to validate data, updating or querying rows in a database once the file has been processed… the list goes on.&lt;/p&gt;&lt;p&gt;But what each of these actions has in common is that it could &lt;i&gt;fail&lt;/i&gt;. Maybe that upstream API is unavailable, maybe you get rate-limited, maybe your database is down. Having to write extensive retry logic around each action, manage backoffs, and (importantly) ensure your application doesn’t have to start from scratch when a later &lt;i&gt;step&lt;/i&gt; fails is more boilerplate to write and more code to test and debug.&lt;/p&gt;&lt;p&gt;What’s a &lt;i&gt;step, &lt;/i&gt;you ask? The core building block of every Workflow is the step: an individually retriable component of your application that can optionally emit state. That state is then persisted, even if subsequent steps were to fail. This means that your application doesn’t have to restart, allowing it to not only recover more quickly from failure scenarios, but it can also avoid doing redundant work. You don’t want your application hammering an expensive third-party API (or getting you rate limited) because it’s naively retrying an API call that you don’t have to.&lt;/p&gt;\n            &lt;pre class=\&quot;language-JavaScript\&quot;&gt;&lt;code class=\&quot;language-JavaScript\&quot;&gt;export class MyWorkflow extends WorkflowEntrypoint&amp;lt;Env, Params&amp;gt; {\n\tasync run(event: WorkflowEvent&amp;lt;Params&amp;gt;, step: WorkflowStep) {\n\t\tconst files = await step.do(&amp;#039;my first step&amp;#039;, async () =&amp;gt; {\n\t\t\treturn {\n\t\t\t\tinputParams: event,\n\t\t\t\tfiles: [\n\t\t\t\t\t&amp;#039;doc_7392_rev3.pdf&amp;#039;,\n\t\t\t\t\t&amp;#039;report_x29_final.pdf&amp;#039;,\n\t\t\t\t\t&amp;#039;memo_2024_05_12.pdf&amp;#039;,\n\t\t\t\t\t&amp;#039;file_089_update.pdf&amp;#039;,\n\t\t\t\t\t&amp;#039;proj_alpha_v2.pdf&amp;#039;,\n\t\t\t\t\t&amp;#039;data_analysis_q2.pdf&amp;#039;,\n\t\t\t\t\t&amp;#039;notes_meeting_52.pdf&amp;#039;,\n\t\t\t\t\t&amp;#039;summary_fy24_draft.pdf&amp;#039;,\n\t\t\t\t],\n\t\t\t};\n\t\t});\n\n\t\t// Other steps...\n\t}\n}\n&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;Notably, a Workflow can have hundreds of steps: one of the &lt;a href=\&quot;https://developers.cloudflare.com/workflows/build/rules-of-workflows/\&quot;&gt;&lt;u&gt;Rules of Workflows&lt;/u&gt;&lt;/a&gt; is to encapsulate every API call or stateful action within your application into its own step. Each step can also define its own retry strategy, automatically backing off, adding a delay and/or (eventually) giving up after a set number of attempts.&lt;/p&gt;\n            &lt;pre class=\&quot;language-JavaScript\&quot;&gt;&lt;code class=\&quot;language-JavaScript\&quot;&gt;await step.do(\n\t&amp;#039;make a call to write that could maybe, just might, fail&amp;#039;,\n\t// Define a retry strategy\n\t{\n\t\tretries: {\n\t\t\tlimit: 5,\n\t\t\tdelay: &amp;#039;5 seconds&amp;#039;,\n\t\t\tbackoff: &amp;#039;exponential&amp;#039;,\n\t\t},\n\t\ttimeout: &amp;#039;15 minutes&amp;#039;,\n\t},\n\tasync () =&amp;gt; {\n\t\t// Do stuff here, with access to the state from our previous steps\n\t\tif (Math.random() &amp;gt; 0.5) {\n\t\t\tthrow new Error(&amp;#039;API call to $STORAGE_SYSTEM failed&amp;#039;);\n\t\t}\n\t},\n);\n&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;To illustrate this further, imagine you have an application that reads text files from an R2 storage bucket, pre-processes the text into chunks, generates text embeddings &lt;a href=\&quot;https://developers.cloudflare.com/workers-ai/models/bge-large-en-v1.5/\&quot;&gt;&lt;u&gt;using Workers AI&lt;/u&gt;&lt;/a&gt;, and then inserts those into a vector database (like &lt;a href=\&quot;https://developers.cloudflare.com/vectorize/\&quot;&gt;&lt;u&gt;Vectorize&lt;/u&gt;&lt;/a&gt;) for semantic search.&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/7b9m0rPDlGvIiTnhguyvzI/3f27678b141ce600f1f54eb999e9d671/WORKFLOWS.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;2324\&quot; height=\&quot;1000\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;In the Workflows programming model, each of those is a discrete step, and each can emit state. For example, each of the four actions below can be a discrete &lt;code&gt;step.do&lt;/code&gt; call in a Workflow:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;&lt;p&gt;Reading the files from storage and emitting the list of filenames&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Chunking the text and emitting the results&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Generating text embeddings&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Upserting them into Vectorize and capturing the result of a test query&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;You can also start to imagine that some steps, such as chunking text or generating text embeddings, can be broken down into even more steps — a step per file that we chunk, or a step per API call to our text embedding model, so that our application is even more resilient to failure.&lt;/p&gt;&lt;p&gt;Steps can be created programmatically or conditionally based on input, allowing you to dynamically create steps based on the number of inputs your application needs to process. You do not need to define all steps ahead of time, and each instance of a Workflow may choose to conditionally create steps on the fly.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;building-cloudflare-on-cloudflare\&quot;&gt;Building Cloudflare on Cloudflare&lt;/h2&gt;\n            &lt;a href=\&quot;#building-cloudflare-on-cloudflare\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;As the Cloudflare Developer platform &lt;a href=\&quot;https://www.cloudflare.com/birthday-week/\&quot;&gt;&lt;u&gt;continues to grow&lt;/u&gt;&lt;/a&gt;, almost all of our own products are built on top of it. Workflows is yet another example of how we built a new product from scratch using nothing but Workers and its vast catalog of features and APIs. This section of the blog has two goals: to explain how we built it, and to demonstrate that anyone can create a complex application or platform with demanding requirements and multiple architectural layers on our stack, too.&lt;/p&gt;&lt;p&gt;If you’re wondering how Workflows manages to make durable execution easy, how it persists state, and how it automatically scales: it’s because we built it on Cloudflare Workers, including the brand-new &lt;a href=\&quot;https://blog.cloudflare.com/sqlite-in-durable-objects/\&quot;&gt;&lt;u&gt;zero-latency SQLite storage we recently introduced to Durable Objects&lt;/u&gt;&lt;/a&gt;.\n&lt;/p&gt;&lt;p&gt;To understand how Workflows uses Workers &amp;amp; Durable Objects, here’s the high-level overview of our architecture:&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/7pknYk0Sshxka3iPbxBCRj/bb8b75986601e38b6b69fe8d849c0cbe/image9.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1999\&quot; height=\&quot;895\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;There are three main blocks in this diagram:&lt;/p&gt;&lt;p&gt;The user-facing APIs are where the user interacts with the platform, creating and deploying new workflows or instances, controlling them, and accessing their state and activity logs. These operations can be executed through our public &lt;a href=\&quot;https://developers.cloudflare.com/api/\&quot;&gt;&lt;u&gt;API gateway&lt;/u&gt;&lt;/a&gt; using REST calls, a Worker script using bindings, &lt;a href=\&quot;https://blog.cloudflare.com/wrangler3\&quot;&gt;&lt;u&gt;Wrangler&lt;/u&gt;&lt;/a&gt; (Cloudflare&amp;#39;s developer platform command line tool), or via the &lt;a href=\&quot;https://dash.cloudflare.com/\&quot;&gt;&lt;u&gt;Dashboard&lt;/u&gt;&lt;/a&gt; user interface.&lt;/p&gt;&lt;p&gt;The managed platform holds the internal configuration APIs running on a Worker implementing a catalog of REST endpoints, the binding shim, which is supported by another dedicated Worker, every account controller, and their correspondent workflow engines, all powered by SQLite-backed Durable Objects. This is where all the magic happens and what we are sharing more details about in this technical blog.&lt;/p&gt;&lt;p&gt;Finally, there are the workflow instances, essentially independent clones of the workflow application. Instances are user account-owned and have a one-to-one relationship with a managed engine that powers them. You can run as many instances and engines as you want concurrently.&lt;/p&gt;&lt;p&gt;Let&amp;#39;s get into more detail…&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;configuration-api-and-binding-shim\&quot;&gt;Configuration API and Binding Shim&lt;/h3&gt;\n            &lt;a href=\&quot;#configuration-api-and-binding-shim\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        \n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/2qEGr9M8KwgPS66Ju8mELL/189db9764392c00ae34dd3a44eeb1ed7/image6.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1999\&quot; height=\&quot;984\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;The Configuration API and the Binding Shim are two stateless Workers; one receives REST API calls from clients calling our &lt;a href=\&quot;https://developers.cloudflare.com/api/\&quot;&gt;&lt;u&gt;API Gateway&lt;/u&gt;&lt;/a&gt; directly, using &lt;a href=\&quot;https://developers.cloudflare.com/workers/wrangler/\&quot;&gt;&lt;u&gt;Wrangler&lt;/u&gt;&lt;/a&gt;, or navigating the &lt;a href=\&quot;https://dash.cloudflare.com/\&quot;&gt;&lt;u&gt;Dashboard&lt;/u&gt;&lt;/a&gt; UI, and the other is the endpoint for the Workflows &lt;a href=\&quot;https://developers.cloudflare.com/workers/runtime-apis/bindings/\&quot;&gt;&lt;u&gt;binding&lt;/u&gt;&lt;/a&gt;, an efficient and authenticated interface to interact with the Cloudflare Developer Platform resources from a Workers script.&lt;/p&gt;&lt;p&gt;The configuration API worker uses &lt;a href=\&quot;https://hono.dev/docs/getting-started/cloudflare-workers\&quot;&gt;&lt;u&gt;HonoJS&lt;/u&gt;&lt;/a&gt; and &lt;a href=\&quot;https://hono.dev/examples/zod-openapi\&quot;&gt;&lt;u&gt;Zod&lt;/u&gt;&lt;/a&gt; to implement the REST endpoints, which are declared in an &lt;a href=\&quot;https://swagger.io/specification/\&quot;&gt;&lt;u&gt;OpenAPI&lt;/u&gt;&lt;/a&gt; schema and exported to our API Gateway, thus adding our methods to the Cloudflare API &lt;a href=\&quot;https://developers.cloudflare.com/api/\&quot;&gt;&lt;u&gt;catalog&lt;/u&gt;&lt;/a&gt;.&lt;/p&gt;\n            &lt;pre class=\&quot;language-JavaScript\&quot;&gt;&lt;code class=\&quot;language-JavaScript\&quot;&gt;import { swaggerUI } from &amp;#039;@hono/swagger-ui&amp;#039;;\nimport { createRoute, OpenAPIHono, z } from &amp;#039;@hono/zod-openapi&amp;#039;;\nimport { Hono } from &amp;#039;hono&amp;#039;;\n\n...\n\n​​api.openapi(\n  createRoute({\n    method: &amp;#039;get&amp;#039;,\n    path: &amp;#039;/&amp;#039;,\n    request: {\n      query: PaginationParams,\n    },\n    responses: {\n      200: {\n        content: {\n          &amp;#039;application/json&amp;#039;: {\n             schema: APISchemaSuccess(z.array(WorkflowWithInstancesCountSchema)),\n          },\n        },\n        description: &amp;#039;List of all Workflows belonging to a account.&amp;#039;,\n      },\n    },\n  }),\n  async (ctx) =&amp;gt; {\n    ...\n  },\n);\n\n...\n\napi.route(&amp;#039;/:workflow_name&amp;#039;, routes.workflows);\napi.route(&amp;#039;/:workflow_name/instances&amp;#039;, routes.instances);\napi.route(&amp;#039;/:workflow_name/versions&amp;#039;, routes.versions);&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;These Workers perform two different functions, but they share a large portion of their code and implement similar logic; once the request is authenticated and ready to travel to the next stage, they use the account ID to delegate the operation to a Durable Object called Account Controller.&lt;/p&gt;\n            &lt;pre class=\&quot;language-JavaScript\&quot;&gt;&lt;code class=\&quot;language-JavaScript\&quot;&gt;// env.ACCOUNTS is the Account Controllers Durable Objects namespace\nconst accountStubId = c.env.ACCOUNTS.idFromName(accountId.toString());\nconst accountStub = c.env.ACCOUNTS.get(accountStubId);&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;As you can see, every account has its own Account Controller Durable Object.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;account-controllers\&quot;&gt;Account Controllers&lt;/h3&gt;\n            &lt;a href=\&quot;#account-controllers\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;The Account Controller is a dedicated persisted database that stores the list of all the account’s workflows, versions, and instances. We scale to millions of account controllers, one per every Cloudflare account using Workflows, by leveraging the power of &lt;a href=\&quot;https://developers.cloudflare.com/durable-objects/best-practices/access-durable-objects-storage/#sqlite-storage-backend\&quot;&gt;&lt;u&gt;Durable Objects with SQLite backend&lt;/u&gt;&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;&lt;a href=\&quot;https://developers.cloudflare.com/durable-objects/\&quot;&gt;&lt;u&gt;Durable Objects&lt;/u&gt;&lt;/a&gt; (DOs) are single-threaded singletons that run in our data centers and are bound to a stateful storage API, in this case, SQLite. They are also Workers, just a special kind, and have access to all of our other APIs. This makes it easy to build consistent, highly available distributed applications with them.&lt;/p&gt;&lt;p&gt;Here’s what we get for free by using one Durable Object per Workflows account:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;Sharding based on account boundaries aligns perfectly with the way we manage resources at Cloudflare internally. Also, due to the nature of DOs, there are other things that this model gets us for free: Not that we expect them, but eventual bugs or state inconsistencies during beta are confined to the affected account, and don’t impact everyone.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;DO instances run close to the end user; Alice is in London and will call the config API through our &lt;a href=\&quot;https://www.cloudflare.com/en-gb/network/\&quot;&gt;&lt;u&gt;LHR data center&lt;/u&gt;&lt;/a&gt;, while Bob is in Lisbon and will connect to LIS.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Because every account is a Worker, we can gradually upgrade them to new versions, starting with the internal users, thus derisking real customers.&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;Before SQLite, our only option was to use the Durable Object&amp;#39;s &lt;a href=\&quot;https://developers.cloudflare.com/durable-objects/api/storage-api/#get\&quot;&gt;&lt;u&gt;key-value&lt;/u&gt;&lt;/a&gt; storage API, but having a relational database at our fingertips and being able to create tables and do complex queries is a significant enabler. For example, take a look at how we implement the internal method getWorkflow():&lt;/p&gt;\n            &lt;pre class=\&quot;language-JavaScript\&quot;&gt;&lt;code class=\&quot;language-JavaScript\&quot;&gt;async function getWorkflow(accountId: number, workflowName: string) {\n  try {\n    const res = this.ctx.storage.transactionSync(() =&amp;gt; {\n      const cursor = Array.from(\n        this.ctx.storage.sql.exec(\n          `\n                    SELECT *,\n                    (SELECT class_name\n                        FROM   versions\n                        WHERE  workflow_id = w.id\n                        ORDER  BY created_on DESC\n                        LIMIT  1) AS class_name\n                    FROM   workflows w\n                    WHERE  w.name = ? \n                    `,\n          workflowName\n        )\n      )[0] as Workflow;\n\n      return cursor;\n    });\n\n    this.sendAnalytics(accountId, begin, &amp;quot;getWorkflow&amp;quot;);\n    return res as Workflow | undefined;\n  } catch (err) {\n    this.sendErrorAnalytics(accountId, begin, &amp;quot;getWorkflow&amp;quot;);\n    throw err;\n  }\n}\n&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;The other thing we take advantage of in Workflows is using the recently &lt;a href=\&quot;https://blog.cloudflare.com/javascript-native-rpc/\&quot;&gt;&lt;u&gt;announced&lt;/u&gt;&lt;/a&gt; JavaScript-native RPC feature when communicating between components.&lt;/p&gt;&lt;p&gt;Before &lt;a href=\&quot;https://developers.cloudflare.com/workers/runtime-apis/rpc/\&quot;&gt;&lt;u&gt;RPC&lt;/u&gt;&lt;/a&gt;, we had to &lt;code&gt;fetch()&lt;/code&gt; between components, make HTTP requests, and serialize and deserialize the parameters and the payload. Now, we can async call the remote object&amp;#39;s method as if it was local. Not only does this feel more natural and simplify our logic, but it&amp;#39;s also more efficient, and we can take advantage of TypeScript type-checking when writing code.&lt;/p&gt;&lt;p&gt;This is how the Configuration API would call the Account Controller’s &lt;code&gt;countWorkflows()&lt;/code&gt; method before:&lt;/p&gt;\n            &lt;pre class=\&quot;language-JavaScript\&quot;&gt;&lt;code class=\&quot;language-JavaScript\&quot;&gt;const resp = await accountStub.fetch(\n      &amp;quot;https://controller/count-workflows&amp;quot;,\n      {\n        method: &amp;quot;POST&amp;quot;,\n        headers: {\n          &amp;quot;Content-Type&amp;quot;: &amp;quot;application/json; charset=utf-8&amp;quot;,\n        },\n        body: JSON.stringify({ accountId }),\n      },\n    );\n\nif (!resp.ok) {\n  return new Response(&amp;quot;Internal Server Error&amp;quot;, { status: 500 });\n}\n\nconst result = await resp.json();\nconst total_count = result.total_count;&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;This is how we do it using RPC:&lt;/p&gt;\n            &lt;pre class=\&quot;language-JavaScript\&quot;&gt;&lt;code class=\&quot;language-JavaScript\&quot;&gt;const total_count = await accountStub.countWorkflows(accountId);&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;The other powerful feature of our RPC system is that it supports passing not only &lt;a href=\&quot;https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Structured_clone_algorithm#supported_types\&quot;&gt;&lt;u&gt;Structured Cloneable&lt;/u&gt;&lt;/a&gt; objects back and forth but also entire classes. More on this later.&lt;/p&gt;&lt;p&gt;Let’s move on to Engine.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;engine-and-instance\&quot;&gt;Engine and instance&lt;/h3&gt;\n            &lt;a href=\&quot;#engine-and-instance\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Every instance of a workflow runs alongside an Engine instance. The Engine is responsible for starting up the user’s workflow entry point, executing the steps on behalf of the user, handling their results, and tracking the workflow state until completion.&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/6yrKsuF501oRCDujckr3yM/bde40097ec5bedda07793375e53e99b9/image1.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1080\&quot; height=\&quot;632\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;When we started thinking about the Engine, we thought about modeling it after a &lt;a href=\&quot;https://en.wikipedia.org/wiki/Finite-state_machine\&quot;&gt;&lt;u&gt;state machine&lt;/u&gt;&lt;/a&gt;, and that was what our initial prototypes looked like. However, state machines require an ahead-of-time understanding of the userland code, which implies having a build step before running them. This is costly at scale and introduces additional complexity.&lt;/p&gt;&lt;p&gt;A few iterations later, we had another idea. What if we could model the engine as a game loop?&lt;/p&gt;&lt;p&gt;Unlike other computer programs, games operate regardless of a user&amp;#39;s input. The game loop is essentially a sequence of tasks that implement the game&amp;#39;s logic and update the display, typically one loop per video frame. Here’s an example of a game loop in pseudo-code:&lt;/p&gt;\n            &lt;pre class=\&quot;language-Rust\&quot;&gt;&lt;code class=\&quot;language-Rust\&quot;&gt;while (game in running)\n    check for user input\n    move graphics\n    play sounds\nend while&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;Well, an oversimplified version of our Workflow engine would look like this:&lt;/p&gt;\n            &lt;pre class=\&quot;language-Rust\&quot;&gt;&lt;code class=\&quot;language-Rust\&quot;&gt;while (last step not completed)\n    iterate every step\n       use memoized cache as response if the step has run already\n       continue running step or timer if it hasn&amp;#039;t finished yet\nend while&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;A workflow is indeed a loop that keeps on going, performing the same sequence of logical tasks until the last step completes.&lt;/p&gt;&lt;p&gt;The Engine and the instance run hand-in-hand in a one-to-one relationship. The first is managed, and part of the platform. It uses SQLite and other platform APIs internally, and we can constantly add new features, fix bugs, and deploy new versions, while keeping everything transparent to the end user. The second is the actual account-owned Worker script that declares the Workflow steps.&lt;/p&gt;&lt;p&gt;For example, when someone passes a callback into &lt;code&gt;step.do()&lt;/code&gt;:&lt;/p&gt;\n            &lt;pre class=\&quot;language-JavaScript\&quot;&gt;&lt;code class=\&quot;language-JavaScript\&quot;&gt;export class MyWorkflow extends WorkflowEntrypoint&amp;lt;Env, Params&amp;gt; {\n  async run(event: WorkflowEvent&amp;lt;Params&amp;gt;, step: WorkflowStep) {\n    step.do(&amp;#039;step1&amp;#039;, () =&amp;gt; { ... });\n  }\n}&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;We switch execution over to the Engine. Again, this is possible because of the power of JS RPC. Besides passing Structured Cloneable objects back and forth, JS RPC allows us to &lt;a href=\&quot;https://developers.cloudflare.com/workers/runtime-apis/rpc/#send-functions-as-parameters-of-rpc-methods\&quot;&gt;&lt;u&gt;create and pass entire application-defined classes&lt;/u&gt;&lt;/a&gt; that extend the built-in RpcTarget. So this is what happens behind the scenes when your Instance calls &lt;code&gt;step.do()&lt;/code&gt; (simplified):&lt;/p&gt;\n            &lt;pre class=\&quot;language-JavaScript\&quot;&gt;&lt;code class=\&quot;language-JavaScript\&quot;&gt;export class Context extends RpcTarget {\n\n  async do&amp;lt;T&amp;gt;(name: string, callback: () =&amp;gt; Promise&amp;lt;T&amp;gt;): Promise&amp;lt;T&amp;gt; {\n\n    // First we check we have a cache of this step.do() already\n    const maybeResult = await this.#state.storage.get(name);\n\n    // We return the cache if it exists\n    if (maybeValue) { return maybeValue; }\n\n    // Else we run the user callback\n    return doWrapper(callback);\n  }\n\n}\n&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;Here’s a more complete diagram of the Engine’s &lt;code&gt;step.do()&lt;/code&gt; lifecycle:&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/4MymVGS7BxwityCRlWcBOX/136d4dcf0affce04164f87b6bbe8b12a/image5.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1999\&quot; height=\&quot;702\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;Again, this diagram only partially represents everything we do in the Engine; things like logging for observability or handling exceptions are missing, and we don&amp;#39;t get into the details of how queuing is implemented. However, it gives you a good idea of how the Engine abstracts and handles all the complexities of completing a step under the hood, allowing us to expose a simple-to-use API to end users.&lt;/p&gt;&lt;p&gt;Also, it&amp;#39;s worth reiterating that every workflow instance is an Engine behind the scenes, and every Engine is an SQLite-backed Durable Object. This ensures that every instance runtime and state are isolated and independent of each other and that we can effortlessly scale to run billions of workflow instances, a solved problem for Durable Objects.&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/4uEoEAtsjNquPCD3F50S9d/006556baf2a0478d1de10e4514843baa/image3.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1999\&quot; height=\&quot;853\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;durability\&quot;&gt;Durability&lt;/h3&gt;\n            &lt;a href=\&quot;#durability\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Durable Execution is all the rage now when we talk about workflow engines, and ours is no exception. Workflows are typically long-lived processes that run multiple functions in sequence where anything can happen. Those functions can time out or fail because of a remote server error or a network issue and need to be retried. A workflow engine ensures that your application runs smoothly and completes regardless of the problems it encounters.&lt;/p&gt;&lt;p&gt;Durability means that if and when a workflow fails, the Engine can re-run it, resume from the last recorded step, and deterministically re-calculate the state from all the successful steps&amp;#39; cached responses. This is possible because steps are stateful and idempotent; they produce the same result no matter how many times we run them, thus not causing unintended duplicate effects like sending the same invoice to a customer multiple times.&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1R5UfQfNMKI7hB6QXJfCUr/242e85f2b5287394871e916844359bd4/image7.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1999\&quot; height=\&quot;1074\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;We ensure durability and handle failures and retries by sharing the same technique we use for a &lt;code&gt;step.sleep()&lt;/code&gt; that requires sleeping for days or months: a combination of using &lt;code&gt;scheduler.wait()&lt;/code&gt;, a method of the &lt;a href=\&quot;https://github.com/WICG/scheduling-apis\&quot;&gt;&lt;u&gt;upcoming WICG Scheduling API&lt;/u&gt;&lt;/a&gt; that we already &lt;a href=\&quot;https://developers.cloudflare.com/workers/platform/changelog/historical-changelog/#2021-12-10\&quot;&gt;&lt;u&gt;support&lt;/u&gt;&lt;/a&gt;, and &lt;a href=\&quot;https://developers.cloudflare.com/durable-objects/api/alarms/\&quot;&gt;&lt;u&gt;Durable Objects alarms&lt;/u&gt;&lt;/a&gt;, which allow you to schedule the Durable Object to be woken up at a time in the future.&lt;/p&gt;&lt;p&gt;These two APIs allow us to overcome the lack of guarantees that a Durable Object runs forever, giving us complete control of its lifecycle. Since every state transition through userland code persists in the Engine’s strongly consistent SQLite, we track timestamps when a step begins execution, its attempts (if it needs retries), and its completion.&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/6FSCXRt9fO4EaaBP7hLV8x/a59de27dfbe18f39addd4eb8240b9df9/image10.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1800\&quot; height=\&quot;794\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;This means that steps pending if a Durable Object is &lt;a href=\&quot;https://developers.cloudflare.com/durable-objects/reference/in-memory-state/\&quot;&gt;&lt;u&gt;evicted&lt;/u&gt;&lt;/a&gt; — perhaps due to a two-month-long timer — get rerun on the next lifetime of the Engine (with its cache from the previous lifetime hydrated) that is triggered by an alarm set with the timestamp of the next expected state transition. &lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;real-life-workflow-step-by-step\&quot;&gt;Real-life workflow, step by step&lt;/h2&gt;\n            &lt;a href=\&quot;#real-life-workflow-step-by-step\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;Let&amp;#39;s walk through an example of a real-life application. You run an e-commerce website and would like to send email reminders to your customers for forgotten carts that haven&amp;#39;t been checked out in a few days.&lt;/p&gt;&lt;p&gt;What would typically have to be a combination of a queue, a cron job, and querying a database table periodically can now simply be a Workflow that we start on every new cart:&lt;/p&gt;\n            &lt;pre class=\&quot;language-JavaScript\&quot;&gt;&lt;code class=\&quot;language-JavaScript\&quot;&gt;import {\n  WorkflowEntrypoint,\n  WorkflowEvent,\n  WorkflowStep,\n} from &amp;quot;cloudflare:workers&amp;quot;;\nimport { sendEmail } from &amp;quot;./legacy-email-provider&amp;quot;;\n\ntype Params = {\n  cartId: string;\n};\n\ntype Env = {\n  DB: D1Database;\n};\n\nexport class Purchase extends WorkflowEntrypoint&amp;lt;Env, Params&amp;gt; {\n  async run(\n    event: WorkflowEvent&amp;lt;Params&amp;gt;,\n    step: WorkflowStep\n  ): Promise&amp;lt;unknown&amp;gt; {\n    await step.sleep(&amp;quot;wait for three days&amp;quot;, &amp;quot;3 days&amp;quot;);\n\n    // Retrieve cart from D1\n    const cart = await step.do(&amp;quot;retrieve cart from database&amp;quot;, async () =&amp;gt; {\n      const { results } = await this.env.DB.prepare(`SELECT * FROM cart WHERE id = ?`)\n        .bind(event.payload.cartId)\n        .all();\n      return results[0];\n    });\n\n    if (!cart.checkedOut) {\n      await step.do(&amp;quot;send an email&amp;quot;, async () =&amp;gt; {\n        await sendEmail(&amp;quot;reminder&amp;quot;, cart);\n      });\n    }\n  }\n}\n&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;This works great. However, sometimes the &lt;code&gt;sendEmail&lt;/code&gt; function fails due to an upstream provider erroring out. While &lt;code&gt;step.do&lt;/code&gt; automatically retries with a reasonable default configuration, we can define our settings:&lt;/p&gt;\n            &lt;pre class=\&quot;language-JavaScript\&quot;&gt;&lt;code class=\&quot;language-JavaScript\&quot;&gt;if (cart.isComplete) {\n  await step.do(\n    &amp;quot;send an email&amp;quot;,\n    {\n      retries: {\n        limit: 5,\n        delay: &amp;quot;1 min&amp;quot;,\n        backoff: &amp;quot;exponential&amp;quot;,\n      },\n    },\n    async () =&amp;gt; {\n      await sendEmail(&amp;quot;reminder&amp;quot;, cart);\n    }\n  );\n}\n&lt;/pre&gt;&lt;/code&gt;\n            \n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;managing-workflows\&quot;&gt;Managing Workflows&lt;/h3&gt;\n            &lt;a href=\&quot;#managing-workflows\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Workflows allows us to create and manage workflows using four different interfaces:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;Using our REST HTTP API available on &lt;a href=\&quot;https://developers.cloudflare.com/api/\&quot;&gt;&lt;u&gt;Cloudflare’s API catalog&lt;/u&gt;&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Using &lt;a href=\&quot;https://developers.cloudflare.com/workers/wrangler/\&quot;&gt;&lt;u&gt;Wrangler&lt;/u&gt;&lt;/a&gt;, Cloudflare&amp;#39;s developer platform command-line tool&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Programmatically inside a Worker using &lt;a href=\&quot;https://developers.cloudflare.com/workers/runtime-apis/bindings/\&quot;&gt;&lt;u&gt;bindings&lt;/u&gt;&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Using our Web UI in the &lt;a href=\&quot;https://dash.cloudflare.com/\&quot;&gt;&lt;u&gt;dashboard&lt;/u&gt;&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;The HTTP API makes it easy to trigger new instances of workflows from any system, even if it isn’t on Cloudflare, or from the command line. For example:&lt;/p&gt;\n            &lt;pre class=\&quot;language-JavaScript\&quot;&gt;&lt;code class=\&quot;language-JavaScript\&quot;&gt;curl --request POST \\\n  --url https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/workflows/purchase-workflow/instances/$CART_INSTANCE_ID \\\n  --header &amp;#039;Authorization: Bearer $ACCOUNT_TOKEN \\\n  --header &amp;#039;Content-Type: application/json&amp;#039; \\\n  --data &amp;#039;{\n\t&amp;quot;id&amp;quot;: &amp;quot;$CART_INSTANCE_ID&amp;quot;,\n\t&amp;quot;params&amp;quot;: {\n\t\t&amp;quot;cartId&amp;quot;: &amp;quot;f3bcc11b-2833-41fb-847f-1b19469139d1&amp;quot;\n\t}\n  }&amp;#039;&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;Wrangler goes one step further and gives us a friendlier set of commands to interact with workflows with fancy formatted outputs without needing to authenticate with tokens. Type &lt;code&gt;npx wrangler workflows&lt;/code&gt; for help, or:&lt;/p&gt;\n            &lt;pre class=\&quot;language-Rust\&quot;&gt;&lt;code class=\&quot;language-Rust\&quot;&gt;npx wrangler workflows trigger purchase-workflow &amp;#039;{ &amp;quot;cartId&amp;quot;: &amp;quot;f3bcc11b-2833-41fb-847f-1b19469139d1&amp;quot; }&amp;#039;&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;Furthermore, Workflows has first-party support in wrangler, and you can test your instances locally. A Workflow is similar to a regular&lt;a href=\&quot;https://developers.cloudflare.com/workers/runtime-apis/bindings/service-bindings/rpc/\&quot;&gt;&lt;u&gt; WorkerEntrypoint&lt;/u&gt;&lt;/a&gt; in your Worker, which means that &lt;code&gt;wrangler dev&lt;/code&gt; just naturally works.&lt;/p&gt;\n            &lt;pre class=\&quot;language-JavaScript\&quot;&gt;&lt;code class=\&quot;language-JavaScript\&quot;&gt;❯ npx wrangler dev\n\n ⛅️ wrangler 3.82.0\n----------------------------\n\nYour worker has access to the following bindings:\n- Workflows:\n  - CART_WORKFLOW: EcommerceCartWorkflow\n⎔ Starting local server...\n[wrangler:inf] Ready on http://localhost:8787\n╭───────────────────────────────────────────────╮\n│  [b] open a browser, [d] open devtools        │\n╰───────────────────────────────────────────────╯\n&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;Workflow APIs are also available as a Worker binding. You can interact with the platform programmatically from another Worker script in the same account without worrying about permissions or authentication. You can even have workflows that call and interact with other workflows.&lt;/p&gt;\n            &lt;pre class=\&quot;language-JavaScript\&quot;&gt;&lt;code class=\&quot;language-JavaScript\&quot;&gt;import { WorkerEntrypoint } from &amp;quot;cloudflare:workers&amp;quot;;\n\ntype Env = { DEMO_WORKFLOW: Workflow };\nexport default class extends WorkerEntrypoint&amp;lt;Env&amp;gt; {\n  async fetch() {\n    // Pass in a user defined name for this instance\n    // In this case, we use the same as the cartId\n    const instance = await this.env.DEMO_WORKFLOW.create({\n      id: &amp;quot;f3bcc11b-2833-41fb-847f-1b19469139d1&amp;quot;,\n      params: {\n          cartId: &amp;quot;f3bcc11b-2833-41fb-847f-1b19469139d1&amp;quot;,\n      }\n    });\n  }\n  async scheduled() {\n    // Restart errored out instances in a cron\n    const instance = await this.env.DEMO_WORKFLOW.get(\n      &amp;quot;f3bcc11b-2833-41fb-847f-1b19469139d1&amp;quot;\n    );\n    const status = await instance.status();\n    if (status.error) {\n      await instance.restart();\n    }\n  }\n}&lt;/pre&gt;&lt;/code&gt;\n            \n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;observability\&quot;&gt;Observability &lt;/h3&gt;\n            &lt;a href=\&quot;#observability\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Having good observability and data on often long-lived asynchronous tasks is crucial to understanding how we&amp;#39;re doing under normal operation and, more importantly, when things go south, and we need to troubleshoot problems or when we are iterating on code changes.&lt;/p&gt;&lt;p&gt;We designed Workflows around the philosophy that there is no such thing as too much logging. You can get all the SQLite data for your workflow and its instances by calling the REST APIs. Here is the output of an instance:&lt;/p&gt;\n            &lt;pre class=\&quot;language-Rust\&quot;&gt;&lt;code class=\&quot;language-Rust\&quot;&gt;{\n  &amp;quot;success&amp;quot;: true,\n  &amp;quot;errors&amp;quot;: [],\n  &amp;quot;messages&amp;quot;: [],\n  &amp;quot;result&amp;quot;: {\n    &amp;quot;status&amp;quot;: &amp;quot;running&amp;quot;,\n    &amp;quot;params&amp;quot;: {},\n    &amp;quot;trigger&amp;quot;: { &amp;quot;source&amp;quot;: &amp;quot;api&amp;quot; },\n    &amp;quot;versionId&amp;quot;: &amp;quot;ae042999-39ff-4d27-bbcd-22e03c7c4d02&amp;quot;,\n    &amp;quot;queued&amp;quot;: &amp;quot;2024-10-21 17:15:09.350&amp;quot;,\n    &amp;quot;start&amp;quot;: &amp;quot;2024-10-21 17:15:09.350&amp;quot;,\n    &amp;quot;end&amp;quot;: null,\n    &amp;quot;success&amp;quot;: null,\n    &amp;quot;steps&amp;quot;: [\n      {\n        &amp;quot;name&amp;quot;: &amp;quot;send email&amp;quot;,\n        &amp;quot;start&amp;quot;: &amp;quot;2024-10-21 17:15:09.411&amp;quot;,\n        &amp;quot;end&amp;quot;: &amp;quot;2024-10-21 17:15:09.678&amp;quot;,\n        &amp;quot;attempts&amp;quot;: [\n          {\n            &amp;quot;start&amp;quot;: &amp;quot;2024-10-21 17:15:09.411&amp;quot;,\n            &amp;quot;end&amp;quot;: &amp;quot;2024-10-21 17:15:09.678&amp;quot;,\n            &amp;quot;success&amp;quot;: true,\n            &amp;quot;error&amp;quot;: null\n          }\n        ],\n        &amp;quot;config&amp;quot;: {\n          &amp;quot;retries&amp;quot;: { &amp;quot;limit&amp;quot;: 5, &amp;quot;delay&amp;quot;: 1000, &amp;quot;backoff&amp;quot;: &amp;quot;constant&amp;quot; },\n          &amp;quot;timeout&amp;quot;: &amp;quot;15 minutes&amp;quot;\n        },\n        &amp;quot;output&amp;quot;: &amp;quot;celso@example.com&amp;quot;,\n        &amp;quot;success&amp;quot;: true,\n        &amp;quot;type&amp;quot;: &amp;quot;step&amp;quot;\n      },\n      {\n        &amp;quot;name&amp;quot;: &amp;quot;sleep-1&amp;quot;,\n        &amp;quot;start&amp;quot;: &amp;quot;2024-10-21 17:15:09.763&amp;quot;,\n        &amp;quot;end&amp;quot;: &amp;quot;2024-10-21 17:17:09.763&amp;quot;,\n        &amp;quot;finished&amp;quot;: false,\n        &amp;quot;type&amp;quot;: &amp;quot;sleep&amp;quot;,\n        &amp;quot;error&amp;quot;: null\n      }\n    ],\n    &amp;quot;error&amp;quot;: null,\n    &amp;quot;output&amp;quot;: null\n  }\n}&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;As you can see, this is essentially a dump of the instance engine SQLite in JSON. You have the &lt;b&gt;errors&lt;/b&gt;, &lt;b&gt;messages&lt;/b&gt;, current &lt;b&gt;status&lt;/b&gt;, and what happened with &lt;b&gt;every step&lt;/b&gt;, all time stamped to the millisecond.&lt;/p&gt;&lt;p&gt;It&amp;#39;s one thing to get data about a specific workflow instance, but it&amp;#39;s another to zoom out and look at aggregated statistics of all your workflows and instances over time. Workflows data is available through our &lt;a href=\&quot;https://developers.cloudflare.com/analytics/graphql-api/\&quot;&gt;&lt;u&gt;GraphQL Analytics API&lt;/u&gt;&lt;/a&gt;, so you can query it in aggregate and generate valuable insights and reports. In this example we ask for aggregated analytics about the wall time of all the instances of the “e-commerce-carts” workflow:&lt;/p&gt;\n            &lt;pre class=\&quot;language-Rust\&quot;&gt;&lt;code class=\&quot;language-Rust\&quot;&gt;{\n  viewer {\n    accounts(filter: { accountTag: &amp;quot;febf0b1a15b0ec222a614a1f9ac0f0123&amp;quot; }) {\n      wallTime: workflowsAdaptiveGroups(\n        limit: 10000\n        filter: {\n          datetimeHour_geq: &amp;quot;2024-10-20T12:00:00.000Z&amp;quot;\n          datetimeHour_leq: &amp;quot;2024-10-21T12:00:00.000Z&amp;quot;\n          workflowName: &amp;quot;e-commerce-carts&amp;quot;\n        }\n        orderBy: [count_DESC]\n      ) {\n        count\n        sum {\n          wallTime\n        }\n        dimensions {\n          date: datetimeHour\n        }\n      }\n    }\n  }\n}\n&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;For convenience, you can evidently also use Wrangler to describe a workflow or an instance and get an instant and beautifully formatted response:&lt;/p&gt;\n            &lt;pre class=\&quot;language-JavaScript\&quot;&gt;&lt;code class=\&quot;language-JavaScript\&quot;&gt;sid ~ npx wrangler workflows instances describe purchase-workflow latest\n\n ⛅️ wrangler 3.80.4\n\nWorkflow Name:         purchase-workflow\nInstance Id:           d4280218-7756-41d2-bccd-8d647b82d7ce\nVersion Id:            0c07dbc4-aaf3-44a9-9fd0-29437ed11ff6\nStatus:                ✅ Completed\nTrigger:               🌎 API\nQueued:                14/10/2024, 16:25:17\nSuccess:               ✅ Yes\nStart:                 14/10/2024, 16:25:17\nEnd:                   14/10/2024, 16:26:17\nDuration:              1 minute\nLast Successful Step:  wait for three days\nOutput:                false\nSteps:\n\n  Name:      wait for three days\n  Type:      💤 Sleeping\n  Start:     14/10/2024, 16:25:17\n  End:       17/10/2024, 16:25:17\n  Duration:  3 day&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;And finally, we worked really hard to get you the best dashboard UI experience when navigating Workflows data.&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/64XUtBwldkSXUTJ5xEJBgo/2aa861583c8c56c19194cb0869a15a2a/image8.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1960\&quot; height=\&quot;1360\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;so-how-much-does-it-cost\&quot;&gt;So, how much does it cost?&lt;/h2&gt;\n            &lt;a href=\&quot;#so-how-much-does-it-cost\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;It’d be painful if we introduced a powerful new way to build Workers applications but made it cost prohibitive.&lt;/p&gt;&lt;p&gt;Workflows is &lt;a href=\&quot;https://developers.cloudflare.com/workers/platform/pricing/#workers\&quot;&gt;&lt;u&gt;priced&lt;/u&gt;&lt;/a&gt; just like Cloudflare Workers, where we &lt;a href=\&quot;https://blog.cloudflare.com/workers-pricing-scale-to-zero/\&quot;&gt;&lt;u&gt;introduced CPU-based pricing&lt;/u&gt;&lt;/a&gt;: only on active CPU time and requests, not duration (aka: wall time).&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/11WroT4xt0zPj6bsou4u3X/8f2775569f280107345322cb97603b3e/image4.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1600\&quot; height=\&quot;512\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;&lt;sup&gt;&lt;i&gt;Workers Standard pricing model&lt;/i&gt;&lt;/sup&gt;&lt;/p&gt;&lt;p&gt;This is especially advantageous when building the long-running, multi-step applications that Workflows enables: if you had to pay while your Workflow was sleeping, waiting on an event, or making a network call to an API, writing the “right” code would be at odds with writing affordable code.&lt;/p&gt;&lt;p&gt;There’s also no need to keep a Kubernetes cluster or a group of virtual machines running (and burning a hole in your wallet): we manage the infrastructure, and you only pay for the compute your Workflows consume.   &lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;whats-next\&quot;&gt;What’s next?&lt;/h2&gt;\n            &lt;a href=\&quot;#whats-next\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;Today, after months of developing the platform, we are announcing the open beta program, and we couldn&amp;#39;t be more excited to see how you will be using Workflows. Looking forward, we want to do things like triggering instances from queue messages and have other ideas, but at the same time, we are certain that your feedback will help us shape the roadmap ahead.&lt;/p&gt;&lt;p&gt;We hope that this blog post gets you thinking about how to use Workflows for your next application, but also that it inspires you on what you can build on top of Workers. Workflows as a platform is entirely built on top of Workers, its resources, and APIs. Anyone can do it, too.&lt;/p&gt;&lt;p&gt;To chat with the team and other developers building on Workflows, join the #workflows-beta channel on the&lt;a href=\&quot;https://discord.cloudflare.com/\&quot;&gt; &lt;u&gt;Cloudflare Developer Discord&lt;/u&gt;&lt;/a&gt;, and keep an eye on the&lt;a href=\&quot;https://developers.cloudflare.com/workflows/reference/changelog/\&quot;&gt; &lt;u&gt;Workflows changelog&lt;/u&gt;&lt;/a&gt; during the beta. Otherwise,&lt;a href=\&quot;https://developers.cloudflare.com/workflows/get-started/guide/\&quot;&gt; visit the Workflows tutorial&lt;/a&gt; to get started.&lt;/p&gt;&lt;p&gt;If you&amp;#39;re an engineer, &lt;a href=\&quot;https://www.cloudflare.com/en-gb/careers/jobs/\&quot;&gt;&lt;u&gt;look for opportunities&lt;/u&gt;&lt;/a&gt; to work with us and help us improve Workflows or build other products.&lt;/p&gt;&quot;],&quot;published_at&quot;:[0,&quot;2024-10-24T14:05+01:00&quot;],&quot;updated_at&quot;:[0,&quot;2024-10-25T06:06:55.297Z&quot;],&quot;feature_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/Xlle0u2YPZdCmNhVUIiJi/bdc13b0043d9850fb4d68632c063aabf/unnamed.png&quot;],&quot;tags&quot;:[1,[[0,{&quot;id&quot;:[0,&quot;3JAY3z7p7An94s6ScuSQPf&quot;],&quot;name&quot;:[0,&quot;Developer Platform&quot;],&quot;slug&quot;:[0,&quot;developer-platform&quot;]}],[0,{&quot;id&quot;:[0,&quot;6hbkItfupogJP3aRDAq6v8&quot;],&quot;name&quot;:[0,&quot;Cloudflare Workers&quot;],&quot;slug&quot;:[0,&quot;workers&quot;]}],[0,{&quot;id&quot;:[0,&quot;5v2UZdTRX1Rw9akmhexnxs&quot;],&quot;name&quot;:[0,&quot;Durable Objects&quot;],&quot;slug&quot;:[0,&quot;durable-objects&quot;]}],[0,{&quot;id&quot;:[0,&quot;1KBFlaTf50eub8uvJ1pAt1&quot;],&quot;name&quot;:[0,&quot;Workflows&quot;],&quot;slug&quot;:[0,&quot;workflows&quot;]}]]],&quot;relatedTags&quot;:[0],&quot;authors&quot;:[1,[[0,{&quot;name&quot;:[0,&quot;Sid Chatterjee&quot;],&quot;slug&quot;:[0,&quot;sid&quot;],&quot;bio&quot;:[0,null],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/66pIfBfhDUadwWztfEDfXe/66d41b9c01e48856fd1deb323d9007a9/sid.jpg&quot;],&quot;location&quot;:[0,&quot;London, United Kingdom&quot;],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,&quot;@chatsidhartha&quot;],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}],[0,{&quot;name&quot;:[0,&quot;Matt Silverlock&quot;],&quot;slug&quot;:[0,&quot;silverlock&quot;],&quot;bio&quot;:[0,&quot;Director of Product at Cloudflare.&quot;],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/7xP5qePZD9eyVtwIesXYxh/e714aaa573161ec9eb48d59bd1aa6225/silverlock.jpeg&quot;],&quot;location&quot;:[0,null],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,&quot;@elithrar&quot;],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}],[0,{&quot;name&quot;:[0,&quot;Celso Martinho&quot;],&quot;slug&quot;:[0,&quot;celso&quot;],&quot;bio&quot;:[0,&quot;From when Mosaic took over Gopher. Engineering Director at Cloudflare.&quot;],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/2pzgat1zmt1oF1byi7hskH/7b25e8e00117ee44afe36ad27d7d8032/celso.png&quot;],&quot;location&quot;:[0,&quot;Portugal, Lisbon&quot;],&quot;website&quot;:[0,&quot;https://celso.io/&quot;],&quot;twitter&quot;:[0,&quot;@celso&quot;],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}]]],&quot;meta_description&quot;:[0,&quot;Cloudflare Workflows is now in open beta! Workflows allows you to build reliable, repeatable, long-lived multistep applications that can automatically retry, persist state, and scale out. Read on to learn how Workflows works, how we built it on top of Durable Objects, and how you can deploy your first Workflows application.&quot;],&quot;primary_author&quot;:[0,{}],&quot;localeList&quot;:[0,{&quot;name&quot;:[0,&quot;blog-english-only&quot;],&quot;enUS&quot;:[0,&quot;English for Locale&quot;],&quot;zhCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhHansCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhTW&quot;:[0,&quot;No Page for Locale&quot;],&quot;frFR&quot;:[0,&quot;No Page for Locale&quot;],&quot;deDE&quot;:[0,&quot;No Page for Locale&quot;],&quot;itIT&quot;:[0,&quot;No Page for Locale&quot;],&quot;jaJP&quot;:[0,&quot;No Page for Locale&quot;],&quot;koKR&quot;:[0,&quot;No Page for Locale&quot;],&quot;ptBR&quot;:[0,&quot;No Page for Locale&quot;],&quot;esLA&quot;:[0,&quot;No Page for Locale&quot;],&quot;esES&quot;:[0,&quot;No Page for Locale&quot;],&quot;enAU&quot;:[0,&quot;No Page for Locale&quot;],&quot;enCA&quot;:[0,&quot;No Page for Locale&quot;],&quot;enIN&quot;:[0,&quot;No Page for Locale&quot;],&quot;enGB&quot;:[0,&quot;No Page for Locale&quot;],&quot;idID&quot;:[0,&quot;No Page for Locale&quot;],&quot;ruRU&quot;:[0,&quot;No Page for Locale&quot;],&quot;svSE&quot;:[0,&quot;No Page for Locale&quot;],&quot;viVN&quot;:[0,&quot;No Page for Locale&quot;],&quot;plPL&quot;:[0,&quot;No Page for Locale&quot;],&quot;arAR&quot;:[0,&quot;No Page for Locale&quot;],&quot;nlNL&quot;:[0,&quot;No Page for Locale&quot;],&quot;thTH&quot;:[0,&quot;No Page for Locale&quot;],&quot;trTR&quot;:[0,&quot;No Page for Locale&quot;],&quot;heIL&quot;:[0,&quot;No Page for Locale&quot;],&quot;lvLV&quot;:[0,&quot;No Page for Locale&quot;],&quot;etEE&quot;:[0,&quot;No Page for Locale&quot;],&quot;ltLT&quot;:[0,&quot;No Page for Locale&quot;]}],&quot;url&quot;:[0,&quot;https://blog.cloudflare.com/building-workflows-durable-execution-on-workers&quot;],&quot;metadata&quot;:[0,{&quot;title&quot;:[0,&quot;Build durable applications on Cloudflare Workers: you write the Workflows, we take care of the rest&quot;],&quot;description&quot;:[0,&quot;Cloudflare Workflows is now in open beta! Workflows allows you to build reliable, repeatable, long-lived multi-step applications that can automatically retry, persist state, and scale out. Read on to learn how Workflows works, how we built it on top of Durable Objects, and how you can deploy your first Workflows application.&quot;],&quot;imgPreview&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/2M5hbMGRUR4iun8HRKh5CT/df3a02f850b831c4910e76049292293d/Build_durable_applications_on_Cloudflare_Workers-_you_write_the_Workflows__we_take_care_of_the_rest-OG.png&quot;]}],&quot;publicly_index&quot;:[0,true]}],[0,{&quot;id&quot;:[0,&quot;2LUyKREpCJjJ5qGqwZyoAx&quot;],&quot;title&quot;:[0,&quot;Billions and billions (of logs): scaling AI Gateway with the Cloudflare Developer Platform&quot;],&quot;slug&quot;:[0,&quot;billions-and-billions-of-logs-scaling-ai-gateway-with-the-cloudflare&quot;],&quot;excerpt&quot;:[0,&quot;How we scaled AI Gateway to handle and store billions of requests, using Cloudflare Workers, D1, Durable Objects, and R2.&quot;],&quot;featured&quot;:[0,false],&quot;html&quot;:[0,&quot;&lt;p&gt;With the rapid advancements occurring in the AI space, developers face significant challenges in keeping up with the ever-changing landscape. New models and providers are continuously emerging, and understandably, developers want to experiment and test these options to find the best fit for their use cases. This creates the need for a streamlined approach to managing multiple models and providers, as well as a centralized platform to efficiently monitor usage, implement controls, and gather data for optimization.&lt;/p&gt;&lt;p&gt;&lt;a href=\&quot;https://developers.cloudflare.com/ai-gateway/\&quot;&gt;&lt;u&gt;AI Gateway&lt;/u&gt;&lt;/a&gt; is specifically designed to address these pain points. Since its launch in &lt;a href=\&quot;https://blog.cloudflare.com/announcing-ai-gateway\&quot;&gt;&lt;u&gt;September 2023&lt;/u&gt;&lt;/a&gt;, AI Gateway has empowered developers and organizations by successfully proxying over 2 billion requests in just one year, as we &lt;a href=\&quot;https://blog.cloudflare.com/workers-ai-bigger-better-faster/#optimizing-ai-workflows-with-ai-gateway\&quot;&gt;&lt;u&gt;highlighted during September’s Birthday Week&lt;/u&gt;&lt;/a&gt;. With AI Gateway, developers can easily store, analyze, and optimize their AI &lt;a href=\&quot;https://www.cloudflare.com/learning/ai/inference-vs-training/\&quot;&gt;&lt;u&gt;inference&lt;/u&gt;&lt;/a&gt; requests and responses in real time.&lt;/p&gt;&lt;p&gt;With our initial architecture, AI Gateway faced a significant challenge: the logs, those critical trails of data interactions between applications and AI models, could only be retained for 30 minutes. This limitation was not just a minor inconvenience; it posed a substantial barrier for developers and businesses needing to analyze long-term patterns, ensure compliance, or simply debug over more extended periods.&lt;/p&gt;&lt;p&gt;In this post, we&amp;#39;ll explore the technical challenges and strategic decisions behind extending our log storage capabilities from 30 minutes to being able to store billions of logs indefinitely. We&amp;#39;ll discuss the challenges of scale, the intricacies of data management, and how we&amp;#39;ve engineered a system that not only meets the demands of today, but is also scalable for the future of AI development.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;background\&quot;&gt;Background&lt;/h2&gt;\n            &lt;a href=\&quot;#background\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;AI Gateway is built on &lt;a href=\&quot;https://workers.cloudflare.com\&quot;&gt;&lt;u&gt;Cloudflare Workers&lt;/u&gt;&lt;/a&gt;, a serverless platform that runs on the Cloudflare network, allowing developers to write small JavaScript functions that can execute at the point of need, near the user, on Cloudflare&amp;#39;s vast network of data centers, without worrying about platform scalability.&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/6jV3iKCN771ixU21Hixfpz/18086a52cfe05cd20f1c94bbba21e293/_BLOG-2593_2.png\&quot; alt=\&quot;BLOG-2593 2\&quot; class=\&quot;kg-image\&quot; width=\&quot;1954\&quot; height=\&quot;291\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;Our customers use multiple providers and models and are always looking to optimize the way they do inference. And, of course, in order to evaluate their prompts, performance, cost, and to troubleshoot what’s going on, AI Gateway’s customers need to store requests and responses. New requests show up within 15 seconds and customers can check a request’s cost, duration, number of tokens, and provide their feedback (thumbs up or down).&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/RBqZXnLJNCaQPbtbzjQmj/70aa2598f9b9294b67db8cd5712a6345/_BLOG-2593_3.png\&quot; alt=\&quot;BLOG-2593 3\&quot; class=\&quot;kg-image\&quot; width=\&quot;1999\&quot; height=\&quot;1080\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;This scales in a way where an account can have multiple gateways and each gateway has its own settings. In our first implementation, a backend worker was responsible for storing Real Time Logs and other background tasks. However, in the rapidly evolving domain of artificial intelligence, where real-time data is as precious as the insights it provides, managing log data efficiently becomes paramount. We recognized that to truly empower our users, we needed to offer a solution where logs weren&amp;#39;t just transient records but could be stored permanently. Permanent log storage means developers can now track the performance, security, and operational insights of their AI applications over time, enabling not only immediate troubleshooting but also longitudinal studies of AI behavior, usage trends, and system health.&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1TcC1ZdyNzT0xwFwme2oBt/a9202691a0a983fa3eafdf6c0ee92f2c/_BLOG-2593_4.png\&quot; alt=\&quot;BLOG-2593 4\&quot; class=\&quot;kg-image\&quot; width=\&quot;1173\&quot; height=\&quot;410\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;The diagram above describes our old architecture, which could only store 30 minutes of data.&lt;/p&gt;&lt;p&gt;Tracing the path of a request through the AI Gateway, as depicted in the sequence above:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;&lt;p&gt;A developer sends a new inference request, which is first received by our Gateway Worker.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;The Gateway Worker then performs several checks: it looks for cached results, enforces rate limits, and verifies any other configurations set by the user for their gateway. Provided all conditions are met, it forwards the request to the selected inference provider (in this diagram, OpenAI).&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;The inference provider processes the request and sends back the response.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Simultaneously, as the response is relayed back to the developer, the request and response details are also dispatched to our Backend Worker. This worker&amp;#39;s role is to manage and store the log of this transaction.&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;the-challenge-store-two-billion-logs\&quot;&gt;The challenge: Store two billion logs&lt;/h2&gt;\n            &lt;a href=\&quot;#the-challenge-store-two-billion-logs\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          \n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;first-step-real-time-logs\&quot;&gt;First step: real-time logs&lt;/h3&gt;\n            &lt;a href=\&quot;#first-step-real-time-logs\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Initially, the AI Gateway project stored both request metadata and the actual request bodies in a &lt;a href=\&quot;https://developers.cloudflare.com/d1/\&quot;&gt;&lt;u&gt;D1 database&lt;/u&gt;&lt;/a&gt;. This approach facilitated rapid development in the project&amp;#39;s infancy. However, as customer engagement grew, the D1 database began to fill at an accelerating rate, eventually retaining logs for only 30 minutes at a time.&lt;/p&gt;&lt;p&gt;To mitigate this, we first optimized the database schema, which extended the log retention to one hour. However, we soon encountered diminishing returns due to the sheer volume of byte data from the request bodies. Post-launch, it became clear that a more scalable solution was necessary. We decided to migrate the request bodies to R2 storage, significantly alleviating the data load on D1. This adjustment allowed us to incrementally extend log retention to 24 hours.&lt;/p&gt;&lt;p&gt;Consequently, D1 functioned primarily as a log index, enabling users to search and filter logs efficiently. When users needed to view details or download a log, these actions were seamlessly proxied through to R2.&lt;/p&gt;&lt;p&gt;This dual-system approach provided us with the breathing room to contemplate and develop more sophisticated storage solutions for the future.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;second-step-persistent-logs-and-durable-object-transactional-storage\&quot;&gt;Second step: persistent logs and Durable Object transactional storage&lt;/h3&gt;\n            &lt;a href=\&quot;#second-step-persistent-logs-and-durable-object-transactional-storage\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;As our traffic surged, we encountered a growing number of requests from customers wanting to access and compare older logs.&lt;/p&gt;&lt;p&gt;Upon learning that the Durable Objects team was seeking beta testers for their new &lt;a href=\&quot;https://blog.cloudflare.com/sqlite-in-durable-objects/\&quot;&gt;&lt;u&gt;Durable Objects with SQLite&lt;/u&gt;&lt;/a&gt;, we eagerly signed up.&lt;/p&gt;&lt;p&gt;Originally, we considered Durable Objects as the ideal solution for expanding our log storage capacity, which required us to shard the logs by a unique string. Initially, this string was the account ID, but during a mid-development load test, we hit a cap at 10 million logs per Durable Object. This limitation meant that each account could only support up to this number of logs.&lt;/p&gt;&lt;p&gt;Given our commitment to the DO migration, we saw an opportunity rather than a constraint. To overcome the 10 million log limit per account, we refined our approach to shard by both account ID and gateway name. This adjustment effectively raised the storage ceiling from 10 million logs per account to 10 million per gateway. With the default setting allowing each account up to 10 gateways, the potential storage for each account skyrocketed to 100 million logs.&lt;/p&gt;&lt;p&gt;This strategic pivot not only enabled us to store a significantly larger number of logs. But also enhanced our flexibility in gateway management. Now, when a gateway is deleted, we can simply remove the corresponding Durable Object.&lt;/p&gt;&lt;p&gt;Additionally, this sharding method isolates high-volume request scenarios. If one customer&amp;#39;s heavy usage slows down log insertion, it only impacts their specific Durable Object, thereby preserving performance for other customers.&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/3Q6degDA3V02dZFVugW2LO/ae121890a3d4493e5c01459c477f32d9/_BLOG-2593_5.png\&quot; alt=\&quot;BLOG-2593 5\&quot; class=\&quot;kg-image\&quot; width=\&quot;1173\&quot; height=\&quot;410\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;Taking a glance at the revised architecture diagram, we replaced the Backend Worker with our newly integrated Durable Object. The rest of the request flow remains unchanged, including the concurrent response to the user and the interaction with the Durable Object, which occurs in the fourth step.&lt;/p&gt;&lt;p&gt;Leveraging Cloudflare’s network, our Gateway Worker operates near the user&amp;#39;s location, which in turn positions the user&amp;#39;s Durable Object close by. This proximity significantly enhances the speed of log insertion and query operations.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;third-step-managing-thousands-of-durable-objects\&quot;&gt;Third step: managing thousands of Durable Objects&lt;/h3&gt;\n            &lt;a href=\&quot;#third-step-managing-thousands-of-durable-objects\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;As the number of users and requests on AI Gateway grows, managing each unique Durable Object (DO) becomes increasingly complex. New customers join continuously, and we needed an efficient method to track each DO, ensure users stay within their 10 gateway limit, and manage the storage capacity for free users.&lt;/p&gt;&lt;p&gt;To address these challenges, we introduced another layer of control with a new Durable Object we&amp;#39;ve named the Account Manager. The primary function of the Account Manager is straightforward yet crucial: it keeps user activities in check.&lt;/p&gt;&lt;p&gt;Here&amp;#39;s how it works: before any Gateway commits a new log to permanent storage, it consults the Account Manager. This check determines whether the gateway is allowed to insert the log based on the user&amp;#39;s current usage and entitlements. The Account Manager uses its own SQLite database to verify the total number of rows a user has and their service level. If all checks pass, it signals the Gateway that the log can be inserted. It was paramount to guarantee that this entire validation process occurred in the background, ensuring that the user experience remains seamless and uninterrupted.&lt;/p&gt;&lt;p&gt;The Account Manager stays updated by periodically receiving data from each Gateway’s Durable Object. Specifically, after every 1000 inference requests, the Gateway sends an update on its total rows to the Account Manager, which then updates its local records. This system ensures that the Account Manager has the most current data when making its decisions.&lt;/p&gt;&lt;p&gt;Additionally, the Account Manager is responsible for monitoring customer entitlements. It tracks whether an account is on a free or paid plan, how many gateways a user is permitted to create, and the log storage capacity allocated to each gateway. &lt;/p&gt;&lt;p&gt;Through these mechanisms, the Account Manager not only helps in maintaining system integrity but also ensures fair usage across all users of AI Gateway.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;ai-evaluations-and-durable-objects-sharding\&quot;&gt;AI evaluations and Durable Objects sharding&lt;/h2&gt;\n            &lt;a href=\&quot;#ai-evaluations-and-durable-objects-sharding\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;As we continue to develop evaluations to fully automatic and, in the future, use Large Language Models (LLMs),  we are now taking the first step towards this goal and launching the open beta phase of comprehensive &lt;a href=\&quot;https://blog.cloudflare.com/workers-ai-bigger-better-faster/#optimizing-ai-workflows-with-ai-gateway\&quot;&gt;&lt;u&gt;AI evaluations&lt;/u&gt;&lt;/a&gt;, centered on Human-in-the-Loop feedback.&lt;/p&gt;&lt;p&gt;This feature empowers users to create bespoke datasets from their application logs, thereby enabling them to score and evaluate the performance, speed, and cost-effectiveness of their models, with a primary focus on LLMs and automated scoring, analyzing the performance of LLMs, providing developers with objective, data-driven insights to refine their models.&lt;/p&gt;&lt;p&gt;To do this, developers require a reliable logging mechanism that persists logs from multiple gateways, storing up to 100 million logs in total (10 million logs per gateway, across 10 gateways). This represents a significant volume of data, as each request made through the AI Gateway generates a log entry, with some log entries potentially exceeding 50 MB in size.&lt;/p&gt;&lt;p&gt;This necessity leads us to work on the expansion of log storage capabilities. Since log storage is limited to 10 million logs per gateway, in future iterations, we aim to scale this capacity by implementing sharded Durable Objects (DO), allowing multiple Durable Objects per gateway to handle and store logs. This scaling strategy will enable us to store significantly larger volumes of logs, providing richer data for evaluations (using LLMs as a judge or from user input), all through AI Gateway.&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/7FLy2JEfvGFo8P7PCVBZYT/a4d6367341e9fc224dedaad3aa0f02e2/_BLOG-2593_6.png\&quot; alt=\&quot;BLOG-2593 6\&quot; class=\&quot;kg-image\&quot; width=\&quot;954\&quot; height=\&quot;751\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;coming-soon\&quot;&gt;Coming Soon&lt;/h2&gt;\n            &lt;a href=\&quot;#coming-soon\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;We are working on improving our existing &lt;a href=\&quot;https://developers.cloudflare.com/ai-gateway/providers/universal/\&quot;&gt;&lt;u&gt;Universal Endpoint&lt;/u&gt;&lt;/a&gt;, the next step on an enhanced solution that builds on existing fallback mechanisms to offer greater resilience, flexibility, and intelligence in request management.&lt;/p&gt;&lt;p&gt;Currently, when a provider encounters an error or is unavailable, our system &lt;a href=\&quot;https://developers.cloudflare.com/ai-gateway/configuration/fallbacks/\&quot;&gt;&lt;u&gt;falls back&lt;/u&gt;&lt;/a&gt; to an alternative provider to ensure continuity. The improved Universal Endpoint takes this a step further by introducing automatic retry capabilities, allowing failed requests to be reattempted before fallback is triggered. This significantly improves reliability by handling transient errors and increasing the likelihood of successful request fulfillment. It will look something like this:&lt;/p&gt;\n            &lt;pre class=\&quot;language-RUST\&quot;&gt;&lt;code class=\&quot;language-RUST\&quot;&gt;curl --location &amp;#039;https://aig.example.com/&amp;#039; \\\n--header &amp;#039;CF-AIG-TOKEN: Bearer XXXX&amp;#039; \\\n--header &amp;#039;Content-Type: application/json&amp;#039; \\\n--data-raw &amp;#039;[\n    {\n        &amp;quot;id&amp;quot;: &amp;quot;0001&amp;quot;,\n        &amp;quot;provider&amp;quot;: &amp;quot;openai&amp;quot;,\n        &amp;quot;endpoint&amp;quot;: &amp;quot;chat/completions&amp;quot;,\n        &amp;quot;headers&amp;quot;: {\n            &amp;quot;Authorization&amp;quot;: &amp;quot;Bearer XXXX&amp;quot;,\n            &amp;quot;Content-Type&amp;quot;: &amp;quot;application/json&amp;quot;\n        },\n        &amp;quot;query&amp;quot;: {\n            &amp;quot;model&amp;quot;: &amp;quot;gpt-3.5-turbo&amp;quot;,\n            &amp;quot;messages&amp;quot;: [\n                {\n                    &amp;quot;role&amp;quot;: &amp;quot;user&amp;quot;,\n                    &amp;quot;content&amp;quot;: &amp;quot;generate a prompt to create cloudflare random images&amp;quot;\n                }\n            ]\n        },\n        &amp;quot;option&amp;quot;: {\n            &amp;quot;retry&amp;quot;: 2,\n            &amp;quot;delay&amp;quot;: 200,\n            &amp;quot;onComplete&amp;quot;: {\n                &amp;quot;provider&amp;quot;: &amp;quot;workers-ai&amp;quot;,\n                &amp;quot;endpoint&amp;quot;: &amp;quot;@cf/stabilityai/stable-diffusion-xl-base-1.0&amp;quot;,\n                &amp;quot;headers&amp;quot;: {\n                    &amp;quot;Authorization&amp;quot;: &amp;quot;Bearer XXXXXX&amp;quot;,\n                    &amp;quot;Content-Type&amp;quot;: &amp;quot;application/json&amp;quot;\n                },\n                &amp;quot;query&amp;quot;: {\n                    &amp;quot;messages&amp;quot;: [\n                        {\n                            &amp;quot;role&amp;quot;: &amp;quot;user&amp;quot;,\n                            &amp;quot;content&amp;quot;: &amp;quot;&amp;lt;prompt-response id=&amp;#039;\\&amp;#039;&amp;#039;0001&amp;#039;\\&amp;#039;&amp;#039; /&amp;gt;&amp;quot;\n                        }\n                    ]\n                }\n            }\n        }\n    },\n    {\n        &amp;quot;provider&amp;quot;: &amp;quot;workers-ai&amp;quot;,\n        &amp;quot;endpoint&amp;quot;: &amp;quot;@cf/stabilityai/stable-diffusion-xl-base-1.0&amp;quot;,\n        &amp;quot;headers&amp;quot;: {\n            &amp;quot;Authorization&amp;quot;: &amp;quot;Bearer XXXXXX&amp;quot;,\n            &amp;quot;Content-Type&amp;quot;: &amp;quot;application/json&amp;quot;\n        },\n        &amp;quot;query&amp;quot;: {\n            &amp;quot;messages&amp;quot;: [\n                {\n                    &amp;quot;role&amp;quot;: &amp;quot;user&amp;quot;,\n                    &amp;quot;content&amp;quot;: &amp;quot;create a image of a missing cat&amp;quot;\n                }\n            ]\n        }\n    }\n]&amp;#039;&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;The request to the improved Universal Endpoint system demonstrates how it handles multiple providers with integrated retry mechanisms and fallback logic. In this example, the first request is sent to a provider like OpenAI, asking it to generate a text-to-image prompt. The “retry” option ensures that transient issues don’t result in immediate failure.&lt;/p&gt;&lt;p&gt;The system’s ability to seamlessly switch between providers while applying retry strategies ensures higher reliability and robustness in managing requests. By leveraging fallback logic, the Improved Universal Endpoint can dynamically adapt to provider failures, ensuring that tasks are completed successfully even in complex, multi-step workflows.&lt;/p&gt;&lt;p&gt;In addition to retry logic, we will have the ability to inspect requests and responses and make dynamic decisions based on the content of the result. This enables developers to create conditional workflows where the system can adapt its behavior depending on the nature of the response, creating a highly flexible and intelligent decision-making process.&lt;/p&gt;&lt;p&gt;If you haven’t yet used AI Gateway, check out our &lt;a href=\&quot;https://developers.cloudflare.com/ai-gateway/\&quot;&gt;&lt;u&gt;developer documentation&lt;/u&gt;&lt;/a&gt; on how to get started. If you have any questions, reach out on our &lt;a href=\&quot;http://discord.cloudflare.com/\&quot;&gt;&lt;u&gt;Discord channel&lt;/u&gt;&lt;/a&gt;.&lt;/p&gt;&quot;],&quot;published_at&quot;:[0,&quot;2024-10-24T14:00+01:00&quot;],&quot;updated_at&quot;:[0,&quot;2024-12-12T00:02:22.435Z&quot;],&quot;feature_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/617BMsL3rCnCVbJka70swV/a6e1c03a1ee940a18b3c95c6c3d8642b/_BLOG-2593_1.png&quot;],&quot;tags&quot;:[1,[[0,{&quot;id&quot;:[0,&quot;6Foe3R8of95cWVnQwe5Toi&quot;],&quot;name&quot;:[0,&quot;AI&quot;],&quot;slug&quot;:[0,&quot;ai&quot;]}],[0,{&quot;id&quot;:[0,&quot;1GyUhE8o287lrdNSpdRUIe&quot;],&quot;name&quot;:[0,&quot;AI Gateway&quot;],&quot;slug&quot;:[0,&quot;ai-gateway&quot;]}],[0,{&quot;id&quot;:[0,&quot;5v2UZdTRX1Rw9akmhexnxs&quot;],&quot;name&quot;:[0,&quot;Durable Objects&quot;],&quot;slug&quot;:[0,&quot;durable-objects&quot;]}],[0,{&quot;id&quot;:[0,&quot;UKt2GEAUQsbObsNqZ3Pr7&quot;],&quot;name&quot;:[0,&quot;D1&quot;],&quot;slug&quot;:[0,&quot;d1&quot;]}],[0,{&quot;id&quot;:[0,&quot;3JAY3z7p7An94s6ScuSQPf&quot;],&quot;name&quot;:[0,&quot;Developer Platform&quot;],&quot;slug&quot;:[0,&quot;developer-platform&quot;]}],[0,{&quot;id&quot;:[0,&quot;4HIPcb68qM0e26fIxyfzwQ&quot;],&quot;name&quot;:[0,&quot;Developers&quot;],&quot;slug&quot;:[0,&quot;developers&quot;]}],[0,{&quot;id&quot;:[0,&quot;6hbkItfupogJP3aRDAq6v8&quot;],&quot;name&quot;:[0,&quot;Cloudflare Workers&quot;],&quot;slug&quot;:[0,&quot;workers&quot;]}],[0,{&quot;id&quot;:[0,&quot;7JpaihvGGjNhG2v4nTxeFV&quot;],&quot;name&quot;:[0,&quot;R2 Storage&quot;],&quot;slug&quot;:[0,&quot;cloudflare-r2&quot;]}]]],&quot;relatedTags&quot;:[0],&quot;authors&quot;:[1,[[0,{&quot;name&quot;:[0,&quot;Catarina Pires Mota&quot;],&quot;slug&quot;:[0,&quot;catarina-pires-mota&quot;],&quot;bio&quot;:[0],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1YWsahYr40z3FhQwupqAlX/a106b6fd29b4862193399b15022f45b3/_tmp_mini_magick20220926-42-fogz3a.jpg&quot;],&quot;location&quot;:[0],&quot;website&quot;:[0],&quot;twitter&quot;:[0],&quot;facebook&quot;:[0],&quot;publiclyIndex&quot;:[0,true]}],[0,{&quot;name&quot;:[0,&quot;Gabriel Massadas&quot;],&quot;slug&quot;:[0,&quot;gabriel-massadas&quot;],&quot;bio&quot;:[0,null],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/7oQXIEt6Jo1bGVuttPgl46/1c53697f20dec595f4a3f6a13303ff8c/gabriel-massadas.jpeg&quot;],&quot;location&quot;:[0,null],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,null],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}],[0,{&quot;name&quot;:[0,&quot;Nelson Duarte&quot;],&quot;slug&quot;:[0,&quot;nelson-duarte&quot;],&quot;bio&quot;:[0,null],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/zaB3FkPTtktRWr9Quh4N6/fa2e9646d216cb8ad1719ad200623f00/nelson-duarte.jpg&quot;],&quot;location&quot;:[0,&quot;Portugal&quot;],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,null],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}]]],&quot;meta_description&quot;:[0,&quot;How we scaled AI Gateway to handle and store billions of requests, using Cloudflare Workers, D1, Durable Objects, and R2.&quot;],&quot;primary_author&quot;:[0,{}],&quot;localeList&quot;:[0,{&quot;name&quot;:[0,&quot;blog-english-only&quot;],&quot;enUS&quot;:[0,&quot;English for Locale&quot;],&quot;zhCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhHansCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhTW&quot;:[0,&quot;No Page for Locale&quot;],&quot;frFR&quot;:[0,&quot;No Page for Locale&quot;],&quot;deDE&quot;:[0,&quot;No Page for Locale&quot;],&quot;itIT&quot;:[0,&quot;No Page for Locale&quot;],&quot;jaJP&quot;:[0,&quot;No Page for Locale&quot;],&quot;koKR&quot;:[0,&quot;No Page for Locale&quot;],&quot;ptBR&quot;:[0,&quot;No Page for Locale&quot;],&quot;esLA&quot;:[0,&quot;No Page for Locale&quot;],&quot;esES&quot;:[0,&quot;No Page for Locale&quot;],&quot;enAU&quot;:[0,&quot;No Page for Locale&quot;],&quot;enCA&quot;:[0,&quot;No Page for Locale&quot;],&quot;enIN&quot;:[0,&quot;No Page for Locale&quot;],&quot;enGB&quot;:[0,&quot;No Page for Locale&quot;],&quot;idID&quot;:[0,&quot;No Page for Locale&quot;],&quot;ruRU&quot;:[0,&quot;No Page for Locale&quot;],&quot;svSE&quot;:[0,&quot;No Page for Locale&quot;],&quot;viVN&quot;:[0,&quot;No Page for Locale&quot;],&quot;plPL&quot;:[0,&quot;No Page for Locale&quot;],&quot;arAR&quot;:[0,&quot;No Page for Locale&quot;],&quot;nlNL&quot;:[0,&quot;No Page for Locale&quot;],&quot;thTH&quot;:[0,&quot;No Page for Locale&quot;],&quot;trTR&quot;:[0,&quot;No Page for Locale&quot;],&quot;heIL&quot;:[0,&quot;No Page for Locale&quot;],&quot;lvLV&quot;:[0,&quot;No Page for Locale&quot;],&quot;etEE&quot;:[0,&quot;No Page for Locale&quot;],&quot;ltLT&quot;:[0,&quot;No Page for Locale&quot;]}],&quot;url&quot;:[0,&quot;https://blog.cloudflare.com/billions-and-billions-of-logs-scaling-ai-gateway-with-the-cloudflare&quot;],&quot;metadata&quot;:[0,{&quot;title&quot;:[0,&quot;Billions and billions (of logs): scaling AI Gateway with the Cloudflare Developer Platform&quot;],&quot;description&quot;:[0,&quot;How we scaled AI Gateway to handle and store billions of requests, using Cloudflare Workers, D1, Durable Objects, and R2. \n&quot;],&quot;imgPreview&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/2NAiCq0ZF8ACgg9x8jZwyj/04bfb998b306b58bb2c39a4942c7f71e/Billions_and_billions__of_logs_-_scaling_AI_Gateway_with_the_Cloudflare_Developer_Platform-OG.png&quot;]}],&quot;publicly_index&quot;:[0,true]}],[0,{&quot;id&quot;:[0,&quot;41vXJNWrB0YHsKqSz6SGDS&quot;],&quot;title&quot;:[0,&quot;Durable Objects aren&#39;t just durable, they&#39;re fast: a 10x speedup for Cloudflare Queues&quot;],&quot;slug&quot;:[0,&quot;how-we-built-cloudflare-queues&quot;],&quot;excerpt&quot;:[0,&quot;Learn how we built Cloudflare Queues using our own Developer Platform and how it evolved to a geographically-distributed, horizontally-scalable architecture built on Durable Objects. Our new architecture supports over 10x more throughput and over 3x lower latency compared to the previous version.&quot;],&quot;featured&quot;:[0,false],&quot;html&quot;:[0,&quot;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;a href=\&quot;https://www.cloudflare.com/developer-platform/products/cloudflare-queues/\&quot;&gt;&lt;u&gt;Cloudflare Queues&lt;/u&gt;&lt;/a&gt; let a developer decouple their Workers into event-driven services. Producer Workers write events to a Queue, and consumer Workers are invoked to take actions on the events. For example, you can use a Queue to decouple an e-commerce website from a service which sends purchase confirmation emails to users. During 2024’s Birthday Week, we &lt;a href=\&quot;https://blog.cloudflare.com/builder-day-2024-announcements?_gl=1*18s1fwl*_gcl_au*MTgyNDA5NjE5OC4xNzI0MjgzMTQ0*_ga*OTgwZmE0YWUtZWJjMS00NmYxLTllM2QtM2RmY2I4ZjAwNzZk*_ga_SQCRB0TXZW*MTcyODkyOTU2OS4xNi4xLjE3Mjg5Mjk1NzcuNTIuMC4w/#queues-is-ga\&quot;&gt;&lt;u&gt;announced that Cloudflare Queues is now Generally Available&lt;/u&gt;&lt;/a&gt;, with significant performance improvements that enable larger workloads. To accomplish this, we switched to a new architecture for Queues that enabled the following improvements:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;Median latency for sending messages has dropped from ~200ms to ~60ms&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Maximum throughput for each Queue has increased over 10x, from 400 to 5000 messages per second&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Maximum Consumer concurrency for each Queue has increased from 20 to 250 concurrent invocations&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/5PvIsHfLwwIkp2LXVUDhmG/99f286f2f89d10b2a7e359d8d66f6dba/image5.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1999\&quot; height=\&quot;959\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;&lt;sup&gt;&lt;i&gt;Median latency drops from ~200ms to ~60ms as Queues are migrated to the new architecture&lt;/i&gt;&lt;/sup&gt;&lt;/p&gt;&lt;p&gt;In this blog post, we&amp;#39;ll share details about how we built Queues using Durable Objects and the Cloudflare Developer Platform, and how we migrated from an initial Beta architecture to a geographically-distributed, horizontally-scalable architecture for General Availability.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;v1-beta-architecture\&quot;&gt;v1 Beta architecture&lt;/h3&gt;\n            &lt;a href=\&quot;#v1-beta-architecture\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;When initially designing Cloudflare Queues, we decided to build something simple that we could get into users&amp;#39; hands quickly. First, we considered leveraging an off-the-shelf messaging system such as Kafka or Pulsar. However, we decided that it would be too challenging to operate these systems at scale with the large number of isolated tenants that we wanted to support.&lt;/p&gt;&lt;p&gt;Instead of investing in new infrastructure, we decided to build on top of one of Cloudflare&amp;#39;s existing developer platform building blocks: &lt;b&gt;Durable Objects.&lt;/b&gt; &lt;a href=\&quot;https://www.cloudflare.com/developer-platform/durable-objects/\&quot;&gt;&lt;u&gt;Durable Objects&lt;/u&gt;&lt;/a&gt; are a simple, yet powerful building block for coordination and storage in a distributed system. In our initial &lt;i&gt;v1 &lt;/i&gt;architecture, each Queue was implemented using a single Durable Object. As shown below, clients would send messages to a Worker running in their region, which would be forwarded to the single Durable Object hosted in the WNAM (Western North America) region. We used a single Durable Object for simplicity, and hosted it in WNAM for proximity to our centralized configuration API service.&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/yxj5Gut3usYa0mFbRddXU/881f5905f789bc2f910ee1b2dcadac92/image1.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1999\&quot; height=\&quot;1100\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;One of a Queue&amp;#39;s main responsibilities is to accept and store incoming messages. Sending a message to a &lt;i&gt;v1&lt;/i&gt; Queue used the following flow:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;A client sends a POST request containing the message body to the Queues API at &lt;code&gt;/accounts/:accountID/queues/:queueID/messages&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;The request is handled by an instance of the &lt;b&gt;Queue Broker Worker&lt;/b&gt; in a Cloudflare data center running near the client.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;The Worker performs authentication, and then uses Durable Objects &lt;code&gt;idFromName&lt;/code&gt; API to route the request to the &lt;b&gt;Queue Durable Object&lt;/b&gt; for the given &lt;code&gt;queueID&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;The Queue Durable Object persists the message to storage before returning a &lt;i&gt;success &lt;/i&gt;back to the client.&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;Durable Objects handled most of the heavy-lifting here: we did not need to set up any new servers, storage, or service discovery infrastructure. To route requests, we simply provided a &lt;code&gt;queueID&lt;/code&gt; and the platform handled the rest. To store messages, we used the Durable Object storage API to &lt;code&gt;put&lt;/code&gt; each message, and the platform handled reliably storing the data redundantly.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;consuming-messages\&quot;&gt;Consuming messages&lt;/h3&gt;\n            &lt;a href=\&quot;#consuming-messages\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;The other main responsibility of a Queue is to deliver messages to a Consumer. Delivering messages in a v1 Queue used the following process:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;Each Queue Durable Object maintained an &lt;b&gt;alarm &lt;/b&gt;that was always set when there were undelivered messages in storage. The alarm guaranteed that the Durable Object would reliably wake up to deliver any messages in storage, even in the presence of failures. The alarm time was configured to fire after the user&amp;#39;s selected &lt;i&gt;max wait time&lt;/i&gt;&lt;b&gt;&lt;i&gt;, &lt;/i&gt;&lt;/b&gt;if only a partial batch of messages was available. Whenever one or more full batches were available in storage, the alarm was scheduled to fire immediately.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;The alarm would wake the Durable Object, which continually looked for batches of messages in storage to deliver.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Each batch of messages was sent to a &amp;quot;Dispatcher Worker&amp;quot; that used &lt;a href=\&quot;https://developers.cloudflare.com/cloudflare-for-platforms/workers-for-platforms/\&quot;&gt;&lt;u&gt;Workers for Platforms&lt;/u&gt;&lt;/a&gt; &lt;a href=\&quot;https://developers.cloudflare.com/cloudflare-for-platforms/workers-for-platforms/reference/how-workers-for-platforms-works/#dynamic-dispatch-worker\&quot;&gt;&lt;i&gt;&lt;u&gt;dynamic dispatch&lt;/u&gt;&lt;/i&gt;&lt;/a&gt; to pass the messages to the &lt;code&gt;queue()&lt;/code&gt; function defined in a user&amp;#39;s Consumer Worker&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/4vAM17x3nN49JBMGNTblPp/6af391950df5f0fbc14faeccb351e38c/image4.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1999\&quot; height=\&quot;942\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;This v1 architecture let us flesh out the initial version of the Queues Beta product and onboard users quickly. Using Durable Objects allowed us to focus on building application logic, instead of complex low-level systems challenges such as global routing and guaranteed durability for storage. Using a separate Durable Object for each Queue allowed us to host an essentially unlimited number of Queues, and provided isolation between them.&lt;/p&gt;&lt;p&gt;However, using &lt;i&gt;only&lt;/i&gt; one Durable Object per queue had some significant limitations:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;&lt;b&gt;Latency: &lt;/b&gt;we created all of our v1 Queue Durable Objects in Western North America. Messages sent from distant regions incurred significant latency when traversing the globe.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;b&gt;Throughput: &lt;/b&gt;A single Durable Object is not scalable: it is single-threaded and has a fixed capacity for how many requests per second it can process. This is where the previous 400 messages per second limit came from.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;b&gt;Consumer Concurrency: &lt;/b&gt;Due to &lt;a href=\&quot;https://developers.cloudflare.com/workers/platform/limits/#simultaneous-open-connections\&quot;&gt;&lt;u&gt;concurrent subrequest limits&lt;/u&gt;&lt;/a&gt;, a single Durable Object was limited in how many concurrent subrequests it could make to our Dispatcher Worker. This limited the number of &lt;code&gt;queue()&lt;/code&gt; handler invocations that it could run simultaneously.&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;To solve these issues, we created a new v2 architecture that horizontally scales across &lt;b&gt;multiple&lt;/b&gt; Durable Objects to implement each single high-performance Queue.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;v2-architecture\&quot;&gt;v2 Architecture&lt;/h3&gt;\n            &lt;a href=\&quot;#v2-architecture\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;In the new v2 architecture for Queues, each Queue is implemented using multiple Durable Objects, instead of just one. Instead of a single region, we place &lt;i&gt;Storage Shard &lt;/i&gt;Durable Objects in &lt;a href=\&quot;https://developers.cloudflare.com/durable-objects/reference/data-location/#supported-locations-1\&quot;&gt;&lt;u&gt;all available regions&lt;/u&gt;&lt;/a&gt; to enable lower latency. Within each region, we create multiple Storage Shards and load balance incoming requests amongst them. Just like that, we’ve multiplied message throughput.&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/2SJTb2UO8tKGrh26ixwLrA/7272e4eaf6f7e85f086a5ae08670387e/image2.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1999\&quot; height=\&quot;1100\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;Sending a message to a v2 Queue uses the following flow:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;A client sends a POST request containing the message body to the Queues API at &lt;code&gt;/accounts/:accountID/queues/:queueID/messages&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;The request is handled by an instance of the &lt;b&gt;Queue Broker Worker&lt;/b&gt; running in a Cloudflare data center near the client.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;The Worker:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;Performs authentication&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Reads from Workers KV to obtain a &lt;i&gt;Shard Map&lt;/i&gt; that lists available storage shards for the given &lt;code&gt;region&lt;/code&gt; and &lt;code&gt;queueID&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Picks one of the region&amp;#39;s Storage Shards at random, and uses Durable Objects &lt;code&gt;idFromName&lt;/code&gt; API to route the request to the chosen shard&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;The Storage Shard persists the message to storage before returning a &lt;i&gt;success &lt;/i&gt;back to the client.&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;In this v2 architecture, messages are stored in the closest available Durable Object storage cluster near the user, greatly reducing latency since messages don&amp;#39;t need to be shipped all the way to WNAM. Using multiple shards within each region removes the bottleneck of a single Durable Object, and allows us to scale each Queue horizontally to accept even more messages per second. &lt;a href=\&quot;https://blog.cloudflare.com/tag/cloudflare-workers-kv/\&quot;&gt;&lt;u&gt;Workers KV&lt;/u&gt;&lt;/a&gt; acts as a fast metadata store: our Worker can quickly look up the shard map to perform load balancing across shards.&lt;/p&gt;&lt;p&gt;To improve the &lt;i&gt;Consumer&lt;/i&gt; side of v2 Queues, we used a similar &amp;quot;scale out&amp;quot; approach. A single Durable Object can only perform a limited number of concurrent subrequests. In v1 Queues, this limited the number of concurrent subrequests we could make to our Dispatcher Worker. To work around this, we created a new &lt;i&gt;Consumer Shard&lt;/i&gt; Durable Object class that we can scale horizontally, enabling us to execute many more concurrent instances of our users&amp;#39; &lt;code&gt;queue()&lt;/code&gt; handlers.&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/2ujodUVBegDcWXi6DYJR41/5f31ba4da387df82613a496ff311f65f/image3.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1999\&quot; height=\&quot;1243\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;Consumer Durable Objects in v2 Queues use the following approach:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;Each Consumer maintains an alarm that guarantees it will wake up to process any pending messages. &lt;i&gt;v2 &lt;/i&gt;Consumers are notified by the Queue&amp;#39;s &lt;i&gt;Coordinator &lt;/i&gt;(introduced below) when there are messages ready for consumption. Upon notification, the Consumer sets an alarm to go off immediately.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;The Consumer looks at the shard map, which contains information about the storage shards that exist for the Queue, including the number of available messages on each shard.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;The Consumer picks a random storage shard with available messages, and asks for a batch.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;The Consumer sends the batch to the Dispatcher Worker, just like for v1 Queues.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;After processing the messages, the Consumer sends another request to the Storage Shard to either &amp;quot;acknowledge&amp;quot; or &amp;quot;retry&amp;quot; the messages.&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;This scale-out approach enabled us to work around the subrequest limits of a single Durable Object, and increase the maximum supported concurrency level of a Queue from 20 to 250. &lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;the-coordinator-and-control-plane\&quot;&gt;The Coordinator and “Control Plane”&lt;/h3&gt;\n            &lt;a href=\&quot;#the-coordinator-and-control-plane\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;So far, we have primarily discussed the &amp;quot;Data Plane&amp;quot; of a v2 Queue: how messages are load balanced amongst Storage Shards, and how Consumer Shards read and deliver messages. The other main piece of a v2 Queue is the &amp;quot;Control Plane&amp;quot;, which handles creating and managing all the individual Durable Objects in the system. In our v2 architecture, each Queue has a single &lt;i&gt;Coordinator&lt;/i&gt; Durable Object that acts as the brain of the Queue. Requests to create a Queue, or change its settings, are sent to the Queue&amp;#39;s Coordinator.&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/7lYJs23oJ8ibtGgbuOk9JN/7ffa8073a4391602b67a0c6e134975bc/image7.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1999\&quot; height=\&quot;1100\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;The Coordinator maintains a &lt;i&gt;Shard Map&lt;/i&gt; for the Queue, which includes metadata about all the Durable Objects in the Queue (including their region, number of available messages, current estimated load, etc.). The Coordinator periodically writes a fresh copy of the Shard Map into Workers KV, as pictured in step 1 of the diagram. Placing the shard map into Workers KV ensures that it is globally cached and available for our Worker to read quickly, so that it can pick a shard to accept the message.&lt;/p&gt;&lt;p&gt;Every shard in the system periodically sends a heartbeat to the Coordinator as shown in steps 2 and 3 of the diagram. Both Storage Shards and Consumer Shards send heartbeats, including information like the number of messages stored locally, and the current load (requests per second) that the shard is handling. The Coordinator uses this information to perform &lt;b&gt;&lt;i&gt;autoscaling. &lt;/i&gt;&lt;/b&gt;When it detects that the shards in a particular region are overloaded, it creates additional shards in the region, and adds them to the shard map in Workers KV. Our Worker sees the updated shard map and naturally load balances messages across the freshly added shards. Similarly, the Coordinator looks at the backlog of available messages in the Queue, and decides to add more Consumer shards to increase Consumer throughput when the backlog is growing. Consumer Shards pull messages from Storage Shards for processing as shown in step 4 of the diagram.&lt;/p&gt;&lt;p&gt;Switching to a new scalable architecture allowed us to meet our performance goals and take Queues to GA. As a recap, this new architecture delivered these significant improvements:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;P50 latency for writing to a Queue has dropped from ~200ms to ~60ms.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Maximum throughput for a Queue has increased from 400 to 5000 messages per second.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Maximum consumer concurrency has increased from 20 to 250 invocations.\t&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;whats-next-for-queues\&quot;&gt;What&amp;#39;s next for Queues&lt;/h3&gt;\n            &lt;a href=\&quot;#whats-next-for-queues\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;ul&gt;&lt;li&gt;&lt;p&gt;We plan on leveraging the performance improvements in the new &lt;a href=\&quot;https://developers.cloudflare.com/durable-objects/\&quot;&gt;&lt;u&gt;beta version of Durable Objects&lt;/u&gt;&lt;/a&gt; which use SQLite to continue to improve throughput/latency in Queues.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;We will soon be adding message management features to Queues so that you can take actions to purge messages in a queue, pause consumption of messages, or “redrive”/move messages from one queue to another (for example messages that have been sent to a Dead Letter Queue could be “redriven” or moved back to the original queue).&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Work to make Queues the &amp;quot;event hub&amp;quot; for the Cloudflare Developer Platform:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;Create a low-friction way for events emitted from other Cloudflare services with event schemas to be sent to Queues.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Build multi-Consumer support for Queues so that Queues are no longer limited to one Consumer per queue.&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;To start using Queues, head over to our &lt;a href=\&quot;https://developers.cloudflare.com/queues/get-started/\&quot;&gt;&lt;u&gt;Getting Started&lt;/u&gt;&lt;/a&gt; guide. &lt;/p&gt;&lt;p&gt;Do distributed systems like Cloudflare Queues and Durable Objects interest you? Would you like to help build them at Cloudflare? &lt;a href=\&quot;https://boards.greenhouse.io/embed/job_app?token=5390243&amp;gh_src=b2e516a81us\&quot;&gt;&lt;u&gt;We&amp;#39;re Hiring!&lt;/u&gt;&lt;/a&gt;&lt;/p&gt;&quot;],&quot;published_at&quot;:[0,&quot;2024-10-24T14:00+01:00&quot;],&quot;updated_at&quot;:[0,&quot;2024-10-24T13:00:03.392Z&quot;],&quot;feature_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/7jqMx0fPAknCu1pBfXvSG4/499662b35777f79347cb6ef96bdd97c1/image6.png&quot;],&quot;tags&quot;:[1,[[0,{&quot;id&quot;:[0,&quot;6QktrXeEFcl4e2dZUTZVGl&quot;],&quot;name&quot;:[0,&quot;Product News&quot;],&quot;slug&quot;:[0,&quot;product-news&quot;]}],[0,{&quot;id&quot;:[0,&quot;7p9V4sEnUw2qMWnn5Jzsp9&quot;],&quot;name&quot;:[0,&quot;Cloudflare Queues&quot;],&quot;slug&quot;:[0,&quot;cloudflare-queues&quot;]}],[0,{&quot;id&quot;:[0,&quot;6hbkItfupogJP3aRDAq6v8&quot;],&quot;name&quot;:[0,&quot;Cloudflare Workers&quot;],&quot;slug&quot;:[0,&quot;workers&quot;]}],[0,{&quot;id&quot;:[0,&quot;5v2UZdTRX1Rw9akmhexnxs&quot;],&quot;name&quot;:[0,&quot;Durable Objects&quot;],&quot;slug&quot;:[0,&quot;durable-objects&quot;]}],[0,{&quot;id&quot;:[0,&quot;4HIPcb68qM0e26fIxyfzwQ&quot;],&quot;name&quot;:[0,&quot;Developers&quot;],&quot;slug&quot;:[0,&quot;developers&quot;]}],[0,{&quot;id&quot;:[0,&quot;3JAY3z7p7An94s6ScuSQPf&quot;],&quot;name&quot;:[0,&quot;Developer Platform&quot;],&quot;slug&quot;:[0,&quot;developer-platform&quot;]}]]],&quot;relatedTags&quot;:[0],&quot;authors&quot;:[1,[[0,{&quot;name&quot;:[0,&quot;Josh Wheeler&quot;],&quot;slug&quot;:[0,&quot;josh&quot;],&quot;bio&quot;:[0,null],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/6imiHQ1XAeb46hwiEvyfMd/ea89cdb2b823497aef6cd84a2b24cc89/josh.jpg&quot;],&quot;location&quot;:[0,null],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,null],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}],[0,{&quot;name&quot;:[0,&quot;Siddhant Sinha&quot;],&quot;slug&quot;:[0,&quot;siddhant&quot;],&quot;bio&quot;:[0,null],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1vq92TZAtrQDTkxRNUoh3u/896e53442514c2062d025a508205444c/siddhant.jpg&quot;],&quot;location&quot;:[0,null],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,null],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}],[0,{&quot;name&quot;:[0,&quot;Todd Mantell&quot;],&quot;slug&quot;:[0,&quot;todd-mantell&quot;],&quot;bio&quot;:[0],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/6EqvYtkgTeVJkuNFM3tk9d/762b1047d26a713451015fb92bc731e5/_tmp_mini_magick20240417-2-ql63l7.jpg&quot;],&quot;location&quot;:[0],&quot;website&quot;:[0],&quot;twitter&quot;:[0],&quot;facebook&quot;:[0],&quot;publiclyIndex&quot;:[0,true]}],[0,{&quot;name&quot;:[0,&quot;Pranshu Maheshwari&quot;],&quot;slug&quot;:[0,&quot;pranshu-maheshwari&quot;],&quot;bio&quot;:[0],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/uvyJ2RWjiLA25kglsiQBv/06acca0147686d8c076ff771cc923a57/IMG_7400.jpg&quot;],&quot;location&quot;:[0],&quot;website&quot;:[0],&quot;twitter&quot;:[0],&quot;facebook&quot;:[0],&quot;publiclyIndex&quot;:[0,true]}]]],&quot;meta_description&quot;:[0,&quot;Learn how we built Cloudflare Queues using our own Developer Platform and how it evolved to a geographically-distributed, horizontally-scalable architecture built on Durable Objects. Our new architecture supports over 10x more throughput and over 3x lower latency compared to the previous version.&quot;],&quot;primary_author&quot;:[0,{}],&quot;localeList&quot;:[0,{&quot;name&quot;:[0,&quot;blog-english-only&quot;],&quot;enUS&quot;:[0,&quot;English for Locale&quot;],&quot;zhCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhHansCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhTW&quot;:[0,&quot;No Page for Locale&quot;],&quot;frFR&quot;:[0,&quot;No Page for Locale&quot;],&quot;deDE&quot;:[0,&quot;No Page for Locale&quot;],&quot;itIT&quot;:[0,&quot;No Page for Locale&quot;],&quot;jaJP&quot;:[0,&quot;No Page for Locale&quot;],&quot;koKR&quot;:[0,&quot;No Page for Locale&quot;],&quot;ptBR&quot;:[0,&quot;No Page for Locale&quot;],&quot;esLA&quot;:[0,&quot;No Page for Locale&quot;],&quot;esES&quot;:[0,&quot;No Page for Locale&quot;],&quot;enAU&quot;:[0,&quot;No Page for Locale&quot;],&quot;enCA&quot;:[0,&quot;No Page for Locale&quot;],&quot;enIN&quot;:[0,&quot;No Page for Locale&quot;],&quot;enGB&quot;:[0,&quot;No Page for Locale&quot;],&quot;idID&quot;:[0,&quot;No Page for Locale&quot;],&quot;ruRU&quot;:[0,&quot;No Page for Locale&quot;],&quot;svSE&quot;:[0,&quot;No Page for Locale&quot;],&quot;viVN&quot;:[0,&quot;No Page for Locale&quot;],&quot;plPL&quot;:[0,&quot;No Page for Locale&quot;],&quot;arAR&quot;:[0,&quot;No Page for Locale&quot;],&quot;nlNL&quot;:[0,&quot;No Page for Locale&quot;],&quot;thTH&quot;:[0,&quot;No Page for Locale&quot;],&quot;trTR&quot;:[0,&quot;No Page for Locale&quot;],&quot;heIL&quot;:[0,&quot;No Page for Locale&quot;],&quot;lvLV&quot;:[0,&quot;No Page for Locale&quot;],&quot;etEE&quot;:[0,&quot;No Page for Locale&quot;],&quot;ltLT&quot;:[0,&quot;No Page for Locale&quot;]}],&quot;url&quot;:[0,&quot;https://blog.cloudflare.com/how-we-built-cloudflare-queues&quot;],&quot;metadata&quot;:[0,{&quot;title&quot;:[0,&quot;Durable Objects aren&#39;t just durable, they&#39;re fast: a 10x speedup for Cloudflare Queues&quot;],&quot;description&quot;:[0,&quot;Learn how we built Cloudflare Queues using our own Developer Platform and how it evolved to a geographically-distributed, horizontally-scalable architecture built on Durable Objects. Our new architecture supports over 10x more throughput and over 3x lower latency compared to the previous version.&quot;],&quot;imgPreview&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/5bvL18K4wXQlP76YGtO0x0/fd7e25d06fc3b1c74f385d08b00f2ba1/Durable_Objects_aren-t_just_durable__they-re_fast-_a_10x_speedup_for_Cloudflare_Queues-OG.png&quot;]}],&quot;publicly_index&quot;:[0,true]}],[0,{&quot;id&quot;:[0,&quot;5KJejYd85inMDIZUZ6z17D&quot;],&quot;title&quot;:[0,&quot;Our container platform is in production. It has GPUs. Here’s an early look&quot;],&quot;slug&quot;:[0,&quot;container-platform-preview&quot;],&quot;excerpt&quot;:[0,&quot;We’ve been working on something new — a platform for running containers across Cloudflare’s network. We already use it in production, for AI inference and more. Today we want to share an early look at&quot;],&quot;featured&quot;:[0,false],&quot;html&quot;:[0,&quot;&lt;p&gt;We’ve been working on something new — a platform for running containers across Cloudflare’s network. We already use it in production for &lt;a href=\&quot;https://developers.cloudflare.com/workers-ai/\&quot;&gt;&lt;u&gt;Workers AI&lt;/u&gt;&lt;/a&gt;, &lt;a href=\&quot;https://developers.cloudflare.com/workers/ci-cd/\&quot;&gt;&lt;u&gt;Workers Builds&lt;/u&gt;&lt;/a&gt;, &lt;a href=\&quot;https://www.cloudflare.com/zero-trust/products/browser-isolation/\&quot;&gt;&lt;u&gt;Remote Browsing Isolation&lt;/u&gt;&lt;/a&gt;, and the &lt;a href=\&quot;https://developers.cloudflare.com/browser-rendering/\&quot;&gt;&lt;u&gt;Browser Rendering API&lt;/u&gt;&lt;/a&gt;. Today, we want to share an early look at how it’s built, why we built it, and how we use it ourselves.&lt;/p&gt;&lt;p&gt;In 2024, Cloudflare Workers celebrates its 7th birthday. &lt;a href=\&quot;https://blog.cloudflare.com/introducing-cloudflare-workers/\&quot;&gt;&lt;u&gt;When we first announced Workers&lt;/u&gt;&lt;/a&gt;, it was a completely new model for running compute in a multi-tenant way — on isolates, as opposed to containers. While, at the time, Workers was a pretty bare-bones functions-as-a-service product, we took a big bet that this was going to become the way software was going to be written going forward. Since introducing Workers, in addition to expanding our developer products in general to include storage and AI, we have been steadily adding more compute capabilities to Workers:&lt;/p&gt;&lt;table&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;&lt;b&gt;2020&lt;/b&gt;&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;&lt;a href=\&quot;https://blog.cloudflare.com/introducing-cron-triggers-for-cloudflare-workers/\&quot;&gt;&lt;u&gt;Cron Triggers&lt;/u&gt;&lt;/a&gt;&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;&lt;b&gt;2021&lt;/b&gt;&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;&lt;a href=\&quot;https://blog.cloudflare.com/durable-objects-easy-fast-correct-choose-three/\&quot;&gt;&lt;u&gt;Durable Objects&lt;/u&gt;&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a href=\&quot;https://blog.cloudflare.com/workers-rust-sdk/\&quot;&gt;&lt;u&gt;Write Workers in Rust&lt;/u&gt;&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a href=\&quot;https://blog.cloudflare.com/introducing-worker-services/\&quot;&gt;&lt;u&gt;Service Bindings&lt;/u&gt;&lt;/a&gt;&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;&lt;b&gt;2022&lt;/b&gt;&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;&lt;a href=\&quot;https://blog.cloudflare.com/introducing-cloudflare-queues/\&quot;&gt;&lt;u&gt;Queues&lt;/u&gt;&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a href=\&quot;https://blog.cloudflare.com/announcing-route-to-workers/\&quot;&gt;&lt;u&gt;Email Workers&lt;/u&gt;&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a href=\&quot;https://blog.cloudflare.com/durable-objects-alarms/\&quot;&gt;&lt;u&gt;Durable Objects Alarms&lt;/u&gt;&lt;/a&gt;&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;&lt;b&gt;2023&lt;/b&gt;&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;&lt;a href=\&quot;https://blog.cloudflare.com/workers-tcp-socket-api-connect-databases/\&quot;&gt;&lt;u&gt;Workers TCP Socket API&lt;/u&gt;&lt;/a&gt; &lt;/p&gt;&lt;p&gt;&lt;a href=\&quot;https://blog.cloudflare.com/hyperdrive-making-regional-databases-feel-distributed/\&quot;&gt;&lt;u&gt;Hyperdrive&lt;/u&gt;&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a href=\&quot;https://blog.cloudflare.com/announcing-workers-smart-placement/\&quot;&gt;&lt;u&gt;Smart Placement&lt;/u&gt;&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a href=\&quot;https://blog.cloudflare.com/best-place-region-earth-inference/\&quot;&gt;&lt;u&gt;Workers AI&lt;/u&gt;&lt;/a&gt;&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;&lt;b&gt;2024&lt;/b&gt;&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;&lt;a href=\&quot;https://blog.cloudflare.com/python-workers/\&quot;&gt;&lt;u&gt;Python Workers&lt;/u&gt;&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a href=\&quot;https://blog.cloudflare.com/javascript-native-rpc/\&quot;&gt;&lt;u&gt;JavaScript-native RPC&lt;/u&gt;&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a href=\&quot;https://blog.cloudflare.com/more-npm-packages-on-cloudflare-workers-combining-polyfills-and-native-code/\&quot;&gt;&lt;u&gt;Node.js compatibility&lt;/u&gt;&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a href=\&quot;https://blog.cloudflare.com/sqlite-in-durable-objects\&quot;&gt;&lt;u&gt;SQLite in Durable Objects&lt;/u&gt;&lt;/a&gt;&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;p&gt;With each of these, we’ve faced a question — can we build this natively into the platform, in a way that removes, rather than adds complexity? Can we build it in a way that lets developers focus on building and shipping, rather than managing infrastructure, so that they don’t have to be a distributed systems engineer to build distributed systems?&lt;/p&gt;&lt;p&gt;In each instance, the answer has been YES. We try to solve problems in a way that simplifies things for developers in the long run, even if that is the harder path for us to take ourselves. If we didn’t, you’d be right to ask — why not self-host and manage all of this myself? What’s the point of the cloud if I’m still provisioning and managing infrastructure? These are the questions many are asking today about the earlier generation of cloud providers.&lt;/p&gt;&lt;p&gt;Pushing ourselves to build platform-native products and features helped us answer this question. Particularly because some of these actually use containers behind the scenes, even though as a developer you never interact with or think about containers yourself.&lt;/p&gt;&lt;p&gt;If you’ve used AI inference on GPUs with &lt;a href=\&quot;https://developers.cloudflare.com/workers-ai/\&quot;&gt;&lt;u&gt;Workers AI&lt;/u&gt;&lt;/a&gt;, spun up headless browsers with &lt;a href=\&quot;https://developers.cloudflare.com/browser-rendering/\&quot;&gt;&lt;u&gt;Browser Rendering&lt;/u&gt;&lt;/a&gt;, or enqueued build jobs with the new &lt;a href=\&quot;https://developers.cloudflare.com/workers/ci-cd/\&quot;&gt;&lt;u&gt;Workers Builds&lt;/u&gt;&lt;/a&gt;, you’ve run containers on our network, without even knowing it. But to do so, we needed to be able to run untrusted code across Cloudflare’s network, outside a &lt;a href=\&quot;https://developers.cloudflare.com/workers/reference/how-workers-works/#isolates\&quot;&gt;&lt;u&gt;v8 isolate&lt;/u&gt;&lt;/a&gt;, in a way that fits what we promise:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;&lt;p&gt;You shouldn’t have to think about regions or data centers. Routing, scaling, load balancing, scheduling, and capacity are our problem to solve, not yours, with tools like &lt;a href=\&quot;https://blog.cloudflare.com/announcing-workers-smart-placement/\&quot;&gt;&lt;u&gt;Smart Placement&lt;/u&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;You should be able to build distributed systems without being a distributed systems engineer.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Every millisecond matters — Cloudflare has to be fast.&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;There wasn’t an off-the-shelf container platform that solved for what we needed, so we built it ourselves — from scheduling to IP address management, pulling and caching images, to improving startup times and more. Our container platform powers many of our newest products, so we wanted to share how we built it, optimized it, and well, you can probably guess what’s next.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;global-scheduling-the-network-is-the-computer\&quot;&gt;Global scheduling — “The Network is the Computer”&lt;/h2&gt;\n            &lt;a href=\&quot;#global-scheduling-the-network-is-the-computer\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;Cloudflare serves the entire world — region: earth. Rather than asking developers to provision resources in specific regions, data centers and availability zones, we think &lt;a href=\&quot;https://blog.cloudflare.com/the-network-is-the-computer/\&quot;&gt;&lt;u&gt;“The Network is the Computer”&lt;/u&gt;&lt;/a&gt;. When you build on Cloudflare, you build software that runs on the Internet, not just in a data center.&lt;/p&gt;&lt;p&gt;When we started working on this, Cloudflare’s architecture was to just run every service via &lt;a href=\&quot;https://systemd.io/\&quot;&gt;&lt;u&gt;systemd&lt;/u&gt;&lt;/a&gt; on every server (we call them “metals” — we &lt;a href=\&quot;https://blog.cloudflare.com/gen-12-servers\&quot;&gt;&lt;u&gt;run our own hardware&lt;/u&gt;&lt;/a&gt;), allowing all services to take advantage of new capacity we add to our network. That fits running &lt;a href=\&quot;https://blog.cloudflare.com/upgrading-one-of-the-oldest-components-in-cloudflare-software-stack/\&quot;&gt;&lt;u&gt;NGINX&lt;/u&gt;&lt;/a&gt; and a few dozen other services, but cannot fit a world where we need to run &lt;i&gt;many thousands&lt;/i&gt; of different compute heavy, resource hungry workloads. We’d &lt;a href=\&quot;https://blog.cloudflare.com/its-crowded-in-here/\&quot;&gt;&lt;u&gt;run out of space&lt;/u&gt;&lt;/a&gt; just trying to load all of them! Consider a canonical AI workload — deploying &lt;a href=\&quot;https://blog.cloudflare.com/meta-llama-3-1-available-on-workers-ai/\&quot;&gt;&lt;u&gt;Llama 3.1 8B&lt;/u&gt;&lt;/a&gt; to an inference server. If we simply ran a Llama 3.1 8B service on every Cloudflare metal, we’d have no flexibility to use GPUs for the &lt;a href=\&quot;https://developers.cloudflare.com/workers-ai/models/\&quot;&gt;&lt;u&gt;many other models&lt;/u&gt;&lt;/a&gt; that Workers AI supports.&lt;/p&gt;&lt;p&gt;We needed something that would allow us to still take advantage of the full capacity of Cloudflare’s entire network, not just the capacity of individual machines. And ideally not put that burden on the developer.&lt;/p&gt;&lt;p&gt;The answer: we built a control plane on our own Developer Platform that lets us schedule a container anywhere on &lt;a href=\&quot;https://www.cloudflare.com/en-gb/network/\&quot;&gt;&lt;u&gt;Cloudflare’s Network&lt;/u&gt;&lt;/a&gt;:&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/63nPDnWzVLvx2OB9ZPZXM5/d08be3dd36fbd08bb7205a82b20bf90e/BLOG-2573_2.png\&quot; alt=\&quot;BLOG-2573 2\&quot; class=\&quot;kg-image\&quot; width=\&quot;1999\&quot; height=\&quot;1277\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;The global scheduler is built on Cloudflare &lt;a href=\&quot;https://developers.cloudflare.com/workers/\&quot;&gt;&lt;u&gt;Workers&lt;/u&gt;&lt;/a&gt;, &lt;a href=\&quot;https://developers.cloudflare.com/durable-objects/\&quot;&gt;&lt;u&gt;Durable Objects&lt;/u&gt;&lt;/a&gt;, and &lt;a href=\&quot;https://developers.cloudflare.com/kv/\&quot;&gt;&lt;u&gt;KV&lt;/u&gt;&lt;/a&gt;, and decides which Cloudflare location to schedule the container to run in. Each location then runs &lt;i&gt;its own&lt;/i&gt; scheduler, which decides which metals within that location to schedule the container to run on. Location schedulers monitor compute capacity, and expose this to the global scheduler. This allows Cloudflare to dynamically place workloads based on capacity and hardware availability (e.g. multiple types of GPUs) across our network.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;why-does-global-scheduling-matter\&quot;&gt;Why does global scheduling matter?&lt;/h2&gt;\n            &lt;a href=\&quot;#why-does-global-scheduling-matter\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;When you run compute on a first generation cloud, the “contract” between the developer and the platform is that the developer must specify what runs where. This is regional scheduling, the status quo.&lt;/p&gt;&lt;p&gt;Let’s imagine for a second if we applied regional scheduling to running compute on Cloudflare’s network, with locations in &lt;a href=\&quot;https://www.cloudflare.com/en-gb/network/\&quot;&gt;&lt;u&gt;330+ cities, across 120+ countries&lt;/u&gt;&lt;/a&gt;. One of the obvious reasons people tell us they want to run on Cloudflare is because we have compute in places where others don’t, within 50ms of 95% of the world’s Internet-connected population. In South America, other clouds have one region in one city. Cloudflare has 19:&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/53Ba51lqKDRNQPbEBselC3/0b9cd69b4f9fa29dad355df0076d05b9/BLOG-2573_3.png\&quot; alt=\&quot;BLOG-2573 3\&quot; class=\&quot;kg-image\&quot; width=\&quot;1044\&quot; height=\&quot;492\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;Running anywhere means you can be faster, highly available, and have more control over data location. But with regional scheduling, the more locations you run in, the more work you have to do. You configure and manage load balancing, routing, auto-scaling policies and more. Balancing performance and cost in a multi-region setup is literally a full-time job (or more) at most companies who have reached meaningful scale on traditional clouds.&lt;/p&gt;&lt;p&gt;But most importantly, no matter what tools you bring, you were the one who told the cloud provider, “run this container over here”. The cloud platform can’t move it for you, even if moving it would make your workload faster. This prevents the platform from adding locations, because for each location, it has to convince developers to take action themselves to move their compute workloads to the new location. Each new location carries a risk that developers won’t migrate workloads to it, or migrate too slowly, delaying the return on investment.&lt;/p&gt;&lt;p&gt;Global scheduling means Cloudflare can add capacity and use it immediately, letting you benefit from it. The “contract” between us and our customers isn’t tied to a specific datacenter or region, so we have permission to move workloads around to benefit customers. This flexibility plays an essential role in all of our own uses of our container platform, starting with GPUs and AI.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;gpus-everywhere-scheduling-large-images-with-workers-ai\&quot;&gt;GPUs everywhere: Scheduling large images with Workers AI&lt;/h2&gt;\n            &lt;a href=\&quot;#gpus-everywhere-scheduling-large-images-with-workers-ai\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;In late 2023, &lt;a href=\&quot;https://blog.cloudflare.com/workers-ai/\&quot;&gt;&lt;u&gt;we launched Workers AI&lt;/u&gt;&lt;/a&gt;, which provides fast, easy to use, and affordable GPU-backed AI inference.&lt;/p&gt;&lt;p&gt;The more efficiently we can use our capacity, the better pricing we can offer. And the faster we can make changes to which models run in which Cloudflare locations, the closer we can move AI inference to the application, &lt;a href=\&quot;https://blog.cloudflare.com/making-workers-ai-faster/\&quot;&gt;&lt;u&gt;lowering Time to First Token (TTFT)&lt;/u&gt;&lt;/a&gt;. This also allows us to be more resilient to spikes in inference requests.&lt;/p&gt;&lt;p&gt;AI models that rely on GPUs present three challenges though:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;&lt;p&gt;Models have different GPU memory needs. GPU memory is the most scarce resource, and different GPUs have different amounts of memory.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Not all container runtimes, such as &lt;a href=\&quot;https://github.com/firecracker-microvm/firecracker/issues/1179\&quot;&gt;&lt;u&gt;Firecracker&lt;/u&gt;&lt;/a&gt;, support GPU drivers and other dependencies.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;AI models, particularly LLMs, are very large. Even a smaller parameter model, like &lt;a href=\&quot;https://developers.cloudflare.com/workers-ai/models/llama-3.1-8b-instruct/\&quot;&gt;&lt;u&gt;@cf/meta/llama-3.1-8b-instruct&lt;/u&gt;&lt;/a&gt;, is at least 5 GB. The larger the model, the more bytes we need to pull across the network when scheduling a model to run in a new location.&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;Let’s dive into how we solved each of these…&lt;/p&gt;&lt;p&gt;First, GPU memory needs. The global scheduler knows which Cloudflare locations have blocks of GPU memory available, and then delegates scheduling the workload on a specific metal to the local scheduler. This allows us to prioritize placement of AI models that use a large amount of GPU memory, and then move smaller models to other machines in the same location. By doing this, we maximize the overall number of locations that we run AI models in, and maximize our efficiency.&lt;/p&gt;&lt;p&gt;Second, container runtimes and GPU support. Thankfully, from day one we built our container platform to be &lt;i&gt;runtime agnostic&lt;/i&gt;. Using &lt;a href=\&quot;https://blog.cloudflare.com/how-we-use-hashicorp-nomad/\&quot;&gt;&lt;u&gt;a runtime agnostic scheduler&lt;/u&gt;&lt;/a&gt;, we’re able to support &lt;a href=\&quot;https://gvisor.dev/\&quot;&gt;&lt;u&gt;gVisor&lt;/u&gt;&lt;/a&gt;, &lt;a href=\&quot;https://firecracker-microvm.github.io/\&quot;&gt;&lt;u&gt;Firecracker&lt;/u&gt;&lt;/a&gt; microVMs, and traditional VMs with &lt;a href=\&quot;https://www.qemu.org/\&quot;&gt;&lt;u&gt;QEMU&lt;/u&gt;&lt;/a&gt;. We are also evaluating adding support for another one: &lt;a href=\&quot;https://github.com/cloud-hypervisor/cloud-hypervisor\&quot;&gt;&lt;u&gt;cloud-hypervisor&lt;/u&gt;&lt;/a&gt; which is based on &lt;a href=\&quot;https://github.com/rust-vmm\&quot;&gt;&lt;u&gt;rust-vmm&lt;/u&gt;&lt;/a&gt; and has a few compelling advantages for our use case:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;&lt;p&gt;GPU passthrough &lt;a href=\&quot;https://github.com/cloud-hypervisor/cloud-hypervisor/blob/main/docs/vfio.md\&quot;&gt;&lt;u&gt;support&lt;/u&gt;&lt;/a&gt; using VFIO&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;a href=\&quot;https://github.com/cloud-hypervisor/cloud-hypervisor/blob/main/docs/device_model.md#vhost-user-net\&quot;&gt;&lt;u&gt;vhost-user-net&lt;/u&gt;&lt;/a&gt; support, enabling high throughput between the host network interface and the VM&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;a href=\&quot;https://github.com/cloud-hypervisor/cloud-hypervisor/blob/main/docs/device_model.md#vhost-user-net\&quot;&gt;&lt;u&gt;vhost-user-blk&lt;/u&gt;&lt;/a&gt; support, adding flexibility to introduce novel network-based storage backed by other Cloudflare Workers products&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;all the while being a smaller codebase than QEMU and written in a memory-safe language&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;Our goal isn’t to build a platform that makes you as the developer choose between runtimes, and ask, “should I use Firecracker or gVisor”. We needed this flexibility in order to be able to run workloads with different needs efficiently, including workloads that depend on GPUs. gVisor has &lt;a href=\&quot;https://gvisor.dev/docs/user_guide/gpu/\&quot;&gt;&lt;u&gt;GPU support&lt;/u&gt;&lt;/a&gt;, while Firecracker microVMs currently &lt;a href=\&quot;https://github.com/firecracker-microvm/firecracker/issues/1179\&quot;&gt;&lt;u&gt;does not&lt;/u&gt;&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;gVisor’s main component is an application kernel (called Sentry) that implements a Linux-like interface but is written in a memory-safe language (Go) and runs in userspace. It works by intercepting application system calls and acting as the guest kernel, without the need for translation through virtualized hardware.&lt;/p&gt;&lt;p&gt;The resource footprint of a containerized application running on gVisor is lower than a VM because it does not require managing virtualized hardware and booting up a kernel instance. However, this comes at the price of reduced application compatibility and higher per-system call overhead.&lt;/p&gt;&lt;p&gt;To add GPU support, the Google team introduced &lt;a href=\&quot;https://gvisor.dev/docs/user_guide/gpu/\&quot;&gt;&lt;u&gt;nvproxy&lt;/u&gt;&lt;/a&gt; which works using the same principles as described above for syscalls: it intercepts &lt;a href=\&quot;https://en.wikipedia.org/wiki/Ioctl\&quot;&gt;&lt;u&gt;ioctls&lt;/u&gt;&lt;/a&gt; destined to the GPU and proxies a subset to the GPU kernel module.&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1jqt4l5joKUkPNek1xACaM/64df1f3dcab2cae7d9ecf05deb407242/image__19_.png\&quot; alt=\&quot;BLOG-2573 4\&quot; class=\&quot;kg-image\&quot; width=\&quot;1256\&quot; height=\&quot;1428\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;To solve the third challenge, and make scheduling fast with large models, we weren’t satisfied with the status quo. So we did something about it.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;docker-pull-was-too-slow-so-we-fixed-it-and-cut-the-time-in-half\&quot;&gt;Docker pull was too slow, so we fixed it (and cut the time in half)&lt;/h2&gt;\n            &lt;a href=\&quot;#docker-pull-was-too-slow-so-we-fixed-it-and-cut-the-time-in-half\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;Many of the images we need to run for AI inference are over 15 GB. Specialized inference libraries and GPU drivers add up fast. For example, when we make a scheduling decision to run a fresh container in Tokyo, naively running docker pull to fetch the image from a storage bucket in Los Angeles would be unacceptably slow. And scheduling speed is critical to being able to scale up and down in new locations in response to changes in traffic.&lt;/p&gt;&lt;p&gt;We had 3 essential requirements:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;Pulling and pushing very large images should be fast&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;We should not rely on a single point of failure&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Our teams shouldn’t waste time managing image registries&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;We needed globally distributed storage, so we used &lt;a href=\&quot;https://developers.cloudflare.com/r2/\&quot;&gt;&lt;u&gt;R2&lt;/u&gt;&lt;/a&gt;. We needed the highest cache hit rate possible, so we used Cloudflare’s &lt;a href=\&quot;https://developers.cloudflare.com/cache/\&quot;&gt;&lt;u&gt;Cache&lt;/u&gt;&lt;/a&gt;, and will soon use &lt;a href=\&quot;https://developers.cloudflare.com/cache/how-to/tiered-cache/\&quot;&gt;&lt;u&gt;Tiered Cache&lt;/u&gt;&lt;/a&gt;. And we needed a fast container image registry that we could run everywhere, in every Cloudflare location, so we built and open-sourced &lt;a href=\&quot;https://github.com/cloudflare/serverless-registry\&quot;&gt;&lt;u&gt;serverless-registry&lt;/u&gt;&lt;/a&gt;, which is built on &lt;a href=\&quot;https://developers.cloudflare.com/workers/\&quot;&gt;&lt;u&gt;Workers&lt;/u&gt;&lt;/a&gt;. You can deploy serverless-registry to your own Cloudflare account in about 5 minutes. We rely on it in production.&lt;/p&gt;&lt;p&gt;This is fast, but we can be faster. Our performance bottleneck was, somewhat surprisingly, &lt;a href=\&quot;https://docs.docker.com/reference/cli/docker/image/push/\&quot;&gt;&lt;u&gt;docker push&lt;/u&gt;&lt;/a&gt;. Docker uses &lt;a href=\&quot;https://www.gzip.org/\&quot;&gt;&lt;u&gt;gzip&lt;/u&gt;&lt;/a&gt; to compress and decompress layers of images while pushing and pulling. So we started using &lt;a href=\&quot;https://github.com/facebook/zstd\&quot;&gt;&lt;u&gt;Zstandard&lt;/u&gt;&lt;/a&gt; (zstd) instead, which compresses and decompresses faster, and results in smaller compressed files.&lt;/p&gt;&lt;p&gt;In order to build, chunk, and push these images to the R2 registry, we built a custom CLI tool that we use internally in lieu of running docker build and docker push. This makes it easy to use zstd and split layers into 500 MB chunks, which allows uploads to be processed by Workers while staying under &lt;a href=\&quot;https://developers.cloudflare.com/workers/platform/limits/#request-limits\&quot;&gt;&lt;u&gt;body size limits&lt;/u&gt;&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;Using our custom build and push tool doubled the speed of image pulls. Our 30 GB GPU images now pull in 4 minutes instead of 8. We plan on open sourcing this tool in the near future.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;anycast-is-the-gift-that-keeps-on-simplifying-virtual-ips-and-the-global-state-router\&quot;&gt;Anycast is the gift that keeps on simplifying — Virtual IPs and the Global State Router&lt;/h2&gt;\n            &lt;a href=\&quot;#anycast-is-the-gift-that-keeps-on-simplifying-virtual-ips-and-the-global-state-router\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;We still had another challenge to solve. And yes, we solved it with anycast. We’re Cloudflare, did you expect anything else?&lt;/p&gt;&lt;p&gt;First, a refresher — Cloudflare operates &lt;a href=\&quot;https://blog.cloudflare.com/unimog-cloudflares-edge-load-balancer/\&quot;&gt;&lt;u&gt;Unimog&lt;/u&gt;&lt;/a&gt;, a Layer 4 load balancer that handles all incoming Cloudflare traffic. Cloudflare’s network uses &lt;a href=\&quot;https://www.cloudflare.com/learning/cdn/glossary/anycast-network\&quot;&gt;&lt;u&gt;anycast&lt;/u&gt;&lt;/a&gt;, which allows a single IP address to route requests to a variety of different locations. For most Cloudflare services with anycast, the given IP address will route to the nearest Cloudflare data center, reducing latency. Since Cloudflare runs almost every service in every data center, Unimog can simply route traffic to any Cloudflare metal that is online and has capacity, without needing to map traffic to a specific service that runs on specific metals, only in some locations.&lt;/p&gt;&lt;p&gt;The new compute-heavy, GPU-backed workloads we were taking on forced us to confront this fundamental “everything runs everywhere” assumption. If we run a containerized workflow in 20 Cloudflare locations, how does Unimog know which locations, and which metals, it runs in? You might say “just bring your own &lt;a href=\&quot;https://developers.cloudflare.com/reference-architecture/architectures/load-balancing/\&quot;&gt;&lt;u&gt;load balancer&lt;/u&gt;&lt;/a&gt;” — but then what happens when you make scheduling decisions to migrate a workload between locations, scale up, or scale down?&lt;/p&gt;&lt;p&gt;Anycast is foundational to how we build fast and simple products on our network, and we needed a way to keep building new types of products this way — where a team can deploy an application, get back a single IP address, and rely on the platform to balance traffic, taking load, container health, and latency into account, without extra configuration. We started letting teams use the container platform without solving this, and it was painfully clear that we needed to do something about it.&lt;/p&gt;&lt;p&gt;So we started integrating directly into our networking stack, building a sidecar service to Unimog. We’ll call this the Global State Router. Here’s how it works:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;An eyeball makes a request to a virtual IP address issued by Cloudflare&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Request sent to the best location as determined by BGP routing. This is anycast routing.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;A small &lt;a href=\&quot;https://ebpf.io/what-is-ebpf/\&quot;&gt;&lt;u&gt;eBPF&lt;/u&gt;&lt;/a&gt; program sits on the main networking interface and ensures packets bound to a virtual IP address are handled by the Global State Router.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;The main Global State Router program contains a mapping of all anycast IPs addresses to potential end destination container IP addresses. It updates this mapping based on container health, readiness, distance, and latency. Using this information, it picks a best-fit container.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Packets are forwarded at the L4 layer.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;When a target container’s server receives a packet, its own Global State Router program intercepts the packet and routes it to the local container.&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/8ZICyfggbTEpkxki0OnYd/13a427a65b1e9d0c5d591468e3f10612/BLOG-2573_5.png\&quot; alt=\&quot;BLOG-2573 5\&quot; class=\&quot;kg-image\&quot; width=\&quot;1970\&quot; height=\&quot;1286\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;This might sound like just a lower level networking detail, disconnected from developer experience. But by integrating directly with Unimog, we can let developers:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;&lt;p&gt;Push a containerized application to Cloudflare.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Provide constraints, health checks, and load metrics that describe what the application needs.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Delegate scheduling and scaling many containers across Cloudflare’s network.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Get back a single IP address that can be used everywhere.&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;We’re actively working on this, and are excited to continue building on Cloudflare’s anycast capabilities, and pushing to keep the simplicity of running “everywhere” with new categories of workloads.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;low-latency-global-remote-browser-isolation-browser-rendering\&quot;&gt;Low latency &amp;amp; global — Remote Browser Isolation &amp;amp; Browser Rendering&lt;/h2&gt;\n            &lt;a href=\&quot;#low-latency-global-remote-browser-isolation-browser-rendering\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;Our container platform actually started because of a very specific challenge, running &lt;a href=\&quot;https://www.cloudflare.com/zero-trust/products/browser-isolation/\&quot;&gt;&lt;u&gt;Remote Browser Isolation&lt;/u&gt;&lt;/a&gt; across our network. Remote Browser Isolation provides Chromium browsers that run on Cloudflare, in containers, rather than on the end user’s own computer. Only the rendered output is sent to the end user. This provides a layer of protection against zero-day browser vulnerabilities, phishing attacks, and ransomware.&lt;/p&gt;&lt;p&gt;Location is critical — people expect their interactions with a remote browser to feel just as fast as if it ran locally. If the server is thousands of miles away, the remote browser will feel slow. Running across &lt;a href=\&quot;https://www.cloudflare.com/network/\&quot;&gt;&lt;u&gt;Cloudflare’s network of over 330 locations&lt;/u&gt;&lt;/a&gt; means the browser is nearly always as close to you as possible.&lt;/p&gt;&lt;p&gt;Imagine a user in Santiago, Chile, if they were to access a browser running in the same city, each interaction would incur negligible additional latency. Whereas a browser in Buenos Aires might add 21 ms, São Paulo might add 48 ms, Bogota might add 67 ms, and Raleigh, NC might add 128 ms. Where the container runs significantly impacts the latency of every user interaction with the browser, and therefore the experience as a whole.&lt;/p&gt;&lt;p&gt;It’s not just browser isolation that benefits from running near the user: WebRTC servers stream video better, multiplayer games have less lag, online advertisements can be served faster, financial transactions can be processed faster. Our container platform lets us run anything we need to near the user, no matter where they are in the world.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;using-spare-compute-off-peak-jobs-for-workers-ci-cd-builds\&quot;&gt;Using spare compute — “off-peak” jobs for Workers CI/CD builds&lt;/h2&gt;\n            &lt;a href=\&quot;#using-spare-compute-off-peak-jobs-for-workers-ci-cd-builds\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;At any hour of the day, Cloudflare has many CPU cores that sit idle. This is compute power that could be used for something else.&lt;/p&gt;&lt;p&gt;Via anycast, most of Cloudflare’s traffic is handled as close as possible to the eyeball (person) that requested it. Most of our traffic originates from eyeballs. And the eyeballs of (most) people are closed and asleep between midnight and 5:00 AM local time. While we use our compute capacity very efficiently during the daytime in any part of the world, overnight we have spare cycles. Consider what a map of the world looks like at nighttime in Europe and Africa:&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/CtkNFxhvusjLx1khXh9gs/25b5a6579d8abd47bcaa15ba28eddc61/BLOG-2573_6.png\&quot; alt=\&quot;BLOG-2573 6\&quot; class=\&quot;kg-image\&quot; width=\&quot;1044\&quot; height=\&quot;492\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;As shown above, we can run containers during “off-peak” in Cloudflare locations receiving low traffic at night. During this time, the CPU utilization of a typical Cloudflare metal looks something like this:&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/6sXsQ3p19bFecokbR0X1yj/04419589e4f6796fe297435cd1029b5a/Screenshot_2024-09-27_at_2.20.50_PM.png\&quot; alt=\&quot;BLOG-2573 7\&quot; class=\&quot;kg-image\&quot; width=\&quot;2040\&quot; height=\&quot;1128\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;We have many “background” compute workloads at Cloudflare. These are workloads that don’t actually need to run close to the eyeball because there is no eyeball waiting on the request. The challenge is that many of these workloads require running untrusted code — either a dependency on open-source code that we don’t trust enough to run outside of a sandboxed environment, or untrusted code that customers deploy themselves. And unlike &lt;a href=\&quot;https://developers.cloudflare.com/workers/configuration/cron-triggers/\&quot;&gt;&lt;u&gt;Cron Triggers&lt;/u&gt;&lt;/a&gt;, which already make a best-effort attempt to use off-peak compute, these other workloads can’t run in &lt;a href=\&quot;https://developers.cloudflare.com/workers/reference/how-workers-works/#isolates\&quot;&gt;&lt;u&gt;v8 isolates&lt;/u&gt;&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;On Builder Day 2024, we &lt;a href=\&quot;https://blog.cloudflare.com/builder-day-2024-announcements\&quot;&gt;&lt;u&gt;announced Workers Builds in open beta&lt;/u&gt;&lt;/a&gt;. You connect your Worker to a git repository, and Cloudflare builds and deploys your Worker each time you merge a pull request. Workers Builds run on our containers platform, using otherwise idle “off-peak” compute, allowing us to offer lower pricing, and hold more capacity for unexpected spikes in traffic in Cloudflare locations during daytime hours when load is highest. We preserve our ability to serve requests as close to the eyeball as possible where it matters, while using the full compute capacity of our network.&lt;/p&gt;&lt;p&gt;We developed a purpose-built API for these types of jobs. The Workers Builds service has zero knowledge of where Cloudflare has spare compute capacity on its network — it simply schedules an “off-peak” job to run on the containers platform, by defining a scheduling policy:&lt;/p&gt;&lt;p&gt;&lt;code&gt;scheduling_policy: &amp;quot;off-peak&amp;quot;&lt;/code&gt;&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;making-off-peak-jobs-faster-with-prewarmed-images\&quot;&gt;Making off-peak jobs faster with prewarmed images&lt;/h2&gt;\n            &lt;a href=\&quot;#making-off-peak-jobs-faster-with-prewarmed-images\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;Just because a workload isn’t “eyeball-facing” doesn’t mean speed isn’t relevant. When a build job starts, you still want it to start as soon as possible.&lt;/p&gt;&lt;p&gt;Each new build requires a fresh container though, and we must avoid reusing containers to provide strong isolation between customers. How can we keep build job start times low, while using a new container for each job without over-provisioning? &lt;/p&gt;&lt;p&gt;We prewarm servers with the proper image. &lt;/p&gt;&lt;p&gt;Before a server becomes eligible to receive an “off peak” job, the container platform instructs it to download the correct image. Once the image is downloaded and cached locally, new containers can start quickly in a Firecracker VM after receiving a request for a new build. When a build completes, we throw away the container, and start the next build using a fresh container based on the prewarmed image.&lt;/p&gt;&lt;p&gt;Without prewarming, pulling and unpacking our Workers Build images would take roughly 75 seconds. With prewarming, we’re able to spin up a new container in under 10 seconds. We expect this to get even faster as we introduce optimizations like pre-booting images before new runs, or &lt;a href=\&quot;https://github.com/firecracker-microvm/firecracker/blob/main/docs/snapshotting/snapshot-support.md\&quot;&gt;&lt;u&gt;Firecracker snapshotting&lt;/u&gt;&lt;/a&gt;, which can restore a VM in under 200ms.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;workers-and-containers-better-together\&quot;&gt;Workers and containers, better together&lt;/h2&gt;\n            &lt;a href=\&quot;#workers-and-containers-better-together\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;As more of our own engineering teams rely on our containers platform in production, we’ve noticed a pattern: they want a deeper integration with Workers.&lt;/p&gt;&lt;p&gt;We plan to give it to them. &lt;/p&gt;&lt;p&gt;Let’s take a look at a project deployed on our container platform already, &lt;a href=\&quot;https://blog.cloudflare.com/key-transparency/\&quot;&gt;&lt;u&gt;Key Transparency&lt;/u&gt;&lt;/a&gt;. If the container platform were highly integrated with Workers, what would this team’s experience look like?&lt;/p&gt;&lt;p&gt;Cloudflare regularly audits changes to public keys used by WhatsApp for encrypting messages between users. Much of the architecture is built on Workers, but there are long-running compute-intensive tasks that are better suited for containers.&lt;/p&gt;&lt;p&gt;We don’t want our teams to have to jump through hoops to deploy a container and integrate with Workers. They shouldn’t have to pick specific regions to run in, figure out scaling, expose IPs and handle IP updates, or set up Worker-to-container auth.&lt;/p&gt;&lt;p&gt;We’re still exploring many different ideas and API designs, and we want your feedback. But let’s imagine what it might look like to use Workers, Durable Objects and Containers together.&lt;/p&gt;&lt;p&gt;In this case, an outer layer of Workers handles most business logic and ingress, a specialized Durable Object is configured to run alongside our new container, and the platform ensures the image is loaded on the right metals and can scale to meet demand.&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/5GsXRuYvVELJY1syOmfq3z/47d3481116670de291be86438777fbc0/BLOG-2573_8.png\&quot; alt=\&quot;BLOG-2573 8\&quot; class=\&quot;kg-image\&quot; width=\&quot;1162\&quot; height=\&quot;550\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;I add a containerized app to the &lt;a href=\&quot;https://developers.cloudflare.com/workers/wrangler/configuration/\&quot;&gt;&lt;code&gt;&lt;u&gt;wrangler.toml &lt;/u&gt;&lt;/code&gt;&lt;u&gt;configuration file&lt;/u&gt;&lt;/a&gt; of my Worker (or &lt;a href=\&quot;https://blog.cloudflare.com/automatically-generating-cloudflares-terraform-provider\&quot;&gt;&lt;u&gt;Terraform&lt;/u&gt;&lt;/a&gt;):&lt;/p&gt;\n            &lt;pre class=\&quot;language-javascript\&quot;&gt;&lt;code class=\&quot;language-javascript\&quot;&gt;[[container-app]]\nimage = &amp;quot;./key-transparency/verifier/Dockerfile&amp;quot;\nname = &amp;quot;verifier&amp;quot;\n\n[durable_objects]\nbindings = { name = &amp;quot;VERIFIER&amp;quot;, class_name = &amp;quot;Verifier&amp;quot;, container = &amp;quot;verifier&amp;quot; } }\n&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;Then, in my Worker, I call the runVerification &lt;a href=\&quot;https://developers.cloudflare.com/workers/runtime-apis/rpc/\&quot;&gt;&lt;u&gt;RPC method&lt;/u&gt;&lt;/a&gt; of my Durable Object:&lt;/p&gt;\n            &lt;pre class=\&quot;language-javascript\&quot;&gt;&lt;code class=\&quot;language-javascript\&quot;&gt;fetch(request, env, ctx) {\n  const id = new URL(request.url).searchParams.get(&amp;#039;id&amp;#039;)\n  const durableObjectId = env.VERIFIER.idFromName(request.params.id);\n  await env.VERIFIER.get(durableObjectId).runVerification()\n  //...\n}\n&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;From my Durable Object I can boot, configure, mount storage buckets as directories, and make HTTP requests to the container:&lt;/p&gt;\n            &lt;pre class=\&quot;language-javascript\&quot;&gt;&lt;code class=\&quot;language-javascript\&quot;&gt;class Verifier extends DurableObject {\n  constructor(state, env) {\n    this.ctx.blockConcurrency(async () =&amp;gt; {\n\n      // starts the container\n      await this.ctx.container.start();\n\n      // configures the container before accepting traffic\n      const config = await this.state.storage.get(&amp;quot;verifierConfig&amp;quot;);\n      await this.ctx.container.fetch(&amp;quot;/set-config&amp;quot;, { method: &amp;quot;PUT&amp;quot;, body: config});\n    })\n  }\n\n  async runVerification(updateId) {\n    // downloads &amp;amp; mounts latest updates from R2\n    const latestPublicKeyUpdates = await this.env.R2.get(`public-key-updates/${updateId}`);\n    await this.ctx.container.mount(`/updates/${updateId}`, latestPublicKeyUpdates);\n\n    // starts verification via HTTP call \n    return await this.ctx.container.fetch(`/verifier/${updateId}`);\n  }\n}\n&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;And… that’s it.&lt;/p&gt;&lt;p&gt;I didn’t have to worry about placement, scaling, service discovery authorization, and I was able to leverage integrations into other services like KV and R2 with just a few lines of code. The container platform took care of routing, placement, and auth. If I needed more instances, I could call the binding with a new ID, and the platform would scale up containers for me.&lt;/p&gt;&lt;p&gt;We are still in the early stages of building these integrations, but we’re excited about everything that containers will bring to Workers and vice versa.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;so-what-do-you-want-to-build\&quot;&gt;So, what do you want to build?&lt;/h2&gt;\n            &lt;a href=\&quot;#so-what-do-you-want-to-build\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;If you’ve read this far, there’s a non-zero chance you were hoping to get to run a container yourself on our network. While we’re not ready (quite yet) to open up the platform to everyone, now that we’ve built a few GA products on our container platform, we’re looking for a handful of engineering teams to start building, in advance of wider availability in 2025. And we’re &lt;a href=\&quot;https://job-boards.greenhouse.io/cloudflare/jobs/5547603\&quot;&gt;&lt;u&gt;continuing to hire engineers&lt;/u&gt;&lt;/a&gt; to work on this.&lt;/p&gt;&lt;p&gt;We’ve told you about our use cases for containers, and now it’s your turn. If you’re interested, &lt;a href=\&quot;https://forms.gle/msrkBLBYNFFYRaqY8\&quot;&gt;&lt;u&gt;tell us here&lt;/u&gt;&lt;/a&gt; what you want to build, and why it goes beyond what’s possible today in &lt;a href=\&quot;https://developers.cloudflare.com/workers/\&quot;&gt;&lt;u&gt;Workers&lt;/u&gt;&lt;/a&gt; and on our &lt;a href=\&quot;https://developers.cloudflare.com/products/?product-group=Developer+platform\&quot;&gt;&lt;u&gt;Developer Platform&lt;/u&gt;&lt;/a&gt;. What do you wish you could build on Cloudflare, but can’t yet today?&lt;/p&gt;&quot;],&quot;published_at&quot;:[0,&quot;2024-09-27T14:00+01:00&quot;],&quot;updated_at&quot;:[0,&quot;2025-04-08T20:38:51.731Z&quot;],&quot;feature_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/6uXyuXT5ofnG9x4JGrR7jv/5d9436ce5da24f51f3d19387e0850957/BLOG-2573_1.png&quot;],&quot;tags&quot;:[1,[[0,{&quot;id&quot;:[0,&quot;4HIPcb68qM0e26fIxyfzwQ&quot;],&quot;name&quot;:[0,&quot;Developers&quot;],&quot;slug&quot;:[0,&quot;developers&quot;]}],[0,{&quot;id&quot;:[0,&quot;3JAY3z7p7An94s6ScuSQPf&quot;],&quot;name&quot;:[0,&quot;Developer Platform&quot;],&quot;slug&quot;:[0,&quot;developer-platform&quot;]}],[0,{&quot;id&quot;:[0,&quot;6Foe3R8of95cWVnQwe5Toi&quot;],&quot;name&quot;:[0,&quot;AI&quot;],&quot;slug&quot;:[0,&quot;ai&quot;]}],[0,{&quot;id&quot;:[0,&quot;5v2UZdTRX1Rw9akmhexnxs&quot;],&quot;name&quot;:[0,&quot;Durable Objects&quot;],&quot;slug&quot;:[0,&quot;durable-objects&quot;]}]]],&quot;relatedTags&quot;:[0],&quot;authors&quot;:[1,[[0,{&quot;name&quot;:[0,&quot;Brendan Irvine-Broque&quot;],&quot;slug&quot;:[0,&quot;brendan-irvine-broque&quot;],&quot;bio&quot;:[0,&quot;Product Manager, Cloudflare Stream&quot;],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/lTJBFKfbqthKbJKPvulre/e8bf53afa7caf1dffeeb55a8c6884959/brendan-irvine-broque.JPG&quot;],&quot;location&quot;:[0,&quot;Oakland, CA&quot;],&quot;website&quot;:[0,&quot;https://www.cloudflare.com/products/cloudflare-stream/&quot;],&quot;twitter&quot;:[0,&quot;@irvinebroque&quot;],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}],[0,{&quot;name&quot;:[0,&quot;Thomas Lefebvre&quot;],&quot;slug&quot;:[0,&quot;thomas&quot;],&quot;bio&quot;:[0,null],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/6olw7cJNP8SN0qnNsDbwOf/5b8554a41e3a7aa10759088ab4193901/thomas.jpg&quot;],&quot;location&quot;:[0,null],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,null],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}],[0,{&quot;name&quot;:[0,&quot;Mike Nomitch&quot;],&quot;slug&quot;:[0,&quot;mike-nomitch&quot;],&quot;bio&quot;:[0],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/3Ub221L51x1p3FZJbnblyn/23b50473b99404db0baf42921edd269c/_tmp_mini_magick20240415-2-6izqhi.jpg&quot;],&quot;location&quot;:[0],&quot;website&quot;:[0],&quot;twitter&quot;:[0],&quot;facebook&quot;:[0],&quot;publiclyIndex&quot;:[0,true]}]]],&quot;meta_description&quot;:[0,&quot;We’ve been working on something new — a platform for running containers across Cloudflare’s network. We already use it in production, for AI inference and more. Today we want to share an early look at how it’s built, why we built it, and how we use it ourselves.\n&quot;],&quot;primary_author&quot;:[0,{}],&quot;localeList&quot;:[0,{&quot;name&quot;:[0,&quot;blog-english-only&quot;],&quot;enUS&quot;:[0,&quot;English for Locale&quot;],&quot;zhCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhHansCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhTW&quot;:[0,&quot;No Page for Locale&quot;],&quot;frFR&quot;:[0,&quot;No Page for Locale&quot;],&quot;deDE&quot;:[0,&quot;No Page for Locale&quot;],&quot;itIT&quot;:[0,&quot;No Page for Locale&quot;],&quot;jaJP&quot;:[0,&quot;No Page for Locale&quot;],&quot;koKR&quot;:[0,&quot;No Page for Locale&quot;],&quot;ptBR&quot;:[0,&quot;No Page for Locale&quot;],&quot;esLA&quot;:[0,&quot;No Page for Locale&quot;],&quot;esES&quot;:[0,&quot;No Page for Locale&quot;],&quot;enAU&quot;:[0,&quot;No Page for Locale&quot;],&quot;enCA&quot;:[0,&quot;No Page for Locale&quot;],&quot;enIN&quot;:[0,&quot;No Page for Locale&quot;],&quot;enGB&quot;:[0,&quot;No Page for Locale&quot;],&quot;idID&quot;:[0,&quot;No Page for Locale&quot;],&quot;ruRU&quot;:[0,&quot;No Page for Locale&quot;],&quot;svSE&quot;:[0,&quot;No Page for Locale&quot;],&quot;viVN&quot;:[0,&quot;No Page for Locale&quot;],&quot;plPL&quot;:[0,&quot;No Page for Locale&quot;],&quot;arAR&quot;:[0,&quot;No Page for Locale&quot;],&quot;nlNL&quot;:[0,&quot;No Page for Locale&quot;],&quot;thTH&quot;:[0,&quot;No Page for Locale&quot;],&quot;trTR&quot;:[0,&quot;No Page for Locale&quot;],&quot;heIL&quot;:[0,&quot;No Page for Locale&quot;],&quot;lvLV&quot;:[0,&quot;No Page for Locale&quot;],&quot;etEE&quot;:[0,&quot;No Page for Locale&quot;],&quot;ltLT&quot;:[0,&quot;No Page for Locale&quot;]}],&quot;url&quot;:[0,&quot;https://blog.cloudflare.com/container-platform-preview&quot;],&quot;metadata&quot;:[0,{&quot;title&quot;:[0,&quot;Our container platform is in production. It has GPUs. Here’s an early look&quot;],&quot;description&quot;:[0,&quot;We’ve been working on something new — a platform for running containers across Cloudflare’s network. We already use it in production, for AI inference and more. Today we want to share an early look at how it’s built, why we built it, and how we use it ourselves.\n&quot;],&quot;imgPreview&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1RolWb3TF9PRzx075YgVxq/3c2378ad8e1bff9715e731bd3e0f72b3/BLOG-2573_OG.png&quot;]}],&quot;publicly_index&quot;:[0,true]}],[0,{&quot;id&quot;:[0,&quot;44R2ywetTc9l1c6D7oWTsz&quot;],&quot;title&quot;:[0,&quot;Zero-latency SQLite storage in every Durable Object&quot;],&quot;slug&quot;:[0,&quot;sqlite-in-durable-objects&quot;],&quot;excerpt&quot;:[0,&quot;Traditional cloud storage is inherently slow because it is accessed over a network and must synchronize many clients. But what if we could instead put your application code deep into the storage layer&quot;],&quot;featured&quot;:[0,false],&quot;html&quot;:[0,&quot;&lt;p&gt;Traditional cloud storage is inherently slow, because it is normally accessed over a network and must carefully synchronize across many clients that could be accessing the same data. But what if we could instead put your application code deep into the storage layer, such that your code runs directly on the machine where the data is stored, and the database itself executes as a local library embedded inside your application?&lt;/p&gt;&lt;p&gt;&lt;a href=\&quot;https://developers.cloudflare.com/durable-objects/\&quot;&gt;&lt;u&gt;Durable Objects (DO)&lt;/u&gt;&lt;/a&gt; are a novel approach to cloud computing which accomplishes just that: Your application code runs exactly where the data is stored. Not just on the same machine: your storage lives in the same thread as the application, requiring not even a context switch to access. With proper use of caching, storage latency is essentially zero, while nevertheless being durable and consistent.&lt;/p&gt;&lt;p&gt;Until today, DOs only offered key/value oriented storage. But now, they support a full SQL query interface with tables and indexes, through the power of SQLite.&lt;/p&gt;&lt;p&gt;&lt;a href=\&quot;https://www.sqlite.org/\&quot;&gt;&lt;u&gt;SQLite&lt;/u&gt;&lt;/a&gt; is the most-used SQL database implementation in the world, with billions of installations. It’s on practically every phone and desktop computer, and many embedded devices use it as well. It&amp;#39;s known to be blazingly fast and rock solid. But it&amp;#39;s been less common on the server. This is because traditional cloud architecture favors large distributed databases that live separately from application servers, while SQLite is designed to run as an embedded library. In this post, we&amp;#39;ll show you how Durable Objects turn this architecture on its head and unlock the full power of SQLite in the cloud.&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/3epYvfKAWLT38mjUPsnMCj/d6566573e999ea874fc713cf31c65d62/BLOG-2536_2.png\&quot; alt=\&quot;BLOG-2536 2\&quot; class=\&quot;kg-image\&quot; width=\&quot;1999\&quot; height=\&quot;900\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/7c3of8FUDi3R4HC18qo2iP/9a372797b67d1e33075b9c1ef0780762/BLOG-2536_3.png\&quot; alt=\&quot;BLOG-2536 3\&quot; class=\&quot;kg-image\&quot; width=\&quot;1999\&quot; height=\&quot;1000\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;refresher-what-are-durable-objects\&quot;&gt;Refresher: what are Durable Objects?&lt;/h2&gt;\n            &lt;a href=\&quot;#refresher-what-are-durable-objects\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;&lt;a href=\&quot;https://developers.cloudflare.com/durable-objects/\&quot;&gt;&lt;u&gt;Durable Objects&lt;/u&gt;&lt;/a&gt; (DOs) are a part of the Cloudflare &lt;a href=\&quot;https://developers.cloudflare.com/workers/\&quot;&gt;&lt;u&gt;Workers&lt;/u&gt;&lt;/a&gt; serverless platform. A DO is essentially a small server that can be addressed by a unique name and can keep state both in-memory and on-disk. Workers running anywhere on Cloudflare&amp;#39;s network can send messages to a DO by its name, and all messages addressed to the same name — from anywhere in the world — will find their way to the same DO instance.&lt;/p&gt;&lt;p&gt;DOs are intended to be small and numerous. A single application can create billions of DOs distributed across our global network. Cloudflare automatically decides where a DO should live based on where it is accessed, automatically starts it up as needed when requests arrive, and shuts it down when idle. A DO has in-memory state while running and can also optionally store long-lived durable state. Since there is exactly one DO for each name, a DO can be used to coordinate between operations on the same logical object.&lt;/p&gt;&lt;p&gt;For example, imagine a real-time collaborative document editor application. Many users may be editing the same document at the same time. Each user&amp;#39;s changes must be broadcast to other users in real time, and conflicts must be resolved. An application built on DOs would typically create one DO for each document. The DO would receive edits from users, resolve conflicts, broadcast the changes back out to other users, and keep the document content updated in its local storage.&lt;/p&gt;&lt;p&gt;DOs are especially good at real-time collaboration, but are by no means limited to this use case. They are general-purpose servers that can implement any logic you desire to serve requests. Even more generally, &lt;b&gt;DOs are a basic building block for distributed systems&lt;/b&gt;.&lt;/p&gt;&lt;p&gt;When using Durable Objects, it&amp;#39;s important to remember that they are intended to scale &lt;i&gt;out&lt;/i&gt;, not &lt;i&gt;up&lt;/i&gt;. A single object is inherently limited in throughput since it runs on a single thread of a single machine. To handle more traffic, you create more objects. This is easiest when different objects can handle different logical units of state (like different documents, different users, or different &amp;quot;shards&amp;quot; of a database), where each unit of state has low enough traffic to be handled by a single object. But sometimes, a lot of traffic needs to modify the same state: consider a vote counter with a million users all trying to cast votes at once. To handle such cases with Durable Objects, you would need to create a set of objects that each handle a subset of traffic and then replicate state to each other. Perhaps they use &lt;a href=\&quot;https://en.wikipedia.org/wiki/Conflict-free_replicated_data_type\&quot;&gt;&lt;u&gt;CRDTs&lt;/u&gt;&lt;/a&gt; in a &lt;a href=\&quot;https://en.wikipedia.org/wiki/Gossip_protocol\&quot;&gt;&lt;u&gt;gossip network&lt;/u&gt;&lt;/a&gt;, or perhaps they implement a fan-in/fan-out approach to a single primary object. Whatever approach you take, Durable Objects make it fast and easy to create more stateful nodes as needed.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;why-is-sqlite-in-do-so-fast\&quot;&gt;Why is SQLite-in-DO so fast?&lt;/h2&gt;\n            &lt;a href=\&quot;#why-is-sqlite-in-do-so-fast\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;In traditional cloud architecture, stateless application servers run business logic and communicate over the network to a database. Even if the network is local, database requests still incur latency, typically measured in milliseconds.&lt;/p&gt;&lt;p&gt;When a Durable Object uses SQLite, SQLite is invoked as a library. This means the database code runs not just on the same machine as the DO, not just in the same process, but in the very same thread. Latency is effectively zero, because there is no communication barrier between the application and SQLite. A query can complete in microseconds.&lt;/p&gt;&lt;h4&gt;Reads and writes are synchronous&lt;/h4&gt;&lt;p&gt;The SQL query API in DOs does not require you to await results — they are returned synchronously:&lt;/p&gt;\n            &lt;pre class=\&quot;language-javascript\&quot;&gt;&lt;code class=\&quot;language-javascript\&quot;&gt;// No awaits!\nlet cursor = sql.exec(&amp;quot;SELECT name, email FROM users&amp;quot;);\nfor (let user of cursor) {\n  console.log(user.name, user.email);\n}\n&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;This may come as a surprise to some. Querying a database is I/O, right? I/O should always be asynchronous, right? Isn&amp;#39;t this a violation of the natural order of JavaScript?&lt;/p&gt;&lt;p&gt;It&amp;#39;s OK! The database content is probably cached in memory already, and SQLite is being called as a library in the same thread as the application, so the query often actually won&amp;#39;t spend any time at all waiting for I/O. Even if it does have to go to disk, it&amp;#39;s a local SSD. You might as well consider the local disk as just another layer in the memory cache hierarchy: L5 cache, if you will. In any case, it will respond quickly.&lt;/p&gt;&lt;p&gt;Meanwhile, synchronous queries provide some big benefits. First, the logistics of asynchronous event loops have a cost, so in the common case where the data is already in memory, a synchronous query will actually complete faster than an async one.&lt;/p&gt;&lt;p&gt;More importantly, though, synchronous queries help you avoid subtle bugs. Any time your application awaits a promise, it&amp;#39;s possible that some other code executes while you wait. The state of the world may have changed by the time your await completes. Maybe even other SQL queries were executed. This can lead to subtle bugs that are hard to reproduce because they require events to happen at just the wrong time. With a synchronous API, though, none of that can happen. Your code always executes in the order you wrote it, uninterrupted.&lt;/p&gt;&lt;h4&gt;Fast writes with Output Gates&lt;/h4&gt;&lt;p&gt;Database experts might have a deeper objection to synchronous queries: Yes, caching may mean we can perform reads and writes very fast. However, in the case of a write, just writing to cache isn&amp;#39;t good enough. Before we return success to our client, we must &lt;i&gt;confirm&lt;/i&gt; that the write is actually &lt;i&gt;durable&lt;/i&gt;, that is, it has actually made it onto disk or network storage such that it cannot be lost if the power suddenly goes out.&lt;/p&gt;&lt;p&gt;Normally, a database would confirm all writes before returning to the application. So if the query is successful, it is confirmed. But confirming writes can be slow, because it requires waiting for the underlying storage medium to respond. Normally, this is OK because the write is performed asynchronously, so the program can go on and work on other things while it waits for the write to finish. It looks kind of like this:&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1vuBOUXdFxUKM5gTyhKvx5/4e55fa2d8fb5a68af8a84453cf2b5d14/BLOG-2536_4.png\&quot; alt=\&quot;BLOG-2536 4\&quot; class=\&quot;kg-image\&quot; width=\&quot;732\&quot; height=\&quot;817\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;But I just told you that in Durable Objects, writes are synchronous. While a synchronous call is running, no other code in the program can run (because JavaScript does not have threads). This is convenient, as mentioned above, because it means you don&amp;#39;t need to worry that the state of the world may have changed while you were waiting. However, if write queries have to wait a while, and the whole program must pause and wait for them, then throughput will suffer.&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/35QfJmRKIo763Sv3EU0tAv/96e6819df3504d9d893557f43cc30fab/BLOG-2536_5.png\&quot; alt=\&quot;BLOG-2536 5\&quot; class=\&quot;kg-image\&quot; width=\&quot;732\&quot; height=\&quot;817\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;Luckily, in Durable Objects, writes do not have to wait, due to a little trick we call &amp;quot;Output Gates&amp;quot;.&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/2UhnMY6J6QrjWAAYH1rgTq/39532506841293c1a5c41d9843df1037/BLOG-2536_6.png\&quot; alt=\&quot;BLOG-2536 6\&quot; class=\&quot;kg-image\&quot; width=\&quot;732\&quot; height=\&quot;482\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;In DOs, when the application issues a write, it continues executing without waiting for confirmation. However, when the DO then responds to the client, the response is blocked by the &amp;quot;Output Gate&amp;quot;. This system holds the response until all storage writes relevant to the response have been confirmed, then sends the response on its way. In the rare case that the write fails, the response will be replaced with an error and the Durable Object itself will restart. So, even though the application constructed a &amp;quot;success&amp;quot; response, nobody can ever see that this happened, and thus nobody can be misled into believing that the data was stored.&lt;/p&gt;&lt;p&gt;Let&amp;#39;s see what this looks like with multiple requests:&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/5nwypzObwvZ73JJ4Ho2VkS/5bd72d9c80944eb47c43b0b202cb3f86/BLOG-2536_7.png\&quot; alt=\&quot;BLOG-2536 7\&quot; class=\&quot;kg-image\&quot; width=\&quot;732\&quot; height=\&quot;734\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;If you compare this against the first diagram above, you should notice a few things:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;The timing of requests and confirmations are the same.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;But, all responses were sent to the client &lt;i&gt;sooner&lt;/i&gt; than in the first diagram. Latency was reduced! This is because the application is able to work on constructing the response in parallel with the storage layer confirming the write.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Request handling is no longer interleaved between the three requests. Instead, each request runs to completion before the next begins. The application does not need to worry, during the handling of one request, that its state might change unexpectedly due to a concurrent request.&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;With Output Gates, we get the ease-of-use of synchronous writes, while also getting lower latency and no loss of throughput.&lt;/p&gt;&lt;h4&gt;N+1 selects? No problem.&lt;/h4&gt;&lt;p&gt;Zero-latency queries aren&amp;#39;t just faster, they allow you to structure your code differently, often making it simpler. A classic example is the &amp;quot;N+1 selects&amp;quot; or &amp;quot;N+1 queries&amp;quot; problem. Let&amp;#39;s illustrate this problem with an example:&lt;/p&gt;\n            &lt;pre class=\&quot;language-javascript\&quot;&gt;&lt;code class=\&quot;language-javascript\&quot;&gt;// N+1 SELECTs example\n\n// Get the 100 most-recently-modified docs.\nlet docs = sql.exec(`\n  SELECT title, authorId FROM documents\n  ORDER BY lastModified DESC\n  LIMIT 100\n`).toArray();\n\n// For each returned document, get the author name from the users table.\nfor (let doc of docs) {\n  doc.authorName = sql.exec(\n      &amp;quot;SELECT name FROM users WHERE id = ?&amp;quot;, doc.authorId).one().name;\n}\n&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;If you are an experienced SQL user, you are probably cringing at this code, and for good reason: this code does 101 queries! If the application is talking to the database across a network with 5ms latency, this will take 505ms to run, which is slow enough for humans to notice.&lt;/p&gt;\n            &lt;pre class=\&quot;language-javascript\&quot;&gt;&lt;code class=\&quot;language-javascript\&quot;&gt;// Do it all in one query with a join?\nlet docs = sql.exec(`\n  SELECT documents.title, users.name\n  FROM documents JOIN users ON documents.authorId = users.id\n  ORDER BY documents.lastModified DESC\n  LIMIT 100\n`).toArray();\n&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;Here we&amp;#39;ve used SQL features to turn our 101 queries into one query. Great! Except, what does it mean? We used an inner join, which is not to be confused with a left, right, or cross join. What&amp;#39;s the difference? Honestly, I have no idea! I had to look up joins just to write this example and I&amp;#39;m already confused.&lt;/p&gt;&lt;p&gt;Well, good news: You don&amp;#39;t need to figure it out. Because &lt;b&gt;when using SQLite as a library, the first example above &lt;/b&gt;&lt;b&gt;&lt;i&gt;works just fine&lt;/i&gt;&lt;/b&gt;&lt;b&gt;.&lt;/b&gt; It&amp;#39;ll perform about the same as the second fancy version.&lt;/p&gt;&lt;p&gt;More generally, when using SQLite as a library, you don&amp;#39;t have to learn how to do fancy things in SQL syntax. Your logic can be in regular old application code in your programming language of choice, orchestrating the most basic SQL queries that are easy to learn. It&amp;#39;s fine. &lt;a href=\&quot;https://www.sqlite.org/np1queryprob.html\&quot;&gt;&lt;u&gt;The creators of SQLite have made this point themselves.&lt;/u&gt;&lt;/a&gt;&lt;/p&gt;&lt;h4&gt;Point-in-Time Recovery&lt;/h4&gt;&lt;p&gt;While not necessarily related to speed, SQLite-backed Durable Objects offer another feature: any object can be reverted to the state it had at any point in time in the last 30 days. So if you accidentally execute a buggy query that corrupts all your data, don&amp;#39;t worry: you can recover. There&amp;#39;s no need to opt into this feature in advance; it&amp;#39;s on by default for all SQLite-backed DOs. See the &lt;a href=\&quot;https://developers.cloudflare.com/durable-objects/api/storage-api/#point-in-time-recovery\&quot;&gt;&lt;u&gt;docs&lt;/u&gt;&lt;/a&gt; for details.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;how-do-i-use-it\&quot;&gt;How do I use it?&lt;/h2&gt;\n            &lt;a href=\&quot;#how-do-i-use-it\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;Let&amp;#39;s say we&amp;#39;re an airline, and we are implementing a way for users to choose their seats on a flight. We will create a new Durable Object for each flight. Within that DO, we will use a SQL table to track the assignments of seats to passengers. The code might look something like this:&lt;/p&gt;\n            &lt;pre class=\&quot;language-javascript\&quot;&gt;&lt;code class=\&quot;language-javascript\&quot;&gt;import {DurableObject} from &amp;quot;cloudflare:workers&amp;quot;;\n\n// Manages seat assignment for a flight.\n//\n// This is an RPC interface. The methods can be called remotely by other Workers\n// running anywhere in the world. All Workers that specify same object ID\n// (probably based on the flight number and date) will reach the same instance of\n// FlightSeating.\nexport class FlightSeating extends DurableObject {\n  sql = this.ctx.storage.sql;\n\n  // Application calls this when the flight is first created to set up the seat map.\n  initializeFlight(seatList) {\n    this.sql.exec(`\n      CREATE TABLE seats (\n        seatId TEXT PRIMARY KEY,  -- e.g. &amp;quot;3B&amp;quot;\n        occupant TEXT             -- null if available\n      )\n    `);\n\n    for (let seat of seatList) {\n      this.sql.exec(`INSERT INTO seats VALUES (?, null)`, seat);\n    }\n  }\n\n  // Get a list of available seats.\n  getAvailable() {\n    let results = [];\n\n    // Query returns a cursor.\n    let cursor = this.sql.exec(`SELECT seatId FROM seats WHERE occupant IS NULL`);\n\n    // Cursors are iterable.\n    for (let row of cursor) {\n      // Each row is an object with a property for each column.\n      results.push(row.seatId);\n    }\n\n    return results;\n  }\n\n  // Assign passenger to a seat.\n  assignSeat(seatId, occupant) {\n    // Check that seat isn&amp;#039;t occupied.\n    let cursor = this.sql.exec(`SELECT occupant FROM seats WHERE seatId = ?`, seatId);\n    let result = [...cursor][0];  // Get the first result from the cursor.\n    if (!result) {\n      throw new Error(&amp;quot;No such seat: &amp;quot; + seatId);\n    }\n    if (result.occupant !== null) {\n      throw new Error(&amp;quot;Seat is occupied: &amp;quot; + seatId);\n    }\n\n    // If the occupant is already in a different seat, remove them.\n    this.sql.exec(`UPDATE seats SET occupant = null WHERE occupant = ?`, occupant);\n\n    // Assign the seat. Note: We don&amp;#039;t have to worry that a concurrent request may\n    // have grabbed the seat between the two queries, because the code is synchronous\n    // (no `await`s) and the database is private to this Durable Object. Nothing else\n    // could have changed since we checked that the seat was available earlier!\n    this.sql.exec(`UPDATE seats SET occupant = ? WHERE seatId = ?`, occupant, seatId);\n  }\n}\n&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;(With just a little more code, we could extend this example to allow clients to subscribe to seat changes with &lt;a href=\&quot;https://developers.cloudflare.com/durable-objects/reference/websockets/#_top\&quot;&gt;&lt;u&gt;WebSockets&lt;/u&gt;&lt;/a&gt;, so that if multiple people are choosing their seats at the same time, they can see in real time as seats become unavailable. But, that&amp;#39;s outside the scope of this blog post, which is just about SQL storage.)&lt;/p&gt;&lt;p&gt;Then in wrangler.toml, &lt;a href=\&quot;https://developers.cloudflare.com/durable-objects/reference/durable-objects-migrations/\&quot;&gt;&lt;u&gt;define a migration&lt;/u&gt;&lt;/a&gt; setting up your DO class like usual, but instead of using new_classes, use new_sqlite_classes:&lt;/p&gt;\n            &lt;pre class=\&quot;language-javascript\&quot;&gt;&lt;code class=\&quot;language-javascript\&quot;&gt;[[migrations]]\ntag = &amp;quot;v1&amp;quot;\nnew_sqlite_classes = [&amp;quot;FlightSeating&amp;quot;]\n&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;SQLite-backed objects also support the existing &lt;a href=\&quot;https://developers.cloudflare.com/durable-objects/api/transactional-storage-api/\&quot;&gt;&lt;u&gt;key/value-based storage API&lt;/u&gt;&lt;/a&gt;: KV data is stored into a hidden table in the SQLite database. So, existing applications built on DOs will work when deployed using SQLite-backed objects.&lt;/p&gt;&lt;p&gt;However, because SQLite-backed objects are based on an all-new storage backend, it is currently not possible to switch an existing deployed DO class to use SQLite. You must ask for SQLite when initially deploying the new DO class; you cannot change it later. We plan to begin migrating existing DOs to the new storage backend in 2025.&lt;/p&gt;&lt;h4&gt;Pricing&lt;/h4&gt;&lt;p&gt;We’ve kept &lt;a href=\&quot;https://developers.cloudflare.com/durable-objects/platform/pricing/#sql-storage-billing\&quot;&gt;&lt;u&gt;pricing&lt;/u&gt;&lt;/a&gt; for SQLite-in-DO similar to D1, Cloudflare’s serverless SQL database, by billing for SQL queries (based on rows) and SQL storage. SQL storage per object is limited to 1 GB during the beta period, and will be increased to 10 GB on general availability. DO &lt;a href=\&quot;https://developers.cloudflare.com/durable-objects/platform/pricing/#billing-metrics\&quot;&gt;&lt;u&gt;requests and duration billing&lt;/u&gt;&lt;/a&gt; are unchanged and apply to all DOs regardless of storage backend. &lt;/p&gt;&lt;p&gt;During the initial beta, billing is not enabled for SQL queries (rows read and rows written) and SQL storage. SQLite-backed objects will incur charges for requests and duration. We plan to enable SQL billing in the first half of 2025 with advance notice.&lt;/p&gt;&lt;style type=\&quot;text/css\&quot;&gt;\n.tg  {border-collapse:collapse;border-spacing:0;margin:0px auto;}\n.tg td{border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;\n  overflow:hidden;padding:10px 5px;word-break:normal;}\n.tg th{border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;\n  font-weight:normal;overflow:hidden;padding:10px 5px;word-break:normal;}\n.tg .tg-4qtd{background-color:#f8a102;font-weight:bold;text-align:left;vertical-align:top}\n.tg .tg-y0nj{background-color:#f8a102;font-weight:bold;text-align:center;vertical-align:top}\n.tg .tg-0lax{text-align:left;vertical-align:top}\n@media screen and (max-width: 767px) {.tg {width: auto !important;}.tg col {width: auto !important;}.tg-wrap {overflow-x: auto;-webkit-overflow-scrolling: touch;margin: auto 0px;}}&lt;/style&gt;\n&lt;div class=\&quot;tg-wrap\&quot;&gt;&lt;table class=\&quot;tg\&quot;&gt;&lt;thead&gt;\n  &lt;tr&gt;\n    &lt;th class=\&quot;tg-4qtd\&quot;&gt;&lt;/th&gt;\n    &lt;th class=\&quot;tg-y0nj\&quot;&gt;&lt;span style=\&quot;font-style:normal;text-decoration:none;color:#000\&quot;&gt;Workers Paid&lt;/span&gt;&lt;/th&gt;\n  &lt;/tr&gt;&lt;/thead&gt;\n&lt;tbody&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Rows read&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;First 25 billion / month included + $0.001 / million rows&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Rows written&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;First 50 million / month included + $1.00 / million rows&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;SQL storage&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;5 GB-month + $0.20/ GB-month&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;For more on how to use SQLite-in-Durable Objects, check out the &lt;a href=\&quot;https://developers.cloudflare.com/durable-objects/best-practices/access-durable-objects-storage/\&quot;&gt;&lt;u&gt;documentation&lt;/u&gt;&lt;/a&gt;. &lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;what-about-d1\&quot;&gt;What about D1?&lt;/h2&gt;\n            &lt;a href=\&quot;#what-about-d1\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;Cloudflare Workers already offers another SQLite-backed database product: &lt;a href=\&quot;https://developers.cloudflare.com/d1/\&quot;&gt;&lt;u&gt;D1&lt;/u&gt;&lt;/a&gt;. In fact, D1 is itself built on SQLite-in-DO. So, what&amp;#39;s the difference? Why use one or the other?&lt;/p&gt;&lt;p&gt;In short, you should think of D1 as a more &amp;quot;managed&amp;quot; database product, while SQLite-in-DO is more of a lower-level “compute with storage” building block.&lt;/p&gt;&lt;p&gt;D1 fits into a more traditional cloud architecture, where stateless application servers talk to a separate database over the network. Those application servers are typically Workers, but could also be clients running outside of Cloudflare. D1 also comes with a pre-built HTTP API and managed observability features like query insights. With D1, where your application code and SQL database queries are not colocated like in SQLite-in-DO, Workers has &lt;a href=\&quot;https://developers.cloudflare.com/workers/configuration/smart-placement\&quot;&gt;&lt;u&gt;Smart Placement&lt;/u&gt;&lt;/a&gt; to dynamically run your Worker in the best location to reduce total request latency, considering everything your Worker talks to, including D1. By the end of 2024, D1 will support automatic read replication for scalability and low-latency access around the world. If this managed model appeals to you, use D1.&lt;/p&gt;&lt;p&gt;Durable Objects require a bit more effort, but in return, give you more power. With DO, you have two pieces of code that run in different places: a front-end Worker which routes incoming requests from the Internet to the correct DO, and the DO itself, which runs on the same machine as the SQLite database. You may need to think carefully about which code to run where, and you may need to build some of your own tooling that exists out-of-the-box with D1. But because you are in full control, you can tailor the solution to your application&amp;#39;s needs and potentially achieve more.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;under-the-hood-storage-relay-service\&quot;&gt;Under the hood: Storage Relay Service&lt;/h2&gt;\n            &lt;a href=\&quot;#under-the-hood-storage-relay-service\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;&lt;a href=\&quot;https://blog.cloudflare.com/introducing-workers-durable-objects/\&quot;&gt;&lt;u&gt;When Durable Objects first launched in 2020&lt;/u&gt;&lt;/a&gt;, it offered only a simple key/value-based interface for durable storage. Under the hood, these keys and values were stored in a well-known off-the-shelf database, with regional instances of this database deployed to locations in our data centers around the world. Durable Objects in each region would store their data to the regional database.&lt;/p&gt;&lt;p&gt;For SQLite-backed Durable Objects, we have completely replaced the persistence layer with a new system built from scratch, called Storage Relay Service, or SRS. SRS has already been powering D1 for over a year, and can now be used more directly by applications through Durable Objects.&lt;/p&gt;&lt;p&gt;SRS is based on a simple idea:&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;&lt;i&gt;Local disk is fast and randomly-accessible, but expensive and prone to disk failures. Object storage (like &lt;/i&gt;&lt;a href=\&quot;https://developers.cloudflare.com/r2/\&quot;&gt;&lt;i&gt;&lt;u&gt;R2&lt;/u&gt;&lt;/i&gt;&lt;/a&gt;&lt;i&gt;) is cheap and durable, but much slower than local disk and not designed for database-like access patterns. Can we get the best of both worlds by using a local disk as a cache on top of object storage?&lt;/i&gt;&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;So, how does it work?&lt;/p&gt;&lt;h4&gt;The mismatch in functionality between local disk and object storage&lt;/h4&gt;&lt;p&gt;A SQLite database on disk tends to undergo many small changes in rapid succession. Any row of the database might be updated by any particular query, but the database is designed to avoid rewriting parts that didn&amp;#39;t change. Read queries may randomly access any part of the database. Assuming the right indexes exist to support the query, they should not require reading parts of the database that aren&amp;#39;t relevant to the results, and should complete in microseconds.&lt;/p&gt;&lt;p&gt;Object storage, on the other hand, is designed for an entirely different usage model: you upload an entire &amp;quot;object&amp;quot; (blob of bytes) at a time, and download an entire blob at a time. Each blob has a different name. For maximum efficiency, blobs should be fairly large, from hundreds of kilobytes to gigabytes in size. Latency is relatively high, measured in tens or hundreds of milliseconds.&lt;/p&gt;&lt;p&gt;So how do we back up our SQLite database to object storage? An obviously naive strategy would be to simply make a copy of the database files from time to time and upload it as a new &amp;quot;object&amp;quot;. But, uploading the database on every change — and making the application wait for the upload to complete — would obviously be way too slow. We could choose to upload the database only occasionally — say, every 10 minutes — but this means in the case of a disk failure, we could lose up to 10 minutes of changes. Data loss is, uh, bad! And even then, for most databases, it&amp;#39;s likely that most of the data doesn&amp;#39;t change every 10 minutes, so we&amp;#39;d be uploading the same data over and over again.&lt;/p&gt;&lt;h4&gt;Trick one: Upload a log of changes&lt;/h4&gt;&lt;p&gt;Instead of uploading the entire database, SRS records a log of &lt;i&gt;changes&lt;/i&gt;, and uploads those.&lt;/p&gt;&lt;p&gt;Conveniently, SQLite itself already has a concept of a change log: the &lt;a href=\&quot;https://www.sqlite.org/wal.html\&quot;&gt;&lt;u&gt;Write-Ahead Log, or WAL&lt;/u&gt;&lt;/a&gt;. SRS always configures SQLite to use WAL mode. In this mode, any changes made to the database are first written to a separate log file. From time to time, the database is &amp;quot;checkpointed&amp;quot;, merging the changes back into the main database file. The WAL format is &lt;a href=\&quot;https://www.sqlite.org/fileformat2.html#the_write_ahead_log\&quot;&gt;&lt;u&gt;well-documented&lt;/u&gt;&lt;/a&gt; and easy to understand: it&amp;#39;s just a sequence of &amp;quot;frames&amp;quot;, where each frame is an instruction to write some bytes to a particular offset in the database file.&lt;/p&gt;&lt;p&gt;SRS monitors changes to the WAL file (by hooking &lt;a href=\&quot;https://www.sqlite.org/vfs.html\&quot;&gt;&lt;u&gt;SQLite&amp;#39;s VFS&lt;/u&gt;&lt;/a&gt; to intercept file writes) to discover the changes being made to the database, and uploads those to object storage.&lt;/p&gt;&lt;p&gt;Unfortunately, SRS cannot simply upload every single change as a separate &amp;quot;object&amp;quot;, as this would result in too many objects, each of which would be inefficiently small. Instead, SRS batches changes over a period of up to 10 seconds, or up to 16 MB worth, whichever happens first, then uploads the whole batch as a single object.&lt;/p&gt;&lt;p&gt;When reconstructing a database from object storage, we must download the series of change batches and replay them in order. Of course, if the database has undergone many changes over a long period of time, this can get expensive. In order to limit how far back it needs to look, SRS also occasionally uploads a snapshot of the entire content of the database. SRS will decide to upload a snapshot any time that the total size of logs since the last snapshot exceeds the size of the database itself. This heuristic implies that the total amount of data that SRS must download to reconstruct a database is limited to no more than twice the size of the database. Since we can delete data from object storage that is older than the latest snapshot, this also means that our total stored data is capped to 2x the database size.&lt;/p&gt;&lt;p&gt;Credit where credit is due: This idea — uploading WAL batches and snapshots to object storage — was inspired by &lt;a href=\&quot;https://litestream.io/\&quot;&gt;&lt;u&gt;Litestream&lt;/u&gt;&lt;/a&gt;, although our implementation is different.&lt;/p&gt;&lt;h4&gt;Trick two: Relay through other servers in our global network&lt;/h4&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/D6uKAW3oEkzgAMKwYmQwr/453ce6d752339fb73022eb32e0e7b792/BLOG-2536_8.png\&quot; alt=\&quot;BLOG-2536 8\&quot; class=\&quot;kg-image\&quot; width=\&quot;1200\&quot; height=\&quot;452\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;Batches are only uploaded to object storage every 10 seconds. But obviously, we cannot make the application wait for 10 whole seconds just to confirm a write. So what happens if the application writes some data, returns a success message to the user, and then the machine fails 9 seconds later, losing the data?&lt;/p&gt;&lt;p&gt;To solve this problem, we take advantage of our global network. Every time SQLite commits a transaction, SRS will immediately forward the change log to five &amp;quot;follower&amp;quot; machines across our network. Once at least three of these followers respond that they have received the change, SRS informs the application that the write is confirmed. (As discussed earlier, the write confirmation opens the Durable Object&amp;#39;s &amp;quot;output gate&amp;quot;, unblocking network communications to the rest of the world.)&lt;/p&gt;&lt;p&gt;When a follower receives a change, it temporarily stores it in a buffer on local disk, and then awaits further instructions. Later on, once SRS has successfully uploaded the change to object storage as part of a batch, it informs each follower that the change has been persisted. At that point, the follower can simply delete the change from its buffer.&lt;/p&gt;&lt;p&gt;However, if the follower never receives the persisted notification, then, after some timeout, the follower itself will upload the change to object storage. Thus, if the machine running the database suddenly fails, as long as at least one follower is still running, it will ensure that all confirmed writes are safely persisted.&lt;/p&gt;&lt;p&gt;Each of a database&amp;#39;s five followers is located in a different physical data center. Cloudflare&amp;#39;s network consists of hundreds of data centers around the world, which means it is always easy for us to find four other data centers nearby any Durable Object (in addition to the one it is running in). In order for a confirmed write to be lost, then, at least four different machines in at least three different physical buildings would have to fail simultaneously (three of the five followers, plus the Durable Object&amp;#39;s host machine). Of course, anything can happen, but this is exceedingly unlikely.&lt;/p&gt;&lt;p&gt;Followers also come in handy when a Durable Object&amp;#39;s host machine is unresponsive. We may not know for sure if the machine has died completely, or if it is still running and responding to some clients but not others. We cannot start up a new instance of the DO until we know for sure that the previous instance is dead – or, at least, that it can no longer confirm writes, since the old and new instances could then confirm contradictory writes. To deal with this situation, if we can&amp;#39;t reach the DO&amp;#39;s host, we can instead try to contact its followers. If we can contact at least three of the five followers, and tell them to stop confirming writes for the unreachable DO instance, then we know that instance is unable to confirm any more writes going forward. We can then safely start up a new instance to replace the unreachable one.&lt;/p&gt;&lt;h4&gt;Bonus feature: Point-in-Time Recovery&lt;/h4&gt;&lt;p&gt;I mentioned earlier that SQLite-backed Durable Objects can be asked to revert their state to any time in the last 30 days. How does this work?&lt;/p&gt;&lt;p&gt;This was actually an accidental feature that fell out of SRS&amp;#39;s design. Since SRS stores a complete log of changes made to the database, we can restore to any point in time by replaying the change log from the last snapshot. The only thing we have to do is make sure we don&amp;#39;t delete those logs too soon.&lt;/p&gt;&lt;p&gt;Normally, whenever a snapshot is uploaded, all previous logs and snapshots can then be deleted. But instead of deleting them immediately, SRS merely marks them for deletion 30 days later. In the meantime, if a point-in-time recovery is requested, the data is still there to work from.&lt;/p&gt;&lt;p&gt;For a database with a high volume of writes, this may mean we store a lot of data for a lot longer than needed. As it turns out, though, once data has been written at all, keeping it around for an extra month is pretty cheap — typically cheaper, even, than writing it in the first place. It&amp;#39;s a small price to pay for always-on disaster recovery.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;get-started-with-sqlite-in-do\&quot;&gt;Get started with SQLite-in-DO&lt;/h2&gt;\n            &lt;a href=\&quot;#get-started-with-sqlite-in-do\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;SQLite-backed DOs are available in beta starting today. You can start building with SQLite-in-DO by visiting &lt;a href=\&quot;https://developers.cloudflare.com/durable-objects/best-practices/access-durable-objects-storage/\&quot;&gt;&lt;u&gt;developer documentation&lt;/u&gt;&lt;/a&gt; and provide beta feedback via the &lt;a href=\&quot;https://discord.com/channels/595317990191398933/773219443911819284\&quot;&gt;&lt;u&gt;#durable-objects channel&lt;/u&gt;&lt;/a&gt; on our Developer Discord.&lt;/p&gt;&lt;p&gt;Do distributed systems like SRS excite you? Would you like to be part of building them at Cloudflare? &lt;a href=\&quot;https://boards.greenhouse.io/embed/job_app?token=5390243\&quot;&gt;&lt;u&gt;We&amp;#39;re hiring!&lt;/u&gt;&lt;/a&gt;&lt;/p&gt;&quot;],&quot;published_at&quot;:[0,&quot;2024-09-26T14:00+01:00&quot;],&quot;updated_at&quot;:[0,&quot;2024-12-12T00:07:19.134Z&quot;],&quot;feature_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/4Nrfj970STQQqJd9TFBTfX/5c9f2098d8cae3a17244f5772bcac9f4/BLOG-2536_1.png&quot;],&quot;tags&quot;:[1,[[0,{&quot;id&quot;:[0,&quot;1Cv5JjXzKWKEA10JdYbXu1&quot;],&quot;name&quot;:[0,&quot;Birthday Week&quot;],&quot;slug&quot;:[0,&quot;birthday-week&quot;]}],[0,{&quot;id&quot;:[0,&quot;6QktrXeEFcl4e2dZUTZVGl&quot;],&quot;name&quot;:[0,&quot;Product News&quot;],&quot;slug&quot;:[0,&quot;product-news&quot;]}],[0,{&quot;id&quot;:[0,&quot;6hbkItfupogJP3aRDAq6v8&quot;],&quot;name&quot;:[0,&quot;Cloudflare Workers&quot;],&quot;slug&quot;:[0,&quot;workers&quot;]}],[0,{&quot;id&quot;:[0,&quot;5v2UZdTRX1Rw9akmhexnxs&quot;],&quot;name&quot;:[0,&quot;Durable Objects&quot;],&quot;slug&quot;:[0,&quot;durable-objects&quot;]}],[0,{&quot;id&quot;:[0,&quot;4HIPcb68qM0e26fIxyfzwQ&quot;],&quot;name&quot;:[0,&quot;Developers&quot;],&quot;slug&quot;:[0,&quot;developers&quot;]}],[0,{&quot;id&quot;:[0,&quot;3JAY3z7p7An94s6ScuSQPf&quot;],&quot;name&quot;:[0,&quot;Developer Platform&quot;],&quot;slug&quot;:[0,&quot;developer-platform&quot;]}]]],&quot;relatedTags&quot;:[0],&quot;authors&quot;:[1,[[0,{&quot;name&quot;:[0,&quot;Kenton Varda&quot;],&quot;slug&quot;:[0,&quot;kenton-varda&quot;],&quot;bio&quot;:[0,null],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1FFs4T2j1RyvxasKOkkdtP/e7bd05ce89c560a545853000a25da9bc/kenton-varda.jpg&quot;],&quot;location&quot;:[0,null],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,&quot;@kentonvarda&quot;],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}]]],&quot;meta_description&quot;:[0,&quot;Traditional cloud storage is inherently slow because it is accessed over a network and must synchronize many clients. But what if we could instead put your application code deep into the storage layer, such that your code runs where the data is stored? Durable Objects with SQLite do just that.\n&quot;],&quot;primary_author&quot;:[0,{}],&quot;localeList&quot;:[0,{&quot;name&quot;:[0,&quot;blog-english-only&quot;],&quot;enUS&quot;:[0,&quot;English for Locale&quot;],&quot;zhCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhHansCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhTW&quot;:[0,&quot;No Page for Locale&quot;],&quot;frFR&quot;:[0,&quot;No Page for Locale&quot;],&quot;deDE&quot;:[0,&quot;No Page for Locale&quot;],&quot;itIT&quot;:[0,&quot;No Page for Locale&quot;],&quot;jaJP&quot;:[0,&quot;No Page for Locale&quot;],&quot;koKR&quot;:[0,&quot;No Page for Locale&quot;],&quot;ptBR&quot;:[0,&quot;No Page for Locale&quot;],&quot;esLA&quot;:[0,&quot;No Page for Locale&quot;],&quot;esES&quot;:[0,&quot;No Page for Locale&quot;],&quot;enAU&quot;:[0,&quot;No Page for Locale&quot;],&quot;enCA&quot;:[0,&quot;No Page for Locale&quot;],&quot;enIN&quot;:[0,&quot;No Page for Locale&quot;],&quot;enGB&quot;:[0,&quot;No Page for Locale&quot;],&quot;idID&quot;:[0,&quot;No Page for Locale&quot;],&quot;ruRU&quot;:[0,&quot;No Page for Locale&quot;],&quot;svSE&quot;:[0,&quot;No Page for Locale&quot;],&quot;viVN&quot;:[0,&quot;No Page for Locale&quot;],&quot;plPL&quot;:[0,&quot;No Page for Locale&quot;],&quot;arAR&quot;:[0,&quot;No Page for Locale&quot;],&quot;nlNL&quot;:[0,&quot;No Page for Locale&quot;],&quot;thTH&quot;:[0,&quot;No Page for Locale&quot;],&quot;trTR&quot;:[0,&quot;No Page for Locale&quot;],&quot;heIL&quot;:[0,&quot;No Page for Locale&quot;],&quot;lvLV&quot;:[0,&quot;No Page for Locale&quot;],&quot;etEE&quot;:[0,&quot;No Page for Locale&quot;],&quot;ltLT&quot;:[0,&quot;No Page for Locale&quot;]}],&quot;url&quot;:[0,&quot;https://blog.cloudflare.com/sqlite-in-durable-objects&quot;],&quot;metadata&quot;:[0,{&quot;title&quot;:[0,&quot;Zero-latency SQLite storage in every Durable Object&quot;],&quot;description&quot;:[0,&quot;Traditional cloud storage is inherently slow because it is accessed over a network and must synchronize many clients. But what if we could instead put your application code deep into the storage layer, such that your code runs where the data is stored? Durable Objects with SQLite do just that.&quot;],&quot;imgPreview&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1EuNamTw8x3H3XRzBaobmS/927b290c7637aa32e7d0f4edce38dae3/Zero-latency_SQLite_storage_in_every_Durable_Object-OG.png&quot;]}],&quot;publicly_index&quot;:[0,true]}],[0,{&quot;id&quot;:[0,&quot;7iSu3hCtgPt2FoZ60sWKuO&quot;],&quot;title&quot;:[0,&quot;Cloudflare acquires PartyKit to allow developers to build real-time multi-user applications&quot;],&quot;slug&quot;:[0,&quot;cloudflare-acquires-partykit&quot;],&quot;excerpt&quot;:[0,&quot;We&#39;re thrilled to announce that PartyKit, a trailblazer in enabling developers to craft ambitious real-time, collaborative, multiplayer applications, is now a part of Cloudflare&quot;],&quot;featured&quot;:[0,false],&quot;html&quot;:[0,&quot;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/6YcepnPyByawIfZ2geoJHw/298ce904b39e91a2ed316858cc36e149/PartyKit-and-Cloudflare.png\&quot; alt=\&quot;Cloudflare acquires PartyKit to allow developers to build real-time multi-user applications\&quot; class=\&quot;kg-image\&quot; width=\&quot;2400\&quot; height=\&quot;1350\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;We&amp;#39;re thrilled to announce that PartyKit, an open source platform for deploying real-time, collaborative, multiplayer applications, is now a part of Cloudflare. This acquisition marks a significant milestone in our journey to redefine the boundaries of serverless computing, making it more dynamic, interactive, and, importantly, stateful.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;defining-the-future-of-serverless-compute-around-state\&quot;&gt;Defining the future of serverless compute around state&lt;/h3&gt;\n            &lt;a href=\&quot;#defining-the-future-of-serverless-compute-around-state\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Building real-time applications on the web have always been difficult. Not only is it a distributed systems problem, but you need to provision and manage infrastructure, databases, and other services to maintain state across multiple clients. This complexity has traditionally been a barrier to entry for many developers, especially those who are just starting out.&lt;/p&gt;&lt;p&gt;&lt;a href=\&quot;/introducing-workers-durable-objects\&quot;&gt;We announced Durable Objects in 2020&lt;/a&gt; as a way of building synchronized real time experiences for the web. Unlike regular serverless functions that are ephemeral and stateless, Durable Objects are stateful, allowing developers to build applications that maintain state across requests. They also act as an ideal synchronization point for building real-time applications that need to maintain state across multiple clients. Combined with WebSockets, Durable Objects can be used to build a wide range of applications, from multiplayer games to collaborative drawing tools.&lt;/p&gt;&lt;p&gt;In 2022, PartyKit began as a project to further explore the capabilities of Durable Objects and make them more accessible to developers by exposing them through familiar components. In seconds, you could create a project that configured behavior for these objects, and deploy it to Cloudflare. By integrating with popular libraries such as &lt;a href=\&quot;https://github.com/yjs/yjs\&quot;&gt;Yjs&lt;/a&gt; (the gold standard in collaborative editing) and React, PartyKit made it possible for developers to build a wide range of use cases, from multiplayer games to collaborative drawing tools, into their applications.&lt;/p&gt;&lt;p&gt;Building experiences with real-time components was previously only accessible to multi-billion dollar companies, but new computing primitives like Durable Objects on the edge make this accessible to regular developers and teams. With PartyKit now under our roof, we&amp;#39;re doubling down on our commitment to this future — a future where serverless is stateful.&lt;/p&gt;&lt;p&gt;We’re excited to give you a preview into our shared vision for applications, and the use cases we’re excited to simplify together.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;making-state-for-serverless-easy\&quot;&gt;Making state for serverless easy&lt;/h3&gt;\n            &lt;a href=\&quot;#making-state-for-serverless-easy\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Unlike conventional approaches that rely on external databases to maintain state, thereby complicating scalability and increasing costs, PartyKit leverages Cloudflare&amp;#39;s Durable Objects to offer a seamless model where stateful serverless functions can operate as if they were running on a single machine, maintaining state across requests. This innovation not only simplifies development but also opens up a broader range of use cases, including real-time computing, collaborative editing, and multiplayer gaming, by allowing thousands of these &amp;quot;machines&amp;quot; to be spun up globally, each maintaining its own state. PartyKit aims to be a complement to traditional serverless computing, providing a more intuitive and efficient method for developing applications that require stateful behavior, thereby marking the &amp;quot;next evolution&amp;quot; of serverless computing.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;simplifying-websockets-for-real-time-interaction\&quot;&gt;Simplifying WebSockets for Real-Time Interaction&lt;/h3&gt;\n            &lt;a href=\&quot;#simplifying-websockets-for-real-time-interaction\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;WebSockets have revolutionized how we think about bidirectional communication on the web. Yet, the challenge has always been about scaling these interactions to millions without a hitch. Cloudflare Workers step in as the hero, providing a serverless framework that makes real-time applications like chat services, multiplayer games, and collaborative tools not just possible but scalable and efficient.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;powering-games-and-multiplayer-applications-without-limits\&quot;&gt;Powering Games and Multiplayer Applications Without Limits&lt;/h3&gt;\n            &lt;a href=\&quot;#powering-games-and-multiplayer-applications-without-limits\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Imagine building multiplayer platforms where the game never lags, the collaboration is seamless, and video conferences are crystal clear. Cloudflare&amp;#39;s Durable Objects morph the stateless serverless landscape into a realm where persistent connections thrive. PartyKit&amp;#39;s integration into this ecosystem means developers now have a powerhouse toolkit to bring ambitious multiplayer visions to life, without the traditional overheads.&lt;/p&gt;&lt;p&gt;This is especially critical in gaming — there are few areas where low-latency and real-time interaction matter more. Every millisecond, every lag, every delay defines the entire experience. With PartyKit&amp;#39;s capabilities integrated into Cloudflare, developers will be able to leverage our combined technologies to create gaming experiences that are not just about playing but living the game, thanks to scalable, immersive, and interactive platforms.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;the-toolkit-for-building-local-first-applications\&quot;&gt;The toolkit for building Local-First applications&lt;/h3&gt;\n            &lt;a href=\&quot;#the-toolkit-for-building-local-first-applications\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;The Internet is great, and increasingly always available, but there are still a few situations where we are forced to disconnect — whether on a plane, a train, or a beach.&lt;/p&gt;&lt;p&gt;The premise of local-first applications is that work doesn&amp;#39;t stop when the Internet does. Wherever you left off in your doc, you can keep working on it, assuming the state will be restored when you come back online. By storing data on the client and syncing when back online, these applications offer resilience and responsiveness that&amp;#39;s unmatched. Cloudflare&amp;#39;s vision, enhanced by PartyKit&amp;#39;s technology, aims to make local-first not just an option but the standard for application development.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;whats-next-for-partykit-users\&quot;&gt;What&amp;#39;s next for PartyKit users?&lt;/h3&gt;\n            &lt;a href=\&quot;#whats-next-for-partykit-users\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Users can expect their existing projects to continue working as expected. We will be adding more features to the platform, including the ability to create and use PartyKit projects inside existing Workers and Pages projects. There will be no extra charges to use PartyKit for commercial purposes, other than the standard usage charges for Cloudflare Workers and other services. Further, we&amp;#39;re going to expand the roadmap to begin working on integrations with popular frameworks and libraries, such as React, Vue, and Angular. We&amp;#39;re deeply committed to executing on the PartyKit vision and roadmap, and we&amp;#39;re excited to see what you build with it.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;the-beginning-of-a-new-chapter\&quot;&gt;The Beginning of a New Chapter&lt;/h3&gt;\n            &lt;a href=\&quot;#the-beginning-of-a-new-chapter\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;The acquisition of PartyKit by Cloudflare isn&amp;#39;t just a milestone for our two teams; it&amp;#39;s a leap forward for developers everywhere. Together, we&amp;#39;re not just building tools; we&amp;#39;re crafting the foundation for the next generation of Internet applications. The future of serverless is stateful, and with PartyKit&amp;#39;s expertise now part of our arsenal, we&amp;#39;re more ready than ever to make that future a reality.&lt;/p&gt;&lt;p&gt;Welcome to the Cloudflare team, PartyKit. Look forward to building something remarkable together.&lt;/p&gt;&quot;],&quot;published_at&quot;:[0,&quot;2024-04-05T14:00:56.000+01:00&quot;],&quot;updated_at&quot;:[0,&quot;2024-10-30T09:13:07.563Z&quot;],&quot;feature_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/3nSyJQb948NaUSlcwzcp98/04dc3e678d3b47c89ea5329c601a19b2/cloudflare-acquires-partykit.png&quot;],&quot;tags&quot;:[1,[[0,{&quot;id&quot;:[0,&quot;2xCnBweKwOI3VXdYsGVbMe&quot;],&quot;name&quot;:[0,&quot;Developer Week&quot;],&quot;slug&quot;:[0,&quot;developer-week&quot;]}],[0,{&quot;id&quot;:[0,&quot;013htAspXBEMdE76Afcyq2&quot;],&quot;name&quot;:[0,&quot;Acquisitions&quot;],&quot;slug&quot;:[0,&quot;acquisitions&quot;]}],[0,{&quot;id&quot;:[0,&quot;6hbkItfupogJP3aRDAq6v8&quot;],&quot;name&quot;:[0,&quot;Cloudflare Workers&quot;],&quot;slug&quot;:[0,&quot;workers&quot;]}],[0,{&quot;id&quot;:[0,&quot;6Foe3R8of95cWVnQwe5Toi&quot;],&quot;name&quot;:[0,&quot;AI&quot;],&quot;slug&quot;:[0,&quot;ai&quot;]}],[0,{&quot;id&quot;:[0,&quot;5v2UZdTRX1Rw9akmhexnxs&quot;],&quot;name&quot;:[0,&quot;Durable Objects&quot;],&quot;slug&quot;:[0,&quot;durable-objects&quot;]}]]],&quot;relatedTags&quot;:[0],&quot;authors&quot;:[1,[[0,{&quot;name&quot;:[0,&quot;Sunil Pai&quot;],&quot;slug&quot;:[0,&quot;sunil&quot;],&quot;bio&quot;:[0,&quot;JavaScript and Les Pauls.  Worked at Cloudflare once, left and created PartyKit, came back wiser.&quot;],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/2xnINigwFaBtTwOffppE85/596c43dfef6205e9c5b71c2caff4bea9/Sunil_Pai.png&quot;],&quot;location&quot;:[0,&quot;London&quot;],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,&quot;@threepointone&quot;],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}],[0,{&quot;name&quot;:[0,&quot;Rita Kozlov&quot;],&quot;slug&quot;:[0,&quot;rita&quot;],&quot;bio&quot;:[0,null],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/56u5zfWi9255rUocOgksl0/5eb2eb16e26893d259f7b00af85e8417/rita.png&quot;],&quot;location&quot;:[0,null],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,&quot;@ritakozlov_&quot;],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}]]],&quot;meta_description&quot;:[0,&quot;We&#39;re thrilled to announce that PartyKit, a trailblazer in enabling developers to craft ambitious real-time, collaborative, multiplayer applications, is now a part of Cloudflare. This acquisition marks a significant milestone in our journey to redefine the boundaries of serverless computing, making it more dynamic, interactive, and, importantly, stateful.&quot;],&quot;primary_author&quot;:[0,{}],&quot;localeList&quot;:[0,{&quot;name&quot;:[0,&quot;Cloudflare acquires PartyKit to allow developers to build real-time multi-user applications Config LOC&quot;],&quot;enUS&quot;:[0,&quot;English for Locale&quot;],&quot;zhCN&quot;:[0,&quot;Translated for Locale&quot;],&quot;zhHansCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhTW&quot;:[0,&quot;Translated for Locale&quot;],&quot;frFR&quot;:[0,&quot;No Page for Locale&quot;],&quot;deDE&quot;:[0,&quot;No Page for Locale&quot;],&quot;itIT&quot;:[0,&quot;No Page for Locale&quot;],&quot;jaJP&quot;:[0,&quot;Translated for Locale&quot;],&quot;koKR&quot;:[0,&quot;Translated for Locale&quot;],&quot;ptBR&quot;:[0,&quot;Translated for Locale&quot;],&quot;esLA&quot;:[0,&quot;No Page for Locale&quot;],&quot;esES&quot;:[0,&quot;Translated for Locale&quot;],&quot;enAU&quot;:[0,&quot;No Page for Locale&quot;],&quot;enCA&quot;:[0,&quot;No Page for Locale&quot;],&quot;enIN&quot;:[0,&quot;No Page for Locale&quot;],&quot;enGB&quot;:[0,&quot;No Page for Locale&quot;],&quot;idID&quot;:[0,&quot;No Page for Locale&quot;],&quot;ruRU&quot;:[0,&quot;Translated for Locale&quot;],&quot;svSE&quot;:[0,&quot;No Page for Locale&quot;],&quot;viVN&quot;:[0,&quot;No Page for Locale&quot;],&quot;plPL&quot;:[0,&quot;No Page for Locale&quot;],&quot;arAR&quot;:[0,&quot;No Page for Locale&quot;],&quot;nlNL&quot;:[0,&quot;No Page for Locale&quot;],&quot;thTH&quot;:[0,&quot;No Page for Locale&quot;],&quot;trTR&quot;:[0,&quot;No Page for Locale&quot;],&quot;heIL&quot;:[0,&quot;No Page for Locale&quot;],&quot;lvLV&quot;:[0,&quot;No Page for Locale&quot;],&quot;etEE&quot;:[0,&quot;No Page for Locale&quot;],&quot;ltLT&quot;:[0,&quot;No Page for Locale&quot;]}],&quot;url&quot;:[0,&quot;https://blog.cloudflare.com/cloudflare-acquires-partykit&quot;],&quot;metadata&quot;:[0,{&quot;title&quot;:[0,&quot;Cloudflare acquires PartyKit to allow developers to build real-time multi-user applications&quot;],&quot;description&quot;:[0,&quot;We&#39;re thrilled to announce that PartyKit, a trailblazer in enabling developers to craft ambitious real-time, collaborative, multiplayer applications, is now a part of Cloudflare. This acquisition marks a significant milestone in our journey to redefine the boundaries of serverless computing, making it more dynamic, interactive, and, importantly, stateful.&quot;],&quot;imgPreview&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/4l0n9ppJGFiPxppX6v4Cyp/711d7245ef4b0a20a3b1ce06c2a29176/cloudflare-acquires-partykit-jk7MUA.png&quot;]}],&quot;publicly_index&quot;:[0,true]}],[0,{&quot;id&quot;:[0,&quot;341i4XnnUcmAjy5VZm855W&quot;],&quot;title&quot;:[0,&quot;Running Serverless Puppeteer with Workers and Durable Objects&quot;],&quot;slug&quot;:[0,&quot;running-serverless-puppeteer-workers-durable-objects&quot;],&quot;excerpt&quot;:[0,&quot;We’ve heard from developers that configuring and maintaining their own serverless browser automation systems can be quite painful. The Workers Browser Rendering API solves this&quot;],&quot;featured&quot;:[0,false],&quot;html&quot;:[0,&quot;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/6q1qWS257ltTlrgJ2rOFcf/baaa779be33983d718fa574c7794adf9/Running-Serverless-Puppeteer-with-Workers-and-Durable-Objects.png\&quot; alt=\&quot;Running Serverless Puppeteer with Workers and Durable Objects\&quot; class=\&quot;kg-image\&quot; width=\&quot;1600\&quot; height=\&quot;900\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;Last year, we &lt;a href=\&quot;/introducing-workers-browser-rendering-api/\&quot;&gt;announced the Browser Rendering API&lt;/a&gt; – letting users running Puppeteer, a browser automation library, directly in Workers. Puppeteer is one of the most popular libraries used to interact with a headless browser instance to accomplish tasks like taking screenshots, generating PDFs, crawling web pages, and testing &lt;a href=\&quot;https://www.cloudflare.com/learning/security/what-is-web-application-security/\&quot;&gt;web applications&lt;/a&gt;. We’ve heard from developers that configuring and maintaining their own serverless browser automation systems can be quite painful.&lt;/p&gt;&lt;p&gt;The &lt;a href=\&quot;https://developers.cloudflare.com/browser-rendering/\&quot;&gt;Workers Browser Rendering API&lt;/a&gt; solves this. It makes the Puppeteer library available directly in your Worker, connected to a real web browser, without the need to configure and manage infrastructure or keep browser sessions warm yourself. You can use &lt;a href=\&quot;https://www.npmjs.com/package/@cloudflare/puppeteer\&quot;&gt;@cloudflare/puppeteer&lt;/a&gt; to run the full Puppeteer API directly on Workers!&lt;/p&gt;&lt;p&gt;We’ve seen so much interest from the developer community since launching last year. While the Browser Rendering API is still in beta (sign up to our &lt;a href=\&quot;https://www.cloudflare.com/lp/workers-browser-rendering-api/?ref=blog.cloudflare.com&amp;cf_target_id=99BC25CE5278572504B986049859D8A2\&quot;&gt;waitlist&lt;/a&gt; to get access), we wanted to share a way to get more out of our &lt;a href=\&quot;https://developers.cloudflare.com/browser-rendering/platform/limits/\&quot;&gt;current limits&lt;/a&gt; by using the Browser Rendering API with &lt;a href=\&quot;https://developers.cloudflare.com/durable-objects/\&quot;&gt;Durable Objects&lt;/a&gt;. We’ll also be sharing pricing for the Rendering API, so you can build knowing exactly what you’ll pay for.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;building-a-responsive-web-design-testing-tool-with-the-browser-rendering-api\&quot;&gt;Building a responsive web design testing tool with the Browser Rendering API&lt;/h3&gt;\n            &lt;a href=\&quot;#building-a-responsive-web-design-testing-tool-with-the-browser-rendering-api\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;As a designer or frontend developer, you want to make sure that content is well-designed for visitors browsing on different screen sizes. With the number of possible devices that users are browsing on are growing, it becomes difficult to test all the possibilities manually. While there are many testing tools on the market, we want to show how easy it is to create your own Chromium based tool with the Workers Browser Rendering API and Durable Objects.&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/OQNeORd8VW4RffHGH8ndq/b94872dfb08664a524eae20227785acf/pasted-image-0--6--2.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;852\&quot; height=\&quot;236\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;We’ll be using the Worker to handle any incoming requests, pass them to the Durable Object to take screenshots and store them in an R2 bucket. The Durable Object is used to create a browser session that’s persistent. By using &lt;a href=\&quot;https://developers.cloudflare.com/durable-objects/api/alarms-in-durable-objects/\&quot;&gt;Durable Object Alarms&lt;/a&gt; we can keep browsers open for longer and reuse browser sessions across requests.&lt;/p&gt;&lt;p&gt;Let’s dive into how we can build this application:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;&lt;p&gt;Create a Worker with a Durable Object, Browser Rendering API binding and R2 bucket. This is the resulting wrangler.toml:&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;\n            &lt;pre class=\&quot;language-bash\&quot;&gt;&lt;code class=\&quot;language-bash\&quot;&gt;name = &amp;quot;rendering-api-demo&amp;quot;\nmain = &amp;quot;src/index.js&amp;quot;\ncompatibility_date = &amp;quot;2023-09-04&amp;quot;\ncompatibility_flags = [ &amp;quot;nodejs_compat&amp;quot;]\naccount_id = &amp;quot;c05e6a39aa4ccdd53ad17032f8a4dc10&amp;quot;\n\n\n# Browser Rendering API binding\nbrowser = { binding = &amp;quot;MYBROWSER&amp;quot; }\n\n# Bind an R2 Bucket\n[[r2_buckets]]\nbinding = &amp;quot;BUCKET&amp;quot;\nbucket_name = &amp;quot;screenshots&amp;quot;\n\n# Binding to a Durable Object\n[[durable_objects.bindings]]\nname = &amp;quot;BROWSER&amp;quot;\nclass_name = &amp;quot;Browser&amp;quot;\n\n[[migrations]]\ntag = &amp;quot;v1&amp;quot; # Should be unique for each entry\nnew_classes = [&amp;quot;Browser&amp;quot;] # Array of new classes&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;2. Define the Worker&lt;/p&gt;&lt;p&gt;This Worker simply passes the request onto the Durable Object.&lt;/p&gt;\n            &lt;pre class=\&quot;language-javascript\&quot;&gt;&lt;code class=\&quot;language-javascript\&quot;&gt;export default {\n\tasync fetch(request, env) {\n\n\t\tlet id = env.BROWSER.idFromName(&amp;quot;browser&amp;quot;);\n\t\tlet obj = env.BROWSER.get(id);\n\t  \n\t\t// Send a request to the Durable Object, then await its response.\n\t\tlet resp = await obj.fetch(request.url);\n\t\tlet count = await resp.text();\n\t  \n\t\treturn new Response(&amp;quot;success&amp;quot;);\n\t}\n};&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;3. Define the Durable Object class&lt;/p&gt;\n            &lt;pre class=\&quot;language-js\&quot;&gt;&lt;code class=\&quot;language-js\&quot;&gt;const KEEP_BROWSER_ALIVE_IN_SECONDS = 60;\n\nexport class Browser {\n\tconstructor(state, env) {\n\t\tthis.state = state;\n\t\tthis.env = env;\n\t\tthis.keptAliveInSeconds = 0;\n\t\tthis.storage = this.state.storage;\n\t}\n  \n\tasync fetch(request) {\n\t\t// screen resolutions to test out\n\t\tconst width = [1920, 1366, 1536, 360, 414]\n\t\tconst height = [1080, 768, 864, 640, 896]\n\n\t\t// use the current date and time to create a folder structure for R2\n\t\tconst nowDate = new Date()\n\t\tvar coeff = 1000 * 60 * 5\n\t\tvar roundedDate = (new Date(Math.round(nowDate.getTime() / coeff) * coeff)).toString();\n\t\tvar folder = roundedDate.split(&amp;quot; GMT&amp;quot;)[0]\n\n\t\t//if there&amp;#039;s a browser session open, re-use it\n\t\tif (!this.browser) {\n\t\t\tconsole.log(`Browser DO: Starting new instance`);\n\t\t\ttry {\n\t\t\t  this.browser = await puppeteer.launch(this.env.MYBROWSER);\n\t\t\t} catch (e) {\n\t\t\t  console.log(`Browser DO: Could not start browser instance. Error: ${e}`);\n\t\t\t}\n\t\t  }\n\t\t\n\t\t// Reset keptAlive after each call to the DO\n\t\tthis.keptAliveInSeconds = 0;\n\t\t\n\t\tconst page = await this.browser.newPage();\n\n\t\t// take screenshots of each screen size \n\t\tfor (let i = 0; i &amp;lt; width.length; i++) {\n\t\t\tawait page.setViewport({ width: width[i], height: height[i] });\n\t\t\tawait page.goto(&amp;quot;https://workers.cloudflare.com/&amp;quot;);\n\t\t\tconst fileName = &amp;quot;screenshot_&amp;quot; + width[i] + &amp;quot;x&amp;quot; + height[i]\n\t\t\tconst sc = await page.screenshot({\n\t\t\t\tpath: fileName + &amp;quot;.jpg&amp;quot;\n\t\t\t}\n\t\t\t);\n\n\t\t\tthis.env.BUCKET.put(folder + &amp;quot;/&amp;quot;+ fileName + &amp;quot;.jpg&amp;quot;, sc);\n\t\t  }\n\t\t\n\t\t// Reset keptAlive after performing tasks to the DO.\n\t\tthis.keptAliveInSeconds = 0;\n\n\t\t// set the first alarm to keep DO alive\n\t\tlet currentAlarm = await this.storage.getAlarm();\n\t\tif (currentAlarm == null) {\n\t\tconsole.log(`Browser DO: setting alarm`);\n\t\tconst TEN_SECONDS = 10 * 1000;\n\t\tthis.storage.setAlarm(Date.now() + TEN_SECONDS);\n\t\t}\n\t\t\n\t\tawait this.browser.close();\n\t\treturn new Response(&amp;quot;success&amp;quot;);\n\t}\n\n\tasync alarm() {\n\t\tthis.keptAliveInSeconds += 10;\n\t\n\t\t// Extend browser DO life\n\t\tif (this.keptAliveInSeconds &amp;lt; KEEP_BROWSER_ALIVE_IN_SECONDS) {\n\t\t  console.log(`Browser DO: has been kept alive for ${this.keptAliveInSeconds} seconds. Extending lifespan.`);\n\t\t  this.storage.setAlarm(Date.now() + 10 * 1000);\n\t\t} else console.log(`Browser DO: cxceeded life of ${KEEP_BROWSER_ALIVE_IN_SECONDS}. Browser DO will be shut down in 10 seconds.`);\n\t  }\n\n  }&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;That’s it! With less than a hundred lines of code, you can fully customize a powerful tool to automate responsive web design testing. You can even incorporate it into your CI pipeline to automatically test different window sizes with each build and verify the result is as expected by using an automated library like &lt;a href=\&quot;https://www.npmjs.com/package/pixelmatch\&quot;&gt;pixelmatch&lt;/a&gt;.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;how-much-will-this-cost\&quot;&gt;How much will this cost?&lt;/h3&gt;\n            &lt;a href=\&quot;#how-much-will-this-cost\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;We’ve spoken to many customers deploying a Puppeteer service on their own infrastructure, on &lt;a href=\&quot;https://www.cloudflare.com/learning/cloud/what-is-a-public-cloud/\&quot;&gt;public cloud containers&lt;/a&gt; or &lt;a href=\&quot;https://www.cloudflare.com/learning/serverless/glossary/function-as-a-service-faas/\&quot;&gt;functions&lt;/a&gt; or using managed services. The common theme that we’ve heard is that these services are costly – costly to maintain and expensive to run.&lt;/p&gt;&lt;p&gt;While you won’t be billed for the Browser Rendering API yet, we want to be transparent with you about costs you start building. We know it’s important to understand the pricing structure so that you don’t get a surprise bill and so that you can design your application efficiently.&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/6gFIbTnuDafnmpIH2FpQUX/94ce188a354578aae872971f974fd4b4/pasted-image-0--7--2.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1316\&quot; height=\&quot;468\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;You pay based on two usage metrics:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;&lt;p&gt;Number of sessions: A Browser Session is a new instance of a browser being launched&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Number of concurrent sessions: Concurrent Sessions is the number of browser instances open at once&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;Using Durable Objects to persist browser sessions improves performance by eliminating the time that it takes to spin up a new browser session. Since it re-uses sessions, it cuts down on the number of concurrent sessions needed. We highly encourage this model of session re-use if you expect to see consistent traffic for applications that you build on the Browser Rendering API.&lt;/p&gt;&lt;p&gt;If you have feedback about this pricing, we’re all ears. Feel free to reach out through &lt;a href=\&quot;https://discord.gg/8Gs9T6jN\&quot;&gt;Discord&lt;/a&gt; (channel name: browser-rendering-api-beta) and share your thoughts.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;get-started\&quot;&gt;Get Started&lt;/h3&gt;\n            &lt;a href=\&quot;#get-started\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Sign up to our &lt;a href=\&quot;https://www.cloudflare.com/lp/workers-browser-rendering-api/?ref=blog.cloudflare.com&amp;cf_target_id=99BC25CE5278572504B986049859D8A2\&quot;&gt;waitlist&lt;/a&gt; to get access to the Workers Browser Rendering API. We’re so excited to see what you build! Share your creations with us on Twitter/X &lt;a href=\&quot;https://www.twitter.com/cloudflaredev\&quot;&gt;@CloudflareDev&lt;/a&gt; or on our Discord community.&lt;/p&gt;&quot;],&quot;published_at&quot;:[0,&quot;2023-09-28T14:00:38.000+01:00&quot;],&quot;updated_at&quot;:[0,&quot;2024-10-09T23:25:53.960Z&quot;],&quot;feature_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/3OJFuPzbh7O6f2CFrQTfOl/eafe854b1a8cffa1e1233fe25fc85e60/running-serverless-puppeteer-workers-durable-objects.png&quot;],&quot;tags&quot;:[1,[[0,{&quot;id&quot;:[0,&quot;1Cv5JjXzKWKEA10JdYbXu1&quot;],&quot;name&quot;:[0,&quot;Birthday Week&quot;],&quot;slug&quot;:[0,&quot;birthday-week&quot;]}],[0,{&quot;id&quot;:[0,&quot;6QktrXeEFcl4e2dZUTZVGl&quot;],&quot;name&quot;:[0,&quot;Product News&quot;],&quot;slug&quot;:[0,&quot;product-news&quot;]}],[0,{&quot;id&quot;:[0,&quot;5v2UZdTRX1Rw9akmhexnxs&quot;],&quot;name&quot;:[0,&quot;Durable Objects&quot;],&quot;slug&quot;:[0,&quot;durable-objects&quot;]}],[0,{&quot;id&quot;:[0,&quot;78aSAeMjGNmCuetQ7B4OgU&quot;],&quot;name&quot;:[0,&quot;JavaScript&quot;],&quot;slug&quot;:[0,&quot;javascript&quot;]}],[0,{&quot;id&quot;:[0,&quot;4HIPcb68qM0e26fIxyfzwQ&quot;],&quot;name&quot;:[0,&quot;Developers&quot;],&quot;slug&quot;:[0,&quot;developers&quot;]}]]],&quot;relatedTags&quot;:[0],&quot;authors&quot;:[1,[[0,{&quot;name&quot;:[0,&quot;Tanushree Sharma&quot;],&quot;slug&quot;:[0,&quot;tanushree&quot;],&quot;bio&quot;:[0,&quot;Product Manager, Cloudflare Workers&quot;],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/77c5gQJtSO9WoLGws7OZef/e429d24838ca9eaa433be9015e69d938/tanushree.jpg&quot;],&quot;location&quot;:[0,&quot;Austin&quot;],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,&quot;@_tanushreeeee&quot;],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}]]],&quot;meta_description&quot;:[0,&quot;We’ve heard from developers that configuring and maintaining their own serverless browser automation systems can be quite painful. The Workers Browser Rendering API solves this&quot;],&quot;primary_author&quot;:[0,{}],&quot;localeList&quot;:[0,{&quot;name&quot;:[0,&quot;Running Serverless Puppeteer with Workers and Durable Objects Config&quot;],&quot;enUS&quot;:[0,&quot;English for Locale&quot;],&quot;zhCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhHansCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhTW&quot;:[0,&quot;No Page for Locale&quot;],&quot;frFR&quot;:[0,&quot;No Page for Locale&quot;],&quot;deDE&quot;:[0,&quot;No Page for Locale&quot;],&quot;itIT&quot;:[0,&quot;No Page for Locale&quot;],&quot;jaJP&quot;:[0,&quot;No Page for Locale&quot;],&quot;koKR&quot;:[0,&quot;No Page for Locale&quot;],&quot;ptBR&quot;:[0,&quot;No Page for Locale&quot;],&quot;esLA&quot;:[0,&quot;No Page for Locale&quot;],&quot;esES&quot;:[0,&quot;No Page for Locale&quot;],&quot;enAU&quot;:[0,&quot;No Page for Locale&quot;],&quot;enCA&quot;:[0,&quot;No Page for Locale&quot;],&quot;enIN&quot;:[0,&quot;No Page for Locale&quot;],&quot;enGB&quot;:[0,&quot;No Page for Locale&quot;],&quot;idID&quot;:[0,&quot;No Page for Locale&quot;],&quot;ruRU&quot;:[0,&quot;No Page for Locale&quot;],&quot;svSE&quot;:[0,&quot;No Page for Locale&quot;],&quot;viVN&quot;:[0,&quot;No Page for Locale&quot;],&quot;plPL&quot;:[0,&quot;No Page for Locale&quot;],&quot;arAR&quot;:[0,&quot;No Page for Locale&quot;],&quot;nlNL&quot;:[0,&quot;No Page for Locale&quot;],&quot;thTH&quot;:[0,&quot;No Page for Locale&quot;],&quot;trTR&quot;:[0,&quot;No Page for Locale&quot;],&quot;heIL&quot;:[0,&quot;No Page for Locale&quot;],&quot;lvLV&quot;:[0,&quot;No Page for Locale&quot;],&quot;etEE&quot;:[0,&quot;No Page for Locale&quot;],&quot;ltLT&quot;:[0,&quot;No Page for Locale&quot;]}],&quot;url&quot;:[0,&quot;https://blog.cloudflare.com/running-serverless-puppeteer-workers-durable-objects&quot;],&quot;metadata&quot;:[0,{&quot;title&quot;:[0,&quot;Running Serverless Puppeteer with Workers and Durable Objects&quot;],&quot;description&quot;:[0,&quot;We’ve heard from developers that configuring and maintaining their own serverless browser automation systems can be quite painful. The Workers Browser Rendering API solves this&quot;],&quot;imgPreview&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/2su2HyYQz8VT1AMWQg5RRs/e7186be164276f500d0e9b875bf4106d/running-serverless-puppeteer-workers-durable-objects-dKLqRb.png&quot;]}],&quot;publicly_index&quot;:[0,true]}],[0,{&quot;id&quot;:[0,&quot;378OAooWIn9X080mpldET2&quot;],&quot;title&quot;:[0,&quot;How Waiting Room makes queueing decisions on Cloudflare&#39;s highly distributed network&quot;],&quot;slug&quot;:[0,&quot;how-waiting-room-queues&quot;],&quot;excerpt&quot;:[0,&quot;We want to give you a behind the scenes look at how we have evolved the core mechanism of our product–namely, exactly how it kicks in to queue traffic in response to spikes&quot;],&quot;featured&quot;:[0,false],&quot;html&quot;:[0,&quot;&lt;p&gt;&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/308ogSo9qOQp2ng3ve7spq/163e8201c4d426710ef2211237699c08/image3-7.png\&quot; alt=\&quot;How Waiting Room makes queueing decisions on Cloudflare&#39;s highly distributed network\&quot; class=\&quot;kg-image\&quot; width=\&quot;1999\&quot; height=\&quot;1125\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;Almost three years ago, we &lt;a href=\&quot;/cloudflare-waiting-room/\&quot;&gt;launched Cloudflare Waiting Room&lt;/a&gt; to protect our customers’ sites from overwhelming spikes in legitimate traffic that could bring down their sites. Waiting Room gives customers control over user experience even in times of high traffic by placing excess traffic in a customizable, on-brand waiting room, dynamically admitting users as spots become available on their sites. Since the launch of Waiting Room, we’ve continued to expand its functionality based on customer feedback with features like &lt;a href=\&quot;/waiting-room-random-queueing-and-custom-web-mobile-apps/\&quot;&gt;mobile app support&lt;/a&gt;, &lt;a href=\&quot;/understand-the-impact-of-your-waiting-rooms-settings-with-waiting-room-analytics/\&quot;&gt;analytics&lt;/a&gt;, &lt;a href=\&quot;/waiting-room-bypass-rules/\&quot;&gt;Waiting Room bypass rules&lt;/a&gt;, and &lt;a href=\&quot;/tag/waiting-room/\&quot;&gt;more&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;We love announcing new features and solving problems for our customers by expanding the capabilities of Waiting Room. But, today, we want to give you a behind the scenes look at how we have evolved the core mechanism of our product–namely, exactly how it kicks in to queue traffic in response to spikes.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;how-was-the-waiting-room-built-and-what-are-the-challenges\&quot;&gt;How was the Waiting Room built, and what are the challenges?&lt;/h2&gt;\n            &lt;a href=\&quot;#how-was-the-waiting-room-built-and-what-are-the-challenges\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;The diagram below shows a quick overview of where the Waiting room sits when a customer enables it for their website.&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card kg-width-wide\&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/e3jZQvH7ed5YAFbSYk5km/8866b3fe3f89ed1ac3f0b536d30b9d30/Waiting-Room-overview.png\&quot; alt=\&quot;Waiting Room overview\&quot; class=\&quot;kg-image\&quot; width=\&quot;1600\&quot; height=\&quot;1127\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;Waiting Room is built on &lt;a href=\&quot;https://workers.cloudflare.com/\&quot;&gt;Workers&lt;/a&gt; that runs across a global network of Cloudflare data centers. The requests to a customer’s website can go to many different Cloudflare data centers. To optimize for minimal &lt;a href=\&quot;https://www.cloudflare.com/learning/performance/glossary/what-is-latency/\&quot;&gt;latency&lt;/a&gt; and enhanced performance, these requests are routed to the data center with the most geographical proximity. When a new user makes a request to the host/path covered by the Waiting room, the waiting room worker decides whether to send the user to the origin or the waiting room. This decision is made by making use of the waiting room state which gives an idea of how many users are on the origin.&lt;/p&gt;&lt;p&gt;The waiting room state changes continuously based on the traffic around the world. This information can be stored in a central location or changes can get propagated around the world eventually. Storing this information in a central location can add significant latency to each request as the central location can be really far from where the request is originating from. So every data center works with its own waiting room state which is a snapshot of the traffic pattern for the website around the world available at that point in time. Before letting a user into the website, we do not want to wait for information from everywhere else in the world as that adds significant latency to the request. This is the reason why we chose not to have a central location but have a pipeline where changes in traffic get propagated eventually around the world.&lt;/p&gt;&lt;p&gt;This pipeline which aggregates the waiting room state in the background is built on Cloudflare &lt;a href=\&quot;/introducing-workers-durable-objects/\&quot;&gt;Durable Objects&lt;/a&gt;. In 2021, we wrote a blog talking about &lt;a href=\&quot;/building-waiting-room-on-workers-and-durable-objects/\&quot;&gt;how the aggregation pipeline works&lt;/a&gt; and the different design decisions we took there if you are interested. This pipeline ensures that every data center gets updated information about changes in traffic within a few seconds.&lt;/p&gt;&lt;p&gt;The Waiting room has to make a decision whether to send users to the website or queue them based on the state that it currently sees. This has to be done while making sure we queue at the right time so that the customer&amp;#39;s website does not get overloaded. We also have to make sure we do not queue too early as we might be queueing for a falsely suspected spike in traffic. Being in a queue could cause some users to abandon going to the website. Waiting Room runs on every server in &lt;a href=\&quot;https://www.cloudflare.com/network/\&quot;&gt;Cloudflare’s network&lt;/a&gt;, which spans over 300 cities in more than 100 countries. We want to make sure, for every new user, the decision whether to go to the website or the queue is made with minimal latency. This is what makes the decision of when to queue a hard question for the waiting room. In this blog, we will cover how we approached that tradeoff. Our algorithm has evolved to decrease the false positives while continuing to respect the customer’s set limits.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;how-a-waiting-room-decides-when-to-queue-users\&quot;&gt;How a waiting room decides when to queue users&lt;/h2&gt;\n            &lt;a href=\&quot;#how-a-waiting-room-decides-when-to-queue-users\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;The most important factor that determines when your waiting room will start queuing is how you configured the traffic settings. There are two traffic limits that you will set when configuring a waiting room–&lt;i&gt;total active users&lt;/i&gt; and &lt;i&gt;new users per minute&lt;/i&gt;.The &lt;i&gt;total active users&lt;/i&gt; is a target threshold for how many simultaneous users you want to allow on the pages covered by your waiting room. &lt;i&gt;New users per minute&lt;/i&gt; defines the target threshold for the maximum rate of user influx to your website per minute. A sharp spike in either of these values might result in queuing. Another configuration that affects how we calculate the &lt;i&gt;total active users&lt;/i&gt; is &lt;i&gt;session duration.&lt;/i&gt; A user is considered active for &lt;i&gt;session duration&lt;/i&gt; minutes since the request is made to any page covered by a waiting room.&lt;/p&gt;&lt;p&gt;The graph below is from one of our internal monitoring tools for a customer and shows a customer&amp;#39;s traffic pattern for 2 days. This customer has set their limits, &lt;i&gt;new users per minute&lt;/i&gt; and &lt;i&gt;total active users&lt;/i&gt; to 200 and 200 respectively.&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card kg-width-wide\&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1ldSHbmG07jQ9qRikiy9Yh/500ddc98a204322415592acdddefb91d/Screen-Shot-2023-09-11-at-10.30.21-AM.png\&quot; alt=\&quot;Customer traffic for 2 days between September 9th to 11th with 2 spikes in traffic\&quot; class=\&quot;kg-image\&quot; width=\&quot;1600\&quot; height=\&quot;927\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;If you look at their traffic you can see that users were queued on September 11th around 11:45. At that point in time, the &lt;i&gt;total active users&lt;/i&gt; was around 200. As the &lt;i&gt;total active users&lt;/i&gt; ramped down (around 12:30)&lt;i&gt;,&lt;/i&gt; the queued users progressed to 0. The queueing started again on September 11th around 15:00 when total active users got to 200. The users that were queued around this time ensured that the traffic going to the website is around the limits set by the customer.&lt;/p&gt;&lt;p&gt;Once a user gets access to the website, we give them an encrypted &lt;a href=\&quot;https://www.cloudflare.com/learning/privacy/what-are-cookies/\&quot;&gt;cookie&lt;/a&gt; which indicates they have already gained access. The contents of the cookie can look like this.&lt;/p&gt;\n            &lt;pre class=\&quot;language-bash\&quot;&gt;&lt;code class=\&quot;language-bash\&quot;&gt;{  \n  &amp;quot;bucketId&amp;quot;: &amp;quot;Mon, 11 Sep 2023 11:45:00 GMT&amp;quot;,\n  &amp;quot;lastCheckInTime&amp;quot;: &amp;quot;Mon, 11 Sep 2023 11:45:54 GMT&amp;quot;,\n  &amp;quot;acceptedAt&amp;quot;: &amp;quot;Mon, 11 Sep 2023 11:45:54 GMT&amp;quot;\n}&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;The cookie is like a ticket which indicates entry to the waiting room.The &lt;i&gt;bucketId&lt;/i&gt; indicates which cluster of users this user is part of. The &lt;i&gt;acceptedAt&lt;/i&gt; time and &lt;i&gt;lastCheckInTime&lt;/i&gt; indicate when the last interaction with the workers was. This information can ensure if the ticket is valid for entry or not when we compare it with the &lt;i&gt;session duration&lt;/i&gt; value that the customer sets while configuring the waiting room. If the cookie is valid, we let the user through which ensures users who are on the website continue to be able to browse the website. If the cookie is invalid, we create a new cookie treating the user as a new user and if there is queueing happening on the website they get to the back of the queue. In the next section let us see how we decide when to queue those users.&lt;/p&gt;&lt;p&gt;To understand this further, let&amp;#39;s see what the contents of the waiting room state are. For the customer we discussed above, at the time &amp;quot;Mon, 11 Sep 2023 11:45:54 GMT&amp;quot;, the state could look like this.&lt;/p&gt;\n            &lt;pre class=\&quot;language-bash\&quot;&gt;&lt;code class=\&quot;language-bash\&quot;&gt;{  \n  &amp;quot;activeUsers&amp;quot;: 50,\n}&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;As mentioned above the customer’s configuration has &lt;i&gt;new users per minute&lt;/i&gt; and t_otal active users_ equal to 200 and 200 respectively.&lt;/p&gt;&lt;p&gt;So the state indicates that there is space for the new users as there are only 50 active users when it&amp;#39;s possible to have 200. So there is space for another 150 users to go in. Let&amp;#39;s assume those 50 users could have come from two data centers San Jose (20 users) and London (30 users). We also keep track of the number of workers that are active across the globe as well as the number of workers active at the data center in which the state is calculated. The state key below could be the one calculated at San Jose.&lt;/p&gt;\n            &lt;pre class=\&quot;language-bash\&quot;&gt;&lt;code class=\&quot;language-bash\&quot;&gt;{  \n  &amp;quot;activeUsers&amp;quot;: 50,\n  &amp;quot;globalWorkersActive&amp;quot;: 10,\n  &amp;quot;dataCenterWorkersActive&amp;quot;: 3,\n  &amp;quot;trafficHistory&amp;quot;: {\n    &amp;quot;Mon, 11 Sep 2023 11:44:00 GMT&amp;quot;: {\n       San Jose: 20/200, // 10%\n       London: 30/200, // 15%\n       Anywhere: 150/200 // 75%\n    }\n  }\n}&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;Imagine at the time &amp;quot;&lt;code&gt;Mon, 11 Sep 2023 11:45:54 GMT&lt;/code&gt;&amp;quot;, we get a request to that waiting room at a datacenter in San Jose.&lt;/p&gt;&lt;p&gt;To see if the user that reached San Jose can go to the origin we first check the traffic history in the past minute to see the distribution of traffic at that time. This is because a lot of websites are popular in certain parts of the world. For a lot of these websites the traffic tends to come from the same data centers.&lt;/p&gt;&lt;p&gt;Looking at the traffic history for the minute &amp;quot;&lt;code&gt;Mon, 11 Sep 2023 11:44:00 GMT&lt;/code&gt;&amp;quot; we see San Jose has 20 users out of 200 users going there (10%) at that time. For the current time &amp;quot;&lt;code&gt;Mon, 11 Sep 2023 11:45:54 GMT&lt;/code&gt;&amp;quot; we divide the slots available at the website at the same ratio as the traffic history in the past minute. So we can send 10% of 150 slots available from San Jose which is 15 users. We also know that there are three active workers as &amp;quot;&lt;code&gt;dataCenterWorkersActive&lt;/code&gt;&amp;quot; is &lt;code&gt;3&lt;/code&gt;.&lt;/p&gt;&lt;p&gt;The number of slots available for the data center is divided evenly among the workers in the data center. So every worker in San Jose can send 15/3 users to the website. If the worker that received the traffic has not sent any users to the origin for the current minute they can send up to &lt;i&gt;five&lt;/i&gt; users (15/3).&lt;/p&gt;&lt;p&gt;At the same time (&amp;quot;&lt;code&gt;Mon, 11 Sep 2023 11:45:54 GMT&lt;/code&gt;&amp;quot;), imagine a request goes to a data center in Delhi. The worker at the data center in Delhi checks the trafficHistory and sees that there are no slots allotted for it. For traffic like this we have reserved the Anywhere slots as we are really far away from the limit.&lt;/p&gt;\n            &lt;pre class=\&quot;language-bash\&quot;&gt;&lt;code class=\&quot;language-bash\&quot;&gt;{  \n  &amp;quot;activeUsers&amp;quot;:50,\n  &amp;quot;globalWorkersActive&amp;quot;: 10,\n  &amp;quot;dataCenterWorkersActive&amp;quot;: 1,\n  &amp;quot;trafficHistory&amp;quot;: {\n    &amp;quot;Mon, 11 Sep 2023 11:44:00 GMT&amp;quot;: {\n       San Jose: 20/200, // 10%\n       London: 30/200, // 15%\n       Anywhere: 150/200 // 75%\n    }\n  }\n}&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;The &lt;code&gt;Anywhere&lt;/code&gt; slots are divided among all the active workers in the globe as any worker around the world can take a part of this pie. 75% of the remaining 150 slots which is 113.&lt;/p&gt;&lt;p&gt;The state key also keeps track of the number of workers (&lt;code&gt;globalWorkersActive&lt;/code&gt;) that have spawned around the world. The Anywhere slots allotted are divided among all the active workers in the world if available. &lt;code&gt;globalWorkersActive&lt;/code&gt; is 10 when we look at the waiting room state. So every active worker can send as many as 113/10 which is approximately 11 users. So the first 11 users that come to a worker in the minute &lt;code&gt;Mon, 11 Sep 2023 11:45:00 GMT&lt;/code&gt; gets admitted to the origin. The extra users get queued. The extra reserved slots (5) in San Jose for minute  &lt;code&gt;Mon, 11 Sep 2023 11:45:00 GMT&lt;/code&gt; discussed before ensures that we can admit up to 16(5 + 11) users from a worker from San Jose to the website.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;queuing-at-the-worker-level-can-cause-users-to-get-queued-before-the-slots-available-for-the-data-center\&quot;&gt;Queuing at the worker level can cause users to get queued before the slots available for the data center&lt;/h2&gt;\n            &lt;a href=\&quot;#queuing-at-the-worker-level-can-cause-users-to-get-queued-before-the-slots-available-for-the-data-center\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;As we can see from the example above, we decide whether to queue or not at the worker level. The number of new users that go to workers around the world can be non-uniform. To understand what can happen when there is non-uniform distribution of traffic to two workers, let us look at the diagram below.&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card kg-width-wide\&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/2I3CYq6IbnjE7T1A4yEOC1/513183137efaa278314be172c9ba549d/Side-effect-of-dividing-slots-at-worker-level.png\&quot; alt=\&quot;Side effect of dividing slots at worker level\&quot; class=\&quot;kg-image\&quot; width=\&quot;1600\&quot; height=\&quot;1013\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;Imagine the slots available for a data center in San Jose are &lt;i&gt;ten&lt;/i&gt;. There are two workers running in San Jose. &lt;i&gt;Seven&lt;/i&gt; users go to worker1 and &lt;i&gt;one&lt;/i&gt; user goes to worker2. In this situation worker1 will let in &lt;i&gt;five&lt;/i&gt; out of the &lt;i&gt;seven&lt;/i&gt; workers to the website and &lt;i&gt;two&lt;/i&gt; of them get queued as worker1 only has &lt;i&gt;five&lt;/i&gt; slots available. The &lt;i&gt;one&lt;/i&gt; user that shows up at worker2 also gets to go to the origin. So we queue &lt;i&gt;two&lt;/i&gt; users, when in reality &lt;i&gt;ten&lt;/i&gt; users can get sent from the datacenter San Jose when only &lt;i&gt;eight&lt;/i&gt; users show up.&lt;/p&gt;&lt;p&gt;This issue while dividing slots evenly among workers results in queueing before a waiting room’s configured traffic limits, typically within 20-30% of the limits set. This approach has advantages which we will discuss next. We have made changes to the approach to decrease the frequency with which queuing occurs outside that 20-30% range, queuing as close to limits as possible, while still ensuring Waiting Room is prepared to catch spikes. Later in this blog, we will cover how we achieved this by updating how we allocate and count slots.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;what-is-the-advantage-of-workers-making-these-decisions\&quot;&gt;What is the advantage of workers making these decisions?&lt;/h3&gt;\n            &lt;a href=\&quot;#what-is-the-advantage-of-workers-making-these-decisions\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;The example above talked about how a worker in San Jose and Delhi makes decisions to let users through to the origin. The advantage of making decisions at the worker level is that we can make decisions without any significant latency added to the request. This is because to make the decision, there is no need to leave the data center to get information about the waiting room as we are always working with the state that is currently available in the data center. The queueing starts when the slots run out within the worker. The lack of additional latency added enables the customers to turn on the waiting room all the time without worrying about extra latency to their users.&lt;/p&gt;&lt;p&gt;Waiting Room’s number one priority is to ensure that customer’s sites remain up and running at all times, even in the face of unexpected and overwhelming traffic surges. To that end, it is critical that a waiting room prioritizes staying near or below traffic limits set by the customer for that room. When a spike happens at one data center around the world, say at San Jose, the local state at the data center will take a few seconds to get to Delhi.&lt;/p&gt;&lt;p&gt;Splitting the slots among workers ensures that working with slightly outdated data does not cause the overall limit to be exceeded by an impactful amount. For example, the &lt;code&gt;activeUsers&lt;/code&gt; value can be 26 in the San Jose data center and 100 in the other data center where the spike is happening. At that point in time, sending extra users from Delhi may not overshoot the overall limit by much as they only have a part of the pie to start with in Delhi. Therefore, queueing before overall limits are reached is part of the design to make sure your overall limits are respected. In the next section we will cover the approaches we implemented to queue as close to limits as possible without increasing the risk of exceeding traffic limits.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;allocating-more-slots-when-traffic-is-low-relative-to-waiting-room-limits\&quot;&gt;Allocating more slots when traffic is low relative to waiting room limits&lt;/h2&gt;\n            &lt;a href=\&quot;#allocating-more-slots-when-traffic-is-low-relative-to-waiting-room-limits\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;The first case we wanted to address was queuing that occurs when traffic is far from limits. While rare and typically lasting for one refresh interval (20s) for the end users who are queued, this was our first priority when updating our queuing algorithm. To solve this, while allocating slots we looked at the utilization (how far you are from traffic limits) and allotted more slots when traffic is really far away from the limits. The idea behind this was to prevent the queueing that happens at lower limits while still being able to readjust slots available per worker when there are more users on the origin.&lt;/p&gt;&lt;p&gt;To understand this let&amp;#39;s revisit the example where there is non-uniform distribution of traffic to two workers. So two workers similar to the one we discussed before are shown below. In this case the utilization is low (10%). This means we are far from the limits. So the slots allocated(8) are closer to the &lt;code&gt;slotsAvailable&lt;/code&gt; for the datacenter San Jose which is 10. As you can see in the diagram below, all the eight users that go to either worker get to reach the website with this modified slot allocation as we are providing more slots per worker at lower utilization levels.&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card kg-width-wide\&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/7zNp1o6DEAbGL4GSYjUkeJ/1bc9bdf44861eb0025a0fe49ce45ae2a/Division-of-slots-among-workers-at-lower-utilization.png\&quot; alt=\&quot;Division of slots among workers at lower utilization\&quot; class=\&quot;kg-image\&quot; width=\&quot;1600\&quot; height=\&quot;1013\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;The diagram below shows how the slots allocated per worker changes with utilization (how far you are away from limits). As you can see here, we are allocating more slots per worker at lower utilization. As the utilization increases, the slots allocated per worker decrease as it’s getting closer to the limits, and we are better prepared for spikes in traffic. At 10% utilization every worker gets close to the slots available for the data center. As the utilization is close to 100% it becomes close to the slots available divided by worker count in the data center.&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/2qy2IXaKqoER8zkDRL9mAZ/2de5767fa86bc57ccc1d428b26269cef/Alloting-more-slots-at-lower-limits.png\&quot; alt=\&quot;Allotting more slots at lower limits\&quot; class=\&quot;kg-image\&quot; width=\&quot;1600\&quot; height=\&quot;1480\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;how-do-we-achieve-more-slots-at-lower-utilization\&quot;&gt;How do we achieve more slots at lower utilization?&lt;/h3&gt;\n            &lt;a href=\&quot;#how-do-we-achieve-more-slots-at-lower-utilization\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;This section delves into the mathematics which helps us get there. If you are not interested in these details, meet us at the “Risk of over provisioning” section.&lt;/p&gt;&lt;p&gt;To understand this further, let&amp;#39;s revisit the previous example where requests come to the Delhi data center. The &lt;code&gt;activeUsers&lt;/code&gt; value is 50, so utilization is 50/200 which is around 25%.&lt;/p&gt;\n            &lt;pre class=\&quot;language-bash\&quot;&gt;&lt;code class=\&quot;language-bash\&quot;&gt;{\n  &amp;quot;activeUsers&amp;quot;: 50,\n  &amp;quot;globalWorkersActive&amp;quot;: 10,\n  &amp;quot;dataCenterWorkersActive&amp;quot;: 1,\n  &amp;quot;trafficHistory&amp;quot;: {\n    &amp;quot;Mon, 11 Sep 2023 11:44:00 GMT&amp;quot;: {\n       San Jose: 20/200, // 10%\n       London: 30/200, // 15%\n       Anywhere: 150/200 // 75%\n    }\n  }\n}&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;The idea is to allocate more slots at lower utilization levels. This ensures that customers do not see unexpected queueing behaviors when traffic is far away from limits. At time &lt;code&gt;Mon, 11 Sep 2023 11:45:54 GMT&lt;/code&gt; requests to Delhi are at 25% utilization based on the local state key.&lt;/p&gt;&lt;p&gt;To allocate more slots to be available at lower utilization we added a &lt;code&gt;workerMultiplier&lt;/code&gt; which moves proportionally to the utilization. At lower utilization the multiplier is lower and at higher utilization it is close to one.&lt;/p&gt;\n            &lt;pre class=\&quot;language-bash\&quot;&gt;&lt;code class=\&quot;language-bash\&quot;&gt;workerMultiplier = (utilization)^curveFactor\nadaptedWorkerCount = actualWorkerCount * workerMultiplier&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;&lt;code&gt;utilization&lt;/code&gt; - how far away from the limits you are.&lt;/p&gt;&lt;p&gt;&lt;code&gt;curveFactor&lt;/code&gt; - is the exponent which can be adjusted which decides how aggressive we are with the distribution of extra budgets at lower worker counts. To understand this let&amp;#39;s look at the graph of how y = x and y = x^2 looks between values 0 and 1.&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/4wgTahQXjs2Heu9fW2jOgG/56f26b2e0bcd048dd4a2a7b28bdaef38/Graph-for-y-x-curveFactor.png\&quot; alt=\&quot;Graph for y=x^curveFactor\&quot; class=\&quot;kg-image\&quot; width=\&quot;1600\&quot; height=\&quot;1480\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;The graph for y=x is a straight line passing through (0, 0) and (1, 1).&lt;/p&gt;&lt;p&gt;The graph for &lt;code&gt;y=x^2&lt;/code&gt; is a curved line where y increases slower than &lt;code&gt;x&lt;/code&gt; when &lt;code&gt;x &amp;lt; 1&lt;/code&gt; and passes through (0, 0) and (1, 1)&lt;/p&gt;&lt;p&gt;Using the concept of how the curves work, we derived the formula for &lt;code&gt;workerCountMultiplier&lt;/code&gt; where &lt;code&gt;&lt;i&gt;y=workerCountMultiplier&lt;/i&gt;&lt;/code&gt;&lt;i&gt;,&lt;/i&gt; &lt;code&gt;&lt;i&gt;x=utilization&lt;/i&gt;&lt;/code&gt; and &lt;code&gt;&lt;i&gt;curveFactor&lt;/i&gt;&lt;/code&gt; is the power which can be adjusted which decides how aggressive we are with the distribution of extra budgets at lower worker counts. When &lt;code&gt;curveFactor&lt;/code&gt; is 1, the &lt;code&gt;workerMultiplier&lt;/code&gt; is equal to the utilization.&lt;/p&gt;&lt;p&gt;Let&amp;#39;s come back to the example we discussed before and see what the value of the curve factor will be. At time &lt;code&gt;Mon, 11 Sep 2023 11:45:54 GMT&lt;/code&gt; requests to Delhi are at 25% utilization based on the local state key. The Anywhere slots are divided among all the active workers in the globe as any worker around the world can take a part of this pie. i.e. 75% of the remaining 150 slots (113).&lt;/p&gt;&lt;p&gt;&lt;code&gt;globalWorkersActive&lt;/code&gt; is 10 when we look at the waiting room state. In this case we do not divide the 113 slots by 10 but instead divide by the adapted worker count which is &lt;code&gt;globalWorkersActive ***** workerMultiplier&lt;/code&gt;. If &lt;code&gt;curveFactor&lt;/code&gt; is &lt;code&gt;1&lt;/code&gt;, the &lt;code&gt;workerMultiplier&lt;/code&gt; is equal to the utilization which is at 25% or 0.25.&lt;/p&gt;&lt;p&gt;So effective &lt;code&gt;workerCount&lt;/code&gt; = 10 * 0.25 = 2.5&lt;/p&gt;&lt;p&gt;So, every active worker can send as many as 113/2.5 which is approximately 45 users. The first 45 users that come to a worker in the minute &lt;code&gt;Mon, 11 Sep 2023 11:45:00 GMT&lt;/code&gt; gets admitted to the origin. The extra users get queued.&lt;/p&gt;&lt;p&gt;Therefore, at lower utilization (when traffic is farther from the limits) each worker gets more slots. But, if the sum of slots are added up, there is a higher chance of exceeding the overall limit.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;risk-of-over-provisioning\&quot;&gt;Risk of over provisioning&lt;/h3&gt;\n            &lt;a href=\&quot;#risk-of-over-provisioning\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;The method of giving more slots at lower limits decreases the chances of queuing when traffic is low relative to traffic limits. However, at lower utilization levels a uniform spike happening around the world could cause more users to go into the origin than expected. The diagram below shows the case where this can be an issue. As you can see the slots available are &lt;i&gt;ten&lt;/i&gt; for the data center. At 10% utilization we discussed before, each worker can have &lt;i&gt;eight&lt;/i&gt; slots each. If &lt;i&gt;eight&lt;/i&gt; users show up at one worker and &lt;i&gt;seven&lt;/i&gt; show up at another, we will be sending &lt;i&gt;fifteen&lt;/i&gt; users to the website when only &lt;i&gt;ten&lt;/i&gt; are the maximum available slots for the data center.&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card kg-width-wide\&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/3aKrVwAvh40LjZGBcGl43R/2736425861cbc5ff8266c0aa7aa64a88/Risk-of-over-provisioning-at-lower-utilization.png\&quot; alt=\&quot;Risk of over provisioning at lower utilization\&quot; class=\&quot;kg-image\&quot; width=\&quot;1600\&quot; height=\&quot;1013\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;With the range of customers and types of traffic we have, we were able to see cases where this became a problem. A traffic spike from low utilization levels could cause overshooting of the global limits. This is because we are over provisioned at lower limits and this increases the risk of significantly exceeding traffic limits. We needed to implement a safer approach which would not cause limits to be exceeded while also decreasing the chance of queueing when traffic is low relative to traffic limits.&lt;/p&gt;&lt;p&gt;Taking a step back and thinking about our approach, one of the assumptions we had was that the traffic in a data center directly correlates to the worker count that is found in a data center. In practice what we found is that this was not true for all customers. Even if the traffic correlates to the worker count, the new users going to the workers in the data centers may not correlate. This is because the slots we allocate are for new users but the traffic that a data center sees consists of both users who are already on the website and new users trying to go to the website.&lt;/p&gt;&lt;p&gt;In the next section we are talking about an approach where worker counts do not get used and instead workers communicate with other workers in the data center. For that we introduced a new service which is a durable object counter.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;decrease-the-number-of-times-we-divide-the-slots-by-introducing-data-center-counters\&quot;&gt;Decrease the number of times we divide the slots by introducing Data Center Counters&lt;/h2&gt;\n            &lt;a href=\&quot;#decrease-the-number-of-times-we-divide-the-slots-by-introducing-data-center-counters\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;From the example above, we can see that overprovisioning at the worker level has the risk of using up more slots than what is allotted for a data center. If we do not over provision at low levels we have the risk of queuing users way before their configured limits are reached which we discussed first. So there has to be a solution which can achieve both these things.&lt;/p&gt;&lt;p&gt;The overprovisioning was done so that the workers do not run out of slots quickly when an uneven number of new users reach a bunch of workers. If there is a way to communicate between two workers in a data center, we do not need to divide slots among workers in the data center based on worker count. For that communication to take place, we introduced counters. Counters are a bunch of small durable object instances that do counting for a set of workers in the data center.&lt;/p&gt;&lt;p&gt;To understand how it helps with avoiding usage of worker counts, let&amp;#39;s check the diagram below. There are two workers talking to a &lt;i&gt;Data Center Counter&lt;/i&gt; below. Just as we discussed before, the workers let users through to the website based on the waiting room state. The count of the number of users let through was stored in the memory of the worker before. By introducing counters, it is done in the &lt;i&gt;Data Center Counter&lt;/i&gt;. Whenever a new user makes a request to the worker, the worker talks to the counter to know the current value of the counter. In the example below for the first new request to the worker the counter value received is 9. When a data center has 10 slots available, that will mean the user can go to the website. If the next worker receives a new user and makes a request just after that, it will get a value 10 and based on the slots available for the worker, the user will get queued.&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card kg-width-wide\&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/ttIdi7gwzmK4ENeqkIGO0/108c8831de2691504c4667bbc6180fcc/Counters-helping-workers-communicate-with-each-other.png\&quot; alt=\&quot;Counters helping workers communicate with each other\&quot; class=\&quot;kg-image\&quot; width=\&quot;1600\&quot; height=\&quot;1170\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;The &lt;i&gt;Data Center Counter&lt;/i&gt; acts as a point of synchronization for the workers in the waiting room. Essentially, this enables the workers to talk to each other without really talking to each other directly. This is similar to how a ticketing counter works. Whenever one worker lets someone in, they request tickets from the counter, so another worker requesting the tickets from the counter will not get the same ticket number. If the ticket value is valid, the new user gets to go to the website. So when different numbers of new users show up at workers, we will not over allocate or under allocate slots for the worker as the number of slots used is calculated by the counter which is for the data center.&lt;/p&gt;&lt;p&gt;The diagram below shows the behavior when an uneven number of new users reach the workers, one gets &lt;i&gt;seven&lt;/i&gt; new users and the other worker gets &lt;i&gt;one&lt;/i&gt; new user. All &lt;i&gt;eight&lt;/i&gt; users that show up at the workers in the diagram below get to the website as the slots available for the data center is &lt;i&gt;ten&lt;/i&gt; which is below &lt;i&gt;ten&lt;/i&gt;.&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card kg-width-wide\&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/bais5OnxQpewoeNM2T81H/b2693f9d527c65183299e5bbe778d976/Uneven-number-of-requests-to-Workers-does-not-cause-queueing.png\&quot; alt=\&quot;Uneven number of requests to workers does not cause queueing\&quot; class=\&quot;kg-image\&quot; width=\&quot;1600\&quot; height=\&quot;1013\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;This also does not cause excess users to get sent to the website as we do not send extra users when the counter value equals the &lt;code&gt;slotsAvailable&lt;/code&gt; for the data center. Out of the &lt;i&gt;fifteen&lt;/i&gt; users that show up at the workers in the diagram below &lt;i&gt;ten&lt;/i&gt; will get to the website and &lt;i&gt;five&lt;/i&gt; will get queued which is what we would expect.&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card kg-width-wide\&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/7IF1Ze4p1TvZM9YUfCLyla/ba620e498641a3006eedc6200e0e3c55/Risk-of-over-provisioning-at-lower-utilization-also-does-not-exist-as-counters-help-Workers-communicate-with-each-other.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1600\&quot; height=\&quot;1013\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;Risk of over provisioning at lower utilization also does not exist as counters help workers to communicate with each other.&lt;/p&gt;&lt;p&gt;To understand this further, let&amp;#39;s look at the previous example we talked about and see how it works with the actual waiting room state.&lt;/p&gt;&lt;p&gt;The waiting room state for the customer is as follows.&lt;/p&gt;\n            &lt;pre class=\&quot;language-bash\&quot;&gt;&lt;code class=\&quot;language-bash\&quot;&gt;{  \n  &amp;quot;activeUsers&amp;quot;: 50,\n  &amp;quot;globalWorkersActive&amp;quot;: 10,\n  &amp;quot;dataCenterWorkersActive&amp;quot;: 3,\n  &amp;quot;trafficHistory&amp;quot;: {\n    &amp;quot;Mon, 11 Sep 2023 11:44:00 GMT&amp;quot;: {\n       San Jose: 20/200, // 10%\n       London: 30/200, // 15%\n       Anywhere: 150/200 // 75%\n    }\n  }\n}&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;The objective is to not divide the slots among workers so that we don’t need to use that information from the state. At time &lt;code&gt;Mon, 11 Sep 2023 11:45:54 GMT&lt;/code&gt; requests come to San Jose. So, we can send 10% of 150 slots available from San Jose which is 15.&lt;/p&gt;&lt;p&gt;The durable object counter at San Jose keeps returning the counter value it is at right now for every new user that reaches the data center. It will increment the value by 1 after it returns to a worker. So the first 15 new users that come to the worker get a unique counter value. If the value received for a user is less than 15 they get to use the slots at the data center.&lt;/p&gt;&lt;p&gt;Once the slots available for the data center runs out, the users can make use of the slots allocated for Anywhere data-centers as these are not reserved for any particular data center. Once a worker in San Jose gets a ticket value that says 15, it realizes that it&amp;#39;s not possible to go to the website using the slots from San Jose.&lt;/p&gt;&lt;p&gt;The Anywhere slots are available for all the active workers in the globe i.e. 75% of the remaining 150 slots (113). The Anywhere slots are handled by a durable object that workers from different data centers can talk to when they want to use Anywhere slots. Even if 128 (113 + 15) users end up going to the same worker for this customer we will not queue them. This increases the ability of Waiting Room to handle an uneven number of new users going to workers around the world which in turn helps the customers to queue close to the configured limits.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;why-do-counters-work-well-for-us\&quot;&gt;Why do counters work well for us?&lt;/h3&gt;\n            &lt;a href=\&quot;#why-do-counters-work-well-for-us\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;When we built the Waiting Room, we wanted the decisions for entry into the website to be made at the worker level itself without talking to other services when the request is in flight to the website. We made that choice to avoid adding latency to user requests. By introducing a synchronization point at a durable object counter, we are deviating from that by introducing a call to a durable object counter.&lt;/p&gt;&lt;p&gt;However, the durable object for the data center stays within the same data center. This leads to minimal additional latency which is usually less than 10 ms. For the calls to the durable object that handles Anywhere data centers, the worker may have to cross oceans and long distances. This could cause the latency to be around 60 or 70 ms in those cases. The 95th percentile values shown below are higher because of calls that go to farther data centers.&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card kg-width-wide\&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/5LC6pdXV2rZxZAntvU36Bs/fa9c714cd8bbad0d2b6fed0a35873f7d/1Dr9LuESmHPXU4nQlr_9WIncDSE9uXcbHA6qevspl.png\&quot; alt=\&quot;Graph showing percentile distribution of counter latencies from our production dashboard\&quot; class=\&quot;kg-image\&quot; width=\&quot;1600\&quot; height=\&quot;688\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;The design decision to add counters adds a slight extra latency for new users going to the website. We deemed the trade-off acceptable because this reduces the number of users that get queued before limits are reached. In addition, the counters are only required when new users try to go into the website. Once new users get to the origin, they get entry directly from workers as the proof of entry is available in the cookies that the customers come with, and we can let them in based on that.&lt;/p&gt;&lt;p&gt;Counters are really simple services which do simple counting and do nothing else. This keeps the memory and CPU footprint of the counters minimal. Moreover, we have a lot of counters around the world handling the coordination between a subset of workers.This helps counters to successfully handle the load for the synchronization requirements from the workers. These factors add up to make counters a viable solution for our use case.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;summary\&quot;&gt;Summary&lt;/h2&gt;\n            &lt;a href=\&quot;#summary\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;Waiting Room was designed with our number one priority in mind–to ensure that our customers’ sites remain up and running, no matter the volume or ramp up of legitimate traffic. Waiting Room runs on every server in Cloudflare’s network, which spans over 300 cities in more than 100 countries. We want to make sure, for every new user, the decision whether to go to the website or the queue is made with minimal latency and is done at the right time. This decision is a hard one as queuing too early at a data center can cause us to queue earlier than the customer set limits. Queuing too late can cause us to overshoot the customer set limits.&lt;/p&gt;&lt;p&gt;With our initial approach where we divide slots among our workers evenly we were sometimes queuing too early but were pretty good at respecting customer set limits. Our next approach of giving more slots at low utilization (low traffic levels compared to customer limits) ensured that we did better at the cases where we queued earlier than the customer set limits as every worker has more slots to work with at each worker. But as we have seen, this made us more likely to overshoot when a sudden spike in traffic occurred after a period of low utilization.&lt;/p&gt;&lt;p&gt;With counters we are able to get the best of both worlds as we avoid the division of slots by worker counts. Using counters we are able to ensure that we do not queue too early or too late based on the customer set limits. This comes at the cost of a little bit of latency to every request from a new user which we have found to be negligible and creates a better user experience than getting queued early.&lt;/p&gt;&lt;p&gt;We keep iterating on our approach to make sure we are always queuing people at the right time and above all protecting your website. As more and more customers are using the waiting room, we are learning more about different types of traffic and that is helping the product be better for everyone.&lt;/p&gt;&quot;],&quot;published_at&quot;:[0,&quot;2023-09-20T14:00:58.000+01:00&quot;],&quot;updated_at&quot;:[0,&quot;2024-10-09T23:25:27.089Z&quot;],&quot;feature_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/3bCUD8fhDDdX6B9Kg6FnFL/8ef35a7d9aadd4e0c62233b81ac462b6/how-waiting-room-queues.png&quot;],&quot;tags&quot;:[1,[[0,{&quot;id&quot;:[0,&quot;79jLdGrSe87cix3F6A5Snu&quot;],&quot;name&quot;:[0,&quot;Waiting Room&quot;],&quot;slug&quot;:[0,&quot;waiting-room&quot;]}],[0,{&quot;id&quot;:[0,&quot;6hbkItfupogJP3aRDAq6v8&quot;],&quot;name&quot;:[0,&quot;Cloudflare Workers&quot;],&quot;slug&quot;:[0,&quot;workers&quot;]}],[0,{&quot;id&quot;:[0,&quot;5v2UZdTRX1Rw9akmhexnxs&quot;],&quot;name&quot;:[0,&quot;Durable Objects&quot;],&quot;slug&quot;:[0,&quot;durable-objects&quot;]}],[0,{&quot;id&quot;:[0,&quot;1U6ifhBwTuaJ2w4pjNOzNT&quot;],&quot;name&quot;:[0,&quot;Network&quot;],&quot;slug&quot;:[0,&quot;network&quot;]}],[0,{&quot;id&quot;:[0,&quot;4HIPcb68qM0e26fIxyfzwQ&quot;],&quot;name&quot;:[0,&quot;Developers&quot;],&quot;slug&quot;:[0,&quot;developers&quot;]}],[0,{&quot;id&quot;:[0,&quot;3JAY3z7p7An94s6ScuSQPf&quot;],&quot;name&quot;:[0,&quot;Developer Platform&quot;],&quot;slug&quot;:[0,&quot;developer-platform&quot;]}]]],&quot;relatedTags&quot;:[0],&quot;authors&quot;:[1,[[0,{&quot;name&quot;:[0,&quot;George Thomas&quot;],&quot;slug&quot;:[0,&quot;george&quot;],&quot;bio&quot;:[0,&quot;I am a systems Engineer who works at the San Francisco office. &quot;],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/7JkNNinN2jouiqfkQCe8np/52d8a93efcdeda8edf0bc94806d1db98/george.png&quot;],&quot;location&quot;:[0,&quot;San Francisco&quot;],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,&quot;@georgeagain&quot;],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}]]],&quot;meta_description&quot;:[0,&quot;We want to give you a behind the scenes look at how we have evolved the core mechanism of our product–namely, exactly how it kicks in to queue traffic in response to spikes.&quot;],&quot;primary_author&quot;:[0,{}],&quot;localeList&quot;:[0,{&quot;name&quot;:[0,&quot;How Waiting Room makes queueing decisions on Cloudflare&#39;s highly distributed network Config&quot;],&quot;enUS&quot;:[0,&quot;English for Locale&quot;],&quot;zhCN&quot;:[0,&quot;Translated for Locale&quot;],&quot;zhHansCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhTW&quot;:[0,&quot;Translated for Locale&quot;],&quot;frFR&quot;:[0,&quot;Translated for Locale&quot;],&quot;deDE&quot;:[0,&quot;Translated for Locale&quot;],&quot;itIT&quot;:[0,&quot;No Page for Locale&quot;],&quot;jaJP&quot;:[0,&quot;Translated for Locale&quot;],&quot;koKR&quot;:[0,&quot;No Page for Locale&quot;],&quot;ptBR&quot;:[0,&quot;No Page for Locale&quot;],&quot;esLA&quot;:[0,&quot;No Page for Locale&quot;],&quot;esES&quot;:[0,&quot;No Page for Locale&quot;],&quot;enAU&quot;:[0,&quot;No Page for Locale&quot;],&quot;enCA&quot;:[0,&quot;No Page for Locale&quot;],&quot;enIN&quot;:[0,&quot;No Page for Locale&quot;],&quot;enGB&quot;:[0,&quot;No Page for Locale&quot;],&quot;idID&quot;:[0,&quot;No Page for Locale&quot;],&quot;ruRU&quot;:[0,&quot;No Page for Locale&quot;],&quot;svSE&quot;:[0,&quot;No Page for Locale&quot;],&quot;viVN&quot;:[0,&quot;No Page for Locale&quot;],&quot;plPL&quot;:[0,&quot;No Page for Locale&quot;],&quot;arAR&quot;:[0,&quot;No Page for Locale&quot;],&quot;nlNL&quot;:[0,&quot;No Page for Locale&quot;],&quot;thTH&quot;:[0,&quot;No Page for Locale&quot;],&quot;trTR&quot;:[0,&quot;No Page for Locale&quot;],&quot;heIL&quot;:[0,&quot;No Page for Locale&quot;],&quot;lvLV&quot;:[0,&quot;No Page for Locale&quot;],&quot;etEE&quot;:[0,&quot;No Page for Locale&quot;],&quot;ltLT&quot;:[0,&quot;No Page for Locale&quot;]}],&quot;url&quot;:[0,&quot;https://blog.cloudflare.com/how-waiting-room-queues&quot;],&quot;metadata&quot;:[0,{&quot;title&quot;:[0,&quot;How Waiting Room makes queueing decisions on Cloudflare&#39;s highly distributed network&quot;],&quot;description&quot;:[0,&quot;We want to give you a behind the scenes look at how we have evolved the core mechanism of our product–namely, exactly how it kicks in to queue traffic in response to spikes.&quot;],&quot;imgPreview&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1ZmA2hsrNUhCEcpT4Kw5m4/6ca2a2e3deacdb94b051824eb3f6b7d8/how-waiting-room-queues-CUVlza.png&quot;]}],&quot;publicly_index&quot;:[0,true]}],[0,{&quot;id&quot;:[0,&quot;65UG8ITOXBu4pXT5pj8bSj&quot;],&quot;title&quot;:[0,&quot;Building a scheduling system with Workers and Durable Objects&quot;],&quot;slug&quot;:[0,&quot;building-scheduling-system-with-workers-and-durable-objects&quot;],&quot;excerpt&quot;:[0,&quot;In this post we&#39;re going to show you how to build a scalable service that will schedule HTTP requests on a specific schedule or as one-off at a specific time &quot;],&quot;featured&quot;:[0,false],&quot;html&quot;:[0,&quot;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/2fjdl7kWRa7MwLUn86agFI/c0523af4c465553a7152ba2d9cf483f9/Scheduling-system-with-Workers-and-Durable-Objects.png\&quot; alt=\&quot;Building a scheduling system with Workers and Durable Objects\&quot; class=\&quot;kg-image\&quot; width=\&quot;1600\&quot; height=\&quot;901\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;We rely on technology to help us on a daily basis – if you are not good at keeping track of time, your calendar can remind you when it&amp;#39;s time to prepare for your next meeting. If you made a reservation at a really nice restaurant, you don&amp;#39;t want to miss it! You appreciate the app to remind you a day before your plans the next evening.&lt;/p&gt;&lt;p&gt;However, who tells the application when it&amp;#39;s the right time to send you a notification? For this, we generally rely on scheduled events. And when you are relying on them, you really want to make sure that they occur. Turns out, this can get difficult. The scheduler and storage backend need to be designed with scale in mind - otherwise you may hit limitations quickly.&lt;/p&gt;&lt;p&gt;Workers, Durable Objects, and Alarms are actually a perfect match for this type of workload. Thanks to the distributed architecture of Durable Objects and their storage, they are a reliable and scalable option. Each Durable Object has access to its own isolated storage and alarm scheduler, both being automatically replicated and failover in case of failures.&lt;/p&gt;&lt;p&gt;There are many use cases where having a reliable scheduler can come in handy: running a webhook service, sending emails to your customers a week after they sign up to keep them engaged, sending invoices reminders, and more!&lt;/p&gt;&lt;p&gt;Today, we&amp;#39;re going to show you how to build a scalable service that will schedule HTTP requests on a specific schedule or as one-off at a specific time as a way to guide you through any use case that requires scheduled events.&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/5QsLhy4QmfImRWULDDCpRx/07a879528b6632d850fda9c141ba8707/Scheduling-system-with-Workers-and-Durable-Objects---Diagram.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1531\&quot; height=\&quot;871\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;quick-intro-into-the-application-stack\&quot;&gt;Quick intro into the application stack&lt;/h3&gt;\n            &lt;a href=\&quot;#quick-intro-into-the-application-stack\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Before we dive in, here are some of the tools we’re going to be using today:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;&lt;a href=\&quot;https://developers.cloudflare.com/workers/wrangler/get-started/#install\&quot;&gt;Wrangler&lt;/a&gt; - CLI tool to develop and publish Workers&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;a href=\&quot;https://developers.cloudflare.com/workers\&quot;&gt;Cloudflare Workers&lt;/a&gt; - runtime&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;a href=\&quot;https://developers.cloudflare.com/workers/learning/using-durable-objects/\&quot;&gt;Cloudflare Durable Objects&lt;/a&gt; - storage for HTTP requests and &lt;a href=\&quot;/durable-objects-alarms/\&quot;&gt;Alarms&lt;/a&gt; to schedule them&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;The application is going to have the following components:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;Scheduling system API to accept scheduled requests and manage Durable Objects&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Unique Durable Object per scheduled request, each with&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Storage - keeping the request metadata, such as URL, body, or headers.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Alarm - a timer (trigger) to wake Durable Object up.&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;While we will focus on building the application, the Cloudflare global network will take care of the rest – storing and replicating our data, and making sure to wake our Durable Objects up when the time&amp;#39;s right. Let’s build it!&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;initialize-new-workers-project\&quot;&gt;Initialize new Workers project&lt;/h3&gt;\n            &lt;a href=\&quot;#initialize-new-workers-project\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Get started by generating a completely new Workers project using the &lt;code&gt;wrangler init&lt;/code&gt; command, which makes creating new projects quick &amp;amp; easy.&lt;/p&gt;&lt;p&gt;&lt;b&gt;wrangler init -y durable-objects-requests-scheduler&lt;/b&gt;&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/6vgw0sXTG850ifbluBAbEy/57b6965270f884980aa64ebd4d90a914/pasted-image-0.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1600\&quot; height=\&quot;562\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;For more information on how to install, authenticate, or update Wrangler, check out &lt;a href=\&quot;https://developers.cloudflare.com/workers/wrangler/get-started\&quot;&gt;https://developers.cloudflare.com/workers/wrangler/get-started&lt;/a&gt;&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;preparing-typescript-types\&quot;&gt;Preparing TypeScript types&lt;/h3&gt;\n            &lt;a href=\&quot;#preparing-typescript-types\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;From my personal experience, at least a draft of TypeScript types significantly helps to be more productive down the road, so let&amp;#39;s prepare and describe our scheduled request in advance. Create a file types.ts in src directory and paste the following TypeScript definitions.&lt;/p&gt;&lt;p&gt;&lt;b&gt;src/types.ts&lt;/b&gt;&lt;/p&gt;\n            &lt;pre class=\&quot;language-typescript\&quot;&gt;&lt;code class=\&quot;language-typescript\&quot;&gt;export interface Env {\n    DO_REQUEST: DurableObjectNamespace\n}\n \nexport interface ScheduledRequest {\n  url: string // URL of the request\n  triggerAt?: number // optional, unix timestamp in milliseconds, defaults to `new Date()`\n  requestInit?: RequestInit // optional, includes method, headers, body\n}&lt;/pre&gt;&lt;/code&gt;\n            \n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;a-scheduled-request-durable-object-class-alarm\&quot;&gt;A scheduled request Durable Object class &amp;amp; alarm&lt;/h3&gt;\n            &lt;a href=\&quot;#a-scheduled-request-durable-object-class-alarm\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Based on our architecture design, each scheduled request will be saved into its own Durable Object, effectively separating storage and alarms from each other and allowing our scheduling system to scale horizontally - there is no limit to the number of Durable Objects we create.&lt;/p&gt;&lt;p&gt;In the end, the Durable Object class is a matter of a couple of lines. The code snippet below accepts and saves the request body to a persistent storage and sets the alarm timer. Workers runtime will wake up the Durable Object and call the &lt;code&gt;alarm()&lt;/code&gt; method to process the request.&lt;/p&gt;&lt;p&gt;The alarm method reads the scheduled request data from the storage, then processes the request, and in the end reschedules itself in case it&amp;#39;s configured to be executed on a recurring schedule.&lt;/p&gt;&lt;p&gt;&lt;b&gt;src/request-durable-object.ts&lt;/b&gt;&lt;/p&gt;\n            &lt;pre class=\&quot;language-js\&quot;&gt;&lt;code class=\&quot;language-js\&quot;&gt;import { ScheduledRequest } from &amp;quot;./types&amp;quot;;\n \nexport class RequestDurableObject {\n  id: string|DurableObjectId\n  storage: DurableObjectStorage\n \n  constructor(state:DurableObjectState) {\n    this.storage = state.storage\n    this.id = state.id\n  }\n \n    async fetch(request:Request) {\n    // read scheduled request from request body\n    const scheduledRequest:ScheduledRequest = await request.json()\n     \n    // save scheduled request data to Durable Object storage, set the alarm, and return Durable Object id\n    this.storage.put(&amp;quot;request&amp;quot;, scheduledRequest)\n    this.storage.setAlarm(scheduledRequest.triggerAt || new Date())\n    return new Response(JSON.stringify({\n      id: this.id.toString()\n    }), {\n      headers: {\n        &amp;quot;content-type&amp;quot;: &amp;quot;application/json&amp;quot;\n      }\n    })\n  }\n \n  async alarm() {\n    // read the scheduled request from Durable Object storage\n    const scheduledRequest:ScheduledRequest|undefined = await this.storage.get(&amp;quot;request&amp;quot;)\n \n    // call fetch on scheduled request URL with optional requestInit\n    if (scheduledRequest) {\n      await fetch(scheduledRequest.url, scheduledRequest.requestInit ? webhook.requestInit : undefined)\n \n      // cleanup scheduled request once done\n      this.storage.deleteAll()\n    }\n  }\n}&lt;/pre&gt;&lt;/code&gt;\n            \n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;wrangler-configuration\&quot;&gt;Wrangler configuration&lt;/h3&gt;\n            &lt;a href=\&quot;#wrangler-configuration\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Once we have the Durable Object class, we need to create a Durable Object binding by instructing Wrangler where to find it and what the exported class name is.&lt;/p&gt;&lt;p&gt;&lt;b&gt;wrangler.toml&lt;/b&gt;&lt;/p&gt;\n            &lt;pre class=\&quot;language-toml\&quot;&gt;&lt;code class=\&quot;language-toml\&quot;&gt;name = &amp;quot;durable-objects-request-scheduler&amp;quot;\nmain = &amp;quot;src/index.ts&amp;quot;\ncompatibility_date = &amp;quot;2022-08-02&amp;quot;\n \n# added Durable Objects configuration\n[durable_objects]\nbindings = [\n  { name = &amp;quot;DO_REQUEST&amp;quot;, class_name = &amp;quot;RequestDurableObject&amp;quot; },\n]\n \n[[migrations]]\ntag = &amp;quot;v1&amp;quot;\nnew_classes = [&amp;quot;RequestDurableObject&amp;quot;]&lt;/pre&gt;&lt;/code&gt;\n            \n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;scheduling-system-api\&quot;&gt;Scheduling system API&lt;/h3&gt;\n            &lt;a href=\&quot;#scheduling-system-api\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;The API Worker will accept POST HTTP methods only, and is expecting a JSON body with scheduled request data - what URL to call, optionally what method, headers, or body to send. Any other method than POST will return 405 - Method Not Allowed HTTP error.&lt;/p&gt;&lt;p&gt;HTTP &lt;code&gt;POST /:scheduledRequestId?&lt;/code&gt; will create or override a scheduled request, where :scheduledRequestId is optional Durable Object ID returned from a scheduling system API before.&lt;/p&gt;&lt;p&gt;&lt;b&gt;src/index.ts&lt;/b&gt;&lt;/p&gt;\n            &lt;pre class=\&quot;language-js\&quot;&gt;&lt;code class=\&quot;language-js\&quot;&gt;import { Env } from &amp;quot;./types&amp;quot;\nexport { RequestDurableObject } from &amp;quot;./request-durable-object&amp;quot;\n \nexport default {\n    async fetch(\n        request: Request,\n        env: Env\n    ): Promise&amp;lt;Response&amp;gt; {\n        if (request.method !== &amp;quot;POST&amp;quot;) {\n            return new Response(&amp;quot;Method Not Allowed&amp;quot;, {status: 405})\n        }\n \n        // parse the URL and get Durable Object ID from the URL\n        const url = new URL(request.url)\n        const idFromUrl = url.pathname.slice(1)\n \n        // construct the Durable Object ID, use the ID from pathname or create a new unique id\n        const doId = idFromUrl ? env.DO_REQUEST.idFromString(idFromUrl) : env.DO_REQUEST.newUniqueId()\n \n        // get the Durable Object stub for our Durable Object instance\n        const stub = env.DO_REQUEST.get(doId)\n \n        // pass the request to Durable Object instance\n        return stub.fetch(request)\n    },\n}&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;It&amp;#39;s good to mention that the script above does not implement any listing of scheduled or processed webhooks. Depending on how the scheduling system would be integrated, you can save each created Durable Object ID to your existing backend, or write your own registry – using one of the &lt;a href=\&quot;https://developers.cloudflare.com/workers/get-started/storage-objects/\&quot;&gt;Workers storage options&lt;/a&gt;.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;starting-a-local-development-server-and-testing-our-application\&quot;&gt;Starting a local development server and testing our application&lt;/h3&gt;\n            &lt;a href=\&quot;#starting-a-local-development-server-and-testing-our-application\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;We are almost done! Before we publish our scheduler system to the Cloudflare edge, let&amp;#39;s start Wrangler in a completely local mode to run a couple of tests against it and to see it in action – which will work even without an Internet connection!&lt;/p&gt;\n            &lt;pre class=\&quot;language-bash\&quot;&gt;&lt;code class=\&quot;language-bash\&quot;&gt;wrangler dev --local&lt;/pre&gt;&lt;/code&gt;\n            \n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/2O2DcPjirepk7sgbtlMpbn/7cef2cc7d230dc4c0010ceb08c84da06/pasted-image-0--1-.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1600\&quot; height=\&quot;614\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;The development server is listening on localhost:8787, which we will use for scheduling our first request. The JSON request payload should match the TypeScript schema we defined in the beginning – required URL, and optional &lt;code&gt;triggerEverySeconds&lt;/code&gt; number or &lt;code&gt;triggerAt&lt;/code&gt; unix timestamp. When only the required URL is passed, the request will be dispatched right away.&lt;/p&gt;&lt;p&gt;An example of request payload that will send a GET request to &lt;a href=\&quot;https://example.com\&quot;&gt;https://example.com&lt;/a&gt; every 30 seconds.&lt;/p&gt;\n            &lt;pre class=\&quot;language-json\&quot;&gt;&lt;code class=\&quot;language-json\&quot;&gt;{\n\t&amp;quot;url&amp;quot;:  &amp;quot;https://example.com&amp;quot;,\n\t&amp;quot;triggerEverySeconds&amp;quot;: 30,\n}&lt;/pre&gt;&lt;/code&gt;\n            \n            &lt;pre class=\&quot;language-bash\&quot;&gt;&lt;code class=\&quot;language-bash\&quot;&gt;&amp;gt; curl -X POST -d &amp;#039;{&amp;quot;url&amp;quot;: &amp;quot;https://example.com&amp;quot;, &amp;quot;triggerEverySeconds&amp;quot;: 30}&amp;#039; http://localhost:8787\n{&amp;quot;id&amp;quot;:&amp;quot;000000018265a5ecaa5d3c0ab6a6997bf5638fdcb1a8364b269bd2169f022b0f&amp;quot;}&lt;/pre&gt;&lt;/code&gt;\n            \n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/74kGUzg7MYccSbLySud2e5/a7cdb2781a32c2b95953d25109f3bcce/pasted-image-0--2-.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1600\&quot; height=\&quot;998\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;From the wrangler logs we can see the scheduled request ID &lt;code&gt;000000018265a5ecaa5d3c0ab6a6997bf5638fdcb1a8364b269bd2169f022b0f&lt;/code&gt; is being triggered in 30s intervals.&lt;/p&gt;&lt;p&gt;Need to double the interval? No problem, just send a new POST request and pass the request ID as a pathname.&lt;/p&gt;\n            &lt;pre class=\&quot;language-bash\&quot;&gt;&lt;code class=\&quot;language-bash\&quot;&gt;&amp;gt; curl -X POST -d &amp;#039;{&amp;quot;url&amp;quot;: &amp;quot;https://example.com&amp;quot;, &amp;quot;triggerEverySeconds&amp;quot;: 60}&amp;#039; http://localhost:8787/000000018265a5ecaa5d3c0ab6a6997bf5638fdcb1a8364b269bd2169f022b0f\n{&amp;quot;id&amp;quot;:&amp;quot;000000018265a5ecaa5d3c0ab6a6997bf5638fdcb1a8364b269bd2169f022b0f&amp;quot;}&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;Every scheduled request gets a unique Durable Object ID with its own storage and alarm. As we demonstrated, the ID becomes handy when you need to change the settings of the scheduled request, or to deschedule them completely.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;publishing-to-the-network\&quot;&gt;Publishing to the network&lt;/h3&gt;\n            &lt;a href=\&quot;#publishing-to-the-network\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Following command will bundle our Workers application, export and bind Durable Objects, and deploy it to our workers.dev subdomain.&lt;/p&gt;\n            &lt;pre class=\&quot;language-bash\&quot;&gt;&lt;code class=\&quot;language-bash\&quot;&gt;wrangler publish&lt;/pre&gt;&lt;/code&gt;\n            \n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/3p4tcXHgshwEhYihU8blKm/2dd1a3d76fcb72e056e94540228c2c3a/pasted-image-0--3-.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1190\&quot; height=\&quot;500\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;That&amp;#39;s it, we are live! ? The URL of your deployment is shown in the Workers logs. In a reasonably short period of time we managed to write our own scheduling system that is ready to handle requests at scale.&lt;/p&gt;&lt;p&gt;You can check full source code in &lt;a href=\&quot;https://github.com/cloudflare/templates/tree/main/worker-example-request-scheduler\&quot;&gt;Workers templates repository&lt;/a&gt;, or experiment from your browser without installing any dependencies locally using the &lt;a href=\&quot;https://workers.new/example-request-scheduler\&quot;&gt;StackBlitz template&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;&lt;b&gt;What to see or build next&lt;/b&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;New to Workers? Check our Get started guide.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Use &lt;a href=\&quot;https://www.cloudflare.com/products/zero-trust/access/\&quot;&gt;Access&lt;/a&gt; or &lt;a href=\&quot;https://developers.cloudflare.com/workers/runtime-apis/service-bindings/\&quot;&gt;service bindings&lt;/a&gt; if you want to protect your API from unauthorized access.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Got an idea for a Worker, get started in seconds =&amp;gt; &lt;a href=\&quot;https://workers.new/typescript\&quot;&gt;https://workers.new/typescript&lt;/a&gt; (&lt;a href=\&quot;https://workers.new/list\&quot;&gt;full list of StackBlitz supported templates&lt;/a&gt;)&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Dive into more Workers examples&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;a href=\&quot;https://developers.cloudflare.com/workers/examples/\&quot;&gt;https://developers.cloudflare.com/workers/examples/&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;a href=\&quot;https://github.com/cloudflare/templates\&quot;&gt;https://github.com/cloudflare/templates&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&quot;],&quot;published_at&quot;:[0,&quot;2022-08-05T16:45:57.000+01:00&quot;],&quot;updated_at&quot;:[0,&quot;2024-12-12T00:11:09.358Z&quot;],&quot;feature_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1C6waWfup8WNAxRhRzJENn/9261d6f38b5106a6e244dec46776fc44/building-scheduling-system-with-workers-and-durable-objects.png&quot;],&quot;tags&quot;:[1,[[0,{&quot;id&quot;:[0,&quot;6hbkItfupogJP3aRDAq6v8&quot;],&quot;name&quot;:[0,&quot;Cloudflare Workers&quot;],&quot;slug&quot;:[0,&quot;workers&quot;]}],[0,{&quot;id&quot;:[0,&quot;5v2UZdTRX1Rw9akmhexnxs&quot;],&quot;name&quot;:[0,&quot;Durable Objects&quot;],&quot;slug&quot;:[0,&quot;durable-objects&quot;]}],[0,{&quot;id&quot;:[0,&quot;78aSAeMjGNmCuetQ7B4OgU&quot;],&quot;name&quot;:[0,&quot;JavaScript&quot;],&quot;slug&quot;:[0,&quot;javascript&quot;]}],[0,{&quot;id&quot;:[0,&quot;5cye1Bh5KxFh3pKSnX8Dsy&quot;],&quot;name&quot;:[0,&quot;Serverless&quot;],&quot;slug&quot;:[0,&quot;serverless&quot;]}],[0,{&quot;id&quot;:[0,&quot;3OPPjcK7cKutTdeAjpThfG&quot;],&quot;name&quot;:[0,&quot;Edge&quot;],&quot;slug&quot;:[0,&quot;edge&quot;]}],[0,{&quot;id&quot;:[0,&quot;3JAY3z7p7An94s6ScuSQPf&quot;],&quot;name&quot;:[0,&quot;Developer Platform&quot;],&quot;slug&quot;:[0,&quot;developer-platform&quot;]}],[0,{&quot;id&quot;:[0,&quot;4HIPcb68qM0e26fIxyfzwQ&quot;],&quot;name&quot;:[0,&quot;Developers&quot;],&quot;slug&quot;:[0,&quot;developers&quot;]}]]],&quot;relatedTags&quot;:[0],&quot;authors&quot;:[1,[[0,{&quot;name&quot;:[0,&quot;Adam Janiš&quot;],&quot;slug&quot;:[0,&quot;adam-janis&quot;],&quot;bio&quot;:[0,&quot;Developer advocate on the Cloudflare Workers team.&quot;],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/34xEtqcDNnfW4O2wKNecjh/c8847863c1a36797577e5fb2bbcf85aa/adam-janis.png&quot;],&quot;location&quot;:[0,&quot;Lisbon&quot;],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,&quot;@adam_janis&quot;],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}]]],&quot;meta_description&quot;:[0,&quot;Building a scheduling system with Workers and Durable Objects&quot;],&quot;primary_author&quot;:[0,{}],&quot;localeList&quot;:[0,{&quot;name&quot;:[0,&quot;Building a scheduling system with Workers and Durable Objects Config&quot;],&quot;enUS&quot;:[0,&quot;English for Locale&quot;],&quot;zhCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhHansCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhTW&quot;:[0,&quot;No Page for Locale&quot;],&quot;frFR&quot;:[0,&quot;No Page for Locale&quot;],&quot;deDE&quot;:[0,&quot;No Page for Locale&quot;],&quot;itIT&quot;:[0,&quot;No Page for Locale&quot;],&quot;jaJP&quot;:[0,&quot;No Page for Locale&quot;],&quot;koKR&quot;:[0,&quot;No Page for Locale&quot;],&quot;ptBR&quot;:[0,&quot;No Page for Locale&quot;],&quot;esLA&quot;:[0,&quot;No Page for Locale&quot;],&quot;esES&quot;:[0,&quot;No Page for Locale&quot;],&quot;enAU&quot;:[0,&quot;No Page for Locale&quot;],&quot;enCA&quot;:[0,&quot;No Page for Locale&quot;],&quot;enIN&quot;:[0,&quot;No Page for Locale&quot;],&quot;enGB&quot;:[0,&quot;No Page for Locale&quot;],&quot;idID&quot;:[0,&quot;No Page for Locale&quot;],&quot;ruRU&quot;:[0,&quot;No Page for Locale&quot;],&quot;svSE&quot;:[0,&quot;No Page for Locale&quot;],&quot;viVN&quot;:[0,&quot;No Page for Locale&quot;],&quot;plPL&quot;:[0,&quot;No Page for Locale&quot;],&quot;arAR&quot;:[0,&quot;No Page for Locale&quot;],&quot;nlNL&quot;:[0,&quot;No Page for Locale&quot;],&quot;thTH&quot;:[0,&quot;No Page for Locale&quot;],&quot;trTR&quot;:[0,&quot;No Page for Locale&quot;],&quot;heIL&quot;:[0,&quot;No Page for Locale&quot;],&quot;lvLV&quot;:[0,&quot;No Page for Locale&quot;],&quot;etEE&quot;:[0,&quot;No Page for Locale&quot;],&quot;ltLT&quot;:[0,&quot;No Page for Locale&quot;]}],&quot;url&quot;:[0,&quot;https://blog.cloudflare.com/building-scheduling-system-with-workers-and-durable-objects&quot;],&quot;metadata&quot;:[0,{&quot;title&quot;:[0],&quot;description&quot;:[0],&quot;imgPreview&quot;:[0,&quot;&quot;]}],&quot;publicly_index&quot;:[0,true]}],[0,{&quot;id&quot;:[0,&quot;1Zfd75h9CmfNmx9UBTLqM3&quot;],&quot;title&quot;:[0,&quot;Announcing our Spring Developer Challenge&quot;],&quot;slug&quot;:[0,&quot;announcing-our-spring-developer-challenge&quot;],&quot;excerpt&quot;:[0,&quot;After many announcements from Platform Week, we’re thrilled to make one more: our Spring Developer Challenge!&quot;],&quot;featured&quot;:[0,false],&quot;html&quot;:[0,&quot;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/3dOPrJDKikS53YM3l8PhQA/dd266bc9aa39f3d4f8baacd5395b9dca/Screen-Shot-2022-05-10-at-11.45.54-AM-1.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1378\&quot; height=\&quot;730\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;After many announcements from Platform Week, we’re thrilled to make one more: our Spring Developer Challenge!&lt;/p&gt;&lt;p&gt;The theme for this challenge is building real-time, collaborative applications — one of the most exciting use-cases emerging in the Cloudflare ecosystem. This is an opportunity for developers to merge their ideas with our newly released features, earn recognition on our blog, and take home our best swag yet.&lt;/p&gt;&lt;p&gt;Here’s a list of our tools that will get you started:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;&lt;a href=\&quot;https://developers.cloudflare.com/workers\&quot;&gt;Workers&lt;/a&gt; can either be powerful middleware connecting your app to different APIs and an origin — or it can be the entire application itself. We recommend using &lt;a href=\&quot;https://github.com/lukeed/worktop\&quot;&gt;Worktop&lt;/a&gt;, a popular framework for Workers, if you need TypeScript support, routing, and well-organized submodules. Worktop can also &lt;a href=\&quot;https://github.com/lukeed/worktop/issues/147\&quot;&gt;complement&lt;/a&gt; your existing app even if it already uses a framework,  such as Svelte.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;a href=\&quot;https://developers.cloudflare.com/pages\&quot;&gt;Cloudflare Pages&lt;/a&gt; makes it incredibly easy to deploy sites, which you can make into truly dynamic apps by putting a Worker in front &lt;i&gt;or&lt;/i&gt; using the &lt;a href=\&quot;https://developers.cloudflare.com/pages\&quot;&gt;Pages Functions (beta)&lt;/a&gt;.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;a href=\&quot;https://developers.cloudflare.com/workers/learning/using-durable-objects/\&quot;&gt;Durable Objects&lt;/a&gt; are great for collaborative apps because you can use websockets while coordinating state at the edge, seen in this &lt;a href=\&quot;https://github.com/cloudflare/workers-chat-demo\&quot;&gt;chat demo&lt;/a&gt;. To help scale any load, we also recommend &lt;a href=\&quot;https://github.com/cloudflare/dog\&quot;&gt;Durable Object Groups&lt;/a&gt;.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;a href=\&quot;https://developers.cloudflare.com/workers/runtime-apis/kv/\&quot;&gt;Workers KV&lt;/a&gt; provides a global key-value data store that securely stores and quickly serves data across Cloudflare’s network. &lt;a href=\&quot;/r2-open-beta/\&quot;&gt;R2&lt;/a&gt; allows you to store enormous amounts of data without trapping you with costly egress services.&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;Last year, our &lt;a href=\&quot;/tag/developer-spotlight/\&quot;&gt;Developer Spotlight series&lt;/a&gt; highlighted how developers around the world built entire applications on Cloudflare. Our Discord server maintained that momentum with users demonstrating that &lt;a href=\&quot;https://discord.com/channels/595317990191398933/783765338692386886/964521676941455411\&quot;&gt;any type&lt;/a&gt; of application can be built. Need a way to organize thousands of lines of JSON? &lt;a href=\&quot;https://jsonhero.io/\&quot;&gt;JSON Hero&lt;/a&gt;, built with Remix and deployed with Workers, provides an incredibly readable UI for your JSON files. Trying to deploy a GraphQL server for your app that scales? &lt;a href=\&quot;https://github.com/launchport/helix-flare\&quot;&gt;helix-flare&lt;/a&gt; deploys a GraphQL server easily through Workers and uses Durable Objects to coordinate data.&lt;/p&gt;&lt;p&gt;We hope developers continue to explore the boundaries of what they can build on Cloudflare as our platform evolves. During our Summer Developer Challenge in 2021, we received over 1,200 submissions that revealed you can build almost any app imaginable with Workers, Pages, and the rest of the developer ecosystem. We sent out hundreds of swag boxes to participants, to show our appreciation. The ensuing unboxing videos on &lt;a href=\&quot;https://twitter.com/KukicAdo/status/1435356070067662849?s=20&amp;t=cPyF9ekfCyrL06Ucn5WO2w\&quot;&gt;Twitter&lt;/a&gt; and &lt;a href=\&quot;https://www.youtube.com/watch?v=TuYRhrnMUiQ\&quot;&gt;YouTube&lt;/a&gt; thrilled our team.&lt;/p&gt;&lt;p&gt;This year’s Spring Developer Challenge is all about making real-time, collaborative apps such as chat rooms, games, web-based editing tools, or anything else in your imagination! Here are the rules:&lt;/p&gt;&lt;p&gt;This year’s Spring Developer Challenge is all about making real-time, collaborative apps such as chat rooms, games, web-based editing tools, or anything else in your imagination! Here are the rules:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;You must be at least 18 years old to participate&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;You can work in teams of up to 10 people per submission&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;The deadline to submit your repo is May 24 June 7&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;Enter the challenge by going to &lt;a href=\&quot;https://challenge.developers.cloudflare.com\&quot;&gt;&lt;b&gt;this site&lt;/b&gt;&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;As you build your app, &lt;a href=\&quot;https://discord.gg/cloudflaredev\&quot;&gt;join our Discord&lt;/a&gt; if you or your team need any help. We will be enthusiastically reviewing submissions, promoting them on Twitter, and sending out swag boxes.&lt;/p&gt;&lt;p&gt;If you’re new to Cloudflare or have an exciting idea as a developer, this is your opportunity to see how far our platform has evolved and get rewarded for it!&lt;/p&gt;&quot;],&quot;published_at&quot;:[0,&quot;2022-05-17T13:58:47.000+01:00&quot;],&quot;updated_at&quot;:[0,&quot;2024-10-09T23:18:39.956Z&quot;],&quot;feature_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/67AXnR2X5JEYnDx6YLvMfS/e84b4849030a4013c05b716744de1952/announcing-our-spring-developer-challenge.png&quot;],&quot;tags&quot;:[1,[[0,{&quot;id&quot;:[0,&quot;4HIPcb68qM0e26fIxyfzwQ&quot;],&quot;name&quot;:[0,&quot;Developers&quot;],&quot;slug&quot;:[0,&quot;developers&quot;]}],[0,{&quot;id&quot;:[0,&quot;1VkRSlsXf1AYB3QvlWU1JK&quot;],&quot;name&quot;:[0,&quot;Platform Week&quot;],&quot;slug&quot;:[0,&quot;platform-week&quot;]}],[0,{&quot;id&quot;:[0,&quot;6hbkItfupogJP3aRDAq6v8&quot;],&quot;name&quot;:[0,&quot;Cloudflare Workers&quot;],&quot;slug&quot;:[0,&quot;workers&quot;]}],[0,{&quot;id&quot;:[0,&quot;5v2UZdTRX1Rw9akmhexnxs&quot;],&quot;name&quot;:[0,&quot;Durable Objects&quot;],&quot;slug&quot;:[0,&quot;durable-objects&quot;]}],[0,{&quot;id&quot;:[0,&quot;3kr4meEhp1NrKwm01XXeqk&quot;],&quot;name&quot;:[0,&quot;Cloudflare Pages&quot;],&quot;slug&quot;:[0,&quot;cloudflare-pages&quot;]}],[0,{&quot;id&quot;:[0,&quot;3JAY3z7p7An94s6ScuSQPf&quot;],&quot;name&quot;:[0,&quot;Developer Platform&quot;],&quot;slug&quot;:[0,&quot;developer-platform&quot;]}]]],&quot;relatedTags&quot;:[0],&quot;authors&quot;:[1,[[0,{&quot;name&quot;:[0,&quot;Albert Zhao&quot;],&quot;slug&quot;:[0,&quot;albert&quot;],&quot;bio&quot;:[0,null],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/6jLrtPQ1dDV67OCi5karLL/8812d4eb2405bf7337530a1f6a666cde/albert.jpg&quot;],&quot;location&quot;:[0,null],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,null],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}]]],&quot;meta_description&quot;:[0,&quot;After many announcements from Platform Week, we’re thrilled to make one more: our Spring Developer Challenge!&quot;],&quot;primary_author&quot;:[0,{}],&quot;localeList&quot;:[0,{&quot;name&quot;:[0,&quot;Announcing our Spring Developer Challenge Config&quot;],&quot;enUS&quot;:[0,&quot;English for Locale&quot;],&quot;zhCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhHansCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhTW&quot;:[0,&quot;No Page for Locale&quot;],&quot;frFR&quot;:[0,&quot;No Page for Locale&quot;],&quot;deDE&quot;:[0,&quot;No Page for Locale&quot;],&quot;itIT&quot;:[0,&quot;No Page for Locale&quot;],&quot;jaJP&quot;:[0,&quot;No Page for Locale&quot;],&quot;koKR&quot;:[0,&quot;No Page for Locale&quot;],&quot;ptBR&quot;:[0,&quot;No Page for Locale&quot;],&quot;esLA&quot;:[0,&quot;No Page for Locale&quot;],&quot;esES&quot;:[0,&quot;No Page for Locale&quot;],&quot;enAU&quot;:[0,&quot;No Page for Locale&quot;],&quot;enCA&quot;:[0,&quot;No Page for Locale&quot;],&quot;enIN&quot;:[0,&quot;No Page for Locale&quot;],&quot;enGB&quot;:[0,&quot;No Page for Locale&quot;],&quot;idID&quot;:[0,&quot;No Page for Locale&quot;],&quot;ruRU&quot;:[0,&quot;No Page for Locale&quot;],&quot;svSE&quot;:[0,&quot;No Page for Locale&quot;],&quot;viVN&quot;:[0,&quot;No Page for Locale&quot;],&quot;plPL&quot;:[0,&quot;No Page for Locale&quot;],&quot;arAR&quot;:[0,&quot;No Page for Locale&quot;],&quot;nlNL&quot;:[0,&quot;No Page for Locale&quot;],&quot;thTH&quot;:[0,&quot;No Page for Locale&quot;],&quot;trTR&quot;:[0,&quot;No Page for Locale&quot;],&quot;heIL&quot;:[0,&quot;No Page for Locale&quot;],&quot;lvLV&quot;:[0,&quot;No Page for Locale&quot;],&quot;etEE&quot;:[0,&quot;No Page for Locale&quot;],&quot;ltLT&quot;:[0,&quot;No Page for Locale&quot;]}],&quot;url&quot;:[0,&quot;https://blog.cloudflare.com/announcing-our-spring-developer-challenge&quot;],&quot;metadata&quot;:[0,{&quot;title&quot;:[0,&quot;Announcing our Spring Developer Challenge&quot;],&quot;description&quot;:[0,&quot;After many announcements from Platform Week, we’re thrilled to make one more: our Spring Developer Challenge!&quot;],&quot;imgPreview&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/4LgPq4jtAEHZakCwpBZ10/e64d7ed21ba692e9da8e335f574fe689/announcing-our-spring-developer-challenge-tuvWhL.png&quot;]}],&quot;publicly_index&quot;:[0,true]}],[0,{&quot;id&quot;:[0,&quot;5FKrh4z1ggyDYSTMgbDku6&quot;],&quot;title&quot;:[0,&quot;Durable Objects Alarms — a wake-up call for your applications&quot;],&quot;slug&quot;:[0,&quot;durable-objects-alarms&quot;],&quot;excerpt&quot;:[0,&quot;Durable Object alarms let you call a function at a defined point in the future, unlocking deeper use-cases for Durable Objects like reliable queuing&quot;],&quot;featured&quot;:[0,false],&quot;html&quot;:[0,&quot;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/6KBFsrZapTGmQH28QipBma/63f1d01e83bdbd38691ff4dab61128c9/Durable-Object-Alarms.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1200\&quot; height=\&quot;675\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;Since we launched Durable Objects, developers have leveraged them as a novel building block for distributed applications.&lt;/p&gt;&lt;p&gt;Durable Objects provide globally unique instances of a JavaScript class a developer writes, accessed via a unique ID. The Durable Object associated with each ID implements some fundamental component of an application — a banking application might have a Durable Object representing each bank account, for example. The bank account object would then expose methods for incrementing a balance, transferring money or any other actions that the application needs to do on the bank account.&lt;/p&gt;&lt;p&gt;Durable Objects work well as a stateful backend for applications — while Workers can instantiate a new instance of your code in any of Cloudflare’s data centers in response to a request, Durable Objects guarantee that all requests for a given Durable Object will reach the same instance on Cloudflare’s network.&lt;/p&gt;&lt;p&gt;Each Durable Object is single-threaded and has access to a stateful storage API, making it easy to build consistent and highly-available distributed applications on top of them.&lt;/p&gt;&lt;p&gt;This system makes distributed systems’ development easier — we’ve seen some impressive applications launched atop Durable Objects, from collaborative whiteboarding tools to conflict-free replicated data type (CRDT) systems for coordinating distributed state launch.&lt;/p&gt;&lt;p&gt;However, up until now, there’s been a piece missing — how do you invoke a Durable Object when a client Worker is not making requests to it?&lt;/p&gt;&lt;p&gt;As with any distributed system, Durable Objects can become unavailable and stop running. Perhaps the machine you were running on was unplugged, or the datacenter burned down and is never coming back, or an individual object exceeded its memory limit and was reset. Before today, a subsequent request would reinitialize the Durable Object on another machine, but there was no way to programmatically wake up an Object.&lt;/p&gt;&lt;p&gt;Durable Objects Alarms are here to change that, unlocking new use cases for Durable Objects like queues and deferred processing.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;what-is-a-durable-object-alarm\&quot;&gt;What is a Durable Object Alarm?&lt;/h3&gt;\n            &lt;a href=\&quot;#what-is-a-durable-object-alarm\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Durable Object Alarms allow you, from within your Durable Object, to schedule the object to be woken up at a time in the future. When the alarm’s scheduled time comes, the Durable Object’s &lt;code&gt;alarm()&lt;/code&gt; handler will be called. If this handler throws an exception, the alarm will be automatically retried using exponential backoff until it succeeds — alarms have guaranteed at-least-once execution.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;how-are-alarms-different-from-workers-cron-triggers\&quot;&gt;How are Alarms different from Workers Cron Triggers?&lt;/h3&gt;\n            &lt;a href=\&quot;#how-are-alarms-different-from-workers-cron-triggers\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Alarms are more fine-grained than Cron Triggers. While a Workers service can have up to three Cron Triggers configured at once, it can have an unlimited amount of Durable Objects, each of which can have a single alarm active at a time.&lt;/p&gt;&lt;p&gt;Alarms are directly scheduled from and invoke a function within your Durable Object. Cron Triggers, on the other hand, are not programmatic — they execute based on their schedules, which have to be configured via the Cloudflare Dashboard or centralized configuration APIs.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;how-do-i-use-alarms\&quot;&gt;How do I use Alarms?&lt;/h3&gt;\n            &lt;a href=\&quot;#how-do-i-use-alarms\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;First, you’ll need to add the &lt;code&gt;durable_object_alarms&lt;/code&gt; compatibility flag to your &lt;code&gt;wrangler.toml&lt;/code&gt;.&lt;/p&gt;\n            &lt;pre class=\&quot;language-toml\&quot;&gt;&lt;code class=\&quot;language-toml\&quot;&gt;compatibility_flags = [&amp;quot;durable_object_alarms&amp;quot;]&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;Next, implement an &lt;code&gt;alarm()&lt;/code&gt; handler in your Durable Object that will be called when the alarm executes. From anywhere else in your Durable Object, call &lt;code&gt;state.storage.setAlarm()&lt;/code&gt; and pass in a time for the alarm to run at. You can use &lt;code&gt;state.storage.getAlarm()&lt;/code&gt; to retrieve the currently set alarm time.&lt;/p&gt;&lt;p&gt;In this example, we implemented an alarm handler that wakes the Durable Object up once every 10 seconds to batch requests to a single Durable Object, deferring processing until there is enough work in the queue for it to be worthwhile to process them.&lt;/p&gt;\n            &lt;pre class=\&quot;language-js\&quot;&gt;&lt;code class=\&quot;language-js\&quot;&gt;export default {\n  async fetch(request, env) {\n    let id = env.BATCHER.idFromName(&amp;quot;foo&amp;quot;);\n    return await env.BATCHER.get(id).fetch(request);\n  },\n};\n\nconst SECONDS = 1000;\n\nexport class Batcher {\n  constructor(state, env) {\n    this.state = state;\n    this.storage = state.storage;\n    this.state.blockConcurrencyWhile(async () =&amp;gt; {\n      let vals = await this.storage.list({ reverse: true, limit: 1 });\n      this.count = vals.size == 0 ? 0 : parseInt(vals.keys().next().value);\n    });\n  }\n  async fetch(request) {\n    this.count++;\n\n    // If there is no alarm currently set, set one for 10 seconds from now\n    // Any further POSTs in the next 10 seconds will be part of this kh.\n    let currentAlarm = await this.storage.getAlarm();\n    if (currentAlarm == null) {\n      this.storage.setAlarm(Date.now() + 10 * SECONDS);\n    }\n\n    // Add the request to the batch.\n    await this.storage.put(this.count, await request.text());\n    return new Response(JSON.stringify({ queued: this.count }), {\n      headers: {\n        &amp;quot;content-type&amp;quot;: &amp;quot;application/json;charset=UTF-8&amp;quot;,\n      },\n    });\n  }\n  async alarm() {\n    let vals = await this.storage.list();\n    await fetch(&amp;quot;http://example.com/some-upstream-service&amp;quot;, {\n      method: &amp;quot;POST&amp;quot;,\n      body: Array.from(vals.values()),\n    });\n    await this.storage.deleteAll();\n    this.count = 0;\n  }\n}&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;Once every 10 seconds, the &lt;code&gt;alarm()&lt;/code&gt; handler will be called. In the event an unexpected error terminates the Durable Object, it will be re-instantiated on another machine, following a short delay, after which it can continue processing.&lt;/p&gt;&lt;p&gt;Under the hood, Alarms are implemented by making reads and writes to the storage layer. This means Alarm &lt;code&gt;get&lt;/code&gt; and &lt;code&gt;set&lt;/code&gt; operations follow the same rules as any other storage operation – writes are coalesced with other writes, and reads have a defined ordering. See &lt;a href=\&quot;/durable-objects-easy-fast-correct-choose-three/\&quot;&gt;our blog post&lt;/a&gt; on the caching layer we implemented for Durable Objects for more information.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;durable-objects-alarms-guarantee-fault-tolerance\&quot;&gt;Durable Objects Alarms guarantee fault-tolerance&lt;/h3&gt;\n            &lt;a href=\&quot;#durable-objects-alarms-guarantee-fault-tolerance\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Alarms are designed to have no single point of failure and to run entirely on our edge – every Cloudflare data center running Durable Objects is capable of running alarms, including migrating Durable Objects from unhealthy data centers to healthy ones as necessary to ensure that their Alarm executes. Single failures should resolve in under 30 seconds, while multiple failures may take slightly longer.&lt;/p&gt;&lt;p&gt;We achieve this by storing alarms in the same distributed datastore that backs the Durable Object storage API. This allows alarm reads and writes to behave identically to storage reads and writes and to be performed atomically with them, and ensures that alarms are replicated across multiple datacenters.&lt;/p&gt;&lt;p&gt;Within each data center capable of running Durable Objects, there are multiple processes responsible for tracking upcoming alarms and triggering them, providing fault tolerance and scalability within the data center. A single elected leader in each data center is responsible for detecting failure of other data centers and assigning responsibility of those alarms to healthy local processes in its own data center. In the event of leader failure, another leader will be elected and become responsible for executing Alarms in the data center. This allows us to guarantee at-least-once execution for all Alarms.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;how-do-i-get-started\&quot;&gt;How do I get started?&lt;/h3&gt;\n            &lt;a href=\&quot;#how-do-i-get-started\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Alarms are a great way to build new distributed primitives, like queues, atop Durable Objects. They also provide a method for guaranteeing work within a Durable Object will complete, without relying on a client request to “kick” the Object.&lt;/p&gt;&lt;p&gt;You can get started with Alarms now by enabling Durable Objects in the Cloudflare &lt;a href=\&quot;https://dash.cloudflare.com/\&quot;&gt;dashboard&lt;/a&gt;. For more info, check the developer docs or jump in our Discord.&lt;/p&gt;&quot;],&quot;published_at&quot;:[0,&quot;2022-05-11T13:59:17.000+01:00&quot;],&quot;updated_at&quot;:[0,&quot;2024-10-09T23:18:23.764Z&quot;],&quot;feature_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/dzYi0K2y2hCkxjJCNgYiH/c2ebbf54f6a1bfb884725a0cbacc576e/durable-objects-alarms.png&quot;],&quot;tags&quot;:[1,[[0,{&quot;id&quot;:[0,&quot;1VkRSlsXf1AYB3QvlWU1JK&quot;],&quot;name&quot;:[0,&quot;Platform Week&quot;],&quot;slug&quot;:[0,&quot;platform-week&quot;]}],[0,{&quot;id&quot;:[0,&quot;5v2UZdTRX1Rw9akmhexnxs&quot;],&quot;name&quot;:[0,&quot;Durable Objects&quot;],&quot;slug&quot;:[0,&quot;durable-objects&quot;]}],[0,{&quot;id&quot;:[0,&quot;6QktrXeEFcl4e2dZUTZVGl&quot;],&quot;name&quot;:[0,&quot;Product News&quot;],&quot;slug&quot;:[0,&quot;product-news&quot;]}],[0,{&quot;id&quot;:[0,&quot;5cye1Bh5KxFh3pKSnX8Dsy&quot;],&quot;name&quot;:[0,&quot;Serverless&quot;],&quot;slug&quot;:[0,&quot;serverless&quot;]}],[0,{&quot;id&quot;:[0,&quot;6hbkItfupogJP3aRDAq6v8&quot;],&quot;name&quot;:[0,&quot;Cloudflare Workers&quot;],&quot;slug&quot;:[0,&quot;workers&quot;]}],[0,{&quot;id&quot;:[0,&quot;6cjyAFDpR8zwR4Ylx8wKYu&quot;],&quot;name&quot;:[0,&quot;Notifications&quot;],&quot;slug&quot;:[0,&quot;notifications&quot;]}],[0,{&quot;id&quot;:[0,&quot;4HIPcb68qM0e26fIxyfzwQ&quot;],&quot;name&quot;:[0,&quot;Developers&quot;],&quot;slug&quot;:[0,&quot;developers&quot;]}],[0,{&quot;id&quot;:[0,&quot;3JAY3z7p7An94s6ScuSQPf&quot;],&quot;name&quot;:[0,&quot;Developer Platform&quot;],&quot;slug&quot;:[0,&quot;developer-platform&quot;]}]]],&quot;relatedTags&quot;:[0],&quot;authors&quot;:[1,[[0,{&quot;name&quot;:[0,&quot;Matt Alonso&quot;],&quot;slug&quot;:[0,&quot;matt-alonso&quot;],&quot;bio&quot;:[0,null],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/28IQWzENpxkBKoy5vIJWKu/7007f9f38e561e6e090b6da32295d0de/IMG_1945.png&quot;],&quot;location&quot;:[0,null],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,null],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}],[0,{&quot;name&quot;:[0,&quot;Greg McKeon&quot;],&quot;slug&quot;:[0,&quot;greg&quot;],&quot;bio&quot;:[0,null],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/6eXlcFixG7Tc7SoBGH2Cjr/243f54f33f488392c302ee00931ac9d0/greg.png&quot;],&quot;location&quot;:[0,null],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,&quot;@wegmckeon&quot;],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}]]],&quot;meta_description&quot;:[0,&quot;Durable Object alarms let you call a function at a defined point in the future, unlocking deeper use-cases for Durable Objects like reliable queuing.&quot;],&quot;primary_author&quot;:[0,{}],&quot;localeList&quot;:[0,{&quot;name&quot;:[0,&quot;Durable Objects Alarms — a wake-up call for your applications Config&quot;],&quot;enUS&quot;:[0,&quot;English for Locale&quot;],&quot;zhCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhHansCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhTW&quot;:[0,&quot;No Page for Locale&quot;],&quot;frFR&quot;:[0,&quot;No Page for Locale&quot;],&quot;deDE&quot;:[0,&quot;No Page for Locale&quot;],&quot;itIT&quot;:[0,&quot;No Page for Locale&quot;],&quot;jaJP&quot;:[0,&quot;No Page for Locale&quot;],&quot;koKR&quot;:[0,&quot;No Page for Locale&quot;],&quot;ptBR&quot;:[0,&quot;No Page for Locale&quot;],&quot;esLA&quot;:[0,&quot;No Page for Locale&quot;],&quot;esES&quot;:[0,&quot;No Page for Locale&quot;],&quot;enAU&quot;:[0,&quot;No Page for Locale&quot;],&quot;enCA&quot;:[0,&quot;No Page for Locale&quot;],&quot;enIN&quot;:[0,&quot;No Page for Locale&quot;],&quot;enGB&quot;:[0,&quot;No Page for Locale&quot;],&quot;idID&quot;:[0,&quot;No Page for Locale&quot;],&quot;ruRU&quot;:[0,&quot;No Page for Locale&quot;],&quot;svSE&quot;:[0,&quot;No Page for Locale&quot;],&quot;viVN&quot;:[0,&quot;No Page for Locale&quot;],&quot;plPL&quot;:[0,&quot;No Page for Locale&quot;],&quot;arAR&quot;:[0,&quot;No Page for Locale&quot;],&quot;nlNL&quot;:[0,&quot;No Page for Locale&quot;],&quot;thTH&quot;:[0,&quot;No Page for Locale&quot;],&quot;trTR&quot;:[0,&quot;No Page for Locale&quot;],&quot;heIL&quot;:[0,&quot;No Page for Locale&quot;],&quot;lvLV&quot;:[0,&quot;No Page for Locale&quot;],&quot;etEE&quot;:[0,&quot;No Page for Locale&quot;],&quot;ltLT&quot;:[0,&quot;No Page for Locale&quot;]}],&quot;url&quot;:[0,&quot;https://blog.cloudflare.com/durable-objects-alarms&quot;],&quot;metadata&quot;:[0,{&quot;title&quot;:[0,&quot;Durable Objects Alarms — a wake-up call for your applications&quot;],&quot;description&quot;:[0,&quot;Durable Object alarms let you call a function at a defined point in the future, unlocking deeper use-cases for Durable Objects like reliable queuing.&quot;],&quot;imgPreview&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/3H5O1KP3i8djuDxCIXWX2I/f3adfed57a8faf974d4a48f055a1bc2a/durable-objects-alarms-vdznQW.png&quot;]}],&quot;publicly_index&quot;:[0,true]}],[0,{&quot;id&quot;:[0,&quot;6Wem9UEIPhVV2YuN0Wt3im&quot;],&quot;title&quot;:[0,&quot;Developer Spotlight: Winning a Game Jam with Jamstack and Durable Objects&quot;],&quot;slug&quot;:[0,&quot;developer-spotlight-guido-zuidhof-full-tilt&quot;],&quot;excerpt&quot;:[0,&quot;Guido won the innovative category in one of the biggest Game Jams with a combination of Pages, Durable Objects, modern browser APIs, and a hefty amount of ingenuity.&quot;],&quot;featured&quot;:[0,false],&quot;html&quot;:[0,&quot;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1qjqyB8jOeHueIIWsBxcHg/4e6f8f3b597f874f33ebd8f4cbdce67c/image1-18.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1800\&quot; height=\&quot;1012\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;Welcome to a new blog post series called Developer Spotlight. In this series we will be showcasing interesting applications built on top of the Cloudflare Workers Ecosystem.&lt;/p&gt;&lt;p&gt;And to celebrate &lt;a href=\&quot;/durable-objects-ga/\&quot;&gt;Durable Objects going GA&lt;/a&gt;, what better to kick off the series than with a really cool tech demo of Durable Objects called Full Tilt?&lt;/p&gt;&lt;p&gt;Full Tilt by &lt;a href=\&quot;https://github.com/gzuidhof\&quot;&gt;Guido Zuidhof&lt;/a&gt; is a game jam entry for Ludum Dare, one of the biggest and oldest game jams around, where he won first place in the innovation category. A game jam is like a hackathon for games, where you have a very short amount of time (usually 48-72 hours) to create a game from scratch.&lt;/p&gt;&lt;p&gt;We love Full Tilt, not just because Guido used Workers and Durable Objects to build a cool game where you control a game on your computer via your phone, but especially because it shows how powerful Durable Objects are. In less than 48 hours Guido was able to write all the logic to instantly spin up a personal gaming server anywhere in the world, as close to that player as possible. And it is so fast that you feel like you are controlling the computer directly.&lt;/p&gt;&lt;p&gt;But here is Guido, to tell you about his experience developing Full Tilt.&lt;/p&gt;&lt;!--kg-card-begin: html--&gt;&lt;div style=\&quot;position: relative; padding-top: 76.28865979381443%;\&quot;&gt;&lt;iframe src=\&quot;https://iframe.videodelivery.net/9443c301ad57eb58d2068b3db7bb9bec?preload=true\&quot; style=\&quot;border: none; position: absolute; top: 0; left: 0; height: 100%; width: 100%;\&quot;  allow=\&quot;accelerometer; gyroscope; autoplay; encrypted-media; picture-in-picture;\&quot; allowfullscreen=\&quot;true\&quot;&gt;&lt;/iframe&gt;&lt;/div&gt;&lt;!--kg-card-end: html--&gt;&lt;p&gt;Last October I participated in the Ludum Dare 49 game jam. The thing I love about game jams is that the time constraint forces you to work quickly, iterate often, and most importantly cut scope.&lt;/p&gt;&lt;p&gt;In this game jam I created &lt;a href=\&quot;https://ldjam.com/events/ludum-dare/49/full-tilt\&quot;&gt;Full Tilt&lt;/a&gt;, a game in which you seamlessly use your phone as a Wiimote-like motion controller for a game that is run on your laptop in a web browser. The secret sauce to making it so smooth was in combining a game jam with Jamstack and mixing in some Durable Objects.&lt;/p&gt;&lt;p&gt;You can try the game &lt;a href=\&quot;https://ld49.pages.dev\&quot;&gt;right here&lt;/a&gt;.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;phone-as-a-controller\&quot;&gt;Phone as a controller&lt;/h3&gt;\n            &lt;a href=\&quot;#phone-as-a-controller\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Full Tilt is a browser game in which you move the player character by moving your hand around. There are a few different ways we can do that. One idea would be to use your computer&amp;#39;s webcam to track a marker object through 3D space. While that is possible, it is tricky to get it working in any situation (a dark room can be problematic!) and also some players may feel uncomfortable turning on their webcam for a simple web game.&lt;/p&gt;&lt;p&gt;A smartphone has a bunch of sensors built in, including a magnetometer and gyroscope — those sensors are exactly what we need, and we can assume that the majority of our potential players have a smartphone within arm&amp;#39;s reach. When a native mobile application uses these sensors, it adds a lot of friction (users now have to install an app), as well as a bunch of implementation work. Fortunately modern web browsers allow you to read from these sensors through the &lt;a href=\&quot;https://developer.mozilla.org/en-US/docs/Web/API/DeviceMotionEvent\&quot;&gt;DeviceMotion API&lt;/a&gt;: a small web app will do the job perfectly!&lt;/p&gt;&lt;p&gt;The next challenge is communicating the sensor readings from the phone to the game running on the main computer. For that we will use a combination of Cloudflare Workers and Durable Objects. There needs to be some shared contact (i.e., a game server) that both the main computer and the smartphone talk to. Using a serverless solution makes a lot of sense for a web game. And as we only have 48 hours here, less stuff to worry about is a big selling point too. Workers and Durable Objects also make it easy to keep the game running after the game jam, without having to pay for — and more importantly worry about — keeping servers running.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;setting-up-a-line-of-communication\&quot;&gt;Setting up a line of communication&lt;/h3&gt;\n            &lt;a href=\&quot;#setting-up-a-line-of-communication\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;There are roughly two ways for browsers to communicate: through a shared connection (a game server somewhere) or a peer to peer connection, so browsers can talk directly to each other without a middleman by leveraging &lt;a href=\&quot;https://webrtc.org/\&quot;&gt;WebRTC&lt;/a&gt; DataChannels.&lt;/p&gt;&lt;p&gt;WebRTC can be very challenging to make reliable and may still need a proxy server for some especially problematic network setups behind multiple NATs. Setting up a WebRTC connection may have been the perfect solution for the lowest possible latency, but it was out of scope for such a short game jam.&lt;/p&gt;&lt;p&gt;The game we are creating has low latency requirements, when I tilt my phone the game should respond quickly. We can probably get away with anything under 100ms, although low double digits or less is definitely preferred! If I&amp;#39;m geographically located in one place and the game server is geographically close enough, then this game server will be able to pass messages from my smartphone to my laptop without too much delay. Edge computing is hot nowadays, and for this gaming use case it is not just a nice-to-have but also a necessity.&lt;/p&gt;&lt;p&gt;Enough background, let&amp;#39;s architect the system.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;on-demand-game-rooms\&quot;&gt;On-demand game rooms&lt;/h3&gt;\n            &lt;a href=\&quot;#on-demand-game-rooms\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;The first thing I needed to set up was game rooms. Something that both the phone and the computer browsers could connect to, so they can pass messages between them.&lt;/p&gt;&lt;p&gt;Durable Objects allow us to create a large amount of small stateful &amp;quot;mini servers&amp;quot; or &amp;quot;rooms&amp;quot; that multiple clients can connect to simultaneously over WebSockets, providing perfect small on-demand game servers. Think of Durable Objects as a single thread of Javascript that runs in a data center close to where the user first asked for it to be created.&lt;/p&gt;&lt;p&gt;After the browser on the computer starts the game, it asks our Cloudflare Worker API to create a room for the current game session. This API request is a simple POST request, the server responds with a four character room code that uniquely identifies the room that was created. The reason we want the room code to be short is because the user may need to copy this code and type it into their smartphone if they are unable to scan a QR code.&lt;/p&gt;&lt;p&gt;Humans are notoriously bad at copying random character strings as different characters look alike, so we use a limited character set that excludes the most commonly confused characters:&lt;/p&gt;\n            &lt;pre class=\&quot;language-javascript\&quot;&gt;&lt;code class=\&quot;language-javascript\&quot;&gt;const DICTIONARY = &amp;quot;2345679ADEFGHJKLMNPQRSTUVWXYZ&amp;quot;; // 29 chars (no 0, O, I, 1, B, 8)&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;A four character code will allow us to uniquely point to ~700,000 different rooms, that seems like it would be enough even if our game got quite popular! What&amp;#39;s more: these game sessions don&amp;#39;t last forever. After some period of time (say 24 hours) we can be certain enough that the game session has ended, and we can re-use that room code.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;room-code-coordination\&quot;&gt;Room code coordination&lt;/h3&gt;\n            &lt;a href=\&quot;#room-code-coordination\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;In your Cloudflare Worker script, there are two ways to create a Durable Object: either we ask for one to be created with an ID generated from a name, or we ask for one to be created with a random unique ID. The naive solution would be to create a Durable Object with an ID generated from the room code. However, that is not a good idea here because a Durable Object gets created in a data center that is geographically close to the end user.&lt;/p&gt;&lt;p&gt;A problematic situation would be if a user in Mumbai requests a room and gets room code ABCD. Initially, they play the game for a bit, and it works great.&lt;/p&gt;&lt;p&gt;The issue comes a week later when that room code is reused for another player based in Los Angeles, The game room Durable Object will be revived in Mumbai and latency will be awful for our Los Angeles player. In the future, Durable Objects may get migrated between data centers, but that&amp;#39;s not yet guaranteed.&lt;/p&gt;&lt;p&gt;Instead, what we can do is create a new Durable Object with a random ID for every new game session and keep a mapping from the four character room code to this random ID. We are introducing some state in our system: we will need a central source of truth which is where Durable Objects can come to the rescue again.&lt;/p&gt;&lt;p&gt;We will solve this by creating a single &amp;quot;Room Hub&amp;quot; Durable Object that keeps track of this mapping from room code to Durable Object ID. This Durable Object will have two endpoints, one to request a new room and another to look up a room&amp;#39;s information.&lt;/p&gt;&lt;p&gt;Here&amp;#39;s our request handler for the Room Request endpoint (the argument is a &lt;a href=\&quot;https://sunderjs.com/docs/context\&quot;&gt;Sunder Context&lt;/a&gt;, Sunder is the web framework I used for this project):&lt;/p&gt;\n            &lt;pre class=\&quot;language-typescript\&quot;&gt;&lt;code class=\&quot;language-typescript\&quot;&gt;export async function handleRoomRequest(ctx: Context&amp;lt;Env&amp;gt;) {\n    const now = Date.now();    \n    const reqBody = await ctx.request.json();\n\n    // We make some attempts to find a room that is available..\n    const attempts = 5\n\n    let roomCode: string;\n    let roomStorageKey: string;\n\n    for (let i = 0; i &amp;lt; attempts; i++) {\n        roomCode = generateRoomCode();\n        roomStorageKey = ROOM_STATE_PREFIX + roomCode;\n        const room = await ctx.state.storage.get&amp;lt;RoomData&amp;gt;(roomStorageKey);\n        if (room === undefined) {\n            break;\n        } else if (now - room.createdAt &amp;gt; MAX_ROOM_AGE) {\n            await ctx.state.storage.delete(roomStorageKey);\n            break;\n        }\n        if (i === attempts-1) {\n            return ctx.throw(&amp;quot;Couldn&amp;#039;t find available room code :(&amp;quot;);\n        }\n    }\n\n    const roomData: RoomData = {\n        roomCode: roomCode,\n        durableObjectId: reqBody.durableObjectId,\n        createdAt: now,\n    }\n\n    await ctx.state.storage.put&amp;lt;RoomData&amp;gt;(roomStorageKey, roomData);\n\n    ctx.response.body = {\n        room: roomData\n    };\n    ctx.response.status = HttpStatus.Created;\n}&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;In a nutshell, we generate a few room codes until we find one that has never been used or hasn&amp;#39;t been used in a long enough time.&lt;/p&gt;&lt;p&gt;There is a subtle but important nuance in this code: the Durable Object gets created in the Cloudflare Worker that talks to our Room Hub, not in the Room Hub itself. Our Room Hub will run in a single data center somewhere on Cloudflare&amp;#39;s network. If we create the game room from there it may still be far away from our end user!&lt;/p&gt;&lt;p&gt;Looking up a room&amp;#39;s information is simpler, we return either the room data or status 404.&lt;/p&gt;\n            &lt;pre class=\&quot;language-typescript\&quot;&gt;&lt;code class=\&quot;language-typescript\&quot;&gt;export async function handleRoomLookup(ctx: Context&amp;lt;Env, {roomCode: string}&amp;gt;) {\n    const now = Date.now();\n\n    let roomStorageKey = ROOM_STATE_PREFIX + ctx.params.roomCode;\n    const roomData = await ctx.state.storage.get&amp;lt;RoomData&amp;gt;(roomStorageKey);\n\n    if (roomData === undefined) {\n        ctx.throw(404, &amp;quot;Room not found&amp;quot;);\n        return;\n    }\n\n    if (now - roomData.createdAt &amp;gt; MAX_ROOM_AGE) {\n        // About time we cleaned it up.\n        await ctx.state.storage.delete(roomStorageKey);\n        ctx.response.status = HttpStatus.NotFound;\n        return;\n    }\n\n    ctx.response.body = {\n        room: roomData\n    };\n}&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;The smartphone browser needs to connect to that same room. To make things easy for the user we generate a four character room code which points at that specific &amp;quot;Game Room&amp;quot; Durable Object. This way the user can take their smartphone, navigate to the website address &lt;code&gt;https://ld49.pages.dev&lt;/code&gt;, and enter the code &amp;quot;ABCD&amp;quot; (or more commonly, they scan a QR code with the link &lt;code&gt;https://ld49.pages.dev?room=ABCD&lt;/code&gt;).&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;game-room-durable-object\&quot;&gt;Game Room Durable Object&lt;/h3&gt;\n            &lt;a href=\&quot;#game-room-durable-object\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Our game room Durable Object can be pretty simple since it is only responsible for passing along messages from the smartphone to the laptop with the latest sensor readings. I was able to modify the &lt;a href=\&quot;https://github.com/cloudflare/workers-chat-demo\&quot;&gt;Durable Objects chat room example&lt;/a&gt; to do exactly this — a good time saver for a game jam!&lt;/p&gt;&lt;p&gt;When a browser connects, they either connect as a &amp;quot;peer&amp;quot; or as a &amp;quot;host&amp;quot; role. Any messages sent by peers are forwarded to the host, and all messages from the host get forwarded to all peers. In this case, our host is the laptop browser running the game and the peer is the smartphone controller. Implementation-wise this means that we keep two lists of users: the peers and the hosts. Whenever a message comes in, we loop over the list to broadcast it to all connections of the other role. In practice, &lt;a href=\&quot;https://github.com/gzuidhof/LD49/blob/master/beamerserver/src/durableObjects/room/handler.ts\&quot;&gt;the code&lt;/a&gt; is a bit more involved to deal with users disconnecting.&lt;/p&gt;&lt;p&gt;Full Tilt is a singleplayer game, but adapting it to be a multiplayer game would be easy with this setup. Imagine a Mario Kart-like game that runs in your browser in which multiple friends can join using their smartphones as their steering wheel controller! Unfortunately there was not enough time in this game jam to make a polished game.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;front-end\&quot;&gt;Front end&lt;/h3&gt;\n            &lt;a href=\&quot;#front-end\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;With the backend ready, we still need to create the actual game and the controller web app.&lt;/p&gt;&lt;p&gt;My initial plan was to create a game in which you fly a 3D plane by tilting your phone, collecting stars and completing aerobatic tricks. It would fit the theme &amp;quot;Unstable&amp;quot; as I expected this control method to be pretty flimsy! Since there was no time left to create anything close to that, it was time to cut scope.&lt;/p&gt;&lt;p&gt;I ended up using the Phaser game engine and put the entire system together in a Svelte app.   This was certainly a challenge, as I had only used Phaser once before many years ago and had never used Svelte. Luckily, I was able to put together something simple quickly enough: a snake-like game in which you move a thingy to collect blips that appear randomly on the screen.&lt;/p&gt;&lt;p&gt;In order for a game to be a game there needs to be some goal for the user, usually some game over condition. I changed the game to go faster and faster over time, added a score counter, and added a game over condition where you lose the game if you touch the edge of the screen. I made my &amp;quot;art&amp;quot; in MS Paint, generated some sound effects using the online tool &lt;a href=\&quot;https://sfxr.me/\&quot;&gt;sfxr&lt;/a&gt;, and &amp;quot;composed&amp;quot; the music soundtrack in &lt;a href=\&quot;https://musiclab.chromeexperiments.com/Song-Maker\&quot;&gt;Chrome&amp;#39;s Music Lab Song Maker&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;Simultaneously I wrote a small client for my game server and duct-taped together the &lt;a href=\&quot;https://github.com/gzuidhof/LD49/blob/master/beamer-gamepad/src/components/Rotato.svelte\&quot;&gt;smartphone controller app&lt;/a&gt; which is powered by the browser&amp;#39;s DeviceMotion APIs. To distribute my game I used Cloudflare Pages, which worked like a charm the first time.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;all-done\&quot;&gt;All done&lt;/h3&gt;\n            &lt;a href=\&quot;#all-done\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;And then the deadline was there — I barely made it, but I submitted something I was proud of. A not-so-great game, but with an interesting backend system and a novel input method. Do try the game yourself &lt;a href=\&quot;https://ld49.pages.dev\&quot;&gt;here&lt;/a&gt;, and the source code is available &lt;a href=\&quot;https://github.com/gzuidhof/LD49\&quot;&gt;here&lt;/a&gt; (&lt;b&gt;warning&lt;/b&gt;: it&amp;#39;s pretty hacky code of course!).&lt;/p&gt;&lt;p&gt;The reception of my co-jammers was great. While everybody agreed the game itself and its graphics were awful, it was novel. The game ended up rated first in the *Innovation* category for this game jam, out of hundreds of other games!&lt;/p&gt;&lt;p&gt;Finally, is this the future of game servers? For indie developers and smaller studios, setting up and maintaining a globally distributed fleet of game servers is both a huge distraction and cost. Serverless and in particular Durable Objects can provide an amazing solution.&lt;/p&gt;&lt;p&gt;But not every game is well-suited for a WebSocket-based backend. In some real-time games you are not interested in what happened a second ago and only the latest information matters. This is where the reliable and ordered nature of WebSockets can get in the way.&lt;/p&gt;&lt;p&gt;All in all my first impressions of Durable Objects are very positive, it is a great tool to have in your toolbelt for all kinds of web projects. You can now tackle problems that would otherwise take days in mere minutes. I am very excited to see what other problems will be made easy by Durable Objects, even those I haven’t even thought of yet.&lt;/p&gt;&quot;],&quot;published_at&quot;:[0,&quot;2021-11-15T13:59:19.000+00:00&quot;],&quot;updated_at&quot;:[0,&quot;2024-10-09T23:16:04.737Z&quot;],&quot;feature_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/4QTAfktOzVC33pQxt1UsAm/b6dfdde85edb3fdc1edd7722c956bb30/developer-spotlight-guido-zuidhof-full-tilt.png&quot;],&quot;tags&quot;:[1,[[0,{&quot;id&quot;:[0,&quot;4Q1oXZOskZczYetWpWXIsl&quot;],&quot;name&quot;:[0,&quot;Full Stack Week&quot;],&quot;slug&quot;:[0,&quot;full-stack-week&quot;]}],[0,{&quot;id&quot;:[0,&quot;4w8BOMHBFRf9MVpjjfaTwL&quot;],&quot;name&quot;:[0,&quot;Developer Spotlight&quot;],&quot;slug&quot;:[0,&quot;developer-spotlight&quot;]}],[0,{&quot;id&quot;:[0,&quot;6hbkItfupogJP3aRDAq6v8&quot;],&quot;name&quot;:[0,&quot;Cloudflare Workers&quot;],&quot;slug&quot;:[0,&quot;workers&quot;]}],[0,{&quot;id&quot;:[0,&quot;5v2UZdTRX1Rw9akmhexnxs&quot;],&quot;name&quot;:[0,&quot;Durable Objects&quot;],&quot;slug&quot;:[0,&quot;durable-objects&quot;]}],[0,{&quot;id&quot;:[0,&quot;7mFLEw3Z6dksCNAsnCMHTH&quot;],&quot;name&quot;:[0,&quot;Guest Post&quot;],&quot;slug&quot;:[0,&quot;guest-post&quot;]}],[0,{&quot;id&quot;:[0,&quot;4HIPcb68qM0e26fIxyfzwQ&quot;],&quot;name&quot;:[0,&quot;Developers&quot;],&quot;slug&quot;:[0,&quot;developers&quot;]}],[0,{&quot;id&quot;:[0,&quot;3JAY3z7p7An94s6ScuSQPf&quot;],&quot;name&quot;:[0,&quot;Developer Platform&quot;],&quot;slug&quot;:[0,&quot;developer-platform&quot;]}]]],&quot;relatedTags&quot;:[0],&quot;authors&quot;:[1,[[0,{&quot;name&quot;:[0,&quot;Erwin van der Koogh&quot;],&quot;slug&quot;:[0,&quot;erwin&quot;],&quot;bio&quot;:[0,null],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/fayl90WdBlMlt0PuzhExJ/a4c6d19ae93df8a68e04a84cdc76c7e5/erwin.jpeg&quot;],&quot;location&quot;:[0,&quot;Melbourne&quot;],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,&quot;@evanderkoogh&quot;],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}],[0,{&quot;name&quot;:[0,&quot;Guido Zuidhof (Guest Author)&quot;],&quot;slug&quot;:[0,&quot;guido&quot;],&quot;bio&quot;:[0,null],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/6wNVpyin8awIPMlLNfszXz/e22b60c2109beb5e5db2aebdf112c921/guido.png&quot;],&quot;location&quot;:[0,null],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,null],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}]]],&quot;meta_description&quot;:[0,&quot;Guido won the innovative category in one of the biggest Game Jams with a combination of Pages, Durable Objects, modern browser APIs, and a hefty amount of ingenuity.&quot;],&quot;primary_author&quot;:[0,{}],&quot;localeList&quot;:[0,{&quot;name&quot;:[0,&quot;Developer Spotlight: Winning a Game Jam with Jamstack and Durable Objects Config&quot;],&quot;enUS&quot;:[0,&quot;English for Locale&quot;],&quot;zhCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhHansCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhTW&quot;:[0,&quot;No Page for Locale&quot;],&quot;frFR&quot;:[0,&quot;No Page for Locale&quot;],&quot;deDE&quot;:[0,&quot;No Page for Locale&quot;],&quot;itIT&quot;:[0,&quot;No Page for Locale&quot;],&quot;jaJP&quot;:[0,&quot;Translated for Locale&quot;],&quot;koKR&quot;:[0,&quot;No Page for Locale&quot;],&quot;ptBR&quot;:[0,&quot;No Page for Locale&quot;],&quot;esLA&quot;:[0,&quot;No Page for Locale&quot;],&quot;esES&quot;:[0,&quot;No Page for Locale&quot;],&quot;enAU&quot;:[0,&quot;No Page for Locale&quot;],&quot;enCA&quot;:[0,&quot;No Page for Locale&quot;],&quot;enIN&quot;:[0,&quot;No Page for Locale&quot;],&quot;enGB&quot;:[0,&quot;No Page for Locale&quot;],&quot;idID&quot;:[0,&quot;No Page for Locale&quot;],&quot;ruRU&quot;:[0,&quot;No Page for Locale&quot;],&quot;svSE&quot;:[0,&quot;No Page for Locale&quot;],&quot;viVN&quot;:[0,&quot;No Page for Locale&quot;],&quot;plPL&quot;:[0,&quot;No Page for Locale&quot;],&quot;arAR&quot;:[0,&quot;No Page for Locale&quot;],&quot;nlNL&quot;:[0,&quot;No Page for Locale&quot;],&quot;thTH&quot;:[0,&quot;No Page for Locale&quot;],&quot;trTR&quot;:[0,&quot;No Page for Locale&quot;],&quot;heIL&quot;:[0,&quot;No Page for Locale&quot;],&quot;lvLV&quot;:[0,&quot;No Page for Locale&quot;],&quot;etEE&quot;:[0,&quot;No Page for Locale&quot;],&quot;ltLT&quot;:[0,&quot;No Page for Locale&quot;]}],&quot;url&quot;:[0,&quot;https://blog.cloudflare.com/developer-spotlight-guido-zuidhof-full-tilt&quot;],&quot;metadata&quot;:[0,{&quot;title&quot;:[0],&quot;description&quot;:[0],&quot;imgPreview&quot;:[0,&quot;&quot;]}],&quot;publicly_index&quot;:[0,true]}],[0,{&quot;id&quot;:[0,&quot;3IEh3rewreHLWQ5OV9E4cd&quot;],&quot;title&quot;:[0,&quot;Durable Objects — now Generally Available&quot;],&quot;slug&quot;:[0,&quot;durable-objects-ga&quot;],&quot;excerpt&quot;:[0,&quot;Today, we’re announcing that Durable Objects are generally available and production-ready for you to use!&quot;],&quot;featured&quot;:[0,false],&quot;html&quot;:[0,&quot;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/782wroVf1pinGM7HVSOJha/0ed01b16feb5bd0aa88be55d70a8c663/image1-16.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1200\&quot; height=\&quot;675\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;&lt;a href=\&quot;/tag/full-stack-week/\&quot;&gt;Full Stack Week&lt;/a&gt; is all about how developers are embracing the power of Cloudflare’s network to build entire applications that are global by default. The promise of Workers isn’t just improved latency — it’s fundamentally different programming paradigms that make developer’s lives easier and applications more resilient.&lt;/p&gt;&lt;p&gt;Last year, we &lt;a href=\&quot;/durable-objects-open-beta/\&quot;&gt;announced Durable Objects&lt;/a&gt; — Cloudflare’s approach to coordinating state across Workers running at Cloudflare’s edge. Durable Objects let developers implement previously complex applications, like collaborative whiteboarding, game servers, or global queues, in just a few lines of code.&lt;/p&gt;&lt;p&gt;Today, we’re announcing that Durable Objects are generally available and production-ready for you to use!&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;what-makes-durable-objects-so-cool\&quot;&gt;What makes Durable Objects so cool?&lt;/h3&gt;\n            &lt;a href=\&quot;#what-makes-durable-objects-so-cool\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;For many traditional applications, state coordination happens through a database. Applications built on Workers present some unique challenges for a database — namely needing to handle global scale out-of-the-box and heavy concurrency that could lead to frequent transaction rollbacks when coordinating on shared keys. Databases themselves are hard to configure and scale, especially at global scale, so developers would need to tweak their database specifically for Workers’ access patterns.&lt;/p&gt;&lt;p&gt;Durable Objects present a simpler paradigm: write a JavaScript class, and your application can create named instances of that class — which are guaranteed to be unique across Cloudflare’s entire network. That instance is a Durable Object — Workers (and other Durable Objects!) can send messages to it via its ID. The Durable Object processes messages in-order and on a single-thread, allowing for coordination across messages. We also provide a strongly consistent storage API, which can store key-value pairs the object needs to make durable.&lt;/p&gt;&lt;p&gt;Take, for example, an online document editor.  A typical architecture would save the state of the document in a database and have users persist changes there.  This makes collaboration difficult, though — how can multiple users ensure that they all see the latest copy of changes to the document?&lt;/p&gt;&lt;p&gt;With Durable Objects, this is a much simpler problem.  By writing a Document class, you store the state of each document in-memory in a Durable Object.  As users connect, they’ll see the latest copy of the document — and can make their changes in-sync with other users. When users leave the document, the Durable Object will leave memory and stop incurring charges, while its state is persisted durably.  There’s no networking to configure, database to manage, or autoscaling policy to implement — it all just works.&lt;/p&gt;&lt;p&gt;While individual objects are single-threaded, Durable Objects’ design means a collection of objects can scale effectively infinitely. An object’s lifecycle is managed for you, meaning there’s no clean-up tasks to run or systems to scale down — Durable Objects can instantly scale to hundreds of thousands of requests per second, then scale back down with no developer interaction.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;what-have-we-been-building-since-announcing-early-access\&quot;&gt;What have we been building since announcing Early Access?&lt;/h3&gt;\n            &lt;a href=\&quot;#what-have-we-been-building-since-announcing-early-access\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;First, we’ve kept busy improving reliability and performance. Durable Objects are behind a number of new products being developed at Cloudflare, including powering &lt;a href=\&quot;/introducing-r2-object-storage/\&quot;&gt;R2 storage&lt;/a&gt; and &lt;a href=\&quot;/cloudflare-waiting-room/\&quot;&gt;Cloudflare Waiting Room&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;Specifically, Waiting Room uses Durable Objects to provide a strongly consistent view of the current number of users attempting to access a given site globally.  Storing this frequently updated state in a traditional database would be difficult to scale and be significantly harder to run globally.&lt;/p&gt;&lt;p&gt;Our customers have also embraced Durable Objects. We’ve seen a major gaming company build their new backend architecture on Durable Objects — coordinating both individual game state and multiplayer game lobbies.  The ability to dynamically scale without managing servers or databases made Durable Objects an easy choice for them, letting them grow their game with a relatively small team.&lt;/p&gt;&lt;p&gt;Customers have built more applications — from status page monitors to collaborative whiteboard applications.  We’ve seen particular interest in using Durable Objects with WebSockets to create entirely responsive applications and have published a &lt;a href=\&quot;https://github.com/cloudflare/dog\&quot;&gt;reference architecture&lt;/a&gt; to help customers build this out further.&lt;/p&gt;&lt;p&gt;We’ve also gotten better at operating the system, particularly in response to large volumes of requests. Durable Objects can now serve hundreds of thousands of requests per second across objects, and hundreds of requests on a single object, making them production-ready for even the most demanding customers.&lt;/p&gt;&lt;p&gt;We’ve shipped &lt;a href=\&quot;/supporting-jurisdictional-restrictions-for-durable-objects/\&quot;&gt;Jurisdictional Restrictions&lt;/a&gt;, which bring the simplicity of scaling Durable Objects to compliance by letting developers tag a Durable Object with a region, ensuring it processes and stores data in that region.&lt;/p&gt;&lt;p&gt;We &lt;a href=\&quot;/durable-objects-easy-fast-correct-choose-three/\&quot;&gt;added a cache&lt;/a&gt; in front of Durable Object storage requests, making read and write operations blazing fast while also making it easier to write correct concurrent code.&lt;/p&gt;&lt;p&gt;Beyond that, we’ve made a number of smaller improvements that included &lt;a href=\&quot;https://developers.cloudflare.com/workers/learning/using-durable-objects#uploading-a-durable-object-worker\&quot;&gt;simplified uploads of new Durable Objects classes&lt;/a&gt;, a UI in the dashboard and support for &lt;code&gt;wrangler dev&lt;/code&gt; and &lt;code&gt;wrangler tail&lt;/code&gt; for live debugging.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;whats-next-for-durable-objects\&quot;&gt;What’s next for Durable Objects?&lt;/h3&gt;\n            &lt;a href=\&quot;#whats-next-for-durable-objects\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;We’re continuing to work on making Durable Objects the easiest platform for building infinitely-scalable applications.&lt;/p&gt;&lt;p&gt;Today, Durable Objects scale well when objects can be partitioned, but individual objects are limited to a single execution thread. Many workloads could be scaled across multiple threads, providing read-only access to an object’s state and choosing to only synchronize when mutating state. We’re calling this replication for Durable Objects, and we’re working on it now.&lt;/p&gt;&lt;p&gt;We’re also working on adding an API for a guaranteed callback to a Durable Object, letting developers wake a Durable Object at a specified time in the future to run a function. This simplifies lifecycle management, making it easy to build primitives like reliable queues on top of Durable Objects.&lt;/p&gt;&lt;p&gt;We’re also looking into how to better geo-distribute objects, including the vision for automatic migration of objects we talked about in our initial announcement.&lt;/p&gt;&lt;p&gt;Have something you’d like to see us add? Shoot us an &lt;a href=\&quot;mailto:workers-product@cloudflare.com\&quot;&gt;email&lt;/a&gt; or a &lt;a href=\&quot;https://twitter.com/cloudflare\&quot;&gt;tweet&lt;/a&gt;!&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;how-do-i-use-durable-objects\&quot;&gt;How do I use Durable Objects?&lt;/h3&gt;\n            &lt;a href=\&quot;#how-do-i-use-durable-objects\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Head over to the Cloudflare Dashboard to enable Durable Objects and opt in to pricing, then check out our &lt;a href=\&quot;https://github.com/cloudflare/workers-chat-demo\&quot;&gt;sample chat application&lt;/a&gt; and reference architecture &lt;a href=\&quot;https://github.com/cloudflare/dog\&quot;&gt;here&lt;/a&gt;!&lt;/p&gt;&lt;p&gt;Happy building!&lt;/p&gt;&quot;],&quot;published_at&quot;:[0,&quot;2021-11-15T13:59:12.000+00:00&quot;],&quot;updated_at&quot;:[0,&quot;2024-10-09T23:16:03.162Z&quot;],&quot;feature_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/10tDcUHtGq9ruSygbXCf6R/cd1e73bd8bd99697408ed796bcd7f461/durable-objects-ga.png&quot;],&quot;tags&quot;:[1,[[0,{&quot;id&quot;:[0,&quot;4Q1oXZOskZczYetWpWXIsl&quot;],&quot;name&quot;:[0,&quot;Full Stack Week&quot;],&quot;slug&quot;:[0,&quot;full-stack-week&quot;]}],[0,{&quot;id&quot;:[0,&quot;5v2UZdTRX1Rw9akmhexnxs&quot;],&quot;name&quot;:[0,&quot;Durable Objects&quot;],&quot;slug&quot;:[0,&quot;durable-objects&quot;]}]]],&quot;relatedTags&quot;:[0],&quot;authors&quot;:[1,[[0,{&quot;name&quot;:[0,&quot;Greg McKeon&quot;],&quot;slug&quot;:[0,&quot;greg&quot;],&quot;bio&quot;:[0,null],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/6eXlcFixG7Tc7SoBGH2Cjr/243f54f33f488392c302ee00931ac9d0/greg.png&quot;],&quot;location&quot;:[0,null],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,&quot;@wegmckeon&quot;],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}]]],&quot;meta_description&quot;:[0,&quot;Today, we’re announcing that Durable Objects are generally available and production-ready for you to use!&quot;],&quot;primary_author&quot;:[0,{}],&quot;localeList&quot;:[0,{&quot;name&quot;:[0,&quot;Durable Objects — now Generally Available Config&quot;],&quot;enUS&quot;:[0,&quot;English for Locale&quot;],&quot;zhCN&quot;:[0,&quot;Translated for Locale&quot;],&quot;zhHansCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhTW&quot;:[0,&quot;No Page for Locale&quot;],&quot;frFR&quot;:[0,&quot;Translated for Locale&quot;],&quot;deDE&quot;:[0,&quot;Translated for Locale&quot;],&quot;itIT&quot;:[0,&quot;No Page for Locale&quot;],&quot;jaJP&quot;:[0,&quot;Translated for Locale&quot;],&quot;koKR&quot;:[0,&quot;No Page for Locale&quot;],&quot;ptBR&quot;:[0,&quot;No Page for Locale&quot;],&quot;esLA&quot;:[0,&quot;No Page for Locale&quot;],&quot;esES&quot;:[0,&quot;No Page for Locale&quot;],&quot;enAU&quot;:[0,&quot;No Page for Locale&quot;],&quot;enCA&quot;:[0,&quot;No Page for Locale&quot;],&quot;enIN&quot;:[0,&quot;No Page for Locale&quot;],&quot;enGB&quot;:[0,&quot;No Page for Locale&quot;],&quot;idID&quot;:[0,&quot;No Page for Locale&quot;],&quot;ruRU&quot;:[0,&quot;No Page for Locale&quot;],&quot;svSE&quot;:[0,&quot;No Page for Locale&quot;],&quot;viVN&quot;:[0,&quot;No Page for Locale&quot;],&quot;plPL&quot;:[0,&quot;No Page for Locale&quot;],&quot;arAR&quot;:[0,&quot;No Page for Locale&quot;],&quot;nlNL&quot;:[0,&quot;No Page for Locale&quot;],&quot;thTH&quot;:[0,&quot;No Page for Locale&quot;],&quot;trTR&quot;:[0,&quot;No Page for Locale&quot;],&quot;heIL&quot;:[0,&quot;No Page for Locale&quot;],&quot;lvLV&quot;:[0,&quot;No Page for Locale&quot;],&quot;etEE&quot;:[0,&quot;No Page for Locale&quot;],&quot;ltLT&quot;:[0,&quot;No Page for Locale&quot;]}],&quot;url&quot;:[0,&quot;https://blog.cloudflare.com/durable-objects-ga&quot;],&quot;metadata&quot;:[0,{&quot;title&quot;:[0,&quot;Durable Objects — now Generally Available&quot;],&quot;description&quot;:[0,&quot;Today, we’re announcing that Durable Objects are generally available and production-ready for you to use!&quot;],&quot;imgPreview&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/4lDu8GGWYsS1h6qNftVnFH/19cfe55433e06de63c76b19b6a250dba/durable-objects-ga-U8644H.png&quot;]}],&quot;publicly_index&quot;:[0,true]}],[0,{&quot;id&quot;:[0,&quot;3Jqpb0snfffIYkIguxuzNT&quot;],&quot;title&quot;:[0,&quot;Durable Objects: Easy, Fast, Correct — Choose three&quot;],&quot;slug&quot;:[0,&quot;durable-objects-easy-fast-correct-choose-three&quot;],&quot;excerpt&quot;:[0,&quot;When multiple clients access the same storage concurrently, race conditions abound. Durable Objects can make it easier. We recently rolled out improvements to Durable Objects that automatically correct many common race conditions while actually making your code faster. &quot;],&quot;featured&quot;:[0,false],&quot;html&quot;:[0,&quot;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/33fbEXtJJwEpFzKnwx3qIF/74787e9624ed480248eac2b68fac7e12/blog-570-DO-collisions-1.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1500\&quot; height=\&quot;788\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;Storage in distributed systems is surprisingly hard to get right. Distributed databases and consensus are well-known to be extremely hard to build. But, application code isn&amp;#39;t necessarily easy either. There are many ways in which apps that use databases can have subtle timing bugs that could result in inconsistent results, or even data loss. Worse, these problems can be very hard to test for, as they&amp;#39;ll often manifest only under heavy load, or only after a sudden machine failure.&lt;/p&gt;&lt;p&gt;Up until recently, Durable Objects were no exception. A Durable Object is a special kind of Cloudflare Worker that has access to persistent storage and processes requests in one of Cloudflare’s points of presence. Each Object has its own private storage, accessible through a classical key/value storage API. Like any classical database API, this storage API had to be used carefully to avoid possible race conditions and data loss, especially when performance mattered. And like any classical database API, many apps got it wrong.&lt;/p&gt;&lt;p&gt;However, rather than fix the apps, we decided to fix the model. Last month, we rolled out deep changes to the Durable Objects runtime such that many applications which previously contained subtle race conditions are now correct by default, and many that were previously slow are now fast. Developers can now write their code in an intuitive way, and have it work. No changes at all are needed to your code in order to take advantage of these new features.&lt;/p&gt;&lt;p&gt;So, let me tell you about what changed…&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;background-durable-objects-are-single-threaded\&quot;&gt;Background: Durable Objects are Single-Threaded&lt;/h2&gt;\n            &lt;a href=\&quot;#background-durable-objects-are-single-threaded\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;To understand what changed, it&amp;#39;s necessary to first understand Durable Objects. For a full introduction, see the &lt;a href=\&quot;/introducing-workers-durable-objects/\&quot;&gt;Durable Objects announcement blog post&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;The most important point is: Each Durable Object runs in exactly one location, in one single thread, at a time. Each object has its own private on-disk storage. This is a very different situation from a typical database, where many clients may be accessing the same data. In Durable Objects, any particular piece of data belongs to exactly one thread at a time.&lt;/p&gt;&lt;p&gt;Because a single Durable Object is single-threaded, it&amp;#39;s possible, and even encouraged, to keep state and perform synchronization in memory. This is, indeed, the killer feature of Durable Objects. With classical databases, in-memory state is extremely difficult to keep synchronized between all database clients. But with Durable Objects, since each piece of data belongs to a specific thread, this synchronization is easy.&lt;/p&gt;&lt;p&gt;However, interacting with the disk is still an I/O (input/output) operation, which means that each operation returns a &lt;code&gt;Promise&lt;/code&gt; which you must &lt;code&gt;await&lt;/code&gt;. As we&amp;#39;ll see, this re-introduces some of the synchronization difficulties that we were trying to avoid. However, it turns out, we can solve these difficulties within the system itself, without bothering application developers.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;an-example\&quot;&gt;An Example&lt;/h2&gt;\n            &lt;a href=\&quot;#an-example\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;Consider this code:&lt;/p&gt;\n            &lt;pre class=\&quot;language-javascript\&quot;&gt;&lt;code class=\&quot;language-javascript\&quot;&gt;// Used to be slow and racy -- but not anymore!\nasync function getUniqueNumber() {\n  let val = await this.storage.get(&amp;quot;counter&amp;quot;);\n  await this.storage.put(&amp;quot;counter&amp;quot;, val + 1);\n  return val;\n}&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;At first glance, this seems like reasonable code that returns a unique number each time it is called (incrementing each time).&lt;/p&gt;&lt;p&gt;Unfortunately, before now, this code had two problems:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;&lt;p&gt;It had a subtle race condition (even though Durable Objects are single-threaded!).&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;It was kind of slow.&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;the-race-condition\&quot;&gt;The Race Condition&lt;/h3&gt;\n            &lt;a href=\&quot;#the-race-condition\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;A race condition occurs when two operations running concurrently might interfere with each other in a way that makes them behave incorrectly. Race conditions are commonly associated with code that uses multiple threads.&lt;/p&gt;&lt;p&gt;JavaScript, however, famously does not use threads. Instead, it uses event-driven programming, with callbacks. It&amp;#39;s not possible for two pieces of JavaScript code to be running &amp;quot;at the same time&amp;quot; in the same isolate (and Durable Objects promises that no other isolate could possibly be accessing the same storage). Does that mean that race conditions aren&amp;#39;t a problem in JavaScript, the way they are in multi-threaded apps?&lt;/p&gt;&lt;p&gt;Unfortunately, it does not. The problem is, the code above is an &lt;code&gt;async&lt;/code&gt; function, containing two &lt;code&gt;await&lt;/code&gt; statements. Each time &lt;code&gt;await&lt;/code&gt; is used, execution pauses, waiting for the specified &lt;code&gt;Promise&lt;/code&gt; to complete.&lt;/p&gt;&lt;p&gt;In the meantime, though, other code can run! For example, the Durable Object might receive two requests at the same time. If each of them calls &lt;code&gt;getUniqueNumber()&lt;/code&gt;, then the two calls might be interleaved. Each time one call performs an &lt;code&gt;await&lt;/code&gt;, execution may switch to the other call. So, the two calls might end up looking like this:&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;style type=\&quot;text/css\&quot;&gt;\n.tg  {border-collapse:collapse;border-spacing:0;margin:0px auto;}\n.tg td{border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;\n  overflow:hidden;padding:10px 5px;word-break:normal;}\n.tg th{border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;\n  font-weight:normal;overflow:hidden;padding:10px 5px;word-break:normal;}\n.tg .tg-jf6t{background-color:#FFF;color:#36393A;text-align:left;vertical-align:middle}\n.tg .tg-d46s{background-color:#F5F2F0;color:#36393A;text-align:left;vertical-align:top}\n.tg .tg-jwid{background-color:#F5F2F0;color:#07A;text-align:left;vertical-align:top}\n@media screen and (max-width: 767px) {.tg {width: auto !important;}.tg col {width: auto !important;}.tg-wrap {overflow-x: auto;-webkit-overflow-scrolling: touch;margin: auto 0px;}}&lt;/style&gt;\n&lt;div class=\&quot;tg-wrap\&quot;&gt;&lt;table class=\&quot;tg\&quot;&gt;&lt;thead&gt;\n  &lt;tr&gt;\n    &lt;th class=\&quot;tg-jf6t\&quot;&gt;Request 1 timeline&lt;/th&gt;\n    &lt;th class=\&quot;tg-jf6t\&quot;&gt;Request 2 timeline&lt;/th&gt;\n  &lt;/tr&gt;&lt;/thead&gt;\n&lt;tbody&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-jwid\&quot;&gt;&lt;span style=\&quot;color:#07A\&quot;&gt;async&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt; &lt;/span&gt;&lt;span style=\&quot;color:#07A\&quot;&gt;function&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt; &lt;/span&gt;&lt;span style=\&quot;color:#DD4A68\&quot;&gt;getUniqueNumber&lt;/span&gt;&lt;span style=\&quot;color:#999\&quot;&gt;()&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt; &lt;/span&gt;&lt;span style=\&quot;color:#999\&quot;&gt;{&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;span style=\&quot;color:#07A\&quot;&gt;let&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt; val &lt;/span&gt;&lt;span style=\&quot;color:#A67F59;background-color:rgba(255, 255, 255, 0.5)\&quot;&gt;=&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt; &lt;/span&gt;&lt;span style=\&quot;color:#07A\&quot;&gt;await&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt; &lt;/span&gt;&lt;span style=\&quot;color:#07A\&quot;&gt;this&lt;/span&gt;&lt;span style=\&quot;color:#999\&quot;&gt;.&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt;storage&lt;/span&gt;&lt;span style=\&quot;color:#999\&quot;&gt;.&lt;/span&gt;&lt;span style=\&quot;color:#07A\&quot;&gt;get&lt;/span&gt;&lt;span style=\&quot;color:#999\&quot;&gt;(&lt;/span&gt;&lt;span style=\&quot;color:#690\&quot;&gt;\&quot;counter\&quot;&lt;/span&gt;&lt;span style=\&quot;color:#999\&quot;&gt;);&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-d46s\&quot;&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-d46s\&quot;&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-jwid\&quot;&gt;&lt;span style=\&quot;color:#07A\&quot;&gt;async&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt; &lt;/span&gt;&lt;span style=\&quot;color:#07A\&quot;&gt;function&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt; &lt;/span&gt;&lt;span style=\&quot;color:#DD4A68\&quot;&gt;getUniqueNumber&lt;/span&gt;&lt;span style=\&quot;color:#999\&quot;&gt;()&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt; &lt;/span&gt;&lt;span style=\&quot;color:#999\&quot;&gt;{&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;span style=\&quot;color:#07A\&quot;&gt;let&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt; val &lt;/span&gt;&lt;span style=\&quot;color:#A67F59;background-color:rgba(255, 255, 255, 0.5)\&quot;&gt;=&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt; &lt;/span&gt;&lt;span style=\&quot;color:#07A\&quot;&gt;await&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt; &lt;/span&gt;&lt;span style=\&quot;color:#07A\&quot;&gt;this&lt;/span&gt;&lt;span style=\&quot;color:#999\&quot;&gt;.&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt;storage&lt;/span&gt;&lt;span style=\&quot;color:#999\&quot;&gt;.&lt;/span&gt;&lt;span style=\&quot;color:#07A\&quot;&gt;get&lt;/span&gt;&lt;span style=\&quot;color:#999\&quot;&gt;(&lt;/span&gt;&lt;span style=\&quot;color:#690\&quot;&gt;\&quot;counter\&quot;&lt;/span&gt;&lt;span style=\&quot;color:#999\&quot;&gt;);&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-d46s\&quot;&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;span style=\&quot;color:#07A\&quot;&gt;await&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt; &lt;/span&gt;&lt;span style=\&quot;color:#07A\&quot;&gt;this&lt;/span&gt;&lt;span style=\&quot;color:#999\&quot;&gt;.&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt;storage&lt;/span&gt;&lt;span style=\&quot;color:#999\&quot;&gt;.&lt;/span&gt;&lt;span style=\&quot;color:#DD4A68\&quot;&gt;put&lt;/span&gt;&lt;span style=\&quot;color:#999\&quot;&gt;(&lt;/span&gt;&lt;span style=\&quot;color:#690\&quot;&gt;\&quot;counter\&quot;&lt;/span&gt;&lt;span style=\&quot;color:#999\&quot;&gt;,&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt; val &lt;/span&gt;&lt;span style=\&quot;color:#A67F59;background-color:rgba(255, 255, 255, 0.5)\&quot;&gt;+&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt; &lt;/span&gt;&lt;span style=\&quot;color:#905\&quot;&gt;1&lt;/span&gt;&lt;span style=\&quot;color:#999\&quot;&gt;);&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-d46s\&quot;&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt; &lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-d46s\&quot;&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt; &lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-d46s\&quot;&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;span style=\&quot;color:#07A\&quot;&gt;await&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt; &lt;/span&gt;&lt;span style=\&quot;color:#07A\&quot;&gt;this&lt;/span&gt;&lt;span style=\&quot;color:#999\&quot;&gt;.&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt;storage&lt;/span&gt;&lt;span style=\&quot;color:#999\&quot;&gt;.&lt;/span&gt;&lt;span style=\&quot;color:#DD4A68\&quot;&gt;put&lt;/span&gt;&lt;span style=\&quot;color:#999\&quot;&gt;(&lt;/span&gt;&lt;span style=\&quot;color:#690\&quot;&gt;\&quot;counter\&quot;&lt;/span&gt;&lt;span style=\&quot;color:#999\&quot;&gt;,&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt; val &lt;/span&gt;&lt;span style=\&quot;color:#A67F59;background-color:rgba(255, 255, 255, 0.5)\&quot;&gt;+&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt; &lt;/span&gt;&lt;span style=\&quot;color:#905\&quot;&gt;1&lt;/span&gt;&lt;span style=\&quot;color:#999\&quot;&gt;);&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-d46s\&quot;&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;span style=\&quot;color:#07A\&quot;&gt;return&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt; val&lt;/span&gt;&lt;span style=\&quot;color:#999\&quot;&gt;;&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt; &lt;/span&gt;&lt;span style=\&quot;color:#999\&quot;&gt;}&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-d46s\&quot;&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-d46s\&quot;&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-d46s\&quot;&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;span style=\&quot;color:#07A\&quot;&gt;return&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt; val&lt;/span&gt;&lt;span style=\&quot;color:#999\&quot;&gt;;&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt; &lt;/span&gt;&lt;span style=\&quot;color:#999\&quot;&gt;}&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;There&amp;#39;s a big problem here: Both of these two calls will call &lt;code&gt;get(&amp;quot;counter&amp;quot;)&lt;/code&gt; before &lt;i&gt;either&lt;/i&gt; of them calls &lt;code&gt;put(&amp;quot;counter&amp;quot;, val + 1)&lt;/code&gt;. That means, both of them will return the same value!&lt;/p&gt;&lt;p&gt;This problem is especially bad because it only happens when multiple requests are being handled at the same time -- and even then, only sometimes. It is very hard to test for this kind of problem, and everything might seem just fine when the application is deployed, as long as it isn&amp;#39;t getting too much traffic. But one day, when a lot of visitors try to use the same object at the same time, all of a sudden &lt;code&gt;getUniqueNumber()&lt;/code&gt; starts returning duplicates!&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;the-slowness\&quot;&gt;The Slowness&lt;/h3&gt;\n            &lt;a href=\&quot;#the-slowness\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;To add insult to injury, &lt;code&gt;getUniqueNumber()&lt;/code&gt; was (until recently) pretty slow. The problem is, it has to do two round trips to storage -- a &lt;code&gt;get()&lt;/code&gt; and a &lt;code&gt;put()&lt;/code&gt;. The &lt;code&gt;get()&lt;/code&gt; might typically take a couple milliseconds. The &lt;code&gt;put()&lt;/code&gt;, however, will take much longer, probably tens of milliseconds.&lt;/p&gt;&lt;p&gt;Why is &lt;code&gt;put()&lt;/code&gt; so slow? Because we don&amp;#39;t want to lose data. The worst thing an application can do is tell the user that their action was successful when it wasn&amp;#39;t. If, for some reason, a write cannot be completed, then it&amp;#39;s imperative that the application presents an error to the user, so that the user knows that something is wrong and they&amp;#39;ll have to try again or look for a fix.&lt;/p&gt;&lt;p&gt;In order to make sure an application does not prematurely report success to the user, &lt;code&gt;await put()&lt;/code&gt; has to make sure it doesn&amp;#39;t return until the data is actually safe on disk. Disks are slow, so this might take a while.&lt;/p&gt;&lt;p&gt;But that&amp;#39;s not all. Disks can fail. In order for the data to be really safe, we have to write the same data on multiple disks, in multiple machines. That means we have to wait for some network traffic.&lt;/p&gt;&lt;p&gt;But that&amp;#39;s still not all. What if a meteor were to come out of the sky and land on a Cloudflare data center, completely destroying it? Or, more likely, what if the power or network connection failed? We don&amp;#39;t want a user&amp;#39;s data to be lost in this case, or even temporarily become unavailable. Therefore, Durable Object data is replicated to multiple Cloudflare locations. This requires communicating across long distances before any write can be confirmed. There is little we can do to make this faster, the speed of light being what it is.&lt;/p&gt;&lt;p&gt;A call to &lt;code&gt;getUniqueNumber()&lt;/code&gt; will therefore always take tens of milliseconds. If an application calls it multiple times, &lt;code&gt;await&lt;/code&gt;ing each call before beginning the next, it can easily become very slow very quickly. Or, at least, that was the case before our recent changes.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;the-wrong-fixes\&quot;&gt;The Wrong Fixes&lt;/h2&gt;\n            &lt;a href=\&quot;#the-wrong-fixes\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;There are several ways that an application could fix these problems, but all of them have their own issues.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;transactions\&quot;&gt;Transactions?&lt;/h3&gt;\n            &lt;a href=\&quot;#transactions\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Many databases offer &amp;quot;transactions&amp;quot;. A transaction allows an application to make sure some operation completes &amp;quot;atomically&amp;quot;, with no interference from concurrent operations.&lt;/p&gt;&lt;p&gt;The Durable Objects storage API has always supported transactions. We could use them to fix our &lt;code&gt;getUniqueNumber()&lt;/code&gt; implementation like so:&lt;/p&gt;\n            &lt;pre class=\&quot;language-javascript\&quot;&gt;&lt;code class=\&quot;language-javascript\&quot;&gt;// No more race condition... but slow and complicated.\nasync function getUniqueNumber() {\n  let val;\n  await this.storage.transaction(async (txn) =&amp;gt; {\n    val = await txn.get(&amp;quot;counter&amp;quot;);\n    await txn.put(&amp;quot;counter&amp;quot;, val + 1);\n  });\n  return val;\n}&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;This fixes our race condition. Now, if &lt;code&gt;getUniqueNumber()&lt;/code&gt; is called multiple times concurrently such that the storage operations interleave, the system will detect the problem. One of the concurrent calls will be chosen to be the &amp;quot;winner&amp;quot;, and will complete normally. The other calls will be canceled and retried, so that they can see the value written by the first call.&lt;/p&gt;&lt;p&gt;This fixes our problems! But, at some cost:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;&lt;code&gt;getUniqueNumber()&lt;/code&gt; is now even slower than it was before. The difference typically won&amp;#39;t be huge, but setting up a transaction does require some additional coordination in the database. Of course, if the transaction needs to be retried, then it may end up being much slower. And retries will tend to happen more when load gets high… the worst possible time.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Speaking of retries, many developers might not realize that the transaction callback can be called multiple times. It&amp;#39;s difficult to test for this, since retries will only happen when concurrent operations cause conflicts. The problem is especially acute when the application is trying to synchronize not just on-disk state, but also in-memory state -- if the transaction callback modifies in-memory state, it must be careful to ensure that its changes are idempotent. The need for idempotency may not be top of mind for most developers, and tests won&amp;#39;t catch the problem, making it very easy to end up deploying buggy code.&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;So we solved our problem, but we did it with a foot-gun. If we keep using the foot-gun, we&amp;#39;re probably going to shoot our own feet eventually.&lt;/p&gt;&lt;p&gt;Is there another way?&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;in-memory-caching\&quot;&gt;In-memory caching?&lt;/h3&gt;\n            &lt;a href=\&quot;#in-memory-caching\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Durable Objects&amp;#39; superpower is their in-memory state. Each object has only one active instance at any particular time. All requests sent to that object are handled by that same instance. That means, you can store some state in memory.&lt;/p&gt;\n            &lt;pre class=\&quot;language-javascript\&quot;&gt;&lt;code class=\&quot;language-javascript\&quot;&gt;// Much faster! But (used to be) wrong.\nasync function getUniqueNumber() {\n  if (this.val === undefined) {\n    this.val = await this.storage.get(&amp;quot;counter&amp;quot;);\n  }\n\n  let result = this.val;\n  ++this.val;\n  this.storage.put(&amp;quot;counter&amp;quot;, this.val);\n  return result;\n}&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;This code is MUCH faster than the previous implementation, because it stores the value in memory. In fact, after the function runs once, further calls won&amp;#39;t wait for any I/O at all -- they will return immediately. This is because by caching the value in memory, we avoid waiting for a &lt;code&gt;get()&lt;/code&gt; (except for the first time), and we don&amp;#39;t wait for the &lt;code&gt;put()&lt;/code&gt; either, trusting that it will complete asynchronously later on.&lt;/p&gt;&lt;p&gt;Returning immediately also means that there&amp;#39;s no opportunity for concurrency, so the calls that return immediately will always return unique numbers! This means that not only is this implementation faster than our original implementation, it is also &lt;i&gt;more correct&lt;/i&gt;. This is only possible because the Durable Objects platform guarantees that there will only be one instance, and therefore only one copy of &lt;code&gt;this.val&lt;/code&gt;.&lt;/p&gt;&lt;p&gt;Unfortunately, there are two problems with this code:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;We still have a race condition on initialization. If the &lt;i&gt;first&lt;/i&gt; two calls to &lt;code&gt;getUniqueNumber()&lt;/code&gt; happen to occur at about the same time, then initialization will be performed multiple times. The second call will likely clobber what the first call did, and the two calls will end up returning the same number. We could solve this problem by making initialization more complicated -- the first call could create an initialization promise, and other concurrent calls could wait on it, so that initialization really only happens once. But this creates even deeper complexity: What if initialization fails for some reason? The object could be placed in a permanently broken state. It&amp;#39;s possible to get this right, but it&amp;#39;s surprisingly tricky.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Because we don&amp;#39;t wait for the &lt;code&gt;put()&lt;/code&gt; to report success, it&amp;#39;s possible that it could be silently lost. For example, if the machine hosting the Durable Object suffered a sudden power failure, then the Durable Object would be transferred to some other machine. When it starts up there, calls to &lt;code&gt;getUniqueNumber()&lt;/code&gt; might return numbers that had already been returned under the old instance before it failed, because the &lt;code&gt;put()&lt;/code&gt;s hadn&amp;#39;t actually completed before the failure occurred. But if we &lt;code&gt;await&lt;/code&gt; the &lt;code&gt;put()&lt;/code&gt;, then our function becomes slow again, and creates more opportunities for race conditions (e.g. in the calling code).&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;our-answer-make-it-automatic\&quot;&gt;Our answer: Make it automatic&lt;/h2&gt;\n            &lt;a href=\&quot;#our-answer-make-it-automatic\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;When looking at this, we had two options:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;&lt;p&gt;Try to carefully document these problems and educate developers about them, so that they could write code that does the right thing.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Change the system so that naturally-written code just does the right thing by default -- and runs quickly.&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;We chose option 2. We accomplished this in three parts.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;part-1-input-gates\&quot;&gt;Part 1: Input Gates&lt;/h3&gt;\n            &lt;a href=\&quot;#part-1-input-gates\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Let&amp;#39;s go back to our original example. Can we make this example &amp;quot;just work&amp;quot;, even in the face of concurrent requests?&lt;/p&gt;\n            &lt;pre class=\&quot;language-javascript\&quot;&gt;&lt;code class=\&quot;language-javascript\&quot;&gt;// Can this &amp;quot;just work&amp;quot; please?\nasync function getUniqueNumber() {\n  let val = await this.storage.get(&amp;quot;counter&amp;quot;);\n  await this.storage.put(&amp;quot;counter&amp;quot;, val + 1);\n  return val;\n}&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;It turns out we can! We create a new rule:&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;&lt;b&gt;Input gates:&lt;/b&gt; While a storage operation is executing, no events shall be delivered to the object except for storage completion events. Any other events will be deferred until such a time as the object is no longer executing JavaScript code &lt;i&gt;and&lt;/i&gt; is no longer waiting for any storage operations. We say that these events are waiting for the &amp;quot;input gate&amp;quot; to open.&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;If we do this, then our storage operations above are no longer an opportunity for concurrency. Our concurrent requests now look like this:&lt;/p&gt;&lt;style type=\&quot;text/css\&quot;&gt;\n.tg  {border-collapse:collapse;border-spacing:0;margin:0px auto;}\n.tg td{border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;\n  overflow:hidden;padding:10px 5px;word-break:normal;}\n.tg th{border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;\n  font-weight:normal;overflow:hidden;padding:10px 5px;word-break:normal;}\n.tg .tg-tsrn{background-color:#F5F2F0;color:#708090;text-align:left;vertical-align:top}\n.tg .tg-jf6t{background-color:#FFF;color:#36393A;text-align:left;vertical-align:middle}\n.tg .tg-d46s{background-color:#F5F2F0;color:#36393A;text-align:left;vertical-align:top}\n.tg .tg-jwid{background-color:#F5F2F0;color:#07A;text-align:left;vertical-align:top}\n@media screen and (max-width: 767px) {.tg {width: auto !important;}.tg col {width: auto !important;}.tg-wrap {overflow-x: auto;-webkit-overflow-scrolling: touch;margin: auto 0px;}}&lt;/style&gt;\n&lt;div class=\&quot;tg-wrap\&quot;&gt;&lt;table class=\&quot;tg\&quot;&gt;&lt;thead&gt;\n  &lt;tr&gt;\n    &lt;th class=\&quot;tg-jf6t\&quot;&gt;Request 1 timeline&lt;/th&gt;\n    &lt;th class=\&quot;tg-jf6t\&quot;&gt;Request 2 timeline&lt;/th&gt;\n  &lt;/tr&gt;&lt;/thead&gt;\n&lt;tbody&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-jwid\&quot;&gt;&lt;span style=\&quot;color:#07A\&quot;&gt;async&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt; &lt;/span&gt;&lt;span style=\&quot;color:#07A\&quot;&gt;function&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt; &lt;/span&gt;&lt;span style=\&quot;color:#DD4A68\&quot;&gt;getUniqueNumber&lt;/span&gt;&lt;span style=\&quot;color:#999\&quot;&gt;()&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt; &lt;/span&gt;&lt;span style=\&quot;color:#999\&quot;&gt;{&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;span style=\&quot;color:#07A\&quot;&gt;let&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt; val &lt;/span&gt;&lt;span style=\&quot;color:#A67F59;background-color:rgba(255, 255, 255, 0.5)\&quot;&gt;=&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt; &lt;/span&gt;&lt;span style=\&quot;color:#07A\&quot;&gt;await&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt; &lt;/span&gt;&lt;span style=\&quot;color:#07A\&quot;&gt;this&lt;/span&gt;&lt;span style=\&quot;color:#999\&quot;&gt;.&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt;storage&lt;/span&gt;&lt;span style=\&quot;color:#999\&quot;&gt;.&lt;/span&gt;&lt;span style=\&quot;color:#07A\&quot;&gt;get&lt;/span&gt;&lt;span style=\&quot;color:#999\&quot;&gt;(&lt;/span&gt;&lt;span style=\&quot;color:#690\&quot;&gt;\&quot;counter\&quot;&lt;/span&gt;&lt;span style=\&quot;color:#999\&quot;&gt;);&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-d46s\&quot;&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-d46s\&quot;&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-tsrn\&quot;&gt;&lt;span style=\&quot;color:slategray\&quot;&gt;// Request 2 delivery is blocked because&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt; &lt;/span&gt;&lt;span style=\&quot;color:slategray\&quot;&gt;// request 1 is waiting for storage.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-d46s\&quot;&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;span style=\&quot;color:#07A\&quot;&gt;await&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt; &lt;/span&gt;&lt;span style=\&quot;color:#07A\&quot;&gt;this&lt;/span&gt;&lt;span style=\&quot;color:#999\&quot;&gt;.&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt;storage&lt;/span&gt;&lt;span style=\&quot;color:#999\&quot;&gt;.&lt;/span&gt;&lt;span style=\&quot;color:#DD4A68\&quot;&gt;put&lt;/span&gt;&lt;span style=\&quot;color:#999\&quot;&gt;(&lt;/span&gt;&lt;span style=\&quot;color:#690\&quot;&gt;\&quot;counter\&quot;&lt;/span&gt;&lt;span style=\&quot;color:#999\&quot;&gt;,&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt; val &lt;/span&gt;&lt;span style=\&quot;color:#A67F59;background-color:rgba(255, 255, 255, 0.5)\&quot;&gt;+&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt; &lt;/span&gt;&lt;span style=\&quot;color:#905\&quot;&gt;1&lt;/span&gt;&lt;span style=\&quot;color:#999\&quot;&gt;);&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-d46s\&quot;&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt; &lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-d46s\&quot;&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-tsrn\&quot;&gt;&lt;span style=\&quot;color:slategray\&quot;&gt;// Request 2 delivery is blocked because&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt; &lt;/span&gt;&lt;span style=\&quot;color:slategray\&quot;&gt;// request 1 is waiting for storage.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-d46s\&quot;&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;span style=\&quot;color:#07A\&quot;&gt;return&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt; val&lt;/span&gt;&lt;span style=\&quot;color:#999\&quot;&gt;;&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt; &lt;/span&gt;&lt;span style=\&quot;color:#999\&quot;&gt;}&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-d46s\&quot;&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-d46s\&quot;&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-jwid\&quot;&gt;&lt;span style=\&quot;color:#07A\&quot;&gt;async&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt; &lt;/span&gt;&lt;span style=\&quot;color:#07A\&quot;&gt;function&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt; &lt;/span&gt;&lt;span style=\&quot;color:#DD4A68\&quot;&gt;getUniqueNumber&lt;/span&gt;&lt;span style=\&quot;color:#999\&quot;&gt;()&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt; &lt;/span&gt;&lt;span style=\&quot;color:#999\&quot;&gt;{&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;span style=\&quot;color:#07A\&quot;&gt;let&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt; val &lt;/span&gt;&lt;span style=\&quot;color:#A67F59;background-color:rgba(255, 255, 255, 0.5)\&quot;&gt;=&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt; &lt;/span&gt;&lt;span style=\&quot;color:#07A\&quot;&gt;await&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt; &lt;/span&gt;&lt;span style=\&quot;color:#07A\&quot;&gt;this&lt;/span&gt;&lt;span style=\&quot;color:#999\&quot;&gt;.&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt;storage&lt;/span&gt;&lt;span style=\&quot;color:#999\&quot;&gt;.&lt;/span&gt;&lt;span style=\&quot;color:#07A\&quot;&gt;get&lt;/span&gt;&lt;span style=\&quot;color:#999\&quot;&gt;(&lt;/span&gt;&lt;span style=\&quot;color:#690\&quot;&gt;\&quot;counter\&quot;&lt;/span&gt;&lt;span style=\&quot;color:#999\&quot;&gt;);&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;span style=\&quot;color:#07A\&quot;&gt;await&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt; &lt;/span&gt;&lt;span style=\&quot;color:#07A\&quot;&gt;this&lt;/span&gt;&lt;span style=\&quot;color:#999\&quot;&gt;.&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt;storage&lt;/span&gt;&lt;span style=\&quot;color:#999\&quot;&gt;.&lt;/span&gt;&lt;span style=\&quot;color:#DD4A68\&quot;&gt;put&lt;/span&gt;&lt;span style=\&quot;color:#999\&quot;&gt;(&lt;/span&gt;&lt;span style=\&quot;color:#690\&quot;&gt;\&quot;counter\&quot;&lt;/span&gt;&lt;span style=\&quot;color:#999\&quot;&gt;,&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt; val &lt;/span&gt;&lt;span style=\&quot;color:#A67F59;background-color:rgba(255, 255, 255, 0.5)\&quot;&gt;+&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt; &lt;/span&gt;&lt;span style=\&quot;color:#905\&quot;&gt;1&lt;/span&gt;&lt;span style=\&quot;color:#999\&quot;&gt;);&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;span style=\&quot;color:#07A\&quot;&gt;return&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt; val&lt;/span&gt;&lt;span style=\&quot;color:#999\&quot;&gt;;&lt;/span&gt;&lt;span style=\&quot;color:black;background-color:initial\&quot;&gt; &lt;/span&gt;&lt;span style=\&quot;color:#999\&quot;&gt;}&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;The two calls return unique numbers, as expected. Hooray! (Unfortunately, we did it by delaying the second request, creating latency and reducing throughput -- but we&amp;#39;ll address that in part 3, below.)&lt;/p&gt;&lt;p&gt;Note that our rule does not preclude making multiple concurrent requests to storage at the same time. You can still say:&lt;/p&gt;\n            &lt;pre class=\&quot;language-javascript\&quot;&gt;&lt;code class=\&quot;language-javascript\&quot;&gt;let promise1 = this.storage.get(&amp;quot;foo&amp;quot;);\nlet promise2 = this.storage.put(&amp;quot;bar&amp;quot;, 123);\nawait promise1;\nfrob();\nawait promise2;&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;Here, the &lt;code&gt;get()&lt;/code&gt; and &lt;code&gt;put()&lt;/code&gt; execute concurrently. Moreover, the call to &lt;code&gt;frob()&lt;/code&gt; may execute before the &lt;code&gt;put()&lt;/code&gt; has completed (but strictly after the &lt;code&gt;get()&lt;/code&gt; completes, since we &lt;code&gt;await&lt;/code&gt;ed that promise). However, no &lt;i&gt;other&lt;/i&gt; event -- such as receiving a new request -- can unexpectedly happen in the meantime.&lt;/p&gt;&lt;p&gt;On the other hand, the rule protects you not just against concurrent incoming requests, but also concurrent responses to outgoing requests. For example, say you have:&lt;/p&gt;\n            &lt;pre class=\&quot;language-javascript\&quot;&gt;&lt;code class=\&quot;language-javascript\&quot;&gt;async function task1() {\n  await fetch(&amp;quot;https://example.com/api1&amp;quot;);\n  return await this.getUniqueNumber();\n}\nasync function task2() {\n  await fetch(&amp;quot;https://example.com/api2&amp;quot;);\n  return await this.getUniqueNumber();\n}\nlet promise1 = task1();\nlet promise2 = task2();\nlet val1 = await promise1;\nlet val2 = await promise2;&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;This code launches two &lt;code&gt;fetch()&lt;/code&gt; calls concurrently. After each fetch completes, getUniqueNumber() is invoked. Could the two calls interfere with each other?&lt;/p&gt;&lt;p&gt;No, they will not. The completion of a &lt;code&gt;fetch()&lt;/code&gt; is itself a kind of event. Our rule states that such events cannot be delivered while storage events are in progress. When the first of the two fetches returns, the app calls &lt;code&gt;getUniqueNumber()&lt;/code&gt;, which starts performing some storage operations. If the second &lt;code&gt;fetch()&lt;/code&gt; also returns while these storage operations are still outstanding, that return will be deferred until after the storage operations are done. Once again, our code ends up correct!&lt;/p&gt;&lt;p&gt;At this point, the async programming experts in the audience are probably starting to feel like something is fishy here. Indeed, there is a catch. What if we do:&lt;/p&gt;\n            &lt;pre class=\&quot;language-javascript\&quot;&gt;&lt;code class=\&quot;language-javascript\&quot;&gt;// Still a problem even with input gates.\nlet promise1 = getUniqueNumber();\nlet promise2 = getUniqueNumber();\nlet val1 = await promise1;\nlet val2 = await promise2;&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;In this case, there is, in fact, a problem. Two calls to &lt;code&gt;getUniqueNumber()&lt;/code&gt; are initiated &lt;i&gt;by the same event&lt;/i&gt;. The application does not &lt;code&gt;await&lt;/code&gt; the first call before starting the second, so the two calls end up running concurrently. Our special rule doesn&amp;#39;t protect us here, because there is no incoming event that can be deferred between when the two calls are made. From the system&amp;#39;s point of view, there&amp;#39;s no way to distinguish this code from code which legitimately decided to perform two storage operations in parallel.&lt;/p&gt;&lt;p&gt;As such, in this case, the two calls to &lt;code&gt;getUniqueNumber()&lt;/code&gt; will interfere with each other. However, this problem is far less likely to come about by accident, and is far easier to catch in testing. This bug is &lt;i&gt;deterministic&lt;/i&gt;, not caused by the unpredictable timing of network events. We consider this an acceptable caveat in order to solve the larger problem posed by concurrent requests.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;part-2-output-gates\&quot;&gt;Part 2: Output Gates&lt;/h3&gt;\n            &lt;a href=\&quot;#part-2-output-gates\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Let&amp;#39;s go back to our in-memory caching example. Can we make it work?&lt;/p&gt;\n            &lt;pre class=\&quot;language-javascript\&quot;&gt;&lt;code class=\&quot;language-javascript\&quot;&gt;// Can we make this &amp;quot;just work&amp;quot;?\nasync function getUniqueNumber() {\n  if (this.val === undefined) {\n    this.val = await this.storage.get(&amp;quot;counter&amp;quot;);\n  }\n\n  let result = this.val;\n  ++this.val;\n  this.storage.put(&amp;quot;counter&amp;quot;, this.val);\n  return result;\n}&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;With input gates (part 1), we&amp;#39;ve solved one of the two problems this code had: the race condition of initialization. We no longer need to worry that two requests will call this at the same time, leading &lt;code&gt;this.val&lt;/code&gt; to be initialized twice.&lt;/p&gt;&lt;p&gt;However, the problem with not &lt;code&gt;await&lt;/code&gt;ing the &lt;code&gt;put()&lt;/code&gt; is still there. If we don&amp;#39;t &lt;code&gt;await&lt;/code&gt; it, then we could lose data. If we do &lt;code&gt;await&lt;/code&gt; it, then the call is slow.&lt;/p&gt;&lt;p&gt;We make another new rule:&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;&lt;b&gt;Output gates:&lt;/b&gt; When a storage write operation is in progress, any new outgoing network messages will be held back until the write has completed. We say that these messages are waiting for the &amp;quot;output gate&amp;quot; to open. If the write ultimately fails, the outgoing network messages will be discarded and replaced with errors, while the Durable Object will be shut down and restarted from scratch.&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;With this rule, we no longer have to &lt;code&gt;await&lt;/code&gt; the result of &lt;code&gt;put()&lt;/code&gt;. Our code can happily continue executing and just &lt;i&gt;assume&lt;/i&gt; the put() will succeed. If the &lt;code&gt;put()&lt;/code&gt; doesn&amp;#39;t succeed, then anything the application does here will never be observable to the rest of the world anyway. For example, if the app prematurely sends a response to the user saying that the operation succeeded, this response will not actually be delivered until after the &lt;code&gt;put()&lt;/code&gt; completes successfully. So, by the time the user &lt;i&gt;receives&lt;/i&gt; the message, it is no longer &amp;quot;premature&amp;quot;! In the very rare event that the write operation fails, the user will not receive the premature confirmation at all.&lt;/p&gt;&lt;p&gt;Note that output gates apply not only to responses sent back to a client, but also to new outgoing requests made with &lt;code&gt;fetch()&lt;/code&gt; -- those requests will be delayed from being sent until all prior writes are confirmed. So, once again, it is impossible for anything else in the world to observe a premature confirmation.&lt;/p&gt;&lt;p&gt;With this change, our &lt;code&gt;getUniqueNumber()&lt;/code&gt; implementation with in-memory caching is now fully correct, while retaining most of its speed advantage over the non-caching implementation. Except for the very first call, the application will never be blocked waiting for &lt;code&gt;getUniqueNumber()&lt;/code&gt; to finish. The final response from the app to the client will be delayed pending write confirmation, but that write can be performed in parallel with any writes the application performs after &lt;code&gt;getUniqueNumber()&lt;/code&gt; completes.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;part-3-automatic-in-memory-caching\&quot;&gt;Part 3: Automatic in-memory caching&lt;/h3&gt;\n            &lt;a href=\&quot;#part-3-automatic-in-memory-caching\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Our in-memory caching example now works great. But, it&amp;#39;s still a little bit complicated and unnatural to write. Let&amp;#39;s go back to our original, simple code one more time… can we make it fast by default?&lt;/p&gt;\n            &lt;pre class=\&quot;language-javascript\&quot;&gt;&lt;code class=\&quot;language-javascript\&quot;&gt;// Can we make this not just work, but just work FAST?\nasync function getUniqueNumber() {\n  let val = await this.storage.get(&amp;quot;counter&amp;quot;);\n  await this.storage.put(&amp;quot;counter&amp;quot;, val + 1);\n  return val;\n}&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;The answer to this part is a classic one: we can add automatic caching to the storage layer, just like most operating systems do for disk storage.&lt;/p&gt;&lt;p&gt;We have rolled out an in-memory caching layer for Durable Objects. This layer keeps up to several megabytes worth of data directly in memory in the process where the object runs.&lt;/p&gt;&lt;p&gt;When a &lt;code&gt;get()&lt;/code&gt; requests a key that is in cache, the operation returns immediately, without even context-switching out of the thread and isolate where the object is hosted. If the key is not in cache, then a storage request will still be needed, but reads complete relatively quickly.&lt;/p&gt;&lt;p&gt;Better yet, &lt;code&gt;put()&lt;/code&gt; requests now always complete &amp;quot;instantaneously&amp;quot;. A &lt;code&gt;put()&lt;/code&gt; simply writes to cache. We rely on output gates (&amp;quot;part 2&amp;quot;, above) to prevent the premature confirmation of writes to any external party. Writes will be coalesced (even if you &lt;code&gt;await&lt;/code&gt; them), so that the output gate waits only for O(1) network round trips of latency, not O(n).&lt;/p&gt;&lt;p&gt;Moreover, because &lt;code&gt;get()&lt;/code&gt; and &lt;code&gt;put()&lt;/code&gt; now complete instantly in most or all cases, the negative impact of input gates on throughput is largely mitigated, because the gate now spends relatively little time blocked.&lt;/p&gt;&lt;p&gt;With Durable Objects built-in caching, our simple code is now &lt;i&gt;just as fast&lt;/i&gt; as our code that manually implemented in-memory caching. Combined with input and output gates, our code is now simple, fast, &lt;i&gt;and&lt;/i&gt; correct, all at the same time.&lt;/p&gt;&lt;h4&gt;Bonus Correctness&lt;/h4&gt;&lt;p&gt;Our caching layer provides some bonus consistency guarantees, in addition to performance.&lt;/p&gt;&lt;p&gt;First, writes are automatically coalesced. That is, if you perform multiple &lt;code&gt;put()&lt;/code&gt; or &lt;code&gt;delete()&lt;/code&gt; operations without &lt;code&gt;await&lt;/code&gt;ing them or anything else in between, then the operations are automatically grouped together and stored atomically. In the case of a sudden power failure, after coming back up, either all of the writes will have been stored, or none of them will. For example:&lt;/p&gt;\n            &lt;pre class=\&quot;language-javascript\&quot;&gt;&lt;code class=\&quot;language-javascript\&quot;&gt;// Move a value from &amp;quot;foo&amp;quot; to &amp;quot;bar&amp;quot;.\nlet val = await this.storage.get(&amp;quot;foo&amp;quot;);\n\nthis.storage.delete(&amp;quot;foo&amp;quot;);\nthis.storage.put(&amp;quot;bar&amp;quot;, val);\n// There&amp;#039;s no possibility of data loss, because the delete() and the\n// following put() are automatically coalesced into one atomic\n// operation. This is true as long as you do not `await` anything\n// in between.&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;Second, the API is also able to provide stronger ordering guarantees for reads. Previously, overlapping storage operations did not have guaranteed ordering. For example, if you issued a &lt;code&gt;get()&lt;/code&gt; and a &lt;code&gt;put()&lt;/code&gt; on the same key at the same time (without &lt;code&gt;await&lt;/code&gt;ing one before starting the other), then it was not deterministic whether the &lt;code&gt;get()&lt;/code&gt; might return the value written by the &lt;code&gt;put()&lt;/code&gt; -- regardless of the ordering of the statements in your code. The caching layer fixes this. Now, operations are performed in exactly the order in which they were initiated, regardless of when they complete.&lt;/p&gt;&lt;p&gt;These two features eliminate more subtle bugs that might otherwise be hard to catch in testing, so that you don&amp;#39;t have to be a database expert to write code that works.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;optional-bypass\&quot;&gt;Optional Bypass&lt;/h3&gt;\n            &lt;a href=\&quot;#optional-bypass\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;We expect gates and caching will be a win in the vast majority of use cases, but not always. In some use cases, concurrency won&amp;#39;t lead to any problems, and so blocking it may be a loss. Sometimes, the application is OK with prematurely confirming writes in order to minimize latency. And sometimes, caching may just waste memory because the same keys are not frequently accessed.&lt;/p&gt;&lt;p&gt;For those cases, we offer explicit bypasses:&lt;/p&gt;\n            &lt;pre class=\&quot;language-javascript\&quot;&gt;&lt;code class=\&quot;language-javascript\&quot;&gt;this.storage.get(&amp;quot;foo&amp;quot;, {allowConcurrency: true, noCache: true});\nthis.storage.put(&amp;quot;foo&amp;quot;, &amp;quot;bar&amp;quot;, {allowUnconfirmed: true, noCache: true});&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;Developers who have taken the time to think carefully about these issues can use these flags to tune performance to their specific needs. For those who don&amp;#39;t want to think about it, the defaults should work well.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;conclusion\&quot;&gt;Conclusion&lt;/h2&gt;\n            &lt;a href=\&quot;#conclusion\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;Concurrency is hard. It doesn&amp;#39;t matter if you&amp;#39;re a novice or an expert: even experts regularly get it wrong. It&amp;#39;s difficult to think about all the ways that concurrent operations might overlap to corrupt your application state.&lt;/p&gt;&lt;p&gt;The traditional answer has been to make applications stateless, and defer all concurrency control to the database layer using transactions. However, transactions are slow, which is a big reason why so many web applications today take hundreds of milliseconds or more to respond to basic actions.&lt;/p&gt;&lt;p&gt;Durable Objects are all about state. By keeping state in memory in addition to on disk, and directing requests for the same data to be coordinated through the same instance, we can make applications much faster. But until recently, this was extremely tricky to get right.&lt;/p&gt;&lt;p&gt;With input gates, output gates, and caching, code written in the most intuitive way now &amp;quot;just works&amp;quot;, and runs fast. This means you can focus on building your application, without wasting time optimizing I/O performance and debugging obscure race conditions.&lt;/p&gt;&quot;],&quot;published_at&quot;:[0,&quot;2021-08-03T14:24:44.000+01:00&quot;],&quot;updated_at&quot;:[0,&quot;2024-10-16T01:39:04.001Z&quot;],&quot;feature_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1clasYXq4Bt8pwsICSXWl5/e8e98a1699ed5498c2c1b7f8b791e777/durable-objects-easy-fast-correct-choose-three.png&quot;],&quot;tags&quot;:[1,[[0,{&quot;id&quot;:[0,&quot;5v2UZdTRX1Rw9akmhexnxs&quot;],&quot;name&quot;:[0,&quot;Durable Objects&quot;],&quot;slug&quot;:[0,&quot;durable-objects&quot;]}]]],&quot;relatedTags&quot;:[0],&quot;authors&quot;:[1,[[0,{&quot;name&quot;:[0,&quot;Kenton Varda&quot;],&quot;slug&quot;:[0,&quot;kenton-varda&quot;],&quot;bio&quot;:[0,null],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1FFs4T2j1RyvxasKOkkdtP/e7bd05ce89c560a545853000a25da9bc/kenton-varda.jpg&quot;],&quot;location&quot;:[0,null],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,&quot;@kentonvarda&quot;],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}]]],&quot;meta_description&quot;:[0,&quot;When multiple clients access the same storage concurrently, race conditions abound. Durable Objects can make it easier. We recently rolled out improvements to Durable Objects that automatically correct many common race conditions while actually making your code faster.&quot;],&quot;primary_author&quot;:[0,{}],&quot;localeList&quot;:[0,{&quot;name&quot;:[0,&quot;Durable Objects: Easy, Fast, Correct — Choose three Config&quot;],&quot;enUS&quot;:[0,&quot;English for Locale&quot;],&quot;zhCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhHansCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhTW&quot;:[0,&quot;No Page for Locale&quot;],&quot;frFR&quot;:[0,&quot;No Page for Locale&quot;],&quot;deDE&quot;:[0,&quot;No Page for Locale&quot;],&quot;itIT&quot;:[0,&quot;No Page for Locale&quot;],&quot;jaJP&quot;:[0,&quot;No Page for Locale&quot;],&quot;koKR&quot;:[0,&quot;No Page for Locale&quot;],&quot;ptBR&quot;:[0,&quot;No Page for Locale&quot;],&quot;esLA&quot;:[0,&quot;No Page for Locale&quot;],&quot;esES&quot;:[0,&quot;No Page for Locale&quot;],&quot;enAU&quot;:[0,&quot;No Page for Locale&quot;],&quot;enCA&quot;:[0,&quot;No Page for Locale&quot;],&quot;enIN&quot;:[0,&quot;No Page for Locale&quot;],&quot;enGB&quot;:[0,&quot;No Page for Locale&quot;],&quot;idID&quot;:[0,&quot;No Page for Locale&quot;],&quot;ruRU&quot;:[0,&quot;No Page for Locale&quot;],&quot;svSE&quot;:[0,&quot;No Page for Locale&quot;],&quot;viVN&quot;:[0,&quot;No Page for Locale&quot;],&quot;plPL&quot;:[0,&quot;No Page for Locale&quot;],&quot;arAR&quot;:[0,&quot;No Page for Locale&quot;],&quot;nlNL&quot;:[0,&quot;No Page for Locale&quot;],&quot;thTH&quot;:[0,&quot;No Page for Locale&quot;],&quot;trTR&quot;:[0,&quot;No Page for Locale&quot;],&quot;heIL&quot;:[0,&quot;No Page for Locale&quot;],&quot;lvLV&quot;:[0,&quot;No Page for Locale&quot;],&quot;etEE&quot;:[0,&quot;No Page for Locale&quot;],&quot;ltLT&quot;:[0,&quot;No Page for Locale&quot;]}],&quot;url&quot;:[0,&quot;https://blog.cloudflare.com/durable-objects-easy-fast-correct-choose-three&quot;],&quot;metadata&quot;:[0,{&quot;title&quot;:[0,&quot;Durable Objects: Easy, Fast, Correct — Choose three&quot;],&quot;description&quot;:[0,&quot;When multiple clients access the same storage concurrently, race conditions abound. Durable Objects can make it easier. We recently rolled out improvements to Durable Objects that automatically correct many common race conditions while actually making your code faster.&quot;],&quot;imgPreview&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/508fF0TfxJ4UdAETGGY02r/4cf823d77fc913905101a0ca9e7cbd80/durable-objects-easy-fast-correct-choose-three-NneZC2.png&quot;]}],&quot;publicly_index&quot;:[0,true]}]]],&quot;translations&quot;:[0,{&quot;posts.by&quot;:[0,&quot;By&quot;],&quot;footer.gdpr&quot;:[0,&quot;GDPR&quot;],&quot;lang_blurb1&quot;:[0,&quot;This post is also available in {lang1}.&quot;],&quot;lang_blurb2&quot;:[0,&quot;This post is also available in {lang1} and {lang2}.&quot;],&quot;lang_blurb3&quot;:[0,&quot;This post is also available in {lang1}, {lang2} and {lang3}.&quot;],&quot;footer.press&quot;:[0,&quot;Press&quot;],&quot;header.title&quot;:[0,&quot;The Cloudflare Blog&quot;],&quot;search.clear&quot;:[0,&quot;Clear&quot;],&quot;search.filter&quot;:[0,&quot;Filter&quot;],&quot;search.source&quot;:[0,&quot;Source&quot;],&quot;footer.careers&quot;:[0,&quot;Careers&quot;],&quot;footer.company&quot;:[0,&quot;Company&quot;],&quot;footer.support&quot;:[0,&quot;Support&quot;],&quot;footer.the_net&quot;:[0,&quot;theNet&quot;],&quot;search.filters&quot;:[0,&quot;Filters&quot;],&quot;footer.our_team&quot;:[0,&quot;Our team&quot;],&quot;footer.webinars&quot;:[0,&quot;Webinars&quot;],&quot;page.more_posts&quot;:[0,&quot;More posts&quot;],&quot;posts.time_read&quot;:[0,&quot;{time} min read&quot;],&quot;search.language&quot;:[0,&quot;Language&quot;],&quot;footer.community&quot;:[0,&quot;Community&quot;],&quot;footer.resources&quot;:[0,&quot;Resources&quot;],&quot;footer.solutions&quot;:[0,&quot;Solutions&quot;],&quot;footer.trademark&quot;:[0,&quot;Trademark&quot;],&quot;header.subscribe&quot;:[0,&quot;Subscribe&quot;],&quot;footer.compliance&quot;:[0,&quot;Compliance&quot;],&quot;footer.free_plans&quot;:[0,&quot;Free plans&quot;],&quot;footer.impact_ESG&quot;:[0,&quot;Impact/ESG&quot;],&quot;posts.follow_on_X&quot;:[0,&quot;Follow on X&quot;],&quot;footer.help_center&quot;:[0,&quot;Help center&quot;],&quot;footer.network_map&quot;:[0,&quot;Network Map&quot;],&quot;header.please_wait&quot;:[0,&quot;Please Wait&quot;],&quot;page.related_posts&quot;:[0,&quot;Related posts&quot;],&quot;search.result_stat&quot;:[0,&quot;Results &lt;strong&gt;{search_range}&lt;/strong&gt; of &lt;strong&gt;{search_total}&lt;/strong&gt; for &lt;strong&gt;{search_keyword}&lt;/strong&gt;&quot;],&quot;footer.case_studies&quot;:[0,&quot;Case Studies&quot;],&quot;footer.connect_2024&quot;:[0,&quot;Connect 2024&quot;],&quot;footer.terms_of_use&quot;:[0,&quot;Terms of Use&quot;],&quot;footer.white_papers&quot;:[0,&quot;White Papers&quot;],&quot;footer.cloudflare_tv&quot;:[0,&quot;Cloudflare TV&quot;],&quot;footer.community_hub&quot;:[0,&quot;Community Hub&quot;],&quot;footer.compare_plans&quot;:[0,&quot;Compare plans&quot;],&quot;footer.contact_sales&quot;:[0,&quot;Contact Sales&quot;],&quot;header.contact_sales&quot;:[0,&quot;Contact Sales&quot;],&quot;header.email_address&quot;:[0,&quot;Email Address&quot;],&quot;page.error.not_found&quot;:[0,&quot;Page not found&quot;],&quot;footer.developer_docs&quot;:[0,&quot;Developer docs&quot;],&quot;footer.privacy_policy&quot;:[0,&quot;Privacy Policy&quot;],&quot;footer.request_a_demo&quot;:[0,&quot;Request a demo&quot;],&quot;page.continue_reading&quot;:[0,&quot;Continue reading&quot;],&quot;footer.analysts_report&quot;:[0,&quot;Analyst reports&quot;],&quot;footer.for_enterprises&quot;:[0,&quot;For enterprises&quot;],&quot;footer.getting_started&quot;:[0,&quot;Getting Started&quot;],&quot;footer.learning_center&quot;:[0,&quot;Learning Center&quot;],&quot;footer.project_galileo&quot;:[0,&quot;Project Galileo&quot;],&quot;pagination.newer_posts&quot;:[0,&quot;Newer Posts&quot;],&quot;pagination.older_posts&quot;:[0,&quot;Older Posts&quot;],&quot;posts.social_buttons.x&quot;:[0,&quot;Discuss on X&quot;],&quot;search.icon_aria_label&quot;:[0,&quot;Search&quot;],&quot;search.source_location&quot;:[0,&quot;Source/Location&quot;],&quot;footer.about_cloudflare&quot;:[0,&quot;About Cloudflare&quot;],&quot;footer.athenian_project&quot;:[0,&quot;Athenian Project&quot;],&quot;footer.become_a_partner&quot;:[0,&quot;Become a partner&quot;],&quot;footer.cloudflare_radar&quot;:[0,&quot;Cloudflare Radar&quot;],&quot;footer.network_services&quot;:[0,&quot;Network services&quot;],&quot;footer.trust_and_safety&quot;:[0,&quot;Trust &amp; Safety&quot;],&quot;header.get_started_free&quot;:[0,&quot;Get Started Free&quot;],&quot;page.search.placeholder&quot;:[0,&quot;Search Cloudflare&quot;],&quot;footer.cloudflare_status&quot;:[0,&quot;Cloudflare Status&quot;],&quot;footer.cookie_preference&quot;:[0,&quot;Cookie Preferences&quot;],&quot;header.valid_email_error&quot;:[0,&quot;Must be valid email.&quot;],&quot;search.result_stat_empty&quot;:[0,&quot;Results &lt;strong&gt;{search_range}&lt;/strong&gt; of &lt;strong&gt;{search_total}&lt;/strong&gt;&quot;],&quot;footer.connectivity_cloud&quot;:[0,&quot;Connectivity cloud&quot;],&quot;footer.developer_services&quot;:[0,&quot;Developer services&quot;],&quot;footer.investor_relations&quot;:[0,&quot;Investor relations&quot;],&quot;page.not_found.error_code&quot;:[0,&quot;Error Code: 404&quot;],&quot;search.autocomplete_title&quot;:[0,&quot;Insert a query. Press enter to send&quot;],&quot;footer.logos_and_press_kit&quot;:[0,&quot;Logos &amp; press kit&quot;],&quot;footer.application_services&quot;:[0,&quot;Application services&quot;],&quot;footer.get_a_recommendation&quot;:[0,&quot;Get a recommendation&quot;],&quot;posts.social_buttons.reddit&quot;:[0,&quot;Discuss on Reddit&quot;],&quot;footer.sse_and_sase_services&quot;:[0,&quot;SSE and SASE services&quot;],&quot;page.not_found.outdated_link&quot;:[0,&quot;You may have used an outdated link, or you may have typed the address incorrectly.&quot;],&quot;footer.report_security_issues&quot;:[0,&quot;Report Security Issues&quot;],&quot;page.error.error_message_page&quot;:[0,&quot;Sorry, we can&#39;t find the page you are looking for.&quot;],&quot;header.subscribe_notifications&quot;:[0,&quot;Subscribe to receive notifications of new posts:&quot;],&quot;footer.cloudflare_for_campaigns&quot;:[0,&quot;Cloudflare for Campaigns&quot;],&quot;header.subscription_confimation&quot;:[0,&quot;Subscription confirmed. Thank you for subscribing!&quot;],&quot;posts.social_buttons.hackernews&quot;:[0,&quot;Discuss on Hacker News&quot;],&quot;footer.diversity_equity_inclusion&quot;:[0,&quot;Diversity, equity &amp; inclusion&quot;],&quot;footer.critical_infrastructure_defense_project&quot;:[0,&quot;Critical Infrastructure Defense Project&quot;]}]}" ssr client="load" opts="{&quot;name&quot;:&quot;MorePosts&quot;,&quot;value&quot;:true}" await-children><div class="w-100 bt-l b--gray8"><h3 data-testid="more-posts-title" class="orange fw5 f4 ph3 mt4">MORE POSTS</h3></div><article data-testid="more-posts-article" class="w-100 w-100-m ph3 mb4"><p class="f3 fw5 gray1" data-iso-date="2025-02-25T14:00+00:00">February 25, 2025  2:00 PM</p><a href="/build-ai-agents-on-cloudflare/" class="no-underline gray1 f4 fw5"><h6 class="gray1 f4 fw5 mt2">Making Cloudflare the best platform for building AI Agents</h6></a><p class="gray1 lh-copy">Today we’re excited to share a few announcements on how we’re making it even easier to build AI agents on Cloudflare.<!-- -->...</p><ul class="flex pl0 fw6 f2"><span>By<!-- --> </span><li class="list flex items-center"><div class="author-name-tooltip"><a href="/author/rita/" class="fw5 f2 black no-underline">Rita Kozlov</a></div></li><li class="list flex items-center"><div class="author-name-tooltip"><span class="fw5 f2 black no-underline">, </span><a href="/author/sunil/" class="fw5 f2 black no-underline">Sunil Pai</a></div></li><li class="list flex items-center"><div class="author-name-tooltip"><span class="fw5 f2 black no-underline">, </span><a href="/author/silverlock/" class="fw5 f2 black no-underline">Matt Silverlock</a></div></li></ul><div class="flex flex-row flex-wrap"><div><a href="/tag/ai/" class="no-underline f1 fw2 blue3 underline-hover">AI</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/workers/" class="no-underline f1 fw2 blue3 underline-hover">Cloudflare Workers</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/durable-objects/" class="no-underline f1 fw2 blue3 underline-hover">Durable Objects</a></div></div></article><article data-testid="more-posts-article" class="w-100 w-100-m ph3 mb4"><p class="f3 fw5 gray1" data-iso-date="2024-10-24T14:05+01:00">October 24, 2024  1:05 PM</p><a href="/building-workflows-durable-execution-on-workers/" class="no-underline gray1 f4 fw5"><h6 class="gray1 f4 fw5 mt2">Build durable applications on Cloudflare Workers: you write the Workflows, we take care of the rest</h6></a><p class="gray1 lh-copy">Cloudflare Workflows is now in open beta! Workflows allows you to build reliable, repeatable, long-lived multi-step applications that can automatically retry, persist state, and scale out. Read on to learn how Workflows works, how we built it on top of Durable Objects, and how yo<!-- -->...</p><ul class="flex pl0 fw6 f2"><span>By<!-- --> </span><li class="list flex items-center"><div class="author-name-tooltip"><a href="/author/sid/" class="fw5 f2 black no-underline">Sid Chatterjee</a></div></li><li class="list flex items-center"><div class="author-name-tooltip"><span class="fw5 f2 black no-underline">, </span><a href="/author/silverlock/" class="fw5 f2 black no-underline">Matt Silverlock</a></div></li><li class="list flex items-center"><div class="author-name-tooltip"><span class="fw5 f2 black no-underline">, </span><a href="/author/celso/" class="fw5 f2 black no-underline">Celso Martinho</a></div></li></ul><div class="flex flex-row flex-wrap"><div><a href="/tag/developer-platform/" class="no-underline f1 fw2 blue3 underline-hover">Developer Platform</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/workers/" class="no-underline f1 fw2 blue3 underline-hover">Cloudflare Workers</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/durable-objects/" class="no-underline f1 fw2 blue3 underline-hover">Durable Objects</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/workflows/" class="no-underline f1 fw2 blue3 underline-hover">Workflows</a></div></div></article><article data-testid="more-posts-article" class="w-100 w-100-m ph3 mb4"><p class="f3 fw5 gray1" data-iso-date="2024-10-24T14:00+01:00">October 24, 2024  1:00 PM</p><a href="/billions-and-billions-of-logs-scaling-ai-gateway-with-the-cloudflare/" class="no-underline gray1 f4 fw5"><h6 class="gray1 f4 fw5 mt2">Billions and billions (of logs): scaling AI Gateway with the Cloudflare Developer Platform</h6></a><p class="gray1 lh-copy">How we scaled AI Gateway to handle and store billions of requests, using Cloudflare Workers, D1, Durable Objects, and R2.<!-- -->...</p><ul class="flex pl0 fw6 f2"><span>By<!-- --> </span><li class="list flex items-center"><div class="author-name-tooltip"><a href="/author/catarina-pires-mota/" class="fw5 f2 black no-underline">Catarina Pires Mota</a></div></li><li class="list flex items-center"><div class="author-name-tooltip"><span class="fw5 f2 black no-underline">, </span><a href="/author/gabriel-massadas/" class="fw5 f2 black no-underline">Gabriel Massadas</a></div></li><li class="list flex items-center"><div class="author-name-tooltip"><span class="fw5 f2 black no-underline">, </span><a href="/author/nelson-duarte/" class="fw5 f2 black no-underline">Nelson Duarte</a></div></li></ul><div class="flex flex-row flex-wrap"><div><a href="/tag/ai/" class="no-underline f1 fw2 blue3 underline-hover">AI</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/ai-gateway/" class="no-underline f1 fw2 blue3 underline-hover">AI Gateway</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/durable-objects/" class="no-underline f1 fw2 blue3 underline-hover">Durable Objects</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/d1/" class="no-underline f1 fw2 blue3 underline-hover">D1</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/developer-platform/" class="no-underline f1 fw2 blue3 underline-hover">Developer Platform</a></div></div></article><article data-testid="more-posts-article" class="w-100 w-100-m ph3 mb4"><p class="f3 fw5 gray1" data-iso-date="2024-10-24T14:00+01:00">October 24, 2024  1:00 PM</p><a href="/how-we-built-cloudflare-queues/" class="no-underline gray1 f4 fw5"><h6 class="gray1 f4 fw5 mt2">Durable Objects aren&#x27;t just durable, they&#x27;re fast: a 10x speedup for Cloudflare Queues</h6></a><p class="gray1 lh-copy">Learn how we built Cloudflare Queues using our own Developer Platform and how it evolved to a geographically-distributed, horizontally-scalable architecture built on Durable Objects. Our new architecture supports over 10x more throughput and over 3x lower latency compared to the <!-- -->...</p><ul class="flex pl0 fw6 f2"><span>By<!-- --> </span><li class="list flex items-center"><div class="author-name-tooltip"><a href="/author/josh/" class="fw5 f2 black no-underline">Josh Wheeler</a></div></li><li class="list flex items-center"><div class="author-name-tooltip"><span class="fw5 f2 black no-underline">, </span><a href="/author/siddhant/" class="fw5 f2 black no-underline">Siddhant Sinha</a></div></li><li class="list flex items-center"><div class="author-name-tooltip"><span class="fw5 f2 black no-underline">, </span><a href="/author/todd-mantell/" class="fw5 f2 black no-underline">Todd Mantell</a></div></li><li class="list flex items-center"><div class="author-name-tooltip"><span class="fw5 f2 black no-underline">, </span><a href="/author/pranshu-maheshwari/" class="fw5 f2 black no-underline">Pranshu Maheshwari</a></div></li></ul><div class="flex flex-row flex-wrap"><div><a href="/tag/product-news/" class="no-underline f1 fw2 blue3 underline-hover">Product News</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/cloudflare-queues/" class="no-underline f1 fw2 blue3 underline-hover">Cloudflare Queues</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/workers/" class="no-underline f1 fw2 blue3 underline-hover">Cloudflare Workers</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/durable-objects/" class="no-underline f1 fw2 blue3 underline-hover">Durable Objects</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/developers/" class="no-underline f1 fw2 blue3 underline-hover">Developers</a></div></div></article><article data-testid="more-posts-article" class="w-100 w-100-m ph3 mb4"><p class="f3 fw5 gray1" data-iso-date="2024-09-27T14:00+01:00">September 27, 2024  1:00 PM</p><a href="/container-platform-preview/" class="no-underline gray1 f4 fw5"><h6 class="gray1 f4 fw5 mt2">Our container platform is in production. It has GPUs. Here’s an early look</h6></a><p class="gray1 lh-copy">We’ve been working on something new — a platform for running containers across Cloudflare’s network. We already use it in production, for AI inference and more. Today we want to share an early look at<!-- -->...</p><ul class="flex pl0 fw6 f2"><span>By<!-- --> </span><li class="list flex items-center"><div class="author-name-tooltip"><a href="/author/brendan-irvine-broque/" class="fw5 f2 black no-underline">Brendan Irvine-Broque</a></div></li><li class="list flex items-center"><div class="author-name-tooltip"><span class="fw5 f2 black no-underline">, </span><a href="/author/thomas/" class="fw5 f2 black no-underline">Thomas Lefebvre</a></div></li><li class="list flex items-center"><div class="author-name-tooltip"><span class="fw5 f2 black no-underline">, </span><a href="/author/mike-nomitch/" class="fw5 f2 black no-underline">Mike Nomitch</a></div></li></ul><div class="flex flex-row flex-wrap"><div><a href="/tag/developers/" class="no-underline f1 fw2 blue3 underline-hover">Developers</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/developer-platform/" class="no-underline f1 fw2 blue3 underline-hover">Developer Platform</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/ai/" class="no-underline f1 fw2 blue3 underline-hover">AI</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/durable-objects/" class="no-underline f1 fw2 blue3 underline-hover">Durable Objects</a></div></div></article><article data-testid="more-posts-article" class="w-100 w-100-m ph3 mb4"><p class="f3 fw5 gray1" data-iso-date="2024-09-26T14:00+01:00">September 26, 2024  1:00 PM</p><a href="/sqlite-in-durable-objects/" class="no-underline gray1 f4 fw5"><h6 class="gray1 f4 fw5 mt2">Zero-latency SQLite storage in every Durable Object</h6></a><p class="gray1 lh-copy">Traditional cloud storage is inherently slow because it is accessed over a network and must synchronize many clients. But what if we could instead put your application code deep into the storage layer<!-- -->...</p><ul class="flex pl0 fw6 f2"><span>By<!-- --> </span><li class="list flex items-center"><div class="author-name-tooltip"><a href="/author/kenton-varda/" class="fw5 f2 black no-underline">Kenton Varda</a></div></li></ul><div class="flex flex-row flex-wrap"><div><a href="/tag/birthday-week/" class="no-underline f1 fw2 blue3 underline-hover">Birthday Week</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/product-news/" class="no-underline f1 fw2 blue3 underline-hover">Product News</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/workers/" class="no-underline f1 fw2 blue3 underline-hover">Cloudflare Workers</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/durable-objects/" class="no-underline f1 fw2 blue3 underline-hover">Durable Objects</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/developers/" class="no-underline f1 fw2 blue3 underline-hover">Developers</a></div></div></article><article data-testid="more-posts-article" class="w-100 w-100-m ph3 mb4"><p class="f3 fw5 gray1" data-iso-date="2024-04-05T14:00:56.000+01:00">April 05, 2024  1:00 PM</p><a href="/cloudflare-acquires-partykit/" class="no-underline gray1 f4 fw5"><h6 class="gray1 f4 fw5 mt2">Cloudflare acquires PartyKit to allow developers to build real-time multi-user applications</h6></a><p class="gray1 lh-copy">We&#x27;re thrilled to announce that PartyKit, a trailblazer in enabling developers to craft ambitious real-time, collaborative, multiplayer applications, is now a part of Cloudflare<!-- -->...</p><ul class="flex pl0 fw6 f2"><span>By<!-- --> </span><li class="list flex items-center"><div class="author-name-tooltip"><a href="/author/sunil/" class="fw5 f2 black no-underline">Sunil Pai</a></div></li><li class="list flex items-center"><div class="author-name-tooltip"><span class="fw5 f2 black no-underline">, </span><a href="/author/rita/" class="fw5 f2 black no-underline">Rita Kozlov</a></div></li></ul><div class="flex flex-row flex-wrap"><div><a href="/tag/developer-week/" class="no-underline f1 fw2 blue3 underline-hover">Developer Week</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/acquisitions/" class="no-underline f1 fw2 blue3 underline-hover">Acquisitions</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/workers/" class="no-underline f1 fw2 blue3 underline-hover">Cloudflare Workers</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/ai/" class="no-underline f1 fw2 blue3 underline-hover">AI</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/durable-objects/" class="no-underline f1 fw2 blue3 underline-hover">Durable Objects</a></div></div></article><article data-testid="more-posts-article" class="w-100 w-100-m ph3 mb4"><p class="f3 fw5 gray1" data-iso-date="2023-09-28T14:00:38.000+01:00">September 28, 2023  1:00 PM</p><a href="/running-serverless-puppeteer-workers-durable-objects/" class="no-underline gray1 f4 fw5"><h6 class="gray1 f4 fw5 mt2">Running Serverless Puppeteer with Workers and Durable Objects</h6></a><p class="gray1 lh-copy">We’ve heard from developers that configuring and maintaining their own serverless browser automation systems can be quite painful. The Workers Browser Rendering API solves this<!-- -->...</p><ul class="flex pl0 fw6 f2"><span>By<!-- --> </span><li class="list flex items-center"><div class="author-name-tooltip"><a href="/author/tanushree/" class="fw5 f2 black no-underline">Tanushree Sharma</a></div></li></ul><div class="flex flex-row flex-wrap"><div><a href="/tag/birthday-week/" class="no-underline f1 fw2 blue3 underline-hover">Birthday Week</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/product-news/" class="no-underline f1 fw2 blue3 underline-hover">Product News</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/durable-objects/" class="no-underline f1 fw2 blue3 underline-hover">Durable Objects</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/javascript/" class="no-underline f1 fw2 blue3 underline-hover">JavaScript</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/developers/" class="no-underline f1 fw2 blue3 underline-hover">Developers</a></div></div></article><article data-testid="more-posts-article" class="w-100 w-100-m ph3 mb4"><p class="f3 fw5 gray1" data-iso-date="2023-09-20T14:00:58.000+01:00">September 20, 2023  1:00 PM</p><a href="/how-waiting-room-queues/" class="no-underline gray1 f4 fw5"><h6 class="gray1 f4 fw5 mt2">How Waiting Room makes queueing decisions on Cloudflare&#x27;s highly distributed network</h6></a><p class="gray1 lh-copy">We want to give you a behind the scenes look at how we have evolved the core mechanism of our product–namely, exactly how it kicks in to queue traffic in response to spikes<!-- -->...</p><ul class="flex pl0 fw6 f2"><span>By<!-- --> </span><li class="list flex items-center"><div class="author-name-tooltip"><a href="/author/george/" class="fw5 f2 black no-underline">George Thomas</a></div></li></ul><div class="flex flex-row flex-wrap"><div><a href="/tag/waiting-room/" class="no-underline f1 fw2 blue3 underline-hover">Waiting Room</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/workers/" class="no-underline f1 fw2 blue3 underline-hover">Cloudflare Workers</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/durable-objects/" class="no-underline f1 fw2 blue3 underline-hover">Durable Objects</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/network/" class="no-underline f1 fw2 blue3 underline-hover">Network</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/developers/" class="no-underline f1 fw2 blue3 underline-hover">Developers</a></div></div></article><article data-testid="more-posts-article" class="w-100 w-100-m ph3 mb4"><p class="f3 fw5 gray1" data-iso-date="2022-08-05T16:45:57.000+01:00">August 05, 2022  3:45 PM</p><a href="/building-scheduling-system-with-workers-and-durable-objects/" class="no-underline gray1 f4 fw5"><h6 class="gray1 f4 fw5 mt2">Building a scheduling system with Workers and Durable Objects</h6></a><p class="gray1 lh-copy">In this post we&#x27;re going to show you how to build a scalable service that will schedule HTTP requests on a specific schedule or as one-off at a specific time <!-- -->...</p><ul class="flex pl0 fw6 f2"><span>By<!-- --> </span><li class="list flex items-center"><div class="author-name-tooltip"><a href="/author/adam-janis/" class="fw5 f2 black no-underline">Adam Janiš</a></div></li></ul><div class="flex flex-row flex-wrap"><div><a href="/tag/workers/" class="no-underline f1 fw2 blue3 underline-hover">Cloudflare Workers</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/durable-objects/" class="no-underline f1 fw2 blue3 underline-hover">Durable Objects</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/javascript/" class="no-underline f1 fw2 blue3 underline-hover">JavaScript</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/serverless/" class="no-underline f1 fw2 blue3 underline-hover">Serverless</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/edge/" class="no-underline f1 fw2 blue3 underline-hover">Edge</a></div></div></article><article data-testid="more-posts-article" class="w-100 w-100-m ph3 mb4"><p class="f3 fw5 gray1" data-iso-date="2022-05-17T13:58:47.000+01:00">May 17, 2022  12:58 PM</p><a href="/announcing-our-spring-developer-challenge/" class="no-underline gray1 f4 fw5"><h6 class="gray1 f4 fw5 mt2">Announcing our Spring Developer Challenge</h6></a><p class="gray1 lh-copy">After many announcements from Platform Week, we’re thrilled to make one more: our Spring Developer Challenge!<!-- -->...</p><ul class="flex pl0 fw6 f2"><span>By<!-- --> </span><li class="list flex items-center"><div class="author-name-tooltip"><a href="/author/albert/" class="fw5 f2 black no-underline">Albert Zhao</a></div></li></ul><div class="flex flex-row flex-wrap"><div><a href="/tag/developers/" class="no-underline f1 fw2 blue3 underline-hover">Developers</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/platform-week/" class="no-underline f1 fw2 blue3 underline-hover">Platform Week</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/workers/" class="no-underline f1 fw2 blue3 underline-hover">Cloudflare Workers</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/durable-objects/" class="no-underline f1 fw2 blue3 underline-hover">Durable Objects</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/cloudflare-pages/" class="no-underline f1 fw2 blue3 underline-hover">Cloudflare Pages</a></div></div></article><article data-testid="more-posts-article" class="w-100 w-100-m ph3 mb4"><p class="f3 fw5 gray1" data-iso-date="2022-05-11T13:59:17.000+01:00">May 11, 2022  12:59 PM</p><a href="/durable-objects-alarms/" class="no-underline gray1 f4 fw5"><h6 class="gray1 f4 fw5 mt2">Durable Objects Alarms — a wake-up call for your applications</h6></a><p class="gray1 lh-copy">Durable Object alarms let you call a function at a defined point in the future, unlocking deeper use-cases for Durable Objects like reliable queuing<!-- -->...</p><ul class="flex pl0 fw6 f2"><span>By<!-- --> </span><li class="list flex items-center"><div class="author-name-tooltip"><a href="/author/matt-alonso/" class="fw5 f2 black no-underline">Matt Alonso</a></div></li><li class="list flex items-center"><div class="author-name-tooltip"><span class="fw5 f2 black no-underline">, </span><a href="/author/greg/" class="fw5 f2 black no-underline">Greg McKeon</a></div></li></ul><div class="flex flex-row flex-wrap"><div><a href="/tag/platform-week/" class="no-underline f1 fw2 blue3 underline-hover">Platform Week</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/durable-objects/" class="no-underline f1 fw2 blue3 underline-hover">Durable Objects</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/product-news/" class="no-underline f1 fw2 blue3 underline-hover">Product News</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/serverless/" class="no-underline f1 fw2 blue3 underline-hover">Serverless</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/workers/" class="no-underline f1 fw2 blue3 underline-hover">Cloudflare Workers</a></div></div></article><article data-testid="more-posts-article" class="w-100 w-100-m ph3 mb4"><p class="f3 fw5 gray1" data-iso-date="2021-11-15T13:59:19.000+00:00">November 15, 2021  1:59 PM</p><a href="/developer-spotlight-guido-zuidhof-full-tilt/" class="no-underline gray1 f4 fw5"><h6 class="gray1 f4 fw5 mt2">Developer Spotlight: Winning a Game Jam with Jamstack and Durable Objects</h6></a><p class="gray1 lh-copy">Guido won the innovative category in one of the biggest Game Jams with a combination of Pages, Durable Objects, modern browser APIs, and a hefty amount of ingenuity.<!-- -->...</p><ul class="flex pl0 fw6 f2"><span>By<!-- --> </span><li class="list flex items-center"><div class="author-name-tooltip"><a href="/author/erwin/" class="fw5 f2 black no-underline">Erwin van der Koogh</a></div></li><li class="list flex items-center"><div class="author-name-tooltip"><span class="fw5 f2 black no-underline">, </span><a href="/author/guido/" class="fw5 f2 black no-underline">Guido Zuidhof (Guest Author)</a></div></li></ul><div class="flex flex-row flex-wrap"><div><a href="/tag/full-stack-week/" class="no-underline f1 fw2 blue3 underline-hover">Full Stack Week</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/developer-spotlight/" class="no-underline f1 fw2 blue3 underline-hover">Developer Spotlight</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/workers/" class="no-underline f1 fw2 blue3 underline-hover">Cloudflare Workers</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/durable-objects/" class="no-underline f1 fw2 blue3 underline-hover">Durable Objects</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/guest-post/" class="no-underline f1 fw2 blue3 underline-hover">Guest Post</a></div></div></article><article data-testid="more-posts-article" class="w-100 w-100-m ph3 mb4"><p class="f3 fw5 gray1" data-iso-date="2021-11-15T13:59:12.000+00:00">November 15, 2021  1:59 PM</p><a href="/durable-objects-ga/" class="no-underline gray1 f4 fw5"><h6 class="gray1 f4 fw5 mt2">Durable Objects — now Generally Available</h6></a><p class="gray1 lh-copy">Today, we’re announcing that Durable Objects are generally available and production-ready for you to use!<!-- -->...</p><ul class="flex pl0 fw6 f2"><span>By<!-- --> </span><li class="list flex items-center"><div class="author-name-tooltip"><a href="/author/greg/" class="fw5 f2 black no-underline">Greg McKeon</a></div></li></ul><div class="flex flex-row flex-wrap"><div><a href="/tag/full-stack-week/" class="no-underline f1 fw2 blue3 underline-hover">Full Stack Week</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/durable-objects/" class="no-underline f1 fw2 blue3 underline-hover">Durable Objects</a></div></div></article><article data-testid="more-posts-article" class="w-100 w-100-m ph3 mb4"><p class="f3 fw5 gray1" data-iso-date="2021-08-03T14:24:44.000+01:00">August 03, 2021  1:24 PM</p><a href="/durable-objects-easy-fast-correct-choose-three/" class="no-underline gray1 f4 fw5"><h6 class="gray1 f4 fw5 mt2">Durable Objects: Easy, Fast, Correct — Choose three</h6></a><p class="gray1 lh-copy">When multiple clients access the same storage concurrently, race conditions abound. Durable Objects can make it easier. We recently rolled out improvements to Durable Objects that automatically correct many common race conditions while actually making your code faster. <!-- -->...</p><ul class="flex pl0 fw6 f2"><span>By<!-- --> </span><li class="list flex items-center"><div class="author-name-tooltip"><a href="/author/kenton-varda/" class="fw5 f2 black no-underline">Kenton Varda</a></div></li></ul><div class="flex flex-row flex-wrap"><div><a href="/tag/durable-objects/" class="no-underline f1 fw2 blue3 underline-hover">Durable Objects</a></div></div></article><!--astro:end--></astro-island> <div class="pagination mw-100 center mv5 ph3 w-100 tc"><div class="center w-50-l w-100"><div class="flex items-center justify-center justify-around-m "><ul class="flex list ml3" style="padding-inline-start:inherit"><li class="gray"><a class="no-underline  underline-hover  dib-m dib-l mr1 gray3 " href="/tag/durable-objects/">1</a></li><li class=""><a class="no-underline  underline-hover  dib-m dib-l mr1 blue3" href="/tag/durable-objects/page/2/">2</a></li><li class="ml">…</li><li><a class="no-underline  underline-hover dib-m dib-l mr3 blue3" href="/tag/durable-objects/page/2/">2</a></li></ul><span><a class="no-underline blue3 underline-hover" data-testid="pagination-toggle-next" href="/tag/durable-objects/page/2/" rel="prev"><span class="underline-hover dn dib-m dib-l">Older Posts</span> →</a></span></div></div></div> </main>  <footer class="pt4 pb4 pl1 pr1 main-footer"><div class="mw8 center dn db-l ph3"><div class="flex flex-row justify-between"><div class="main-footer__menu-group"><ul id="getting-started-menu" class="list pl0"><li class="pt1 pb1 f1 main-footer__menu-group__header js-toggle-footer-group" data-submenu="getting-started-menu">Getting Started<i class="icon-caret-down"></i></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/plans/free/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="free-plans" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Free plans</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/enterprise/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="enterprise" class="f1 blue3 no-underline underline-hover" rel="noreferrer">For enterprises</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/plans/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="compare-plans" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Compare plans</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/about-your-website/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="get-a-recommendation" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Get a recommendation</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/plans/enterprise/demo/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="request-a-demo" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Request a demo</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/plans/enterprise/contact/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="contact-sales" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Contact Sales</a></li></ul></div><div class="main-footer__menu-group"><ul id="company-menu" class="list pl0"><li class="pt1 pb1 f1" data-submenu="company-menu">Resources<i class="icon-caret-down"></i></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/learning/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="learning-center" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Learning Center</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/analysts/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="analysts-report" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Analyst reports</a></li><li class="pt1 pb1"><a href="https://radar.cloudflare.com/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="overview" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Cloudflare Radar</a></li><li class="pt1 pb1"><a href="https://cloudflare.tv/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="tv" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Cloudflare TV</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/case-studies/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="case-studies" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Case Studies</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/resource-hub/?resourcetype=Webinar" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="webinars" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Webinars</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/resource-hub/?resourcetype=Whitepaper" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="white-papers" class="f1 blue3 no-underline underline-hover" rel="noreferrer">White Papers</a></li><li class="pt1 pb1"><a href="https://developers.cloudflare.com" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="developer-docs" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Developer docs</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/the-net/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="theNet" class="f1 blue3 no-underline underline-hover" rel="noreferrer">theNet</a></li></ul></div><div class="main-footer__menu-group"><ul id="sales-menu" class="list pl0"><li class="pt1 pb1 f1 main-footer__menu-group__header js-toggle-footer-group" data-submenu="sales-menu">Solutions<i class="icon-caret-down"></i></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/connectivity-cloud/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="connectivity-cloud" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Connectivity cloud</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/zero-trust/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="zero-trust" class="f1 blue3 no-underline underline-hover" rel="noreferrer">SSE and SASE services</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/application-services/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="application-services" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Application services</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/network-services/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="network-services" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Network services</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/developer-platform/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="developer-services" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Developer services</a></li></ul></div><div class="main-footer__menu-group"><ul id="community-menu" class="list pl0"><li class="pt1 pb1 f1 main-footer__menu-group__header js-toggle-footer-group" data-submenu="community-menu">Community<i class="icon-caret-down"></i></li><li class="pt1 pb1"><a href="https://community.cloudflare.com" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="community_hub" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Community Hub</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/galileo/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="galileo" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Project Galileo</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/athenian/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="athenian" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Athenian Project</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/campaigns/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="cloudflare-for-campaigns" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Cloudflare for Campaigns</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/partners/technology-partners/cidp/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="critical-infrastructure-defense-project" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Critical Infrastructure Defense Project</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/connect2024/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="connect-2024" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Connect 2024</a></li></ul></div><div class="main-footer__menu-group"><ul id="support-menu" class="list pl0"><li class="pt1 pb1 f1 main-footer__menu-group__header js-toggle-footer-group" data-submenu="support-menu">Support<i class="icon-caret-down"></i></li><li class="pt1 pb1"><a href="https://support.cloudflare.com" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="help-center" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Help center</a></li><li class="pt1 pb1"><a href="https://www.cloudflarestatus.com" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="status" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Cloudflare Status</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/compliance/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="compliance" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Compliance</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/gdpr/introduction/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="gdpr" class="f1 blue3 no-underline underline-hover" rel="noreferrer">GDPR</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/trust-hub/abuse-approach/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="trust-and-safety" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Trust &amp; Safety</a></li></ul></div><div class="main-footer__menu-group"><ul id="company-menu" class="list pl0"><li class="pt1 pb1 f1 main-footer__menu-group__header js-toggle-footer-group" data-submenu="company-menu">Company<i class="icon-caret-down"></i></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/about-overview/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="overview" class="f1 blue3 no-underline underline-hover" rel="noreferrer">About Cloudflare</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/people/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="our_team" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Our team</a></li><li class="pt1 pb1"><a href="https://cloudflare.net/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="investor-relations" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Investor relations</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/press/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="press" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Press</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/careers/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="careers" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Careers</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/diversity-equity-and-inclusion/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="diversity-equity-inclusion" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Diversity, equity &amp; inclusion</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/impact/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="impact-ESG" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Impact/ESG</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/network/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="network_map" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Network Map</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/press-kit/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="press-kit" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Logos &amp; press kit</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/partners/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="partners" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Become a partner</a></li></ul></div></div></div><div class="mw8 center ph3"><div class="flex flex-row flex-wrap justify-center md:justify-between items-center pt4"><div class="flex flex-row space-x-4 items-start w-25-l pb4 pb0-l"><a target="_blank" rel="noreferrer" href="https://www.facebook.com/Cloudflare/" class="w-8"><img class="w-8" src="https://www.cloudflare.com/img/footer/facebook.svg" alt="facebook"/></a><a target=" _blank" rel="noreferrer" href="https://x.com/Cloudflare" class="w-8"><img class="w-8" src="https://www.cloudflare.com/img/footer/twitter.svg" alt="X"/></a><a target="_blank" rel="noreferrer" href="https://www.linkedin.com/company/cloudflare" class="w-8"><img class="w-8" src="https://www.cloudflare.com/img/footer/linkedin.svg" alt="linkedin"/></a><a target="_blank" rel="noreferrer" href="https://www.youtube.com/cloudflare" class="w-8"><img class="w-8" src="https://www.cloudflare.com/img/footer/youtube.svg" alt="youtube"/></a><a target="_blank" rel="noreferrer" href="https://www.instagram.com/cloudflare" class="w-8"><img class="w-8" src="https://www.cloudflare.com/img/footer/instagram.svg" alt="instagram"/></a></div><div class="w-70-l tr-l tl-ns"><div><span class="main-footer__copyright f1">© <!-- -->2025<!-- --> Cloudflare, Inc.<!-- --> </span><span class="main-footer__copyright f1">|</span><a href="https://www.cloudflare.com/privacypolicy/" target="_blank" class="main-footer__copyright f1 no-underline underline-hover" rel="noreferrer"> <!-- -->Privacy Policy<!-- --> </a><span class="main-footer__copyright f1">|</span><a href="https://www.cloudflare.com/website-terms/" target="_blank" class="main-footer__copyright f1 no-underline underline-hover" rel="noreferrer"> <!-- -->Terms of Use<!-- --> </a><span class="main-footer__copyright f1">|</span><a href="https://www.cloudflare.com/disclosure/" target="_blank" class="main-footer__copyright f1 no-underline underline-hover" rel="noreferrer"> <!-- -->Report Security Issues<!-- --> </a><span class="main-footer__copyright f1">|</span><img class="mw2 ph1" src="/images/privacy-options.svg" alt="Privacy Options"/><a href="#cookie-settings" id="ot-sdk-btn" class="ot-sdk-show-settings main-footer__copyright f1 no-underline underline-hover"><span class="brandGray5">Cookie Preferences</span> </a><span class="main-footer__copyright f1">|</span><a href="https://www.cloudflare.com/trademark/" target="_blank" class="main-footer__copyright f1 no-underline underline-hover" rel="noreferrer"> <!-- -->Trademark<!-- --> </a></div></div></div></div></footer></html>
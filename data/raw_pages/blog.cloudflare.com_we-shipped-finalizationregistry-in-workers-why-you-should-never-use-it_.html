<!DOCTYPE html><script type="module" src="/_astro/index.astro_astro_type_script_index_0_lang.CoXd8L9s.js"></script> <html lang="en-us" dir="ltr"> <head><script async src="https://ot.www.cloudflare.com/public/vendor/onetrust/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" data-domain-script="b1e05d49-f072-4bae-9116-bdb78af15448"></script><meta name="HandheldFriendly" content="True"><meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="baidu-site-verification" content="KeThzeyMOr"><meta name="baidu-site-verification" content="code-NIlrS7gNhx"><meta charset="UTF-8"><meta name="description" content="Cloudflare Workers now support FinalizationRegistry, but just because you can use it doesn’t mean you should. Dive into the tricky world of JavaScript and WebAssembly memory management and see why newer features make life a lot easier."><title>We shipped FinalizationRegistry in Workers: why you should never use it</title><meta name="title" content="We shipped FinalizationRegistry in Workers: why you should never use it"><meta name="msvalidate.01" content="CF295E1604697F9CAD18B5A232E871F6"><meta class="swiftype" name="language" data-type="string" content="en"><script src="/static/z/i.js" type="text/javascript" referrerpolicy="origin"></script><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/favicon-32x32.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-32x32.png"><link rel="mask-icon" href="/images/favicon-32x32.png" color="#f78100"><link rel="stylesheet" href="/themes/ashes.min.css"><link rel="sitemap" href="/sitemap.xml"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"><link rel="canonical" href="https://blog.cloudflare.com/we-shipped-finalizationregistry-in-workers-why-you-should-never-use-it/"><link rel="alternate" hreflang="en-us" href="https://blog.cloudflare.com/we-shipped-finalizationregistry-in-workers-why-you-should-never-use-it/"><!-- General Meta Tags --><meta property="article:published_time" content="2025-06-11T14:00+01:00"><meta property="article:modified_time" content="2025-06-11T13:00:03.311Z"><meta property="article:tag" content="Cloudflare Workers"><meta property="article:tag" content="WebAssembly"><meta property="article:tag" content="JavaScript"><meta property="article:publisher" content="https://www.facebook.com/cloudflare"><!-- Facebook Meta Tags --><meta property="og:site_name" content="The Cloudflare Blog"><meta property="og:type" content="article"><meta property="og:title" content="We shipped FinalizationRegistry in Workers: why you should never use it"><meta property="og:description" content="Cloudflare Workers now support FinalizationRegistry, but just because you can use it doesn’t mean you should. Dive into the tricky world of JavaScript and WebAssembly memory management and see why newer features make life a lot easier. "><meta property="og:url" content="https://blog.cloudflare.com/we-shipped-finalizationregistry-in-workers-why-you-should-never-use-it/"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="628"><!-- Twitter/X Meta Tags --><meta name="twitter:title" content="We shipped FinalizationRegistry in Workers: why you should never use it"><meta name="twitter:description" content="Cloudflare Workers now support FinalizationRegistry, but just because you can use it doesn’t mean you should. Dive into the tricky world of JavaScript and WebAssembly memory management and see why newer features make life a lot easier. "><meta name="twitter:url" content="https://blog.cloudflare.com/we-shipped-finalizationregistry-in-workers-why-you-should-never-use-it/"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:label1" content="Written by"><meta name="twitter:data1" content="Ketan Gupta"><meta name="twitter:label2" content="Filed under"><meta name="twitter:data2" content="Cloudflare Workers,WebAssembly,JavaScript"><meta name="twitter:site" content="@cloudflare"><meta property="og:image" content="https://cf-assets.www.cloudflare.com/zkvhlag99gkb/3qcV6p7f2TQDnrcte9HS0w/1488188579d497e0756b603e8e41091f/We_shipped_FinalizationRegistry_in_Workers-_why_you_should_never_use_it-OG.png"><meta name="twitter:image" content="https://cf-assets.www.cloudflare.com/zkvhlag99gkb/3qcV6p7f2TQDnrcte9HS0w/1488188579d497e0756b603e8e41091f/We_shipped_FinalizationRegistry_in_Workers-_why_you_should_never_use_it-OG.png"><link rel="stylesheet" href="/_astro/index.DAblDsYO.css"></head><style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).only=e;window.dispatchEvent(new Event("astro:only"));})();;(()=>{var A=Object.defineProperty;var g=(i,o,a)=>o in i?A(i,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[o]=a;var d=(i,o,a)=>g(i,typeof o!="symbol"?o+"":o,a);{let i={0:t=>m(t),1:t=>a(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(a(t)),5:t=>new Set(a(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t),11:t=>1/0*t},o=t=>{let[l,e]=t;return l in i?i[l](e):void 0},a=t=>t.map(o),m=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([l,e])=>[l,o(e)]));class y extends HTMLElement{constructor(){super(...arguments);d(this,"Component");d(this,"hydrator");d(this,"hydrate",async()=>{var b;if(!this.hydrator||!this.isConnected)return;let e=(b=this.parentElement)==null?void 0:b.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let c=this.querySelectorAll("astro-slot"),n={},h=this.querySelectorAll("template[data-astro-template]");for(let r of h){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of c){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("name")||"default"]=r.innerHTML)}let p;try{p=this.hasAttribute("props")?m(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",v=this.getAttribute("component-export");throw v&&(s+=` (export ${v})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}let u;await this.hydrator(this)(this.Component,p,n,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))});d(this,"unmount",()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))})}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(!this.hasAttribute("await-children")||document.readyState==="interactive"||document.readyState==="complete")this.childrenConnectedCallback();else{let e=()=>{document.removeEventListener("DOMContentLoaded",e),c.disconnect(),this.childrenConnectedCallback()},c=new MutationObserver(()=>{var n;((n=this.lastChild)==null?void 0:n.nodeType)===Node.COMMENT_NODE&&this.lastChild.nodeValue==="astro:end"&&(this.lastChild.remove(),e())});c.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",e)}}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}async start(){let e=JSON.parse(this.getAttribute("opts")),c=this.getAttribute("client");if(Astro[c]===void 0){window.addEventListener(`astro:${c}`,()=>this.start(),{once:!0});return}try{await Astro[c](async()=>{let n=this.getAttribute("renderer-url"),[h,{default:p}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),u=this.getAttribute("component-export")||"default";if(!u.includes("."))this.Component=h[u];else{this.Component=h;for(let f of u.split("."))this.Component=this.Component[f]}return this.hydrator=p,this.hydrate},e,this)}catch(n){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,n)}}attributeChangedCallback(){this.hydrate()}}d(y,"observedAttributes",["props"]),customElements.get("astro-island")||customElements.define("astro-island",y)}})();</script><astro-island uid="Z18zq7w" component-url="/_astro/GoogleAnalytics.o7SaAFZX.js" component-export="GoogleAnalytics" renderer-url="/_astro/client.DLO1yDVm.js" props="{&quot;title&quot;:[0,&quot;We shipped FinalizationRegistry in Workers: why you should never use it&quot;],&quot;canonical&quot;:[0,&quot;https://blog.cloudflare.com/we-shipped-finalizationregistry-in-workers-why-you-should-never-use-it&quot;],&quot;info&quot;:[0,{&quot;id&quot;:[0,&quot;3cuVG8K7iSqKV8O3fNrAYK&quot;],&quot;title&quot;:[0,&quot;We shipped FinalizationRegistry in Workers: why you should never use it&quot;],&quot;slug&quot;:[0,&quot;we-shipped-finalizationregistry-in-workers-why-you-should-never-use-it&quot;],&quot;excerpt&quot;:[0,&quot;Cloudflare Workers now support FinalizationRegistry, but just because you can use it doesn’t mean you should.&quot;],&quot;featured&quot;:[0,false],&quot;html&quot;:[0,&quot;&lt;p&gt;We’ve recently added support for the &lt;a href=\&quot;https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/FinalizationRegistry\&quot;&gt;&lt;u&gt;FinalizationRegistry API&lt;/u&gt;&lt;/a&gt; in Cloudflare Workers. This API allows developers to request a callback when a JavaScript object is garbage-collected, a feature that can be particularly relevant for managing external resources, such as memory allocated by &lt;a href=\&quot;https://developer.mozilla.org/en-US/docs/WebAssembly\&quot;&gt;&lt;u&gt;WebAssembly&lt;/u&gt;&lt;/a&gt; (Wasm). However, despite its availability, our general advice is: &lt;b&gt;avoid using it directly in most scenarios.&lt;/b&gt;&lt;/p&gt;&lt;p&gt;Our decision to add &lt;code&gt;FinalizationRegistry&lt;/code&gt; — while still cautioning against using it — opens up a bigger conversation: how memory management works when JavaScript and WebAssembly share the same runtime. This is becoming more common in high-performance web apps, and getting it wrong can lead to memory leaks, out-of-memory errors, and performance issues, especially in resource-constrained environments like Cloudflare Workers.&lt;/p&gt;&lt;p&gt;In this post, we’ll look at how JavaScript and Wasm handle memory differently, why that difference matters, and what &lt;code&gt;FinalizationRegistry&lt;/code&gt; is actually useful for. We’ll also explain its limitations, particularly around timing and predictability, walk through why we decided to support it, and how we’ve made it safer to use. Finally, we’ll talk about how newer JavaScript language features offer a more reliable and structured approach to solving these problems.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;memory-management-101\&quot;&gt;Memory management 101&lt;/h2&gt;\n            &lt;a href=\&quot;#memory-management-101\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          \n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;javascript\&quot;&gt;JavaScript&lt;/h3&gt;\n            &lt;a href=\&quot;#javascript\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;JavaScript relies on automatic memory management through a process called &lt;a href=\&quot;https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Memory_management#garbage_collection\&quot;&gt;&lt;u&gt;garbage collection&lt;/u&gt;&lt;/a&gt;. This means developers do not need to worry about freeing allocated memory, or lifetimes. The garbage collector identifies and reclaims memory occupied by objects that are no longer needed by the program (that is, garbage). This helps prevent memory leaks and simplifies memory management for developers.&lt;/p&gt;\n            &lt;pre class=\&quot;language-JavaScript\&quot;&gt;&lt;code class=\&quot;language-JavaScript\&quot;&gt;function greet() {\n  let name = &amp;quot;Alice&amp;quot;;         // String is allocated in memory\n  console.log(&amp;quot;Hello, &amp;quot; + name);\n}                             // &amp;#039;name&amp;#039; goes out of scope\n\ngreet();\n// JavaScript automatically frees allocated memory at some point in future&lt;/pre&gt;&lt;/code&gt;\n            \n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;webassembly\&quot;&gt;WebAssembly&lt;/h3&gt;\n            &lt;a href=\&quot;#webassembly\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;WebAssembly (Wasm) is an assembly-like instruction format designed to run high-performance applications on the web. While it initially gained prominence in web browsers, Wasm is also highly effective on the server side. At Cloudflare, we leverage Wasm to enable users to run code written in a variety of programming languages, such as &lt;a href=\&quot;https://developers.cloudflare.com/workers/languages/rust/\&quot;&gt;&lt;u&gt;Rust&lt;/u&gt;&lt;/a&gt; and &lt;a href=\&quot;https://developers.cloudflare.com/workers/languages/python/\&quot;&gt;&lt;u&gt;Python&lt;/u&gt;&lt;/a&gt;, directly within our &lt;a href=\&quot;https://www.cloudflare.com/learning/serverless/glossary/what-is-chrome-v8/\&quot;&gt;&lt;u&gt;V8 isolates&lt;/u&gt;&lt;/a&gt;, offering both performance and versatility.&lt;/p&gt;&lt;p&gt;Wasm runtimes are designed to be simple stack machines, and lack built-in garbage collectors. This necessitates manual memory management (allocation and deallocation of memory used by Wasm code), making it an ideal compilation target for languages like Rust and C++ that handle their own memory.&lt;/p&gt;&lt;p&gt;Wasm modules operate on &lt;a href=\&quot;https://webassembly.github.io/spec/core/exec/runtime.html#memory-instances\&quot;&gt;&lt;u&gt;linear memory&lt;/u&gt;&lt;/a&gt;: a resizable block of raw bytes, which JavaScript views as an &lt;a href=\&quot;https://developer.mozilla.org/en-US/docs/WebAssembly/Reference/JavaScript_interface/Memory\&quot;&gt;&lt;u&gt;ArrayBuffer&lt;/u&gt;&lt;/a&gt;. This memory is organized in 64 KB pages, and its initial size is defined when the module is compiled or loaded. Wasm code interacts with this memory using 32-bit offsets — integer values functioning as direct pointers that specify a byte offset from the start of its linear memory. This direct memory access model is crucial for Wasm&amp;#39;s high performance. The host environment (which in Cloudflare Workers is JavaScript) also shares this ArrayBuffer, reading and writing (often via &lt;a href=\&quot;https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/TypedArray\&quot;&gt;&lt;u&gt;TypedArrays&lt;/u&gt;&lt;/a&gt;) to enable vital data exchange between Wasm and JavaScript.&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/3nWyMj5xginVWLxCnPpUdY/f939bb0b4f0007999aff876854645f16/image3.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1494\&quot; height=\&quot;672\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;A core Wasm design is its &lt;a href=\&quot;https://webassembly.org/docs/security/\&quot;&gt;&lt;u&gt;secure sandbox&lt;/u&gt;&lt;/a&gt;. This confines Wasm code strictly to its own linear memory and explicitly declared imports from the host, preventing unauthorized memory access or system calls. Direct interaction with JavaScript objects is blocked; communication occurs through numeric values, function references, or operations on the shared ArrayBuffer. This strong isolation is vital for security, ensuring Wasm modules don&amp;#39;t interfere with the host or other application components, which is especially important in multi-tenant environments like Cloudflare Workers.&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/3Ck9v7opkB5Mg1agKNnQm7/c328cc0a2d1c3145a527e1267594fe1d/image2.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1984\&quot; height=\&quot;844\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;Bridging WebAssembly memory with JavaScript often involves writing low-level &amp;quot;glue&amp;quot; code to convert raw byte arrays from Wasm into usable JavaScript types. Doing this manually for every function or data structure is both tedious and error-prone. Fortunately, tools like &lt;a href=\&quot;https://rustwasm.github.io/wasm-bindgen/\&quot;&gt;&lt;u&gt;wasm-bindgen&lt;/u&gt;&lt;/a&gt; and &lt;a href=\&quot;https://emscripten.org/\&quot;&gt;&lt;u&gt;Emscripten (Embind)&lt;/u&gt;&lt;/a&gt; handle this interop automatically, generating the binding code needed to pass data cleanly between the two environments. We use these same tools under the hood — wasm-bindgen for Rust-based &lt;a href=\&quot;https://github.com/cloudflare/workers-rs\&quot;&gt;&lt;u&gt;workers-rs&lt;/u&gt;&lt;/a&gt; projects, and Emscripten for &lt;a href=\&quot;https://developers.cloudflare.com/workers/languages/python/how-python-workers-work/\&quot;&gt;&lt;u&gt;Python Workers&lt;/u&gt;&lt;/a&gt; — to simplify integration and let developers focus on application logic rather than memory translation.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;interoperability\&quot;&gt;Interoperability&lt;/h2&gt;\n            &lt;a href=\&quot;#interoperability\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;High-performance web apps often use JavaScript for interactive UIs and data fetching, while WebAssembly handles demanding operations like media processing and complex calculations for significant performance gains, allowing developers to maximize efficiency. Given the difference in memory management models, developers need  to be careful when using WebAssembly memory in JavaScript.&lt;/p&gt;&lt;p&gt;For this example, we&amp;#39;ll use Rust to compile a WebAssembly module manually. Rust is a popular choice for WebAssembly because it offers precise control over memory and easy Wasm compilation using standard toolchains.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;rust\&quot;&gt;Rust&lt;/h3&gt;\n            &lt;a href=\&quot;#rust\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Here we have two simple functions. &lt;code&gt;make_buffer&lt;/code&gt; creates a string and returns a raw pointer back to JavaScript. The function intentionally “forgets” the memory allocated so that it doesn’t get cleaned up after the function returns. &lt;code&gt;free_buffer&lt;/code&gt;, on the other hand, expects the initial string reference handed back and frees the memory.&lt;/p&gt;\n            &lt;pre class=\&quot;language-Rust\&quot;&gt;&lt;code class=\&quot;language-Rust\&quot;&gt;// Allocate a fresh byte buffer and hand the raw pointer + length to JS.\n// *We intentionally “forget” the Vec so Rust will not free it right away;\n//   JS now owns it and must call `free_buffer` later.*\n#[no_mangle]\npub extern &amp;quot;C&amp;quot; fn make_buffer(out_len: *mut usize) -&amp;gt; *mut u8 {\n    let mut data = b&amp;quot;Hello from Rust&amp;quot;.to_vec();\n    let ptr = data.as_mut_ptr();\n    let len  = data.len();\n\n    unsafe { *out_len = len };\n\n    std::mem::forget(data);\n    return ptr;\n}\n\n/// Counterpart that **must** be called by JS to avoid a leak.\n#[no_mangle]\npub unsafe extern &amp;quot;C&amp;quot; fn free_buffer(ptr: *mut u8, len: usize) {\n    let _ = Vec::from_raw_parts(ptr, len, len);\n}&lt;/pre&gt;&lt;/code&gt;\n            \n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;javascript\&quot;&gt;JavaScript&lt;/h3&gt;\n            &lt;a href=\&quot;#javascript\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Back in JavaScript land, we’ll call these Wasm functions and output them using console.log. This is a common pattern in Wasm-based applications since WebAssembly doesn’t have direct access to Web APIs, and rely on a JavaScript “glue” to interface with the outer world in order to do anything useful.&lt;/p&gt;\n            &lt;pre class=\&quot;language-JavaScript\&quot;&gt;&lt;code class=\&quot;language-JavaScript\&quot;&gt;const { instance } = await WebAssembly.instantiate(WasmBytes, {});\n\nconst { memory, make_buffer, free_buffer } = instance.exports;\n\n//  Use the Rust functions\nconst lenPtr = 0;                 // scratch word in Wasm memory\nconst ptr = make_buffer(lenPtr);\n\nconst len = new DataView(memory.buffer).getUint32(lenPtr, true);\nconst data = new Uint8Array(memory.buffer, ptr, len);\n\nconsole.log(new TextDecoder().decode(data)); // “Hello from Rust”\n\nfree_buffer(ptr, len); // free_buffer must be called to prevent memory leaks&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;You can find all code samples along with setup instructions &lt;a href=\&quot;https://github.com/cloudflare/cloudflare-blog/tree/master/2025-06-finalization-registry\&quot;&gt;&lt;u&gt;here&lt;/u&gt;&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;As you can see, working with Wasm memory from JavaScript requires care, as it introduces the risk of memory leaks if allocated memory isn’t properly released. JavaScript developers are often unfamiliar with manual memory management, and it’s easy to forget returning memory to WebAssembly after use. This can become especially tricky when Wasm-allocated data is passed into JavaScript libraries, making ownership and lifetime harder to track.&lt;/p&gt;&lt;p&gt;While occasional leaks may not cause immediate issues, over time they can lead to increased memory usage and degrade performance, particularly in memory-constrained environments like Cloudflare Workers.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;finalizationregistry\&quot;&gt;FinalizationRegistry&lt;/h2&gt;\n            &lt;a href=\&quot;#finalizationregistry\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;&lt;code&gt;FinalizationRegistry&lt;/code&gt;, introduced as part of the &lt;a href=\&quot;https://tc39.es/proposal-weakrefs/\&quot;&gt;&lt;u&gt;TC-39 WeakRef proposal&lt;/u&gt;&lt;/a&gt;, is a JavaScript API which lets you run “finalizers” (aka cleanup callbacks) when an object gets garbage-collected. Let’s look at a simple example to demonstrate the API:&lt;/p&gt;\n            &lt;pre class=\&quot;language-JavaScript\&quot;&gt;&lt;code class=\&quot;language-JavaScript\&quot;&gt;const my_registry = new FinalizationRegistry((obj) =&amp;gt; { console.log(&amp;quot;Cleaned up: &amp;quot; + obj); });\n\n{\n  let temporary = { key: &amp;quot;value&amp;quot; };\n  // Register this object in our FinalizationRegistry -- the second argument,\n  // &amp;quot;temporary&amp;quot;, will be passed to our callback as its obj parameter\n  my_registry.register(temporary, &amp;quot;temporary&amp;quot;);\n}\n\n// At some point in the future when temporary object gets garbage collected, we&amp;#039;ll see &amp;quot;Cleaned up: temporary&amp;quot; in our logs.&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;Let’s see how we can use this API in our Wasm-based application:&lt;/p&gt;\n            &lt;pre class=\&quot;language-JavaScript\&quot;&gt;&lt;code class=\&quot;language-JavaScript\&quot;&gt;const { instance } = await WebAssembly.instantiate(WasmBytes, {});\n\nconst { memory, make_buffer, free_buffer } = instance.exports;\n\n// FinalizationRegistry would be responsible for returning memory back to Wasm\nconst cleanupFr = new FinalizationRegistry(({ ptr, len }) =&amp;gt; {\n  free_buffer(ptr, len);\n});\n\n//  Use the Rust functions\nconst lenPtr = 0;                 // scratch word in Wasm memory\nconst ptr = make_buffer(lenPtr);\n\nconst len = new DataView(memory.buffer).getUint32(lenPtr, true);\nconst data = new Uint8Array(memory.buffer, ptr, len);\n\n// Register the data buffer in our FinalizationRegistry so that it gets cleaned up automatically\ncleanupFr.register(data, { ptr, len });\n\nconsole.log(new TextDecoder().decode(data));   // → “Hello from Rust”\n\n// No need to manually call free_buffer, FinalizationRegistry will do this for us&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;We can use a &lt;code&gt;FinalizationRegistry&lt;/code&gt; to manage any object borrowed from WebAssembly by registering it with a finalizer that calls the appropriate free function. This is the same approach used by &lt;a href=\&quot;https://rustwasm.github.io/docs/wasm-bindgen/reference/weak-references.html\&quot;&gt;&lt;u&gt;wasm-bindgen&lt;/u&gt;&lt;/a&gt;. It shifts the burden of manual cleanup away from the JavaScript developer and delegates it to the JavaScript garbage collector. However, in practice, things aren’t quite that simple.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;inherent-issues-with-finalizationregistry\&quot;&gt;Inherent issues with FinalizationRegistry&lt;/h2&gt;\n            &lt;a href=\&quot;#inherent-issues-with-finalizationregistry\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;There is a fundamental issue with &lt;code&gt;FinalizationRegistry&lt;/code&gt;: garbage collection is non-deterministic, and may clean up your unused memory at some arbitrary point in the future. In some cases, garbage collection might not even run and your “finalizers” will never be triggered.&lt;/p&gt;&lt;p&gt;This is part of its &lt;a href=\&quot;https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/FinalizationRegistry#notes_on_cleanup_callbacks\&quot;&gt;&lt;u&gt;documentation&lt;/u&gt;&lt;/a&gt; as well:&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;&lt;i&gt;“A conforming JavaScript implementation, even one that does garbage collection, is not required to call cleanup callbacks. When and whether it does so is entirely down to the implementation of the JavaScript engine. When a registered object is reclaimed, any cleanup callbacks for it may be called then, or some time later, or not at all.”&lt;/i&gt;&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;Even Emscripten mentions this in their &lt;a href=\&quot;https://emscripten.org/docs/porting/connecting_cpp_and_javascript/embind.html#automatic-memory-management\&quot;&gt;&lt;u&gt;documentation&lt;/u&gt;&lt;/a&gt;: “&lt;i&gt;... finalizers are not guaranteed to be called, and even if they are, there are no guarantees about their timing or order of execution, which makes them unsuitable for general RAII-style resource management.&lt;/i&gt;”&lt;/p&gt;&lt;p&gt;Given their non-deterministic nature, developers seldom use finalizers for any essential program logic. Treat them as a last-ditch safety net, not as a primary cleanup mechanism — explicit, deterministic teardown logic is almost always safer, faster, and easier to reason about.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;enabling-finalizationregistry-in-workers\&quot;&gt;Enabling FinalizationRegistry in Workers&lt;/h2&gt;\n            &lt;a href=\&quot;#enabling-finalizationregistry-in-workers\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;Given its non-deterministic nature and limited early adoption, we initially disabled the &lt;code&gt;FinalizationRegistry&lt;/code&gt; API in our runtime. However, as usage of Wasm-based Workers grew — particularly among high-traffic customers — we began to see new demands emerge. One such customer was running an extremely high requests per second (RPS) workload using WebAssembly, and needed tight control over memory to sustain massive traffic spikes without degradation. This highlighted a gap in our memory management capabilities, especially in cases where manual cleanup wasn’t always feasible or reliable. As a result, we re-evaluated our stance and began exploring the challenges and trade-offs of enabling &lt;code&gt;FinalizationRegistry&lt;/code&gt; within the Workers environment, despite its known limitations.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;preventing-footguns-with-safe-defaults\&quot;&gt;Preventing footguns with safe defaults&lt;/h3&gt;\n            &lt;a href=\&quot;#preventing-footguns-with-safe-defaults\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Because this API could be misused and cause unpredictable results for our customers, we’ve added a few safeguards. Most importantly, cleanup callbacks are run without an active async context, which means they cannot perform any I/O. This includes sending events to a tail Worker, logging metrics, or making fetch requests.&lt;/p&gt;&lt;p&gt;While this might sound limiting, it’s very intentional. Finalization callbacks are meant for cleanup — especially for releasing WebAssembly memory — not for triggering side effects. If we allowed I/O here, developers might (accidentally) rely on finalizers to perform critical logic that depends on when garbage collection happens. That timing is non-deterministic and outside your control, which could lead to flaky, hard-to-debug behavior.&lt;/p&gt;&lt;p&gt;We don’t have full control over when V8’s garbage collector performs cleanup, but V8 does let us nudge the timing of finalizer execution. Like Node and Deno, Workers queue &lt;code&gt;FinalizationRegistry&lt;/code&gt; jobs only after the microtask queue has drained, so each cleanup batch slips into the quiet slots between I/O phases of the event loop.&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/69QSYwmiAueWyP2KlvBwGi/183345cbb043acbe4d76c0fdb2ebf4dd/image1.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1992\&quot; height=\&quot;344\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;security-concerns\&quot;&gt;Security concerns&lt;/h3&gt;\n            &lt;a href=\&quot;#security-concerns\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;The Cloudflare Workers runtime is &lt;a href=\&quot;https://blog.cloudflare.com/mitigating-spectre-and-other-security-threats-the-cloudflare-workers-security-model\&quot;&gt;&lt;u&gt;specifically engineered&lt;/u&gt;&lt;/a&gt; to prevent side-channel attacks in a multi-tenant environment. Prior to enabling the &lt;code&gt;FinalizationRegistry&lt;/code&gt; API, we did a thorough analysis to assess its impact on our security model and determine the necessity of additional safeguards. The non-deterministic nature of &lt;code&gt;FinalizationRegistry&lt;/code&gt; raised concerns about potential information leaks leading to Spectre-like vulnerabilities, particularly regarding the possibility of exploiting the garbage collector (GC) as a confused deputy or using it to create a timer.&lt;/p&gt;&lt;h4&gt;GC as confused deputy&lt;/h4&gt;&lt;p&gt;One concern was whether the garbage collector (GC) could act as a confused deputy — a security antipattern where a privileged component is tricked into misusing its authority on behalf of untrusted code. In theory, a clever attacker could try to exploit the GC&amp;#39;s ability to access internal object lifetimes and memory behavior in order to infer or manipulate sensitive information across isolation boundaries.&lt;/p&gt;&lt;p&gt;However, our analysis indicated that the V8 GC is effectively contained and not exposed to confused deputy risks within the runtime. This is attributed to our existing threat models and security measures, such as the isolation of user code, where the V8 Isolate serves as the primary security boundary. Furthermore, even though FinalizationRegistry involves some internal GC mechanics, the callbacks themselves execute in the same isolate that registered them — never across isolates — ensuring isolation remains intact.&lt;/p&gt;&lt;h4&gt;GC as timer&lt;/h4&gt;&lt;p&gt;We also evaluated the possibility of using FinalizationRegistry as a high-resolution timing mechanism — a common vector in side-channel attacks like Spectre. The concern here is that an attacker could schedule object finalization in a way that indirectly leaks information via the timing of callbacks.&lt;/p&gt;&lt;p&gt;In practice, though, the resolution of such a &amp;quot;GC timer&amp;quot; is low and highly variable, offering poor reliability for side-channel attacks. Additionally, we control when finalizer callbacks are scheduled — delaying them until after the microtask queue has drained — giving us an extra layer of control to limit timing precision and reduce risk.&lt;/p&gt;&lt;p&gt;Following a review with our security research team, we determined that our existing security model is sufficient to support this API.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;predictable-cleanups\&quot;&gt;Predictable cleanups?&lt;/h2&gt;\n            &lt;a href=\&quot;#predictable-cleanups\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;JavaScript&amp;#39;s &lt;a href=\&quot;https://tc39.es/proposal-explicit-resource-management/\&quot;&gt;&lt;u&gt;Explicit Resource Management&lt;/u&gt;&lt;/a&gt; proposal introduces a deterministic approach to handle resources needing manual cleanup, such as file handles, network connections, or database sessions. Drawing inspiration from constructs like C#&amp;#39;s &lt;a href=\&quot;https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/using\&quot;&gt;&lt;u&gt;using&lt;/u&gt;&lt;/a&gt; and Python&amp;#39;s &lt;a href=\&quot;https://docs.python.org/3/reference/compound_stmts.html#with\&quot;&gt;&lt;u&gt;with&lt;/u&gt;&lt;/a&gt;, this proposal introduces the using and &lt;code&gt;await using&lt;/code&gt; syntax. This new syntax guarantees that objects adhering to a specific cleanup protocol are automatically disposed of when they are no longer within their scope.&lt;/p&gt;&lt;p&gt;Let’s look at a simple example to understand it a bit better.&lt;/p&gt;\n            &lt;pre class=\&quot;language-JavaScript\&quot;&gt;&lt;code class=\&quot;language-JavaScript\&quot;&gt;class MyResource {\n  [Symbol.dispose]() {\n    console.log(&amp;quot;Resource cleaned up!&amp;quot;);\n  }\n\n  use() {\n    console.log(&amp;quot;Using the resource...&amp;quot;);\n  }\n}\n\n{\n  using res = new MyResource();\n  res.use();\n} // When this block ends, Symbol.dispose is called automatically (and deterministically).&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;The proposal also includes additional features that offer finer control over when dispose methods are called. But at a high level, it provides a much-needed, deterministic way to manage resource cleanup. Let’s now update our earlier WebAssembly-based example to take advantage of this new mechanism instead of relying on &lt;code&gt;FinalizationRegistry&lt;/code&gt;:&lt;/p&gt;\n            &lt;pre class=\&quot;language-JavaScript\&quot;&gt;&lt;code class=\&quot;language-JavaScript\&quot;&gt;const { instance } = await WebAssembly.instantiate(WasmBytes, {});\nconst { memory, make_buffer, free_buffer } = instance.exports;\n\nclass WasmBuffer {\n  constructor(ptr, len) {\n    this.ptr = ptr;\n    this.len = len;\n  }\n\n  [Symbol.dispose]() {\n    free_buffer(this.ptr, this.len);\n  }\n}\n\n{\n  const lenPtr = 0;\n  const ptr = make_buffer(lenPtr);\n  const len = new DataView(memory.buffer).getUint32(lenPtr, true);\n\n  using buf = new WasmBuffer(ptr, len);\n\n  const data = new Uint8Array(memory.buffer, ptr, len);\n  console.log(new TextDecoder().decode(data));  // → “Hello from Rust”\n} // Symbol.dispose or free_buffer gets called deterministically here&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;Explicit Resource Management provides a more dependable way to clean up resources than &lt;code&gt;FinalizationRegistry&lt;/code&gt;, as it runs cleanup logic — such as calling &lt;code&gt;free_buffer&lt;/code&gt; in WasmBuffer via &lt;code&gt;[Symbol.dispose]()&lt;/code&gt; and the &lt;code&gt;using&lt;/code&gt; syntax — deterministically, rather than relying on the garbage collector’s unpredictable timing. This makes it a more reliable choice for managing critical resources, especially memory.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;future\&quot;&gt;Future&lt;/h2&gt;\n            &lt;a href=\&quot;#future\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;Emscripten &lt;a href=\&quot;https://emscripten.org/docs/porting/connecting_cpp_and_javascript/embind.html#automatic-memory-management\&quot;&gt;&lt;u&gt;already makes use&lt;/u&gt;&lt;/a&gt; of Explicit Resource Management for handling Wasm memory, using &lt;code&gt;FinalizationRegistry&lt;/code&gt; as a last resort, while wasm-bindgen &lt;a href=\&quot;https://github.com/rustwasm/wasm-bindgen/pull/4118\&quot;&gt;&lt;u&gt;supports it in experimental mode&lt;/u&gt;&lt;/a&gt;. The proposal has seen growing adoption across the ecosystem and was recently conditionally advanced to Stage 4 in the TC39 process, meaning it’ll soon officially be part of the JavaScript language standard. This reflects a broader shift toward more predictable and structured memory cleanup in WebAssembly applications.&lt;/p&gt;&lt;p&gt;We &lt;a href=\&quot;https://developers.cloudflare.com/workers/platform/changelog/#2025-05-22\&quot;&gt;&lt;u&gt;recently added support&lt;/u&gt;&lt;/a&gt; for this feature in Cloudflare Workers as well, enabling developers to take advantage of deterministic resource cleanup in edge environments. As support for the feature matures, it&amp;#39;s likely to become a standard practice for managing linear memory safely and reliably.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;finalizationregistry-still-not-dead-yet\&quot;&gt;FinalizationRegistry: still not dead yet?&lt;/h3&gt;\n            &lt;a href=\&quot;#finalizationregistry-still-not-dead-yet\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Explicit Resource Management brings much-needed structure and predictability to resource cleanup in WebAssembly and JavaScript interop applications, but it doesn’t make &lt;code&gt;FinalizationRegistry&lt;/code&gt; obsolete. There are still important use cases, particularly when a Wasm-allocated object’s lifecycle is out of your hands or when explicit disposal isn’t practical. In scenarios involving third-party libraries, dynamic lifecycles, or integration layers that don’t follow &lt;code&gt;using&lt;/code&gt; patterns, &lt;code&gt;FinalizationRegistry&lt;/code&gt; remains a valuable fallback to prevent memory leaks.&lt;/p&gt;&lt;p&gt;Looking ahead, a hybrid approach will likely become the standard in Wasm-JavaScript applications. Developers can use ERM for deterministic cleanup of Wasm memory and other resources, while relying on &lt;code&gt;FinalizationRegistry&lt;/code&gt; as a safety net when full control isn’t possible. Together, they offer a more reliable and flexible foundation for managing memory across the JavaScript and WebAssembly boundary.&lt;/p&gt;&lt;p&gt;Ready to try it yourself? Deploy a &lt;a href=\&quot;https://developers.cloudflare.com/workers/runtime-apis/webassembly/\&quot;&gt;&lt;u&gt;WebAssembly-powered Worker&lt;/u&gt;&lt;/a&gt; and experiment with memory management — start building with &lt;a href=\&quot;https://developers.cloudflare.com/workers/\&quot;&gt;&lt;u&gt;Cloudflare Workers&lt;/u&gt;&lt;/a&gt; today.&lt;/p&gt;&quot;],&quot;published_at&quot;:[0,&quot;2025-06-11T14:00+01:00&quot;],&quot;updated_at&quot;:[0,&quot;2025-06-11T13:00:03.311Z&quot;],&quot;feature_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/7cLMMILFb6WD9qrMUeJoWO/57652dbdb6f77038eedffd08bef442e4/image4.png&quot;],&quot;tags&quot;:[1,[[0,{&quot;id&quot;:[0,&quot;6hbkItfupogJP3aRDAq6v8&quot;],&quot;name&quot;:[0,&quot;Cloudflare Workers&quot;],&quot;slug&quot;:[0,&quot;workers&quot;]}],[0,{&quot;id&quot;:[0,&quot;5ghWZAL0nNGxrphuhWW6G0&quot;],&quot;name&quot;:[0,&quot;WebAssembly&quot;],&quot;slug&quot;:[0,&quot;webassembly&quot;]}],[0,{&quot;id&quot;:[0,&quot;78aSAeMjGNmCuetQ7B4OgU&quot;],&quot;name&quot;:[0,&quot;JavaScript&quot;],&quot;slug&quot;:[0,&quot;javascript&quot;]}]]],&quot;relatedTags&quot;:[0],&quot;authors&quot;:[1,[[0,{&quot;name&quot;:[0,&quot;Ketan Gupta&quot;],&quot;slug&quot;:[0,&quot;ketan-gupta&quot;],&quot;bio&quot;:[0],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/4HNGL8tqmoWI8yZJEEynzY/4dc4778dc00d47cc7da853c61c224fd7/Ketan_Gupta.webp&quot;],&quot;location&quot;:[0],&quot;website&quot;:[0],&quot;twitter&quot;:[0],&quot;facebook&quot;:[0],&quot;publiclyIndex&quot;:[0,true]}],[0,{&quot;name&quot;:[0,&quot;Harris Hancock&quot;],&quot;slug&quot;:[0,&quot;harris-hancock&quot;],&quot;bio&quot;:[0],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/kl1szOUahVoAesAqM5x8w/18cf3fe1108e24731361523b5c51e45c/Harris_Hancock.webp&quot;],&quot;location&quot;:[0],&quot;website&quot;:[0],&quot;twitter&quot;:[0],&quot;facebook&quot;:[0],&quot;publiclyIndex&quot;:[0,true]}]]],&quot;meta_description&quot;:[0,&quot;Cloudflare Workers now support FinalizationRegistry, but just because you can use it doesn’t mean you should. Dive into the tricky world of JavaScript and WebAssembly memory management and see why newer features make life a lot easier.&quot;],&quot;primary_author&quot;:[0,{}],&quot;localeList&quot;:[0,{&quot;name&quot;:[0,&quot;blog-english-only&quot;],&quot;enUS&quot;:[0,&quot;English for Locale&quot;],&quot;zhCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhHansCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhTW&quot;:[0,&quot;No Page for Locale&quot;],&quot;frFR&quot;:[0,&quot;No Page for Locale&quot;],&quot;deDE&quot;:[0,&quot;No Page for Locale&quot;],&quot;itIT&quot;:[0,&quot;No Page for Locale&quot;],&quot;jaJP&quot;:[0,&quot;No Page for Locale&quot;],&quot;koKR&quot;:[0,&quot;No Page for Locale&quot;],&quot;ptBR&quot;:[0,&quot;No Page for Locale&quot;],&quot;esLA&quot;:[0,&quot;No Page for Locale&quot;],&quot;esES&quot;:[0,&quot;No Page for Locale&quot;],&quot;enAU&quot;:[0,&quot;No Page for Locale&quot;],&quot;enCA&quot;:[0,&quot;No Page for Locale&quot;],&quot;enIN&quot;:[0,&quot;No Page for Locale&quot;],&quot;enGB&quot;:[0,&quot;No Page for Locale&quot;],&quot;idID&quot;:[0,&quot;No Page for Locale&quot;],&quot;ruRU&quot;:[0,&quot;No Page for Locale&quot;],&quot;svSE&quot;:[0,&quot;No Page for Locale&quot;],&quot;viVN&quot;:[0,&quot;No Page for Locale&quot;],&quot;plPL&quot;:[0,&quot;No Page for Locale&quot;],&quot;arAR&quot;:[0,&quot;No Page for Locale&quot;],&quot;nlNL&quot;:[0,&quot;No Page for Locale&quot;],&quot;thTH&quot;:[0,&quot;No Page for Locale&quot;],&quot;trTR&quot;:[0,&quot;No Page for Locale&quot;],&quot;heIL&quot;:[0,&quot;No Page for Locale&quot;],&quot;lvLV&quot;:[0,&quot;No Page for Locale&quot;],&quot;etEE&quot;:[0,&quot;No Page for Locale&quot;],&quot;ltLT&quot;:[0,&quot;No Page for Locale&quot;]}],&quot;url&quot;:[0,&quot;https://blog.cloudflare.com/we-shipped-finalizationregistry-in-workers-why-you-should-never-use-it&quot;],&quot;metadata&quot;:[0,{&quot;title&quot;:[0,&quot;We shipped FinalizationRegistry in Workers: why you should never use it&quot;],&quot;description&quot;:[0,&quot;Cloudflare Workers now support FinalizationRegistry, but just because you can use it doesn’t mean you should. Dive into the tricky world of JavaScript and WebAssembly memory management and see why newer features make life a lot easier. &quot;],&quot;imgPreview&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/3qcV6p7f2TQDnrcte9HS0w/1488188579d497e0756b603e8e41091f/We_shipped_FinalizationRegistry_in_Workers-_why_you_should_never_use_it-OG.png&quot;]}],&quot;publicly_index&quot;:[0,true]}],&quot;tagInfo&quot;:[0],&quot;authorInfo&quot;:[0],&quot;translatedPosts&quot;:[1,[]]}" ssr client="only" opts="{&quot;name&quot;:&quot;GoogleAnalytics&quot;,&quot;value&quot;:&quot;react&quot;}"></astro-island><script>(()=>{var l=(n,t)=>{let i=async()=>{await(await n())()},e=typeof t.value=="object"?t.value:void 0,s={timeout:e==null?void 0:e.timeout};"requestIdleCallback"in window?window.requestIdleCallback(i,s):setTimeout(i,s.timeout||200)};(self.Astro||(self.Astro={})).idle=l;window.dispatchEvent(new Event("astro:idle"));})();</script><astro-island uid="Z1dQJsc" prefix="r3" component-url="/_astro/Navigation.JWiNRNo9.js" component-export="Navigation" renderer-url="/_astro/client.DLO1yDVm.js" props="{&quot;title&quot;:[0,&quot;The Cloudflare Blog&quot;],&quot;logo&quot;:[0,&quot;//images.ctfassets.net/zkvhlag99gkb/69RwBidpiEHCDZ9rFVVk7T/092507edbed698420b89658e5a6d5105/CF_logo_stacked_blktype.png&quot;],&quot;pagesStore&quot;:[0,{&quot;page&quot;:[0,&quot;Post&quot;],&quot;slug&quot;:[0,&quot;we-shipped-finalizationregistry-in-workers-why-you-should-never-use-it&quot;],&quot;translationsAvailable&quot;:[1,[]],&quot;navData&quot;:[1,[[0,{&quot;metadata&quot;:[0,{&quot;tags&quot;:[1,[]],&quot;concepts&quot;:[1,[]]}],&quot;sys&quot;:[0,{&quot;space&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Space&quot;],&quot;id&quot;:[0,&quot;zkvhlag99gkb&quot;]}]}],&quot;id&quot;:[0,&quot;6Foe3R8of95cWVnQwe5Toi&quot;],&quot;type&quot;:[0,&quot;Entry&quot;],&quot;createdAt&quot;:[0,&quot;2024-10-09T22:44:28.803Z&quot;],&quot;updatedAt&quot;:[0,&quot;2025-06-17T05:04:39.288Z&quot;],&quot;environment&quot;:[0,{&quot;sys&quot;:[0,{&quot;id&quot;:[0,&quot;master&quot;],&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Environment&quot;]}]}],&quot;publishedVersion&quot;:[0,153],&quot;revision&quot;:[0,44],&quot;contentType&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;ContentType&quot;],&quot;id&quot;:[0,&quot;blogTag&quot;]}]}],&quot;locale&quot;:[0,&quot;en-US&quot;]}],&quot;fields&quot;:[0,{&quot;entryTitle&quot;:[0,&quot;AI&quot;],&quot;name&quot;:[0,&quot;AI&quot;],&quot;slug&quot;:[0,&quot;ai&quot;],&quot;featured&quot;:[0,true],&quot;publiclyIndex&quot;:[0,true]}]}],[0,{&quot;metadata&quot;:[0,{&quot;tags&quot;:[1,[]],&quot;concepts&quot;:[1,[]]}],&quot;sys&quot;:[0,{&quot;space&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Space&quot;],&quot;id&quot;:[0,&quot;zkvhlag99gkb&quot;]}]}],&quot;id&quot;:[0,&quot;4HIPcb68qM0e26fIxyfzwQ&quot;],&quot;type&quot;:[0,&quot;Entry&quot;],&quot;createdAt&quot;:[0,&quot;2024-10-09T19:43:21.536Z&quot;],&quot;updatedAt&quot;:[0,&quot;2025-05-19T05:03:04.375Z&quot;],&quot;environment&quot;:[0,{&quot;sys&quot;:[0,{&quot;id&quot;:[0,&quot;master&quot;],&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Environment&quot;]}]}],&quot;publishedVersion&quot;:[0,135],&quot;revision&quot;:[0,46],&quot;contentType&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;ContentType&quot;],&quot;id&quot;:[0,&quot;blogTag&quot;]}]}],&quot;locale&quot;:[0,&quot;en-US&quot;]}],&quot;fields&quot;:[0,{&quot;entryTitle&quot;:[0,&quot;Developers&quot;],&quot;name&quot;:[0,&quot;Developers&quot;],&quot;slug&quot;:[0,&quot;developers&quot;],&quot;featured&quot;:[0,true]}]}],[0,{&quot;metadata&quot;:[0,{&quot;tags&quot;:[1,[]],&quot;concepts&quot;:[1,[]]}],&quot;sys&quot;:[0,{&quot;space&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Space&quot;],&quot;id&quot;:[0,&quot;zkvhlag99gkb&quot;]}]}],&quot;id&quot;:[0,&quot;5kZtWqjqa7aOUoZr8NFGwI&quot;],&quot;type&quot;:[0,&quot;Entry&quot;],&quot;createdAt&quot;:[0,&quot;2024-10-09T19:43:26.040Z&quot;],&quot;updatedAt&quot;:[0,&quot;2025-04-30T14:03:57.409Z&quot;],&quot;environment&quot;:[0,{&quot;sys&quot;:[0,{&quot;id&quot;:[0,&quot;master&quot;],&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Environment&quot;]}]}],&quot;publishedVersion&quot;:[0,142],&quot;revision&quot;:[0,43],&quot;contentType&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;ContentType&quot;],&quot;id&quot;:[0,&quot;blogTag&quot;]}]}],&quot;locale&quot;:[0,&quot;en-US&quot;]}],&quot;fields&quot;:[0,{&quot;entryTitle&quot;:[0,&quot;Cloudflare Radar&quot;],&quot;name&quot;:[0,&quot;Radar&quot;],&quot;slug&quot;:[0,&quot;cloudflare-radar&quot;],&quot;featured&quot;:[0,true]}]}],[0,{&quot;metadata&quot;:[0,{&quot;tags&quot;:[1,[]],&quot;concepts&quot;:[1,[]]}],&quot;sys&quot;:[0,{&quot;space&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Space&quot;],&quot;id&quot;:[0,&quot;zkvhlag99gkb&quot;]}]}],&quot;id&quot;:[0,&quot;6QktrXeEFcl4e2dZUTZVGl&quot;],&quot;type&quot;:[0,&quot;Entry&quot;],&quot;createdAt&quot;:[0,&quot;2024-10-09T19:43:20.198Z&quot;],&quot;updatedAt&quot;:[0,&quot;2025-04-09T11:02:56.665Z&quot;],&quot;environment&quot;:[0,{&quot;sys&quot;:[0,{&quot;id&quot;:[0,&quot;master&quot;],&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Environment&quot;]}]}],&quot;publishedVersion&quot;:[0,68],&quot;revision&quot;:[0,28],&quot;contentType&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;ContentType&quot;],&quot;id&quot;:[0,&quot;blogTag&quot;]}]}],&quot;locale&quot;:[0,&quot;en-US&quot;]}],&quot;fields&quot;:[0,{&quot;entryTitle&quot;:[0,&quot;Product News&quot;],&quot;name&quot;:[0,&quot;Product News&quot;],&quot;slug&quot;:[0,&quot;product-news&quot;],&quot;featured&quot;:[0,true]}]}],[0,{&quot;metadata&quot;:[0,{&quot;tags&quot;:[1,[]],&quot;concepts&quot;:[1,[]]}],&quot;sys&quot;:[0,{&quot;space&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Space&quot;],&quot;id&quot;:[0,&quot;zkvhlag99gkb&quot;]}]}],&quot;id&quot;:[0,&quot;6Mp7ouACN2rT3YjL1xaXJx&quot;],&quot;type&quot;:[0,&quot;Entry&quot;],&quot;createdAt&quot;:[0,&quot;2024-10-09T19:42:46.231Z&quot;],&quot;updatedAt&quot;:[0,&quot;2025-04-09T11:02:54.136Z&quot;],&quot;environment&quot;:[0,{&quot;sys&quot;:[0,{&quot;id&quot;:[0,&quot;master&quot;],&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Environment&quot;]}]}],&quot;publishedVersion&quot;:[0,134],&quot;revision&quot;:[0,41],&quot;contentType&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;ContentType&quot;],&quot;id&quot;:[0,&quot;blogTag&quot;]}]}],&quot;locale&quot;:[0,&quot;en-US&quot;]}],&quot;fields&quot;:[0,{&quot;entryTitle&quot;:[0,&quot;Security&quot;],&quot;name&quot;:[0,&quot;Security&quot;],&quot;slug&quot;:[0,&quot;security&quot;],&quot;featured&quot;:[0,true]}]}],[0,{&quot;metadata&quot;:[0,{&quot;tags&quot;:[1,[]],&quot;concepts&quot;:[1,[]]}],&quot;sys&quot;:[0,{&quot;space&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Space&quot;],&quot;id&quot;:[0,&quot;zkvhlag99gkb&quot;]}]}],&quot;id&quot;:[0,&quot;16yk8DVbNNifxov5cWvAov&quot;],&quot;type&quot;:[0,&quot;Entry&quot;],&quot;createdAt&quot;:[0,&quot;2024-10-09T19:56:23.848Z&quot;],&quot;updatedAt&quot;:[0,&quot;2025-04-07T23:03:54.104Z&quot;],&quot;environment&quot;:[0,{&quot;sys&quot;:[0,{&quot;id&quot;:[0,&quot;master&quot;],&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Environment&quot;]}]}],&quot;publishedVersion&quot;:[0,65],&quot;revision&quot;:[0,29],&quot;contentType&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;ContentType&quot;],&quot;id&quot;:[0,&quot;blogTag&quot;]}]}],&quot;locale&quot;:[0,&quot;en-US&quot;]}],&quot;fields&quot;:[0,{&quot;entryTitle&quot;:[0,&quot;Policy &amp; Legal&quot;],&quot;name&quot;:[0,&quot;Policy &amp; Legal&quot;],&quot;slug&quot;:[0,&quot;policy&quot;],&quot;featured&quot;:[0,true]}]}],[0,{&quot;metadata&quot;:[0,{&quot;tags&quot;:[1,[]],&quot;concepts&quot;:[1,[]]}],&quot;sys&quot;:[0,{&quot;space&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Space&quot;],&quot;id&quot;:[0,&quot;zkvhlag99gkb&quot;]}]}],&quot;id&quot;:[0,&quot;J61Eszqn98amrYHq4IhTx&quot;],&quot;type&quot;:[0,&quot;Entry&quot;],&quot;createdAt&quot;:[0,&quot;2024-10-09T19:43:46.068Z&quot;],&quot;updatedAt&quot;:[0,&quot;2025-04-07T23:03:53.720Z&quot;],&quot;environment&quot;:[0,{&quot;sys&quot;:[0,{&quot;id&quot;:[0,&quot;master&quot;],&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Environment&quot;]}]}],&quot;publishedVersion&quot;:[0,136],&quot;revision&quot;:[0,44],&quot;contentType&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;ContentType&quot;],&quot;id&quot;:[0,&quot;blogTag&quot;]}]}],&quot;locale&quot;:[0,&quot;en-US&quot;]}],&quot;fields&quot;:[0,{&quot;entryTitle&quot;:[0,&quot;Zero Trust&quot;],&quot;name&quot;:[0,&quot;Zero Trust&quot;],&quot;slug&quot;:[0,&quot;zero-trust&quot;],&quot;featured&quot;:[0,true]}]}],[0,{&quot;metadata&quot;:[0,{&quot;tags&quot;:[1,[]],&quot;concepts&quot;:[1,[]]}],&quot;sys&quot;:[0,{&quot;space&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Space&quot;],&quot;id&quot;:[0,&quot;zkvhlag99gkb&quot;]}]}],&quot;id&quot;:[0,&quot;48r7QV00gLMWOIcM1CSDRy&quot;],&quot;type&quot;:[0,&quot;Entry&quot;],&quot;createdAt&quot;:[0,&quot;2024-10-09T19:54:22.790Z&quot;],&quot;updatedAt&quot;:[0,&quot;2025-04-07T23:03:52.422Z&quot;],&quot;environment&quot;:[0,{&quot;sys&quot;:[0,{&quot;id&quot;:[0,&quot;master&quot;],&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Environment&quot;]}]}],&quot;publishedVersion&quot;:[0,66],&quot;revision&quot;:[0,28],&quot;contentType&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;ContentType&quot;],&quot;id&quot;:[0,&quot;blogTag&quot;]}]}],&quot;locale&quot;:[0,&quot;en-US&quot;]}],&quot;fields&quot;:[0,{&quot;entryTitle&quot;:[0,&quot;Speed &amp; Reliability&quot;],&quot;name&quot;:[0,&quot;Speed &amp; Reliability&quot;],&quot;slug&quot;:[0,&quot;speed-and-reliability&quot;],&quot;featured&quot;:[0,true]}]}],[0,{&quot;metadata&quot;:[0,{&quot;tags&quot;:[1,[]],&quot;concepts&quot;:[1,[]]}],&quot;sys&quot;:[0,{&quot;space&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Space&quot;],&quot;id&quot;:[0,&quot;zkvhlag99gkb&quot;]}]}],&quot;id&quot;:[0,&quot;4g8tPriKOAUwdUT4jNPebe&quot;],&quot;type&quot;:[0,&quot;Entry&quot;],&quot;createdAt&quot;:[0,&quot;2024-10-09T19:46:40.927Z&quot;],&quot;updatedAt&quot;:[0,&quot;2025-04-07T23:03:51.235Z&quot;],&quot;environment&quot;:[0,{&quot;sys&quot;:[0,{&quot;id&quot;:[0,&quot;master&quot;],&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Environment&quot;]}]}],&quot;publishedVersion&quot;:[0,77],&quot;revision&quot;:[0,29],&quot;contentType&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;ContentType&quot;],&quot;id&quot;:[0,&quot;blogTag&quot;]}]}],&quot;locale&quot;:[0,&quot;en-US&quot;]}],&quot;fields&quot;:[0,{&quot;entryTitle&quot;:[0,&quot;Life at Cloudflare&quot;],&quot;name&quot;:[0,&quot;Life at Cloudflare&quot;],&quot;slug&quot;:[0,&quot;life-at-cloudflare&quot;],&quot;featured&quot;:[0,true]}]}],[0,{&quot;metadata&quot;:[0,{&quot;tags&quot;:[1,[]],&quot;concepts&quot;:[1,[]]}],&quot;sys&quot;:[0,{&quot;space&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Space&quot;],&quot;id&quot;:[0,&quot;zkvhlag99gkb&quot;]}]}],&quot;id&quot;:[0,&quot;V86khSc459Yi1AhTlvtY7&quot;],&quot;type&quot;:[0,&quot;Entry&quot;],&quot;createdAt&quot;:[0,&quot;2024-10-09T19:46:53.657Z&quot;],&quot;updatedAt&quot;:[0,&quot;2025-02-04T17:12:59.473Z&quot;],&quot;environment&quot;:[0,{&quot;sys&quot;:[0,{&quot;id&quot;:[0,&quot;master&quot;],&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Environment&quot;]}]}],&quot;publishedVersion&quot;:[0,57],&quot;revision&quot;:[0,21],&quot;contentType&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;ContentType&quot;],&quot;id&quot;:[0,&quot;blogTag&quot;]}]}],&quot;locale&quot;:[0,&quot;en-US&quot;]}],&quot;fields&quot;:[0,{&quot;entryTitle&quot;:[0,&quot;Partners&quot;],&quot;name&quot;:[0,&quot;Partners&quot;],&quot;slug&quot;:[0,&quot;partners&quot;],&quot;featured&quot;:[0,true]}]}]]]}],&quot;locale&quot;:[0,&quot;en-us&quot;],&quot;translations&quot;:[0,{&quot;posts.by&quot;:[0,&quot;By&quot;],&quot;footer.gdpr&quot;:[0,&quot;GDPR&quot;],&quot;lang_blurb1&quot;:[0,&quot;This post is also available in {lang1}.&quot;],&quot;lang_blurb2&quot;:[0,&quot;This post is also available in {lang1} and {lang2}.&quot;],&quot;lang_blurb3&quot;:[0,&quot;This post is also available in {lang1}, {lang2} and {lang3}.&quot;],&quot;footer.press&quot;:[0,&quot;Press&quot;],&quot;header.title&quot;:[0,&quot;The Cloudflare Blog&quot;],&quot;search.clear&quot;:[0,&quot;Clear&quot;],&quot;search.filter&quot;:[0,&quot;Filter&quot;],&quot;search.source&quot;:[0,&quot;Source&quot;],&quot;footer.careers&quot;:[0,&quot;Careers&quot;],&quot;footer.company&quot;:[0,&quot;Company&quot;],&quot;footer.support&quot;:[0,&quot;Support&quot;],&quot;footer.the_net&quot;:[0,&quot;theNet&quot;],&quot;search.filters&quot;:[0,&quot;Filters&quot;],&quot;footer.our_team&quot;:[0,&quot;Our team&quot;],&quot;footer.webinars&quot;:[0,&quot;Webinars&quot;],&quot;page.more_posts&quot;:[0,&quot;More posts&quot;],&quot;posts.time_read&quot;:[0,&quot;{time} min read&quot;],&quot;search.language&quot;:[0,&quot;Language&quot;],&quot;footer.community&quot;:[0,&quot;Community&quot;],&quot;footer.resources&quot;:[0,&quot;Resources&quot;],&quot;footer.solutions&quot;:[0,&quot;Solutions&quot;],&quot;footer.trademark&quot;:[0,&quot;Trademark&quot;],&quot;header.subscribe&quot;:[0,&quot;Subscribe&quot;],&quot;footer.compliance&quot;:[0,&quot;Compliance&quot;],&quot;footer.free_plans&quot;:[0,&quot;Free plans&quot;],&quot;footer.impact_ESG&quot;:[0,&quot;Impact/ESG&quot;],&quot;posts.follow_on_X&quot;:[0,&quot;Follow on X&quot;],&quot;footer.help_center&quot;:[0,&quot;Help center&quot;],&quot;footer.network_map&quot;:[0,&quot;Network Map&quot;],&quot;header.please_wait&quot;:[0,&quot;Please Wait&quot;],&quot;page.related_posts&quot;:[0,&quot;Related posts&quot;],&quot;search.result_stat&quot;:[0,&quot;Results &lt;strong&gt;{search_range}&lt;/strong&gt; of &lt;strong&gt;{search_total}&lt;/strong&gt; for &lt;strong&gt;{search_keyword}&lt;/strong&gt;&quot;],&quot;footer.case_studies&quot;:[0,&quot;Case Studies&quot;],&quot;footer.connect_2024&quot;:[0,&quot;Connect 2024&quot;],&quot;footer.terms_of_use&quot;:[0,&quot;Terms of Use&quot;],&quot;footer.white_papers&quot;:[0,&quot;White Papers&quot;],&quot;footer.cloudflare_tv&quot;:[0,&quot;Cloudflare TV&quot;],&quot;footer.community_hub&quot;:[0,&quot;Community Hub&quot;],&quot;footer.compare_plans&quot;:[0,&quot;Compare plans&quot;],&quot;footer.contact_sales&quot;:[0,&quot;Contact Sales&quot;],&quot;header.contact_sales&quot;:[0,&quot;Contact Sales&quot;],&quot;header.email_address&quot;:[0,&quot;Email Address&quot;],&quot;page.error.not_found&quot;:[0,&quot;Page not found&quot;],&quot;footer.developer_docs&quot;:[0,&quot;Developer docs&quot;],&quot;footer.privacy_policy&quot;:[0,&quot;Privacy Policy&quot;],&quot;footer.request_a_demo&quot;:[0,&quot;Request a demo&quot;],&quot;page.continue_reading&quot;:[0,&quot;Continue reading&quot;],&quot;footer.analysts_report&quot;:[0,&quot;Analyst reports&quot;],&quot;footer.for_enterprises&quot;:[0,&quot;For enterprises&quot;],&quot;footer.getting_started&quot;:[0,&quot;Getting Started&quot;],&quot;footer.learning_center&quot;:[0,&quot;Learning Center&quot;],&quot;footer.project_galileo&quot;:[0,&quot;Project Galileo&quot;],&quot;pagination.newer_posts&quot;:[0,&quot;Newer Posts&quot;],&quot;pagination.older_posts&quot;:[0,&quot;Older Posts&quot;],&quot;posts.social_buttons.x&quot;:[0,&quot;Discuss on X&quot;],&quot;search.icon_aria_label&quot;:[0,&quot;Search&quot;],&quot;search.source_location&quot;:[0,&quot;Source/Location&quot;],&quot;footer.about_cloudflare&quot;:[0,&quot;About Cloudflare&quot;],&quot;footer.athenian_project&quot;:[0,&quot;Athenian Project&quot;],&quot;footer.become_a_partner&quot;:[0,&quot;Become a partner&quot;],&quot;footer.cloudflare_radar&quot;:[0,&quot;Cloudflare Radar&quot;],&quot;footer.network_services&quot;:[0,&quot;Network services&quot;],&quot;footer.trust_and_safety&quot;:[0,&quot;Trust &amp; Safety&quot;],&quot;header.get_started_free&quot;:[0,&quot;Get Started Free&quot;],&quot;page.search.placeholder&quot;:[0,&quot;Search Cloudflare&quot;],&quot;footer.cloudflare_status&quot;:[0,&quot;Cloudflare Status&quot;],&quot;footer.cookie_preference&quot;:[0,&quot;Cookie Preferences&quot;],&quot;header.valid_email_error&quot;:[0,&quot;Must be valid email.&quot;],&quot;search.result_stat_empty&quot;:[0,&quot;Results &lt;strong&gt;{search_range}&lt;/strong&gt; of &lt;strong&gt;{search_total}&lt;/strong&gt;&quot;],&quot;footer.connectivity_cloud&quot;:[0,&quot;Connectivity cloud&quot;],&quot;footer.developer_services&quot;:[0,&quot;Developer services&quot;],&quot;footer.investor_relations&quot;:[0,&quot;Investor relations&quot;],&quot;page.not_found.error_code&quot;:[0,&quot;Error Code: 404&quot;],&quot;search.autocomplete_title&quot;:[0,&quot;Insert a query. Press enter to send&quot;],&quot;footer.logos_and_press_kit&quot;:[0,&quot;Logos &amp; press kit&quot;],&quot;footer.application_services&quot;:[0,&quot;Application services&quot;],&quot;footer.get_a_recommendation&quot;:[0,&quot;Get a recommendation&quot;],&quot;posts.social_buttons.reddit&quot;:[0,&quot;Discuss on Reddit&quot;],&quot;footer.sse_and_sase_services&quot;:[0,&quot;SSE and SASE services&quot;],&quot;page.not_found.outdated_link&quot;:[0,&quot;You may have used an outdated link, or you may have typed the address incorrectly.&quot;],&quot;footer.report_security_issues&quot;:[0,&quot;Report Security Issues&quot;],&quot;page.error.error_message_page&quot;:[0,&quot;Sorry, we can&#39;t find the page you are looking for.&quot;],&quot;header.subscribe_notifications&quot;:[0,&quot;Subscribe to receive notifications of new posts:&quot;],&quot;footer.cloudflare_for_campaigns&quot;:[0,&quot;Cloudflare for Campaigns&quot;],&quot;header.subscription_confimation&quot;:[0,&quot;Subscription confirmed. Thank you for subscribing!&quot;],&quot;posts.social_buttons.hackernews&quot;:[0,&quot;Discuss on Hacker News&quot;],&quot;footer.diversity_equity_inclusion&quot;:[0,&quot;Diversity, equity &amp; inclusion&quot;],&quot;footer.critical_infrastructure_defense_project&quot;:[0,&quot;Critical Infrastructure Defense Project&quot;]}]}" ssr client="idle" opts="{&quot;name&quot;:&quot;NavigationComponent&quot;,&quot;value&quot;:true}" await-children><header class="flex flex-row flex-wrap justify-between items-flex-end mw8 center mv3 pl3 pr1"><div class="w-100 flex items-flex-end justify-between justify-start-l"><div class="w-100 tr flex justify-end"><div class="flex justify-between items-center"><span class="dn di-l pr1"><a href="https://dash.cloudflare.com/sign-up" class="f1 blue1 dn di-l b no-underline underline-hover" target="_blank" rel="noreferrer">Get Started Free</a></span><span class="f1 gray4 dn di-l pr1">|</span><span class="dn di-l"><a target="_blank" href="https://www.cloudflare.com/plans/enterprise/contact/" class="f1 gray4 no-underline underline-hover pr1" rel="noreferrer">Contact Sales</a></span></div></div></div><div class="w-100 w-50-l flex items-end nb5 nb1-l"><a href="/" class="header-logo mr4 dn db-l"><img class="header-logo" src="https://cf-assets.www.cloudflare.com/zkvhlag99gkb/69RwBidpiEHCDZ9rFVVk7T/092507edbed698420b89658e5a6d5105/CF_logo_stacked_blktype.png" alt="The Cloudflare Blog" width="170" height="57"/></a><h2 class="mt0 mb1 dn di-l"><a href="/" class="fw5 f5 gray3 no-underline"><span class="dn di-l">The Cloudflare Blog</span></a></h2></div><div class="w-100 w-50-l dn db-l"><div class="w-100 tr mkto-sub-message"><p class="f2">Subscribe to receive notifications of new posts:</p></div><div class="w-100 tr"><div class="marketo-form-container"><form id="mktoForm_1653"><div class="top-subscribe-form-container"><div class="top-subscribe-form-field"><input placeholder="Email Address" class="top-subscribe-form-input" name="email" type="email" title="Must be valid email."/></div><button class="top-subscribe-form-button" type="button">Subscribe</button></div></form></div></div></div></header><nav dir="ltr" class="bb b--black-10 db dn-l w-100 ph3 "><div class=" flex justify-between items-center" style="height:44px"><a href="/search/"><img class="h-6 w-6" src="/images/magnifier.svg" alt="magnifier icon"/></a><button type="button" style="background:transparent;border:none"><img src="/images/hamburger.svg" alt="hamburger menu"/></button></div><div class="js-mobile-nav-container dn"><div class="flex flex-column flex-wrap bg-gray9 o-95 absolute ph3 z-1 left-0 right-0 mx-4"><div class="pv3 ph2 tl"><a href="/tag/ai/" class="no-underline gray1 f4 fw7">AI</a></div><div class="pv3 ph2 tl"><a href="/tag/developers/" class="no-underline gray1 f4 fw7">Developers</a></div><div class="pv3 ph2 tl"><a href="/tag/cloudflare-radar/" class="no-underline gray1 f4 fw7">Radar</a></div><div class="pv3 ph2 tl"><a href="/tag/product-news/" class="no-underline gray1 f4 fw7">Product News</a></div><div class="pv3 ph2 tl"><a href="/tag/security/" class="no-underline gray1 f4 fw7">Security</a></div><div class="pv3 ph2 tl"><a href="/tag/policy/" class="no-underline gray1 f4 fw7">Policy &amp; Legal</a></div><div class="pv3 ph2 tl"><a href="/tag/zero-trust/" class="no-underline gray1 f4 fw7">Zero Trust</a></div><div class="pv3 ph2 tl"><a href="/tag/speed-and-reliability/" class="no-underline gray1 f4 fw7">Speed &amp; Reliability</a></div><div class="pv3 ph2 tl"><a href="/tag/life-at-cloudflare/" class="no-underline gray1 f4 fw7">Life at Cloudflare</a></div><div class="pv3 ph2 tl"><a href="/tag/partners/" class="no-underline gray1 f4 fw7">Partners</a></div></div></div></nav><nav id="nav" class="w-100 bb-0 bb-l b--black-10 z-1"><div id="desktop-nav-items-container" class="flex flex-wrap justify-between items-center mw8 center mv3 mv0-l"><div data-tag="ai" class="nav-item nav-item-desktop ml3 mr2 dn db-l pv3"><a href="/tag/ai/" class="no-underline gray1 f2 fw5 pv3">AI</a></div><div data-tag="developers" class="nav-item nav-item-desktop ml3 mr2 dn db-l pv3"><a href="/tag/developers/" class="no-underline gray1 f2 fw5 pv3">Developers</a></div><div data-tag="cloudflare-radar" class="nav-item nav-item-desktop ml3 mr2 dn db-l pv3"><a href="/tag/cloudflare-radar/" class="no-underline gray1 f2 fw5 pv3">Radar</a></div><div data-tag="product-news" class="nav-item nav-item-desktop ml3 mr2 dn db-l pv3"><a href="/tag/product-news/" class="no-underline gray1 f2 fw5 pv3">Product News</a></div><div data-tag="security" class="nav-item nav-item-desktop ml3 mr2 dn db-l pv3"><a href="/tag/security/" class="no-underline gray1 f2 fw5 pv3">Security</a></div><div data-tag="policy" class="nav-item nav-item-desktop ml3 mr2 dn db-l pv3"><a href="/tag/policy/" class="no-underline gray1 f2 fw5 pv3">Policy &amp; Legal</a></div><div data-tag="zero-trust" class="nav-item nav-item-desktop ml3 mr2 dn db-l pv3"><a href="/tag/zero-trust/" class="no-underline gray1 f2 fw5 pv3">Zero Trust</a></div><div data-tag="speed-and-reliability" class="nav-item nav-item-desktop ml3 mr2 dn db-l pv3"><a href="/tag/speed-and-reliability/" class="no-underline gray1 f2 fw5 pv3">Speed &amp; Reliability</a></div><div data-tag="life-at-cloudflare" class="nav-item nav-item-desktop ml3 mr2 dn db-l pv3"><a href="/tag/life-at-cloudflare/" class="no-underline gray1 f2 fw5 pv3">Life at Cloudflare</a></div><div data-tag="partners" class="nav-item nav-item-desktop ml3 mr2 dn db-l pv3"><a href="/tag/partners/" class="no-underline gray1 f2 fw5 pv3">Partners</a></div><div class="nav-item ml2 mr3 dn db-l pv3" data-tag="search icon"><a href="/search/"><img id="search-icon" class="h-6 w-6" src="/images/magnifier.svg" alt="magnifier icon"/></a></div></div></nav><!--astro:end--></astro-island><progress class="reading-progress" value="0" max="100" aria-label="Reading progress"></progress><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();</script><astro-island uid="Z1jLeQB" prefix="r1" component-url="/_astro/Post.DMARki2D.js" component-export="Post" renderer-url="/_astro/client.DLO1yDVm.js" props="{&quot;post&quot;:[0,{&quot;id&quot;:[0,&quot;3cuVG8K7iSqKV8O3fNrAYK&quot;],&quot;title&quot;:[0,&quot;We shipped FinalizationRegistry in Workers: why you should never use it&quot;],&quot;slug&quot;:[0,&quot;we-shipped-finalizationregistry-in-workers-why-you-should-never-use-it&quot;],&quot;excerpt&quot;:[0,&quot;Cloudflare Workers now support FinalizationRegistry, but just because you can use it doesn’t mean you should.&quot;],&quot;featured&quot;:[0,false],&quot;html&quot;:[0,&quot;&lt;p&gt;We’ve recently added support for the &lt;a href=\&quot;https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/FinalizationRegistry\&quot;&gt;&lt;u&gt;FinalizationRegistry API&lt;/u&gt;&lt;/a&gt; in Cloudflare Workers. This API allows developers to request a callback when a JavaScript object is garbage-collected, a feature that can be particularly relevant for managing external resources, such as memory allocated by &lt;a href=\&quot;https://developer.mozilla.org/en-US/docs/WebAssembly\&quot;&gt;&lt;u&gt;WebAssembly&lt;/u&gt;&lt;/a&gt; (Wasm). However, despite its availability, our general advice is: &lt;b&gt;avoid using it directly in most scenarios.&lt;/b&gt;&lt;/p&gt;&lt;p&gt;Our decision to add &lt;code&gt;FinalizationRegistry&lt;/code&gt; — while still cautioning against using it — opens up a bigger conversation: how memory management works when JavaScript and WebAssembly share the same runtime. This is becoming more common in high-performance web apps, and getting it wrong can lead to memory leaks, out-of-memory errors, and performance issues, especially in resource-constrained environments like Cloudflare Workers.&lt;/p&gt;&lt;p&gt;In this post, we’ll look at how JavaScript and Wasm handle memory differently, why that difference matters, and what &lt;code&gt;FinalizationRegistry&lt;/code&gt; is actually useful for. We’ll also explain its limitations, particularly around timing and predictability, walk through why we decided to support it, and how we’ve made it safer to use. Finally, we’ll talk about how newer JavaScript language features offer a more reliable and structured approach to solving these problems.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;memory-management-101\&quot;&gt;Memory management 101&lt;/h2&gt;\n            &lt;a href=\&quot;#memory-management-101\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          \n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;javascript\&quot;&gt;JavaScript&lt;/h3&gt;\n            &lt;a href=\&quot;#javascript\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;JavaScript relies on automatic memory management through a process called &lt;a href=\&quot;https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Memory_management#garbage_collection\&quot;&gt;&lt;u&gt;garbage collection&lt;/u&gt;&lt;/a&gt;. This means developers do not need to worry about freeing allocated memory, or lifetimes. The garbage collector identifies and reclaims memory occupied by objects that are no longer needed by the program (that is, garbage). This helps prevent memory leaks and simplifies memory management for developers.&lt;/p&gt;\n            &lt;pre class=\&quot;language-JavaScript\&quot;&gt;&lt;code class=\&quot;language-JavaScript\&quot;&gt;function greet() {\n  let name = &amp;quot;Alice&amp;quot;;         // String is allocated in memory\n  console.log(&amp;quot;Hello, &amp;quot; + name);\n}                             // &amp;#039;name&amp;#039; goes out of scope\n\ngreet();\n// JavaScript automatically frees allocated memory at some point in future&lt;/pre&gt;&lt;/code&gt;\n            \n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;webassembly\&quot;&gt;WebAssembly&lt;/h3&gt;\n            &lt;a href=\&quot;#webassembly\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;WebAssembly (Wasm) is an assembly-like instruction format designed to run high-performance applications on the web. While it initially gained prominence in web browsers, Wasm is also highly effective on the server side. At Cloudflare, we leverage Wasm to enable users to run code written in a variety of programming languages, such as &lt;a href=\&quot;https://developers.cloudflare.com/workers/languages/rust/\&quot;&gt;&lt;u&gt;Rust&lt;/u&gt;&lt;/a&gt; and &lt;a href=\&quot;https://developers.cloudflare.com/workers/languages/python/\&quot;&gt;&lt;u&gt;Python&lt;/u&gt;&lt;/a&gt;, directly within our &lt;a href=\&quot;https://www.cloudflare.com/learning/serverless/glossary/what-is-chrome-v8/\&quot;&gt;&lt;u&gt;V8 isolates&lt;/u&gt;&lt;/a&gt;, offering both performance and versatility.&lt;/p&gt;&lt;p&gt;Wasm runtimes are designed to be simple stack machines, and lack built-in garbage collectors. This necessitates manual memory management (allocation and deallocation of memory used by Wasm code), making it an ideal compilation target for languages like Rust and C++ that handle their own memory.&lt;/p&gt;&lt;p&gt;Wasm modules operate on &lt;a href=\&quot;https://webassembly.github.io/spec/core/exec/runtime.html#memory-instances\&quot;&gt;&lt;u&gt;linear memory&lt;/u&gt;&lt;/a&gt;: a resizable block of raw bytes, which JavaScript views as an &lt;a href=\&quot;https://developer.mozilla.org/en-US/docs/WebAssembly/Reference/JavaScript_interface/Memory\&quot;&gt;&lt;u&gt;ArrayBuffer&lt;/u&gt;&lt;/a&gt;. This memory is organized in 64 KB pages, and its initial size is defined when the module is compiled or loaded. Wasm code interacts with this memory using 32-bit offsets — integer values functioning as direct pointers that specify a byte offset from the start of its linear memory. This direct memory access model is crucial for Wasm&amp;#39;s high performance. The host environment (which in Cloudflare Workers is JavaScript) also shares this ArrayBuffer, reading and writing (often via &lt;a href=\&quot;https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/TypedArray\&quot;&gt;&lt;u&gt;TypedArrays&lt;/u&gt;&lt;/a&gt;) to enable vital data exchange between Wasm and JavaScript.&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/3nWyMj5xginVWLxCnPpUdY/f939bb0b4f0007999aff876854645f16/image3.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1494\&quot; height=\&quot;672\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;A core Wasm design is its &lt;a href=\&quot;https://webassembly.org/docs/security/\&quot;&gt;&lt;u&gt;secure sandbox&lt;/u&gt;&lt;/a&gt;. This confines Wasm code strictly to its own linear memory and explicitly declared imports from the host, preventing unauthorized memory access or system calls. Direct interaction with JavaScript objects is blocked; communication occurs through numeric values, function references, or operations on the shared ArrayBuffer. This strong isolation is vital for security, ensuring Wasm modules don&amp;#39;t interfere with the host or other application components, which is especially important in multi-tenant environments like Cloudflare Workers.&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/3Ck9v7opkB5Mg1agKNnQm7/c328cc0a2d1c3145a527e1267594fe1d/image2.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1984\&quot; height=\&quot;844\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;Bridging WebAssembly memory with JavaScript often involves writing low-level &amp;quot;glue&amp;quot; code to convert raw byte arrays from Wasm into usable JavaScript types. Doing this manually for every function or data structure is both tedious and error-prone. Fortunately, tools like &lt;a href=\&quot;https://rustwasm.github.io/wasm-bindgen/\&quot;&gt;&lt;u&gt;wasm-bindgen&lt;/u&gt;&lt;/a&gt; and &lt;a href=\&quot;https://emscripten.org/\&quot;&gt;&lt;u&gt;Emscripten (Embind)&lt;/u&gt;&lt;/a&gt; handle this interop automatically, generating the binding code needed to pass data cleanly between the two environments. We use these same tools under the hood — wasm-bindgen for Rust-based &lt;a href=\&quot;https://github.com/cloudflare/workers-rs\&quot;&gt;&lt;u&gt;workers-rs&lt;/u&gt;&lt;/a&gt; projects, and Emscripten for &lt;a href=\&quot;https://developers.cloudflare.com/workers/languages/python/how-python-workers-work/\&quot;&gt;&lt;u&gt;Python Workers&lt;/u&gt;&lt;/a&gt; — to simplify integration and let developers focus on application logic rather than memory translation.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;interoperability\&quot;&gt;Interoperability&lt;/h2&gt;\n            &lt;a href=\&quot;#interoperability\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;High-performance web apps often use JavaScript for interactive UIs and data fetching, while WebAssembly handles demanding operations like media processing and complex calculations for significant performance gains, allowing developers to maximize efficiency. Given the difference in memory management models, developers need  to be careful when using WebAssembly memory in JavaScript.&lt;/p&gt;&lt;p&gt;For this example, we&amp;#39;ll use Rust to compile a WebAssembly module manually. Rust is a popular choice for WebAssembly because it offers precise control over memory and easy Wasm compilation using standard toolchains.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;rust\&quot;&gt;Rust&lt;/h3&gt;\n            &lt;a href=\&quot;#rust\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Here we have two simple functions. &lt;code&gt;make_buffer&lt;/code&gt; creates a string and returns a raw pointer back to JavaScript. The function intentionally “forgets” the memory allocated so that it doesn’t get cleaned up after the function returns. &lt;code&gt;free_buffer&lt;/code&gt;, on the other hand, expects the initial string reference handed back and frees the memory.&lt;/p&gt;\n            &lt;pre class=\&quot;language-Rust\&quot;&gt;&lt;code class=\&quot;language-Rust\&quot;&gt;// Allocate a fresh byte buffer and hand the raw pointer + length to JS.\n// *We intentionally “forget” the Vec so Rust will not free it right away;\n//   JS now owns it and must call `free_buffer` later.*\n#[no_mangle]\npub extern &amp;quot;C&amp;quot; fn make_buffer(out_len: *mut usize) -&amp;gt; *mut u8 {\n    let mut data = b&amp;quot;Hello from Rust&amp;quot;.to_vec();\n    let ptr = data.as_mut_ptr();\n    let len  = data.len();\n\n    unsafe { *out_len = len };\n\n    std::mem::forget(data);\n    return ptr;\n}\n\n/// Counterpart that **must** be called by JS to avoid a leak.\n#[no_mangle]\npub unsafe extern &amp;quot;C&amp;quot; fn free_buffer(ptr: *mut u8, len: usize) {\n    let _ = Vec::from_raw_parts(ptr, len, len);\n}&lt;/pre&gt;&lt;/code&gt;\n            \n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;javascript\&quot;&gt;JavaScript&lt;/h3&gt;\n            &lt;a href=\&quot;#javascript\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Back in JavaScript land, we’ll call these Wasm functions and output them using console.log. This is a common pattern in Wasm-based applications since WebAssembly doesn’t have direct access to Web APIs, and rely on a JavaScript “glue” to interface with the outer world in order to do anything useful.&lt;/p&gt;\n            &lt;pre class=\&quot;language-JavaScript\&quot;&gt;&lt;code class=\&quot;language-JavaScript\&quot;&gt;const { instance } = await WebAssembly.instantiate(WasmBytes, {});\n\nconst { memory, make_buffer, free_buffer } = instance.exports;\n\n//  Use the Rust functions\nconst lenPtr = 0;                 // scratch word in Wasm memory\nconst ptr = make_buffer(lenPtr);\n\nconst len = new DataView(memory.buffer).getUint32(lenPtr, true);\nconst data = new Uint8Array(memory.buffer, ptr, len);\n\nconsole.log(new TextDecoder().decode(data)); // “Hello from Rust”\n\nfree_buffer(ptr, len); // free_buffer must be called to prevent memory leaks&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;You can find all code samples along with setup instructions &lt;a href=\&quot;https://github.com/cloudflare/cloudflare-blog/tree/master/2025-06-finalization-registry\&quot;&gt;&lt;u&gt;here&lt;/u&gt;&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;As you can see, working with Wasm memory from JavaScript requires care, as it introduces the risk of memory leaks if allocated memory isn’t properly released. JavaScript developers are often unfamiliar with manual memory management, and it’s easy to forget returning memory to WebAssembly after use. This can become especially tricky when Wasm-allocated data is passed into JavaScript libraries, making ownership and lifetime harder to track.&lt;/p&gt;&lt;p&gt;While occasional leaks may not cause immediate issues, over time they can lead to increased memory usage and degrade performance, particularly in memory-constrained environments like Cloudflare Workers.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;finalizationregistry\&quot;&gt;FinalizationRegistry&lt;/h2&gt;\n            &lt;a href=\&quot;#finalizationregistry\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;&lt;code&gt;FinalizationRegistry&lt;/code&gt;, introduced as part of the &lt;a href=\&quot;https://tc39.es/proposal-weakrefs/\&quot;&gt;&lt;u&gt;TC-39 WeakRef proposal&lt;/u&gt;&lt;/a&gt;, is a JavaScript API which lets you run “finalizers” (aka cleanup callbacks) when an object gets garbage-collected. Let’s look at a simple example to demonstrate the API:&lt;/p&gt;\n            &lt;pre class=\&quot;language-JavaScript\&quot;&gt;&lt;code class=\&quot;language-JavaScript\&quot;&gt;const my_registry = new FinalizationRegistry((obj) =&amp;gt; { console.log(&amp;quot;Cleaned up: &amp;quot; + obj); });\n\n{\n  let temporary = { key: &amp;quot;value&amp;quot; };\n  // Register this object in our FinalizationRegistry -- the second argument,\n  // &amp;quot;temporary&amp;quot;, will be passed to our callback as its obj parameter\n  my_registry.register(temporary, &amp;quot;temporary&amp;quot;);\n}\n\n// At some point in the future when temporary object gets garbage collected, we&amp;#039;ll see &amp;quot;Cleaned up: temporary&amp;quot; in our logs.&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;Let’s see how we can use this API in our Wasm-based application:&lt;/p&gt;\n            &lt;pre class=\&quot;language-JavaScript\&quot;&gt;&lt;code class=\&quot;language-JavaScript\&quot;&gt;const { instance } = await WebAssembly.instantiate(WasmBytes, {});\n\nconst { memory, make_buffer, free_buffer } = instance.exports;\n\n// FinalizationRegistry would be responsible for returning memory back to Wasm\nconst cleanupFr = new FinalizationRegistry(({ ptr, len }) =&amp;gt; {\n  free_buffer(ptr, len);\n});\n\n//  Use the Rust functions\nconst lenPtr = 0;                 // scratch word in Wasm memory\nconst ptr = make_buffer(lenPtr);\n\nconst len = new DataView(memory.buffer).getUint32(lenPtr, true);\nconst data = new Uint8Array(memory.buffer, ptr, len);\n\n// Register the data buffer in our FinalizationRegistry so that it gets cleaned up automatically\ncleanupFr.register(data, { ptr, len });\n\nconsole.log(new TextDecoder().decode(data));   // → “Hello from Rust”\n\n// No need to manually call free_buffer, FinalizationRegistry will do this for us&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;We can use a &lt;code&gt;FinalizationRegistry&lt;/code&gt; to manage any object borrowed from WebAssembly by registering it with a finalizer that calls the appropriate free function. This is the same approach used by &lt;a href=\&quot;https://rustwasm.github.io/docs/wasm-bindgen/reference/weak-references.html\&quot;&gt;&lt;u&gt;wasm-bindgen&lt;/u&gt;&lt;/a&gt;. It shifts the burden of manual cleanup away from the JavaScript developer and delegates it to the JavaScript garbage collector. However, in practice, things aren’t quite that simple.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;inherent-issues-with-finalizationregistry\&quot;&gt;Inherent issues with FinalizationRegistry&lt;/h2&gt;\n            &lt;a href=\&quot;#inherent-issues-with-finalizationregistry\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;There is a fundamental issue with &lt;code&gt;FinalizationRegistry&lt;/code&gt;: garbage collection is non-deterministic, and may clean up your unused memory at some arbitrary point in the future. In some cases, garbage collection might not even run and your “finalizers” will never be triggered.&lt;/p&gt;&lt;p&gt;This is part of its &lt;a href=\&quot;https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/FinalizationRegistry#notes_on_cleanup_callbacks\&quot;&gt;&lt;u&gt;documentation&lt;/u&gt;&lt;/a&gt; as well:&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;&lt;i&gt;“A conforming JavaScript implementation, even one that does garbage collection, is not required to call cleanup callbacks. When and whether it does so is entirely down to the implementation of the JavaScript engine. When a registered object is reclaimed, any cleanup callbacks for it may be called then, or some time later, or not at all.”&lt;/i&gt;&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;Even Emscripten mentions this in their &lt;a href=\&quot;https://emscripten.org/docs/porting/connecting_cpp_and_javascript/embind.html#automatic-memory-management\&quot;&gt;&lt;u&gt;documentation&lt;/u&gt;&lt;/a&gt;: “&lt;i&gt;... finalizers are not guaranteed to be called, and even if they are, there are no guarantees about their timing or order of execution, which makes them unsuitable for general RAII-style resource management.&lt;/i&gt;”&lt;/p&gt;&lt;p&gt;Given their non-deterministic nature, developers seldom use finalizers for any essential program logic. Treat them as a last-ditch safety net, not as a primary cleanup mechanism — explicit, deterministic teardown logic is almost always safer, faster, and easier to reason about.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;enabling-finalizationregistry-in-workers\&quot;&gt;Enabling FinalizationRegistry in Workers&lt;/h2&gt;\n            &lt;a href=\&quot;#enabling-finalizationregistry-in-workers\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;Given its non-deterministic nature and limited early adoption, we initially disabled the &lt;code&gt;FinalizationRegistry&lt;/code&gt; API in our runtime. However, as usage of Wasm-based Workers grew — particularly among high-traffic customers — we began to see new demands emerge. One such customer was running an extremely high requests per second (RPS) workload using WebAssembly, and needed tight control over memory to sustain massive traffic spikes without degradation. This highlighted a gap in our memory management capabilities, especially in cases where manual cleanup wasn’t always feasible or reliable. As a result, we re-evaluated our stance and began exploring the challenges and trade-offs of enabling &lt;code&gt;FinalizationRegistry&lt;/code&gt; within the Workers environment, despite its known limitations.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;preventing-footguns-with-safe-defaults\&quot;&gt;Preventing footguns with safe defaults&lt;/h3&gt;\n            &lt;a href=\&quot;#preventing-footguns-with-safe-defaults\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Because this API could be misused and cause unpredictable results for our customers, we’ve added a few safeguards. Most importantly, cleanup callbacks are run without an active async context, which means they cannot perform any I/O. This includes sending events to a tail Worker, logging metrics, or making fetch requests.&lt;/p&gt;&lt;p&gt;While this might sound limiting, it’s very intentional. Finalization callbacks are meant for cleanup — especially for releasing WebAssembly memory — not for triggering side effects. If we allowed I/O here, developers might (accidentally) rely on finalizers to perform critical logic that depends on when garbage collection happens. That timing is non-deterministic and outside your control, which could lead to flaky, hard-to-debug behavior.&lt;/p&gt;&lt;p&gt;We don’t have full control over when V8’s garbage collector performs cleanup, but V8 does let us nudge the timing of finalizer execution. Like Node and Deno, Workers queue &lt;code&gt;FinalizationRegistry&lt;/code&gt; jobs only after the microtask queue has drained, so each cleanup batch slips into the quiet slots between I/O phases of the event loop.&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/69QSYwmiAueWyP2KlvBwGi/183345cbb043acbe4d76c0fdb2ebf4dd/image1.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1992\&quot; height=\&quot;344\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;security-concerns\&quot;&gt;Security concerns&lt;/h3&gt;\n            &lt;a href=\&quot;#security-concerns\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;The Cloudflare Workers runtime is &lt;a href=\&quot;https://blog.cloudflare.com/mitigating-spectre-and-other-security-threats-the-cloudflare-workers-security-model\&quot;&gt;&lt;u&gt;specifically engineered&lt;/u&gt;&lt;/a&gt; to prevent side-channel attacks in a multi-tenant environment. Prior to enabling the &lt;code&gt;FinalizationRegistry&lt;/code&gt; API, we did a thorough analysis to assess its impact on our security model and determine the necessity of additional safeguards. The non-deterministic nature of &lt;code&gt;FinalizationRegistry&lt;/code&gt; raised concerns about potential information leaks leading to Spectre-like vulnerabilities, particularly regarding the possibility of exploiting the garbage collector (GC) as a confused deputy or using it to create a timer.&lt;/p&gt;&lt;h4&gt;GC as confused deputy&lt;/h4&gt;&lt;p&gt;One concern was whether the garbage collector (GC) could act as a confused deputy — a security antipattern where a privileged component is tricked into misusing its authority on behalf of untrusted code. In theory, a clever attacker could try to exploit the GC&amp;#39;s ability to access internal object lifetimes and memory behavior in order to infer or manipulate sensitive information across isolation boundaries.&lt;/p&gt;&lt;p&gt;However, our analysis indicated that the V8 GC is effectively contained and not exposed to confused deputy risks within the runtime. This is attributed to our existing threat models and security measures, such as the isolation of user code, where the V8 Isolate serves as the primary security boundary. Furthermore, even though FinalizationRegistry involves some internal GC mechanics, the callbacks themselves execute in the same isolate that registered them — never across isolates — ensuring isolation remains intact.&lt;/p&gt;&lt;h4&gt;GC as timer&lt;/h4&gt;&lt;p&gt;We also evaluated the possibility of using FinalizationRegistry as a high-resolution timing mechanism — a common vector in side-channel attacks like Spectre. The concern here is that an attacker could schedule object finalization in a way that indirectly leaks information via the timing of callbacks.&lt;/p&gt;&lt;p&gt;In practice, though, the resolution of such a &amp;quot;GC timer&amp;quot; is low and highly variable, offering poor reliability for side-channel attacks. Additionally, we control when finalizer callbacks are scheduled — delaying them until after the microtask queue has drained — giving us an extra layer of control to limit timing precision and reduce risk.&lt;/p&gt;&lt;p&gt;Following a review with our security research team, we determined that our existing security model is sufficient to support this API.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;predictable-cleanups\&quot;&gt;Predictable cleanups?&lt;/h2&gt;\n            &lt;a href=\&quot;#predictable-cleanups\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;JavaScript&amp;#39;s &lt;a href=\&quot;https://tc39.es/proposal-explicit-resource-management/\&quot;&gt;&lt;u&gt;Explicit Resource Management&lt;/u&gt;&lt;/a&gt; proposal introduces a deterministic approach to handle resources needing manual cleanup, such as file handles, network connections, or database sessions. Drawing inspiration from constructs like C#&amp;#39;s &lt;a href=\&quot;https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/using\&quot;&gt;&lt;u&gt;using&lt;/u&gt;&lt;/a&gt; and Python&amp;#39;s &lt;a href=\&quot;https://docs.python.org/3/reference/compound_stmts.html#with\&quot;&gt;&lt;u&gt;with&lt;/u&gt;&lt;/a&gt;, this proposal introduces the using and &lt;code&gt;await using&lt;/code&gt; syntax. This new syntax guarantees that objects adhering to a specific cleanup protocol are automatically disposed of when they are no longer within their scope.&lt;/p&gt;&lt;p&gt;Let’s look at a simple example to understand it a bit better.&lt;/p&gt;\n            &lt;pre class=\&quot;language-JavaScript\&quot;&gt;&lt;code class=\&quot;language-JavaScript\&quot;&gt;class MyResource {\n  [Symbol.dispose]() {\n    console.log(&amp;quot;Resource cleaned up!&amp;quot;);\n  }\n\n  use() {\n    console.log(&amp;quot;Using the resource...&amp;quot;);\n  }\n}\n\n{\n  using res = new MyResource();\n  res.use();\n} // When this block ends, Symbol.dispose is called automatically (and deterministically).&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;The proposal also includes additional features that offer finer control over when dispose methods are called. But at a high level, it provides a much-needed, deterministic way to manage resource cleanup. Let’s now update our earlier WebAssembly-based example to take advantage of this new mechanism instead of relying on &lt;code&gt;FinalizationRegistry&lt;/code&gt;:&lt;/p&gt;\n            &lt;pre class=\&quot;language-JavaScript\&quot;&gt;&lt;code class=\&quot;language-JavaScript\&quot;&gt;const { instance } = await WebAssembly.instantiate(WasmBytes, {});\nconst { memory, make_buffer, free_buffer } = instance.exports;\n\nclass WasmBuffer {\n  constructor(ptr, len) {\n    this.ptr = ptr;\n    this.len = len;\n  }\n\n  [Symbol.dispose]() {\n    free_buffer(this.ptr, this.len);\n  }\n}\n\n{\n  const lenPtr = 0;\n  const ptr = make_buffer(lenPtr);\n  const len = new DataView(memory.buffer).getUint32(lenPtr, true);\n\n  using buf = new WasmBuffer(ptr, len);\n\n  const data = new Uint8Array(memory.buffer, ptr, len);\n  console.log(new TextDecoder().decode(data));  // → “Hello from Rust”\n} // Symbol.dispose or free_buffer gets called deterministically here&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;Explicit Resource Management provides a more dependable way to clean up resources than &lt;code&gt;FinalizationRegistry&lt;/code&gt;, as it runs cleanup logic — such as calling &lt;code&gt;free_buffer&lt;/code&gt; in WasmBuffer via &lt;code&gt;[Symbol.dispose]()&lt;/code&gt; and the &lt;code&gt;using&lt;/code&gt; syntax — deterministically, rather than relying on the garbage collector’s unpredictable timing. This makes it a more reliable choice for managing critical resources, especially memory.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;future\&quot;&gt;Future&lt;/h2&gt;\n            &lt;a href=\&quot;#future\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;Emscripten &lt;a href=\&quot;https://emscripten.org/docs/porting/connecting_cpp_and_javascript/embind.html#automatic-memory-management\&quot;&gt;&lt;u&gt;already makes use&lt;/u&gt;&lt;/a&gt; of Explicit Resource Management for handling Wasm memory, using &lt;code&gt;FinalizationRegistry&lt;/code&gt; as a last resort, while wasm-bindgen &lt;a href=\&quot;https://github.com/rustwasm/wasm-bindgen/pull/4118\&quot;&gt;&lt;u&gt;supports it in experimental mode&lt;/u&gt;&lt;/a&gt;. The proposal has seen growing adoption across the ecosystem and was recently conditionally advanced to Stage 4 in the TC39 process, meaning it’ll soon officially be part of the JavaScript language standard. This reflects a broader shift toward more predictable and structured memory cleanup in WebAssembly applications.&lt;/p&gt;&lt;p&gt;We &lt;a href=\&quot;https://developers.cloudflare.com/workers/platform/changelog/#2025-05-22\&quot;&gt;&lt;u&gt;recently added support&lt;/u&gt;&lt;/a&gt; for this feature in Cloudflare Workers as well, enabling developers to take advantage of deterministic resource cleanup in edge environments. As support for the feature matures, it&amp;#39;s likely to become a standard practice for managing linear memory safely and reliably.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;finalizationregistry-still-not-dead-yet\&quot;&gt;FinalizationRegistry: still not dead yet?&lt;/h3&gt;\n            &lt;a href=\&quot;#finalizationregistry-still-not-dead-yet\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Explicit Resource Management brings much-needed structure and predictability to resource cleanup in WebAssembly and JavaScript interop applications, but it doesn’t make &lt;code&gt;FinalizationRegistry&lt;/code&gt; obsolete. There are still important use cases, particularly when a Wasm-allocated object’s lifecycle is out of your hands or when explicit disposal isn’t practical. In scenarios involving third-party libraries, dynamic lifecycles, or integration layers that don’t follow &lt;code&gt;using&lt;/code&gt; patterns, &lt;code&gt;FinalizationRegistry&lt;/code&gt; remains a valuable fallback to prevent memory leaks.&lt;/p&gt;&lt;p&gt;Looking ahead, a hybrid approach will likely become the standard in Wasm-JavaScript applications. Developers can use ERM for deterministic cleanup of Wasm memory and other resources, while relying on &lt;code&gt;FinalizationRegistry&lt;/code&gt; as a safety net when full control isn’t possible. Together, they offer a more reliable and flexible foundation for managing memory across the JavaScript and WebAssembly boundary.&lt;/p&gt;&lt;p&gt;Ready to try it yourself? Deploy a &lt;a href=\&quot;https://developers.cloudflare.com/workers/runtime-apis/webassembly/\&quot;&gt;&lt;u&gt;WebAssembly-powered Worker&lt;/u&gt;&lt;/a&gt; and experiment with memory management — start building with &lt;a href=\&quot;https://developers.cloudflare.com/workers/\&quot;&gt;&lt;u&gt;Cloudflare Workers&lt;/u&gt;&lt;/a&gt; today.&lt;/p&gt;&quot;],&quot;published_at&quot;:[0,&quot;2025-06-11T14:00+01:00&quot;],&quot;updated_at&quot;:[0,&quot;2025-06-11T13:00:03.311Z&quot;],&quot;feature_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/7cLMMILFb6WD9qrMUeJoWO/57652dbdb6f77038eedffd08bef442e4/image4.png&quot;],&quot;tags&quot;:[1,[[0,{&quot;id&quot;:[0,&quot;6hbkItfupogJP3aRDAq6v8&quot;],&quot;name&quot;:[0,&quot;Cloudflare Workers&quot;],&quot;slug&quot;:[0,&quot;workers&quot;]}],[0,{&quot;id&quot;:[0,&quot;5ghWZAL0nNGxrphuhWW6G0&quot;],&quot;name&quot;:[0,&quot;WebAssembly&quot;],&quot;slug&quot;:[0,&quot;webassembly&quot;]}],[0,{&quot;id&quot;:[0,&quot;78aSAeMjGNmCuetQ7B4OgU&quot;],&quot;name&quot;:[0,&quot;JavaScript&quot;],&quot;slug&quot;:[0,&quot;javascript&quot;]}]]],&quot;relatedTags&quot;:[0],&quot;authors&quot;:[1,[[0,{&quot;name&quot;:[0,&quot;Ketan Gupta&quot;],&quot;slug&quot;:[0,&quot;ketan-gupta&quot;],&quot;bio&quot;:[0],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/4HNGL8tqmoWI8yZJEEynzY/4dc4778dc00d47cc7da853c61c224fd7/Ketan_Gupta.webp&quot;],&quot;location&quot;:[0],&quot;website&quot;:[0],&quot;twitter&quot;:[0],&quot;facebook&quot;:[0],&quot;publiclyIndex&quot;:[0,true]}],[0,{&quot;name&quot;:[0,&quot;Harris Hancock&quot;],&quot;slug&quot;:[0,&quot;harris-hancock&quot;],&quot;bio&quot;:[0],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/kl1szOUahVoAesAqM5x8w/18cf3fe1108e24731361523b5c51e45c/Harris_Hancock.webp&quot;],&quot;location&quot;:[0],&quot;website&quot;:[0],&quot;twitter&quot;:[0],&quot;facebook&quot;:[0],&quot;publiclyIndex&quot;:[0,true]}]]],&quot;meta_description&quot;:[0,&quot;Cloudflare Workers now support FinalizationRegistry, but just because you can use it doesn’t mean you should. Dive into the tricky world of JavaScript and WebAssembly memory management and see why newer features make life a lot easier.&quot;],&quot;primary_author&quot;:[0,{}],&quot;localeList&quot;:[0,{&quot;name&quot;:[0,&quot;blog-english-only&quot;],&quot;enUS&quot;:[0,&quot;English for Locale&quot;],&quot;zhCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhHansCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhTW&quot;:[0,&quot;No Page for Locale&quot;],&quot;frFR&quot;:[0,&quot;No Page for Locale&quot;],&quot;deDE&quot;:[0,&quot;No Page for Locale&quot;],&quot;itIT&quot;:[0,&quot;No Page for Locale&quot;],&quot;jaJP&quot;:[0,&quot;No Page for Locale&quot;],&quot;koKR&quot;:[0,&quot;No Page for Locale&quot;],&quot;ptBR&quot;:[0,&quot;No Page for Locale&quot;],&quot;esLA&quot;:[0,&quot;No Page for Locale&quot;],&quot;esES&quot;:[0,&quot;No Page for Locale&quot;],&quot;enAU&quot;:[0,&quot;No Page for Locale&quot;],&quot;enCA&quot;:[0,&quot;No Page for Locale&quot;],&quot;enIN&quot;:[0,&quot;No Page for Locale&quot;],&quot;enGB&quot;:[0,&quot;No Page for Locale&quot;],&quot;idID&quot;:[0,&quot;No Page for Locale&quot;],&quot;ruRU&quot;:[0,&quot;No Page for Locale&quot;],&quot;svSE&quot;:[0,&quot;No Page for Locale&quot;],&quot;viVN&quot;:[0,&quot;No Page for Locale&quot;],&quot;plPL&quot;:[0,&quot;No Page for Locale&quot;],&quot;arAR&quot;:[0,&quot;No Page for Locale&quot;],&quot;nlNL&quot;:[0,&quot;No Page for Locale&quot;],&quot;thTH&quot;:[0,&quot;No Page for Locale&quot;],&quot;trTR&quot;:[0,&quot;No Page for Locale&quot;],&quot;heIL&quot;:[0,&quot;No Page for Locale&quot;],&quot;lvLV&quot;:[0,&quot;No Page for Locale&quot;],&quot;etEE&quot;:[0,&quot;No Page for Locale&quot;],&quot;ltLT&quot;:[0,&quot;No Page for Locale&quot;]}],&quot;url&quot;:[0,&quot;https://blog.cloudflare.com/we-shipped-finalizationregistry-in-workers-why-you-should-never-use-it&quot;],&quot;metadata&quot;:[0,{&quot;title&quot;:[0,&quot;We shipped FinalizationRegistry in Workers: why you should never use it&quot;],&quot;description&quot;:[0,&quot;Cloudflare Workers now support FinalizationRegistry, but just because you can use it doesn’t mean you should. Dive into the tricky world of JavaScript and WebAssembly memory management and see why newer features make life a lot easier. &quot;],&quot;imgPreview&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/3qcV6p7f2TQDnrcte9HS0w/1488188579d497e0756b603e8e41091f/We_shipped_FinalizationRegistry_in_Workers-_why_you_should_never_use_it-OG.png&quot;]}],&quot;publicly_index&quot;:[0,true]}],&quot;initialReadingTime&quot;:[0,&quot;9&quot;],&quot;relatedPosts&quot;:[1,[[0,{&quot;id&quot;:[0,&quot;4gk3k2ZiTN6DZoHu3e090r&quot;],&quot;title&quot;:[0,&quot;Connect any React application to an MCP server in three lines of code&quot;],&quot;slug&quot;:[0,&quot;connect-any-react-application-to-an-mcp-server-in-three-lines-of-code&quot;],&quot;excerpt&quot;:[0,&quot;We&#39;re open-sourcing use-mcp, a React library that connects to any MCP server in just 3 lines of code, as well as our AI Playground, a complete chat interface that can connect to remote MCP servers. &quot;],&quot;featured&quot;:[0,false],&quot;html&quot;:[0,&quot;&lt;p&gt;You can &lt;a href=\&quot;https://developers.cloudflare.com/agents/guides/remote-mcp-server/\&quot;&gt;&lt;u&gt;deploy&lt;/u&gt;&lt;/a&gt; a &lt;a href=\&quot;https://blog.cloudflare.com/remote-model-context-protocol-servers-mcp/\&quot;&gt;&lt;u&gt;remote Model Context Protocol (MCP) server&lt;/u&gt;&lt;/a&gt; on Cloudflare in just one-click. Don’t believe us? Click the button below. &lt;/p&gt;&lt;a href=\&quot;https://deploy.workers.cloudflare.com/?url=https://github.com/cloudflare/ai/tree/main/demos/remote-mcp-authless\&quot;&gt;&lt;img src=\&quot;https://deploy.workers.cloudflare.com/button\&quot; alt=\&quot;Deploy to Cloudflare\&quot;/&gt;&lt;/a&gt;\n&lt;p&gt;&lt;/p&gt;&lt;p&gt;This will get you started with a remote MCP server that supports the latest MCP standards and is the reason why thousands of remote MCP servers have been deployed on Cloudflare, including ones from companies like &lt;a href=\&quot;https://blog.cloudflare.com/mcp-demo-day/\&quot;&gt;&lt;u&gt;Atlassian, Linear, PayPal, and more&lt;/u&gt;&lt;/a&gt;. &lt;/p&gt;&lt;p&gt;But deploying servers is only half of the equation — we also wanted to make it just as easy to build and deploy remote MCP clients that can connect to these servers to enable new AI-powered service integrations. That&amp;#39;s why we built &lt;code&gt;use-mcp&lt;/code&gt;, a React library for connecting to remote MCP servers, and we&amp;#39;re excited to contribute it to the MCP ecosystem to enable more developers to build remote MCP clients.&lt;/p&gt;&lt;p&gt;Today, we&amp;#39;re open-sourcing two tools that make it easy to build and deploy MCP clients:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;&lt;p&gt;&lt;a href=\&quot;https://github.com/modelcontextprotocol/use-mcp\&quot;&gt;&lt;u&gt;use-mcp&lt;/u&gt;&lt;/a&gt; — A React library that connects to any remote MCP server in just 3 lines of code, with transport, authentication, and session management automatically handled. We&amp;#39;re excited to contribute this library to the &lt;a href=\&quot;https://github.com/modelcontextprotocol\&quot;&gt;&lt;u&gt;MCP ecosystem&lt;/u&gt;&lt;/a&gt; to enable more developers to build remote MCP clients. &lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;a href=\&quot;https://github.com/cloudflare/ai/tree/main/playground/ai\&quot;&gt;&lt;u&gt;The AI Playground&lt;/u&gt;&lt;/a&gt; — Cloudflare’s &lt;a href=\&quot;https://playground.ai.cloudflare.com/\&quot;&gt;&lt;u&gt;AI chat interface&lt;/u&gt;&lt;/a&gt; platform that uses a number of LLM models to interact with remote MCP servers, with support for the latest MCP standard, which you can now deploy yourself. &lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;Whether you&amp;#39;re building an AI-powered chat bot, a support agent, or an internal company interface, you can leverage these tools to connect your AI agents and applications to external services via MCP. &lt;/p&gt;&lt;p&gt;Ready to get started? Click on the button below to deploy your own instance of Cloudflare’s AI Playground to see it in action. &lt;/p&gt;&lt;a href=\&quot;https://deploy.workers.cloudflare.com/?url=https://github.com/cloudflare/ai/tree/main/playground/ai\&quot;&gt;&lt;img src=\&quot;https://deploy.workers.cloudflare.com/button\&quot; alt=\&quot;Deploy to Cloudflare\&quot;/&gt;&lt;/a&gt;\n&lt;p&gt;&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;use-mcp-a-react-library-for-building-remote-mcp-clients\&quot;&gt;use-mcp: a React library for building remote MCP clients&lt;/h2&gt;\n            &lt;a href=\&quot;#use-mcp-a-react-library-for-building-remote-mcp-clients\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;&lt;a href=\&quot;https://github.com/modelcontextprotocol/use-mcp\&quot;&gt;&lt;u&gt;use-mcp&lt;/u&gt;&lt;/a&gt; is a &lt;a href=\&quot;https://www.npmjs.com/package/use-mcp\&quot;&gt;&lt;u&gt;React library&lt;/u&gt;&lt;/a&gt; that abstracts away all the complexity of building MCP clients. Add the &lt;code&gt;useMCP()&lt;/code&gt; hook into any React application to connect to remote MCP servers that users can interact with. &lt;/p&gt;&lt;p&gt;Here’s all the code you need to add to connect to a remote MCP server: &lt;/p&gt;\n            &lt;pre class=\&quot;language-TypeScript\&quot;&gt;&lt;code class=\&quot;language-TypeScript\&quot;&gt;mport { useMcp } from &amp;#039;use-mcp/react&amp;#039;\nfunction MyComponent() {\n  const { state, tools, callTool } = useMcp({\n    url: &amp;#039;https://mcp-server.example.com&amp;#039;\n  })\n  return &amp;lt;div&amp;gt;Your actual UI code&amp;lt;/div&amp;gt;\n}&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;Just specify the URL, and you&amp;#39;re instantly connected. &lt;/p&gt;&lt;p&gt;Behind the scenes, &lt;code&gt;use-mcp&lt;/code&gt; handles the transport protocols (both Streamable HTTP and Server-Sent Events), authentication flows, and session management. It also includes a number of features to help you build reliable, scalable, and production-ready MCP clients. &lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;connection-management\&quot;&gt;Connection management &lt;/h3&gt;\n            &lt;a href=\&quot;#connection-management\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Network reliability shouldn’t impact user experience. &lt;code&gt;use-mcp &lt;/code&gt;manages connection retries and reconnections with a backoff schedule to ensure your client can recover the connection during a network issue and continue where it left off. The hook exposes real-time &lt;a href=\&quot;https://github.com/modelcontextprotocol/use-mcp/tree/main?tab=readme-ov-file#return-value\&quot;&gt;&lt;u&gt;connection states&lt;/u&gt;&lt;/a&gt; (&amp;quot;connecting&amp;quot;, &amp;quot;ready&amp;quot;, &amp;quot;failed&amp;quot;), allowing you to build responsive UIs that keep users informed without requiring you to write any custom connection handling logic. &lt;/p&gt;\n            &lt;pre class=\&quot;language-TypeScript\&quot;&gt;&lt;code class=\&quot;language-TypeScript\&quot;&gt;const { state } = useMcp({ url: &amp;#039;https://mcp-server.example.com&amp;#039; })\n\nif (state === &amp;#039;connecting&amp;#039;) {\n  return &amp;lt;div&amp;gt;Establishing connection...&amp;lt;/div&amp;gt;\n}\nif (state === &amp;#039;ready&amp;#039;) {\n  return &amp;lt;div&amp;gt;Connected and ready!&amp;lt;/div&amp;gt;\n}\nif (state === &amp;#039;failed&amp;#039;) {\n  return &amp;lt;div&amp;gt;Connection failed&amp;lt;/div&amp;gt;\n}&lt;/pre&gt;&lt;/code&gt;\n            \n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;authentication-authorization\&quot;&gt;Authentication &amp;amp; authorization&lt;/h3&gt;\n            &lt;a href=\&quot;#authentication-authorization\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Many MCP servers require some form of authentication in order to make tool calls. &lt;code&gt;use-mcp&lt;/code&gt; supports &lt;a href=\&quot;https://oauth.net/2.1/\&quot;&gt;&lt;u&gt;OAuth 2.1&lt;/u&gt;&lt;/a&gt; and handles the entire OAuth flow.  It redirects users to the login page, allows them to grant access, securely stores the access token returned by the OAuth provider, and uses it for all subsequent requests to the server. The library also provides &lt;a href=\&quot;https://github.com/modelcontextprotocol/use-mcp/tree/main?tab=readme-ov-file#api-reference\&quot;&gt;&lt;u&gt;methods&lt;/u&gt;&lt;/a&gt; for users to revoke access and clear stored credentials. This gives you a complete authentication system that allows you to securely connect to remote MCP servers, without writing any of the logic. &lt;/p&gt;\n            &lt;pre class=\&quot;language-TypeScript\&quot;&gt;&lt;code class=\&quot;language-TypeScript\&quot;&gt;const { clearStorage } = useMcp({ url: &amp;#039;https://mcp-server.example.com&amp;#039; })\n\n// Revoke access and clear stored credentials\nconst handleLogout = () =&amp;gt; {\n  clearStorage() // Removes all stored tokens, client info, and auth state\n}&lt;/pre&gt;&lt;/code&gt;\n            \n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;dynamic-tool-discovery\&quot;&gt;Dynamic tool discovery&lt;/h3&gt;\n            &lt;a href=\&quot;#dynamic-tool-discovery\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;When you connect to an MCP server, &lt;code&gt;use-mcp&lt;/code&gt; fetches the tools it exposes. If the server adds new capabilities, your app will see them without any code changes. Each tool provides type-safe metadata about its required inputs and functionality, so your client can automatically validate user input and make the right tool calls.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;debugging-monitoring-capabilities\&quot;&gt;Debugging &amp;amp; monitoring capabilities&lt;/h3&gt;\n            &lt;a href=\&quot;#debugging-monitoring-capabilities\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;To help you troubleshoot MCP integrations, &lt;code&gt;use-mcp &lt;/code&gt;exposes a &lt;code&gt;log&lt;/code&gt; array containing structured messages at debug, info, warn, and error levels, with timestamps for each one. You can enable detailed logging with the &lt;code&gt;debug&lt;/code&gt; option to track tool calls, authentication flows, connection state changes, and errors. This real-time visibility makes it easier to diagnose issues during development and production. &lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;future-proofed-backwards-compatible\&quot;&gt;Future-proofed &amp;amp; backwards compatible&lt;/h3&gt;\n            &lt;a href=\&quot;#future-proofed-backwards-compatible\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;MCP is evolving rapidly, with recent updates to transport mechanisms and upcoming changes to authorization. &lt;code&gt;use-mcp&lt;/code&gt; supports both Server-Sent Events (SSE) and the newer Streamable HTTP transport, automatically detecting and upgrading to newer protocols, when supported by the MCP server. &lt;/p&gt;&lt;p&gt;As the MCP specification continues to evolve, we&amp;#39;ll keep the library updated with the latest standards, while maintaining backwards compatibility. We are also excited to contribute &lt;code&gt;use-mcp&lt;/code&gt; to the &lt;a href=\&quot;https://github.com/modelcontextprotocol/\&quot;&gt;&lt;u&gt;MCP project&lt;/u&gt;&lt;/a&gt;, so it can grow with help from the wider community.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;mcp-inspector-built-with-use-mcp\&quot;&gt;MCP Inspector, built with use-mcp&lt;/h3&gt;\n            &lt;a href=\&quot;#mcp-inspector-built-with-use-mcp\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;In use-mcp’s &lt;a href=\&quot;https://github.com/modelcontextprotocol/use-mcp/tree/main/examples\&quot;&gt;&lt;u&gt;examples directory&lt;/u&gt;&lt;/a&gt;, you’ll see a minimal &lt;a href=\&quot;https://inspector.use-mcp.dev/\&quot;&gt;&lt;u&gt;MCP Inspector&lt;/u&gt;&lt;/a&gt; that was built with the &lt;code&gt;use-mcp&lt;/code&gt; hook. . Enter any MCP server URL to test connections, see available tools, and monitor interactions through the debug logs. It&amp;#39;s a great starting point for building your own MCP clients or something you can use to debug connections to your MCP server. &lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/6PmPcZicaO39x9SuRqzqSX/b6caa6c7af1d6b03f17c41771598d1b5/image1.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1450\&quot; height=\&quot;1100\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;a href=\&quot;https://deploy.workers.cloudflare.com/?url=https://github.com/modelcontextprotocol/use-mcp/tree/main/examples/inspector\&quot;&gt;&lt;img src=\&quot;https://deploy.workers.cloudflare.com/button\&quot; alt=\&quot;Deploy to Cloudflare\&quot;/&gt;&lt;/a&gt;\n&lt;p&gt;&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;open-sourcing-the-ai-playground\&quot;&gt;Open-sourcing the AI Playground &lt;/h2&gt;\n            &lt;a href=\&quot;#open-sourcing-the-ai-playground\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;We initially built the &lt;a href=\&quot;https://playground.ai.cloudflare.com/\&quot;&gt;&lt;u&gt;AI Playground&lt;/u&gt;&lt;/a&gt; to give users a chat interface for testing different AI models supported by Workers AI. We then added MCP support, so it could be used as a remote MCP client to connect to and test MCP servers. Today, we&amp;#39;re open-sourcing the playground, giving you the complete chat interface with the MCP client built in, so you can deploy it yourself and customize it to fit your needs. &lt;/p&gt;&lt;a href=\&quot;https://deploy.workers.cloudflare.com/?url=https://github.com/cloudflare/ai/tree/main/playground/ai\&quot;&gt;&lt;img src=\&quot;https://deploy.workers.cloudflare.com/button\&quot; alt=\&quot;Deploy to Cloudflare\&quot;/&gt;&lt;/a&gt;\n&lt;p&gt;&lt;/p&gt;&lt;p&gt;The playground comes with built-in support for the latest MCP standards, including both Streamable HTTP and Server-Sent Events transport methods, OAuth authentication flows that allow users to sign-in and grant permissions, as well as support for bearer token authentication for direct MCP server connections.&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/5iaUzuxBZafrH1q0VYHTJf/a7585da38f75818111b3521c9a5ef4e3/image2.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1999\&quot; height=\&quot;1448\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;how-the-ai-playground-works\&quot;&gt;How the AI Playground works&lt;/h3&gt;\n            &lt;a href=\&quot;#how-the-ai-playground-works\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;The AI Playground is built on Workers AI, giving you access to a full catalog of large language models (LLMs) running on Cloudflare&amp;#39;s network, combined with the Agents SDK and &lt;code&gt;use-mcp&lt;/code&gt; library for MCP server connections.&lt;/p&gt;&lt;p&gt;The AI Playground uses the &lt;code&gt;use-mcp&lt;/code&gt; library to manage connections to remote MCP servers. When the playground starts up, it initializes the MCP connection system with &lt;code&gt;const{tools: mcpTools} = useMcp()&lt;/code&gt;, which provides access to all tools from connected servers. At first, this list is empty because it’s not connected to any MCP servers, but once a connection to a remote MCP server is established, the tools are automatically discovered and populated into the list. &lt;/p&gt;&lt;p&gt;Once &lt;a href=\&quot;https://github.com/cloudflare/ai/blob/af1ce8be87d6a4e6bc10bb83f7959e63b28c1c8e/playground/ai/src/McpServers.tsx#L550\&quot;&gt;&lt;u&gt;connected&lt;/u&gt;&lt;/a&gt;, the playground immediately has access to any tools that the MCP server exposes. The &lt;code&gt;use-mcp&lt;/code&gt; library handles all the protocol communication and tool discovery, and maintains the connection state. If the MCP server requires authentication, the playground handles OAuth flows through a dedicated callback page that uses &lt;code&gt;onMcpAuthorization &lt;/code&gt;from &lt;code&gt;use-mcp&lt;/code&gt; to complete the authentication process.&lt;/p&gt;&lt;p&gt;When a user sends a chat message, the playground takes the &lt;code&gt;mcpTools&lt;/code&gt; from the &lt;code&gt;use-mcp&lt;/code&gt; hook and passes them directly to Workers AI, enabling the model to understand what capabilities are available and invoke them as needed. &lt;/p&gt;\n            &lt;pre class=\&quot;language-TypeScript\&quot;&gt;&lt;code class=\&quot;language-TypeScript\&quot;&gt;const stream = useChat({\n  api: &amp;quot;/api/inference&amp;quot;,\n  body: {\n    model: params.model,\n    tools: mcpTools, // Tools from connected MCP servers\n    max_tokens: params.max_tokens,\n    system_message: params.system_message,\n  },\n})&lt;/pre&gt;&lt;/code&gt;\n            \n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;debugging-and-monitoring\&quot;&gt;Debugging and monitoring&lt;/h3&gt;\n            &lt;a href=\&quot;#debugging-and-monitoring\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;To monitor and debug connections to MCP servers, we’ve added a Debug Log interface to the playground. This displays real-time information about the MCP server connections, including connection status, authentication state, and any connection errors. &lt;/p&gt;&lt;p&gt;During the chat interactions, the debug interface will show the raw message exchanged between the playground and the MCP server, including the tool invocation and its result. This allows you to monitor the JSON payload being sent to the MCP server, the raw response returned, and track whether the tool call succeeded or failed. This is especially helpful for anyone building remote MCP servers, as it allows you to see how your tools are behaving when integrated with different language models. &lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;contributing-to-the-mcp-ecosystem\&quot;&gt;Contributing to the MCP ecosystem&lt;/h2&gt;\n            &lt;a href=\&quot;#contributing-to-the-mcp-ecosystem\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;One of the reasons why MCP has evolved so quickly is that it&amp;#39;s an open source project, powered by the community. We&amp;#39;re excited to contribute the &lt;code&gt;use-mcp&lt;/code&gt; library to the &lt;a href=\&quot;https://github.com/modelcontextprotocol\&quot;&gt;&lt;u&gt;MCP ecosystem&lt;/u&gt;&lt;/a&gt; to enable more developers to build remote MCP clients. &lt;/p&gt;&lt;p&gt;If you&amp;#39;re looking for examples of MCP clients or MCP servers to get started with, check out the&lt;a href=\&quot;https://github.com/cloudflare/ai\&quot;&gt; &lt;u&gt;Cloudflare AI GitHub repository&lt;/u&gt;&lt;/a&gt; for working examples you can deploy and modify. This includes the complete AI Playground &lt;a href=\&quot;https://github.com/cloudflare/ai/tree/main/playground/ai\&quot;&gt;&lt;u&gt;source code,&lt;/u&gt;&lt;/a&gt; a number of remote MCP servers that use different authentication &amp;amp; authorization providers, and the &lt;a href=\&quot;https://github.com/cloudflare/ai/tree/main/demos/use-mcp-inspector\&quot;&gt;&lt;u&gt;MCP Inspector&lt;/u&gt;&lt;/a&gt;. &lt;/p&gt;&lt;p&gt;We’re also building the &lt;a href=\&quot;https://github.com/cloudflare/mcp-server-cloudflare\&quot;&gt;&lt;u&gt;Cloudflare MCP servers&lt;/u&gt;&lt;/a&gt; in public and welcome contributions to help make them better. &lt;/p&gt;&lt;p&gt;Whether you&amp;#39;re building your first MCP server, integrating MCP into an existing application, or contributing to the broader ecosystem, we&amp;#39;d love to hear from you. If you have any questions, feedback, or ideas for collaboration, you can reach us via email at &lt;a href=\&quot;mailto:1800-mcp@cloudflare.com\&quot;&gt;&lt;u&gt;1800-mcp@cloudflare.com&lt;/u&gt;&lt;/a&gt;. &lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/7sYYS9c45orRX6SaUw5qTx/b975c5221ab538cc8f1167b706da375f/image3.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1200\&quot; height=\&quot;267\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;&lt;/p&gt;&quot;],&quot;published_at&quot;:[0,&quot;2025-06-18T14:00+01:00&quot;],&quot;updated_at&quot;:[0,&quot;2025-06-19T15:45:45.217Z&quot;],&quot;feature_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/LtVhVVAsSFzhekIF0nnt6/13c8e0249a24cf40bde2f6ae2d46d938/Open_sourcing_new_MCP_client_tooling.png&quot;],&quot;tags&quot;:[1,[[0,{&quot;id&quot;:[0,&quot;6Foe3R8of95cWVnQwe5Toi&quot;],&quot;name&quot;:[0,&quot;AI&quot;],&quot;slug&quot;:[0,&quot;ai&quot;]}],[0,{&quot;id&quot;:[0,&quot;22RkiaggH3NV4u6qyMmC42&quot;],&quot;name&quot;:[0,&quot;Agents&quot;],&quot;slug&quot;:[0,&quot;agents&quot;]}],[0,{&quot;id&quot;:[0,&quot;6Lfy7VaNvl5G8gOYMKFiux&quot;],&quot;name&quot;:[0,&quot;MCP&quot;],&quot;slug&quot;:[0,&quot;mcp&quot;]}],[0,{&quot;id&quot;:[0,&quot;6hbkItfupogJP3aRDAq6v8&quot;],&quot;name&quot;:[0,&quot;Cloudflare Workers&quot;],&quot;slug&quot;:[0,&quot;workers&quot;]}],[0,{&quot;id&quot;:[0,&quot;4HIPcb68qM0e26fIxyfzwQ&quot;],&quot;name&quot;:[0,&quot;Developers&quot;],&quot;slug&quot;:[0,&quot;developers&quot;]}]]],&quot;relatedTags&quot;:[0],&quot;authors&quot;:[1,[[0,{&quot;name&quot;:[0,&quot;Dina Kozlov&quot;],&quot;slug&quot;:[0,&quot;dina&quot;],&quot;bio&quot;:[0,null],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/bY78cK0burCjZbD6jOgAH/a8479b5ea6dd8fb3acb41227c1a4ad0e/dina.jpg&quot;],&quot;location&quot;:[0,null],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,&quot;@dinasaur_404&quot;],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}],[0,{&quot;name&quot;:[0,&quot;Glen Maddern&quot;],&quot;slug&quot;:[0,&quot;glen&quot;],&quot;bio&quot;:[0,null],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/7dtWmquDOA3nc27l0f7RwQ/43791027b587018e9003bf83e28b77df/glen.jpg&quot;],&quot;location&quot;:[0,null],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,&quot;@glenmaddern&quot;],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}],[0,{&quot;name&quot;:[0,&quot;Sunil Pai&quot;],&quot;slug&quot;:[0,&quot;sunil&quot;],&quot;bio&quot;:[0,&quot;JavaScript and Les Pauls.  Worked at Cloudflare once, left and created PartyKit, came back wiser.&quot;],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/2xnINigwFaBtTwOffppE85/596c43dfef6205e9c5b71c2caff4bea9/Sunil_Pai.png&quot;],&quot;location&quot;:[0,&quot;London&quot;],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,&quot;@threepointone&quot;],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}]]],&quot;meta_description&quot;:[0,&quot;We&#39;re open-sourcing use-mcp, a React library that connects to any MCP server in just 3 lines of code, as well as our AI Playground, a complete chat interface that can connect to remote MCP servers. &quot;],&quot;primary_author&quot;:[0,{}],&quot;localeList&quot;:[0,{&quot;name&quot;:[0,&quot;blog-english-only&quot;],&quot;enUS&quot;:[0,&quot;English for Locale&quot;],&quot;zhCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhHansCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhTW&quot;:[0,&quot;No Page for Locale&quot;],&quot;frFR&quot;:[0,&quot;No Page for Locale&quot;],&quot;deDE&quot;:[0,&quot;No Page for Locale&quot;],&quot;itIT&quot;:[0,&quot;No Page for Locale&quot;],&quot;jaJP&quot;:[0,&quot;No Page for Locale&quot;],&quot;koKR&quot;:[0,&quot;No Page for Locale&quot;],&quot;ptBR&quot;:[0,&quot;No Page for Locale&quot;],&quot;esLA&quot;:[0,&quot;No Page for Locale&quot;],&quot;esES&quot;:[0,&quot;No Page for Locale&quot;],&quot;enAU&quot;:[0,&quot;No Page for Locale&quot;],&quot;enCA&quot;:[0,&quot;No Page for Locale&quot;],&quot;enIN&quot;:[0,&quot;No Page for Locale&quot;],&quot;enGB&quot;:[0,&quot;No Page for Locale&quot;],&quot;idID&quot;:[0,&quot;No Page for Locale&quot;],&quot;ruRU&quot;:[0,&quot;No Page for Locale&quot;],&quot;svSE&quot;:[0,&quot;No Page for Locale&quot;],&quot;viVN&quot;:[0,&quot;No Page for Locale&quot;],&quot;plPL&quot;:[0,&quot;No Page for Locale&quot;],&quot;arAR&quot;:[0,&quot;No Page for Locale&quot;],&quot;nlNL&quot;:[0,&quot;No Page for Locale&quot;],&quot;thTH&quot;:[0,&quot;No Page for Locale&quot;],&quot;trTR&quot;:[0,&quot;No Page for Locale&quot;],&quot;heIL&quot;:[0,&quot;No Page for Locale&quot;],&quot;lvLV&quot;:[0,&quot;No Page for Locale&quot;],&quot;etEE&quot;:[0,&quot;No Page for Locale&quot;],&quot;ltLT&quot;:[0,&quot;No Page for Locale&quot;]}],&quot;url&quot;:[0,&quot;https://blog.cloudflare.com/connect-any-react-application-to-an-mcp-server-in-three-lines-of-code&quot;],&quot;metadata&quot;:[0,{&quot;title&quot;:[0,&quot;Connect any React application to an MCP server in three lines of code&quot;],&quot;description&quot;:[0,&quot;We&#39;re open-sourcing use-mcp, a React library that connects to any MCP server in just 3 lines of code, as well as our AI Playground, a complete chat interface that can connect to remote MCP servers. &quot;],&quot;imgPreview&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/3SYJOvNUqnrtTSKCkjxaxn/57151661ce2b97eb30ad11d93ea822ac/OG_Share_2024__58_.png&quot;]}],&quot;publicly_index&quot;:[0,true]}],[0,{&quot;id&quot;:[0,&quot;3YwK1RRHXn4kGrNazu4AKd&quot;],&quot;title&quot;:[0,&quot;Building an AI Agent that puts humans in the loop with Knock and Cloudflare’s Agents SDK&quot;],&quot;slug&quot;:[0,&quot;building-agents-at-knock-agents-sdk&quot;],&quot;excerpt&quot;:[0,&quot;How Knock shipped an AI Agent with human-in-the-loop capabilities with Cloudflare’s Agents SDK and Cloudflare Workers.&quot;],&quot;featured&quot;:[0,false],&quot;html&quot;:[0,&quot;&lt;p&gt;&lt;sub&gt;&lt;i&gt;This is a guest post by Chris Bell, CTO of &lt;/i&gt;&lt;/sub&gt;&lt;a href=\&quot;https://knock.app/\&quot;&gt;&lt;sub&gt;&lt;i&gt;&lt;u&gt;Knock&lt;/u&gt;&lt;/i&gt;&lt;/sub&gt;&lt;/a&gt;&lt;/p&gt;&lt;p&gt;There’s a lot of talk right now about building AI agents, but not a lot out there about what it takes to make those agents truly &lt;i&gt;useful&lt;/i&gt;.&lt;/p&gt;&lt;p&gt;An Agent is an autonomous system designed to make decisions and perform actions to achieve a specific goal or set of goals, without human input.&lt;/p&gt;&lt;p&gt;No matter how good your agent is at making decisions, you will need a person to provide guidance or input on the agent’s path towards its goal. After all, an agent that cannot interact or respond to the outside world and the systems that govern it will be limited in the problems it can solve.&lt;/p&gt;&lt;p&gt;That’s where the “human-in-the-loop” interaction pattern comes in. You&amp;#39;re bringing a human &lt;i&gt;into&lt;/i&gt; the agent&amp;#39;s loop and requiring an input from that human before the agent can continue on its task.&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/6dhEhrOtwdaWOjJqhrzmMw/cc8576e7ccce43e2df1bacfd91b125ff/image3.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;625\&quot; height=\&quot;565\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;In this blog post, we&amp;#39;ll use&lt;a href=\&quot;https://knock.app/\&quot;&gt; &lt;u&gt;Knock&lt;/u&gt;&lt;/a&gt; and the Cloudflare&lt;a href=\&quot;https://developers.cloudflare.com/agents/\&quot;&gt; &lt;u&gt;Agents SDK&lt;/u&gt;&lt;/a&gt; to build an AI Agent for a virtual card issuing workflow that requires human approval when a new card is requested.&lt;/p&gt;&lt;p&gt;You can find the complete code for this example&lt;a href=\&quot;https://github.com/knocklabs/ai-agent-examples/tree/main/card-issue-agent\&quot;&gt; &lt;u&gt;in the repository&lt;/u&gt;&lt;/a&gt;.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;what-is-knock\&quot;&gt;What is Knock?&lt;/h2&gt;\n            &lt;a href=\&quot;#what-is-knock\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;&lt;a href=\&quot;https://knock.app/\&quot;&gt;&lt;u&gt;Knock&lt;/u&gt;&lt;/a&gt; is messaging infrastructure you can use to send multi-channel messages across in-app, email, SMS, push, and Slack, without writing any integration code.&lt;/p&gt;&lt;p&gt;With Knock, you gain complete visibility into the messages being sent to your users while also handling reliable delivery, user notification preferences, and more.&lt;/p&gt;&lt;p&gt;You can use Knock to power human-in-the-loop flows for your agents using Knock’s&lt;a href=\&quot;https://docs.knock.app/developer-tools/agent-toolkit/overview\&quot;&gt; &lt;u&gt;Agent Toolkit&lt;/u&gt;&lt;/a&gt;, which is a set of tools that expose Knock’s APIs and messaging capabilities to your AI agents.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;using-the-agent-sdk-as-the-foundation-of-our-ai-agent\&quot;&gt;Using the Agent SDK as the foundation of our AI Agent&lt;/h2&gt;\n            &lt;a href=\&quot;#using-the-agent-sdk-as-the-foundation-of-our-ai-agent\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;The Agents SDK provides an abstraction for building stateful, real-time agents on top of &lt;a href=\&quot;https://developers.cloudflare.com/durable-objects/\&quot;&gt;&lt;u&gt;Durable Objects&lt;/u&gt;&lt;/a&gt; that are globally addressable and persist state using an embedded, &lt;a href=\&quot;https://blog.cloudflare.com/sqlite-in-durable-objects/\&quot;&gt;&lt;u&gt;zero-latency&lt;/u&gt;&lt;/a&gt; SQLite database.&lt;/p&gt;&lt;p&gt;Building an AI agent outside of using the Agents SDK and the Cloudflare platform means we need to consider WebSocket servers, state persistence, and how to scale our service horizontally. Because a Durable Object backs the Agents SDK, we receive these benefits for free, while having a globally addressable piece of compute with built-in storage, that’s completely serverless and scales to zero.&lt;/p&gt;&lt;p&gt;In the example, we’ll use these features to build an agent that users interact with in real-time via chat, and that can be paused and resumed as needed. The Agents SDK is the ideal platform for powering asynchronous agentic workflows, such as those required in human-in-the-loop interactions.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;setting-up-our-knock-messaging-workflow\&quot;&gt;Setting up our Knock messaging workflow&lt;/h2&gt;\n            &lt;a href=\&quot;#setting-up-our-knock-messaging-workflow\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;Within Knock, we design our approval workflow using the visual workflow builder to create the cross-channel messaging logic. We then make the notification templates associated with each channel to which we want to send messages.&lt;/p&gt;&lt;p&gt;Knock will automatically apply the&lt;a href=\&quot;https://docs.knock.app/concepts/preferences\&quot;&gt; &lt;u&gt;user’s preferences&lt;/u&gt;&lt;/a&gt; as part of the workflow execution, ensuring that your user’s notification settings are respected.&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/5f1hOpKg3xTxZwYuJYmUAl/83088b52e8cb26aaed561d00733fd2e1/image1.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1999\&quot; height=\&quot;1299\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;You can find an example workflow that we’ve already created for this demo in the repository. You can use this workflow template via the&lt;a href=\&quot;https://docs.knock.app/cli\&quot;&gt; &lt;u&gt;Knock CLI&lt;/u&gt;&lt;/a&gt; to import it into your account.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;building-our-chat-ui\&quot;&gt;Building our chat UI&lt;/h2&gt;\n            &lt;a href=\&quot;#building-our-chat-ui\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;We’ve built the AI Agent as a chat interface on top of the &lt;code&gt;AIChatAgent&lt;/code&gt; abstraction from Cloudflare’s Agents SDK (&lt;a href=\&quot;https://developers.cloudflare.com/agents/api-reference/agents-api/#chat-agent\&quot;&gt;&lt;u&gt;docs&lt;/u&gt;&lt;/a&gt;). The Agents SDK here takes care of the bulk of the complexity, and we’re left to implement our LLM calling code with our system prompt.&lt;/p&gt;\n            &lt;pre class=\&quot;language-TypeScript\&quot;&gt;&lt;code class=\&quot;language-TypeScript\&quot;&gt;// src/index.ts\n\nimport { AIChatAgent } from &amp;quot;agents/ai-chat-agent&amp;quot;;\nimport { openai } from &amp;quot;@ai-sdk/openai&amp;quot;;\nimport { createDataStreamResponse, streamText } from &amp;quot;ai&amp;quot;;\n\nexport class AIAgent extends AIChatAgent {\n  async onChatMessage(onFinish) {\n    return createDataStreamResponse({\n      execute: async (dataStream) =&amp;gt; {\n        try {\n          const stream = streamText({\n            model: openai(&amp;quot;gpt-4o-mini&amp;quot;),\n            system: `You are a helpful assistant for a financial services company. You help customers with credit card issuing.`,\n            messages: this.messages,\n            onFinish,\n            maxSteps: 5,\n          });\n\n          stream.mergeIntoDataStream(dataStream);\n        } catch (error) {\n          console.error(error);\n        }\n      },\n    });\n  }\n}&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;On the client side, we’re using the &lt;code&gt;useAgentChat&lt;/code&gt; hook from the &lt;code&gt;agents/ai-react&lt;/code&gt; package to power the real-time user-to-agent chat.&lt;/p&gt;&lt;p&gt;We’ve modeled our agent as a chat per user, which we set up using the &lt;code&gt;useAgent&lt;/code&gt; hook by specifying the name of the process as the &lt;code&gt;userId&lt;/code&gt;.&lt;/p&gt;\n            &lt;pre class=\&quot;language-TypeScript\&quot;&gt;&lt;code class=\&quot;language-TypeScript\&quot;&gt;// src/index.ts\n\nimport { useAgent } from &amp;quot;agents/react&amp;quot;;\nimport { useAgentChat } from &amp;quot;agents/ai-react&amp;quot;;\n\nfunction Chat({ userId }: { userId: string }) {\n  const agent = useAgent({ agent: &amp;quot;AIAgent&amp;quot;, name: userId });\n  const { messages, input, handleInputChange, handleSubmit, isLoading } = useAgentChat({ agent });\n  // ... \n}&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;This means we have an agent process, and therefore a durable object, per-user. For our human-in-the-loop use case, this becomes important later on as we talk about resuming our deferred tool call.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;deferring-the-tool-call-to-knock\&quot;&gt;Deferring the tool call to Knock&lt;/h2&gt;\n            &lt;a href=\&quot;#deferring-the-tool-call-to-knock\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;We give the agent our card issuing capability through exposing an &lt;code&gt;issueCard&lt;/code&gt; tool. However, instead of writing the approval flow and cross-channel logic ourselves, we delegate it entirely to Knock by wrapping the issue card tool in our &lt;code&gt;requireHumanInput&lt;/code&gt; method.&lt;/p&gt;&lt;p&gt;Now when the user asks to request a new card, we make a call out to Knock to initiate our card request, which will notify the appropriate admins in the organization to request an approval.&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/3siyPnpYiEmoNIQ7eNCRP/13bd33905cfb5c7ad6812a4359d35627/image2.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1999\&quot; height=\&quot;664\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;To set this up, we need to use Knock’s Agent Toolkit, which exposes methods to work with Knock in our AI agent and power cross-channel messaging.&lt;/p&gt;\n            &lt;pre class=\&quot;language-TypeScript\&quot;&gt;&lt;code class=\&quot;language-TypeScript\&quot;&gt;import { createKnockToolkit } from &amp;quot;@knocklabs/agent-toolkit/ai-sdk&amp;quot;;\nimport { tool } from &amp;quot;ai&amp;quot;;\nimport { z } from &amp;quot;zod&amp;quot;;\n\nimport { AIAgent } from &amp;quot;./index&amp;quot;;\nimport { issueCard } from &amp;quot;./api&amp;quot;;\nimport { BASE_URL } from &amp;quot;./constants&amp;quot;;\n\nasync function initializeToolkit(agent: AIAgent) {\n  const toolkit = await createKnockToolkit({ serviceToken: agent.env.KNOCK_SERVICE_TOKEN });\n\n  const issueCardTool = tool({\n    description: &amp;quot;Issue a new credit card to a customer.&amp;quot;,\n    parameters: z.object({\n      customerId: z.string(),\n    }),\n    execute: async ({ customerId }) =&amp;gt; {\n      return await issueCard(customerId);\n    },\n  });\n\n  const { issueCard } = toolkit.requireHumanInput(\n    { issueCard: issueCardTool },\n    {\n      workflow: &amp;quot;approve-issued-card&amp;quot;,\n      actor: agent.name,\n      recipients: [&amp;quot;admin_user_1&amp;quot;],\n      metadata: {\n        approve_url: `${BASE_URL}/card-issued/approve`,\n        reject_url: `${BASE_URL}/card-issued/reject`,\n      },\n    }\n  );\n  \n  return { toolkit, tools: { issueCard } };  \n}&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;There’s a lot going on here, so let’s walk through the key parts:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;We wrap our &lt;code&gt;issueCard&lt;/code&gt; tool in the &lt;code&gt;requireHumanInput&lt;/code&gt; method, exposed from the Knock Agent Toolkit&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;We want the messaging workflow to be invoked to be our &lt;code&gt;approve-issued-card&lt;/code&gt; workflow&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;We pass the agent.name as the &lt;code&gt;actor&lt;/code&gt; of the request, which translates to the user ID&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;We set the recipient of this workflow to be the user &lt;code&gt;admin_user_1&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;We pass the approve and reject URLs so that they can be used in our message templates&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;The wrapped tool is then returned as &lt;code&gt;issueCard&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;Under the hood, these options are passed to the&lt;a href=\&quot;https://docs.knock.app/api-reference/workflows/trigger\&quot;&gt; &lt;u&gt;Knock workflow trigger API&lt;/u&gt;&lt;/a&gt; to invoke a workflow per-recipient. The set of the recipients listed here could be dynamic, or go to a group of users through&lt;a href=\&quot;https://docs.knock.app/concepts/subscriptions\&quot;&gt; &lt;u&gt;Knock’s subscriptions API&lt;/u&gt;&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;We can then pass the wrapped issue card tool to our LLM call in the &lt;code&gt;onChatMessage&lt;/code&gt; method on the agent so that the tool call can be called as part of the interaction with the agent.&lt;/p&gt;\n            &lt;pre class=\&quot;language-TypeScript\&quot;&gt;&lt;code class=\&quot;language-TypeScript\&quot;&gt;export class AIAgent extends AIChatAgent {\n  // ... other methods\n\n  async onChatMessage(onFinish) {\n    const { tools } = await initializeToolkit(this);\n\n    return createDataStreamResponse({\n      execute: async (dataStream) =&amp;gt; {\n        const stream = streamText({\n          model: openai(&amp;quot;gpt-4o-mini&amp;quot;),\n          system: &amp;quot;You are a helpful assistant for a financial services company. You help customers with credit card issuing.&amp;quot;,\n          messages: this.messages,\n          onFinish,\n          tools,\n          maxSteps: 5,\n        });\n\n        stream.mergeIntoDataStream(dataStream);\n      },\n    });\n  }\n}&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;Now when the agent calls the &lt;code&gt;issueCardTool&lt;/code&gt;, we invoke Knock to send our approval notifications, deferring the tool call to issue the card until we receive an approval. Knock’s workflows take care of sending out the message to the set of recipient’s specified, generating and delivering messages according to each user’s preferences.&lt;/p&gt;&lt;p&gt;Using Knock&lt;a href=\&quot;https://docs.knock.app/concepts/workflows\&quot;&gt; &lt;u&gt;workflows&lt;/u&gt;&lt;/a&gt; for our approval message makes it easy to build cross-channel messaging to reach the user according to their communication&lt;a href=\&quot;https://docs.knock.app/concepts/preferences\&quot;&gt; &lt;u&gt;preferences&lt;/u&gt;&lt;/a&gt;. We can also leverage&lt;a href=\&quot;https://docs.knock.app/designing-workflows/delay-function\&quot;&gt; &lt;u&gt;delays&lt;/u&gt;&lt;/a&gt;,&lt;a href=\&quot;https://docs.knock.app/designing-workflows/throttle-function\&quot;&gt; &lt;u&gt;throttles&lt;/u&gt;&lt;/a&gt;,&lt;a href=\&quot;https://docs.knock.app/designing-workflows/batch-function\&quot;&gt; &lt;u&gt;batching&lt;/u&gt;&lt;/a&gt;, and&lt;a href=\&quot;https://docs.knock.app/designing-workflows/step-conditions\&quot;&gt; &lt;u&gt;conditions&lt;/u&gt;&lt;/a&gt; to orchestrate more complex messaging.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;handling-the-approval\&quot;&gt;Handling the approval&lt;/h2&gt;\n            &lt;a href=\&quot;#handling-the-approval\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;Once the message has been sent to our approvers, the next step is to handle the approval coming back, bringing the human into the agent’s loop.&lt;/p&gt;&lt;p&gt;The approval request is asynchronous, meaning that the response can come at any point in the future. Fortunately, Knock takes care of the heavy lifting here for you, routing the event to the agent worker via a&lt;a href=\&quot;https://docs.knock.app/developer-tools/outbound-webhooks/overview\&quot;&gt; &lt;u&gt;webhook&lt;/u&gt;&lt;/a&gt; that tracks the interaction with the underlying message. In our case, that’s a click to the &amp;quot;approve&amp;quot; or &amp;quot;reject&amp;quot; button.&lt;/p&gt;&lt;p&gt;First, we set up a &lt;code&gt;message.interacted&lt;/code&gt; webhook handler within the Knock dashboard to forward the interactions to our worker, and ultimately to our agent process.&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/5CZkwJmmOw09FNmhRUqFrC/7e7d195276331b42778518b821f7707f/image4.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1999\&quot; height=\&quot;1299\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;In our example here, we route the approval click back to the worker to handle, appending a Knock message ID to the end of the &lt;code&gt;approve_url&lt;/code&gt; and &lt;code&gt;reject_url&lt;/code&gt; to track engagement against the specific message sent. We do this via liquid inside of our message templates in Knock: &lt;code&gt;{{ data.approve_url }}?messageId={{ current_message.id }} &lt;/code&gt;. One caveat here is that if this were a production application, we’re likely going to handle our approval click in a different application than this agent is running. We co-located it here for the purposes of this demo only.&lt;/p&gt;&lt;p&gt;Once the link is clicked, we have a handler in our worker to mark the message as interacted using Knock’s&lt;a href=\&quot;https://docs.knock.app/api-reference/messages/mark_as_interacted\&quot;&gt; &lt;u&gt;message interaction API&lt;/u&gt;&lt;/a&gt;, passing through the status as metadata so that it can be used later.&lt;/p&gt;\n            &lt;pre class=\&quot;language-TypeScript\&quot;&gt;&lt;code class=\&quot;language-TypeScript\&quot;&gt;import Knock from &amp;#039;@knocklabs/node&amp;#039;;\nimport { Hono } from &amp;quot;hono&amp;quot;;\n\nconst app = new Hono();\nconst client = new Knock();\n\napp.get(&amp;quot;/card-issued/approve&amp;quot;, async (c) =&amp;gt; {\n  const { messageId } = c.req.query();\n  \n  if (!messageId) return c.text(&amp;quot;No message ID found&amp;quot;, { status: 400 });\n\n  await client.messages.markAsInteracted(messageId, {\n    status: &amp;quot;approved&amp;quot;,\n  });\n\n  return c.text(&amp;quot;Approved&amp;quot;);\n});&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;The message interaction will flow from Knock to our worker via the webhook we set up, ensuring that the process is fully asynchronous. The payload of the webhook includes the full message, including metadata about the user that generated the original request, and keeps details about the request itself, which in our case contains the tool call.&lt;/p&gt;\n            &lt;pre class=\&quot;language-TypeScript\&quot;&gt;&lt;code class=\&quot;language-TypeScript\&quot;&gt;import { getAgentByName, routeAgentRequest } from &amp;quot;agents&amp;quot;;\nimport { Hono } from &amp;quot;hono&amp;quot;;\n\nconst app = new Hono();\n\napp.post(&amp;quot;/incoming/knock/webhook&amp;quot;, async (c) =&amp;gt; {\n  const body = await c.req.json();\n  const env = c.env as Env;\n\n  // Find the user ID from the tool call for the calling user\n  const userId = body?.data?.actors[0];\n\n  if (!userId) {\n    return c.text(&amp;quot;No user ID found&amp;quot;, { status: 400 });\n  }\n\n  // Find the agent DO for the user\n  const existingAgent = await getAgentByName(env.AIAgent, userId);\n\n  if (existingAgent) {\n    // Route the request to the agent DO to process\n    const result = await existingAgent.handleIncomingWebhook(body);\n\n    return c.json(result);\n  } else {\n    return c.text(&amp;quot;Not found&amp;quot;, { status: 404 });\n  }\n});&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;We leverage the agent’s ability to be addressed by a named identifier to route the request from the worker to the agent. In our case, that’s the &lt;code&gt;userId&lt;/code&gt;. Because the agent is backed by a durable object, this process of going from incoming worker request to finding and resuming the agent is trivial.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;resuming-the-deferred-tool-call\&quot;&gt;Resuming the deferred tool call&lt;/h2&gt;\n            &lt;a href=\&quot;#resuming-the-deferred-tool-call\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;We then use the context about the original tool call, passed through to Knock and round tripped back to the agent, to resume the tool execution and issue the card.&lt;/p&gt;\n            &lt;pre class=\&quot;language-TypeScript\&quot;&gt;&lt;code class=\&quot;language-TypeScript\&quot;&gt;export class AIAgent extends AIChatAgent {\n  // ... other methods\n\n  async handleIncomingWebhook(body: any) {\n    const { toolkit } = await initializeToolkit(this);\n\n    const deferredToolCall = toolkit.handleMessageInteraction(body);\n\n    if (!deferredToolCall) {\n      return { error: &amp;quot;No deferred tool call given&amp;quot; };\n    }\n\n    // If we received an &amp;quot;approved&amp;quot; status then we know the call was approved \n    // so we can resume the deferred tool call execution\n    if (result.interaction.status === &amp;quot;approved&amp;quot;) {\n      const toolCallResult = \n\t      await toolkit.resumeToolExecution(result.toolCall);\n\n      const { response } = await generateText({\n        model: openai(&amp;quot;gpt-4o-mini&amp;quot;),\n        prompt: `You were asked to issue a card for a customer. The card is now approved. The result was: ${JSON.stringify(toolCallResult)}.`,\n      });\n\n      const message = responseToAssistantMessage(\n        response.messages[0],\n        result.toolCall,\n        toolCallResult\n      );\n\n      // Save the message so that it&amp;#039;s displayed to the user\n      this.persistMessages([...this.messages, message]);\n    }\n\n    return { status: &amp;quot;success&amp;quot; };\n  }\n}&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;Again, there’s a lot going on here, so let’s step through the important parts:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;We attempt to transform the body, which is the webhook payload from Knock, into a deferred tool call via the &lt;code&gt;handleMessageInteraction&lt;/code&gt; method&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;If the metadata status we passed through to the interaction call earlier has an “approved” status then we resume the tool call via the &lt;code&gt;resumeToolExecution&lt;/code&gt; method&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Finally, we generate a message from the LLM and persist it, ensuring that the user is informed of the approved card&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;With this last piece in place, we can now request a new card be issued, have an approval request be dispatched from the agent, send the approval messages, and route those approvals back to our agent to be processed. The agent will asynchronously process our card issue request and the deferred tool call will be resumed for us, with very little code.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;protecting-against-duplicate-approvals\&quot;&gt;Protecting against duplicate approvals&lt;/h2&gt;\n            &lt;a href=\&quot;#protecting-against-duplicate-approvals\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;One issue with the above implementation is that we’re prone to issuing multiple cards if someone clicks on the approve button more than once. To rectify this, we want to keep track of the tool calls being issued, and ensure that the call is processed at most once.&lt;/p&gt;&lt;p&gt;To power this we leverage the&lt;a href=\&quot;https://developers.cloudflare.com/agents/api-reference/store-and-sync-state/\&quot;&gt; &lt;u&gt;agent’s built-in state&lt;/u&gt;&lt;/a&gt;, which can be used to persist information without reaching for another persistence store like a database or Redis, although we could absolutely do so if we wished. We can track the tool calls by their ID and capture their current status, right inside the agent process.&lt;/p&gt;\n            &lt;pre class=\&quot;language-TypeScript\&quot;&gt;&lt;code class=\&quot;language-TypeScript\&quot;&gt;type ToolCallStatus = &amp;quot;requested&amp;quot; | &amp;quot;approved&amp;quot; | &amp;quot;rejected&amp;quot;;\n\nexport interface AgentState {\n  toolCalls: Record&amp;lt;string, ToolCallStatus&amp;gt;;\n}\n\nclass AIAgent extends AIChatAgent&amp;lt;Env, AgentState&amp;gt; {\n  initialState: AgentState = {\n    toolCalls: {},\n  };\n  \n  setToolCallStatus(toolCallId: string, status: ToolCallStatus) {\n    this.setState({\n      ...this.state,\n      toolCalls: { ...this.state.toolCalls, [toolCallId]: status },\n    });\n  } \n  // ... \n}&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;Here, we create the initial state for the tool calls as an empty object. We also add a quick setter helper method to make interactions easier.&lt;/p&gt;&lt;p&gt;Next up, we need to record the tool call being made. To do so, we can use the &lt;code&gt;onAfterCallKnock&lt;/code&gt; option in the &lt;code&gt;requireHumanInput&lt;/code&gt; helper to capture that the tool call has been requested for the user.&lt;/p&gt;\n            &lt;pre class=\&quot;language-TypeScript\&quot;&gt;&lt;code class=\&quot;language-TypeScript\&quot;&gt;const { issueCard }  = toolkit.requireHumanInput(\n  { issueCard: issueCardTool },\n  {\n    // Keep track of the tool call state once it&amp;#039;s been sent to Knock\n    onAfterCallKnock: async (toolCall) =&amp;gt; \n      agent.setToolCallStatus(toolCall.id, &amp;quot;requested&amp;quot;),\n    // ... as before\n  }\n);&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;Finally, we then need to check the state when we’re processing the incoming webhook, and mark the tool call as approved (some code omitted for brevity).&lt;/p&gt;\n            &lt;pre class=\&quot;language-TypeScript\&quot;&gt;&lt;code class=\&quot;language-TypeScript\&quot;&gt;export class AIAgent extends AIChatAgent {\n  async handleIncomingWebhook(body: any) {\n    const { toolkit } = await initializeToolkit(this);\n    const deferredToolCall = toolkit.handleMessageInteraction(body);\n    const toolCallId = result.toolCall.id;\n\n    // Make sure this is a tool call that can be processed\n    if (this.state.toolCalls[toolCallId] !== &amp;quot;requested&amp;quot;) {\n      return { error: &amp;quot;Tool call is not requested&amp;quot; };\n    }\n\n    if (result.interaction.status === &amp;quot;approved&amp;quot;) {\n      const toolCallResult = await toolkit.resumeToolExecution(result.toolCall);\n      this.setToolCallStatus(toolCallId, &amp;quot;approved&amp;quot;);\n      // ... rest as before\n    }\n  }\n}&lt;/pre&gt;&lt;/code&gt;\n            \n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;conclusion\&quot;&gt;Conclusion&lt;/h2&gt;\n            &lt;a href=\&quot;#conclusion\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;Using the Agents SDK and Knock, it’s easy to build advanced human-in-the-loop experiences that defer tool calls.&lt;/p&gt;&lt;p&gt;Knock’s workflow builder and notification engine gives you building blocks to create sophisticated cross-channel messaging for your agents. You can easily create escalation flows that send messages through SMS, push, email, or Slack that respect the notification preferences of your users. Knock also gives you complete visibility into the messages your users are receiving.&lt;/p&gt;&lt;p&gt;The Durable Object abstraction underneath the Agents SDK means that we get a globally addressable agent process that’s easy to yield and resume back to. The persistent storage in the Durable Object means we can retain the complete chat history per-user, and any other state that’s required in the agent process to resume the agent with (like our tool calls). Finally, the serverless nature of the underlying Durable Object means we’re able to horizontally scale to support a large number of users with no effort.&lt;/p&gt;&lt;p&gt;If you’re looking to build your own AI Agent chat experience with a multiplayer human-in-the-loop experience, you’ll find the complete code from this guide&lt;a href=\&quot;https://github.com/knocklabs/ai-agent-examples/tree/main/card-issue-agent\&quot;&gt; &lt;u&gt;available in GitHub&lt;/u&gt;&lt;/a&gt;.&lt;/p&gt;&quot;],&quot;published_at&quot;:[0,&quot;2025-06-03T14:00+01:00&quot;],&quot;updated_at&quot;:[0,&quot;2025-06-11T14:09:01.698Z&quot;],&quot;feature_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/4QDMGATQYFYtzw9CfEpZeA/b850ebb2dd2b22fd415807c4a7a09cf2/hero-knock-cloudflare-agents.png&quot;],&quot;tags&quot;:[1,[[0,{&quot;id&quot;:[0,&quot;6Foe3R8of95cWVnQwe5Toi&quot;],&quot;name&quot;:[0,&quot;AI&quot;],&quot;slug&quot;:[0,&quot;ai&quot;]}],[0,{&quot;id&quot;:[0,&quot;22RkiaggH3NV4u6qyMmC42&quot;],&quot;name&quot;:[0,&quot;Agents&quot;],&quot;slug&quot;:[0,&quot;agents&quot;]}],[0,{&quot;id&quot;:[0,&quot;6hbkItfupogJP3aRDAq6v8&quot;],&quot;name&quot;:[0,&quot;Cloudflare Workers&quot;],&quot;slug&quot;:[0,&quot;workers&quot;]}],[0,{&quot;id&quot;:[0,&quot;5v2UZdTRX1Rw9akmhexnxs&quot;],&quot;name&quot;:[0,&quot;Durable Objects&quot;],&quot;slug&quot;:[0,&quot;durable-objects&quot;]}],[0,{&quot;id&quot;:[0,&quot;3JAY3z7p7An94s6ScuSQPf&quot;],&quot;name&quot;:[0,&quot;Developer Platform&quot;],&quot;slug&quot;:[0,&quot;developer-platform&quot;]}],[0,{&quot;id&quot;:[0,&quot;4HIPcb68qM0e26fIxyfzwQ&quot;],&quot;name&quot;:[0,&quot;Developers&quot;],&quot;slug&quot;:[0,&quot;developers&quot;]}]]],&quot;relatedTags&quot;:[0],&quot;authors&quot;:[1,[[0,{&quot;name&quot;:[0,&quot;Chris Bell (Guest author)&quot;],&quot;slug&quot;:[0,&quot;Chris Bell (Guest author)&quot;],&quot;bio&quot;:[0],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1oACtpoGbOmqrsRXMO0Mgu/913b30bfa207cac04efee1e17df60d6e/Chris_Bell.png&quot;],&quot;location&quot;:[0],&quot;website&quot;:[0],&quot;twitter&quot;:[0,&quot;cjbell_&quot;],&quot;facebook&quot;:[0],&quot;publiclyIndex&quot;:[0,true]}]]],&quot;meta_description&quot;:[0,&quot;How Knock shipped an AI Agent with human-in-the-loop capabilities with Cloudflare’s Agents SDK and Cloudflare Workers.&quot;],&quot;primary_author&quot;:[0,{}],&quot;localeList&quot;:[0,{&quot;name&quot;:[0,&quot;blog-english-only&quot;],&quot;enUS&quot;:[0,&quot;English for Locale&quot;],&quot;zhCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhHansCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhTW&quot;:[0,&quot;No Page for Locale&quot;],&quot;frFR&quot;:[0,&quot;No Page for Locale&quot;],&quot;deDE&quot;:[0,&quot;No Page for Locale&quot;],&quot;itIT&quot;:[0,&quot;No Page for Locale&quot;],&quot;jaJP&quot;:[0,&quot;No Page for Locale&quot;],&quot;koKR&quot;:[0,&quot;No Page for Locale&quot;],&quot;ptBR&quot;:[0,&quot;No Page for Locale&quot;],&quot;esLA&quot;:[0,&quot;No Page for Locale&quot;],&quot;esES&quot;:[0,&quot;No Page for Locale&quot;],&quot;enAU&quot;:[0,&quot;No Page for Locale&quot;],&quot;enCA&quot;:[0,&quot;No Page for Locale&quot;],&quot;enIN&quot;:[0,&quot;No Page for Locale&quot;],&quot;enGB&quot;:[0,&quot;No Page for Locale&quot;],&quot;idID&quot;:[0,&quot;No Page for Locale&quot;],&quot;ruRU&quot;:[0,&quot;No Page for Locale&quot;],&quot;svSE&quot;:[0,&quot;No Page for Locale&quot;],&quot;viVN&quot;:[0,&quot;No Page for Locale&quot;],&quot;plPL&quot;:[0,&quot;No Page for Locale&quot;],&quot;arAR&quot;:[0,&quot;No Page for Locale&quot;],&quot;nlNL&quot;:[0,&quot;No Page for Locale&quot;],&quot;thTH&quot;:[0,&quot;No Page for Locale&quot;],&quot;trTR&quot;:[0,&quot;No Page for Locale&quot;],&quot;heIL&quot;:[0,&quot;No Page for Locale&quot;],&quot;lvLV&quot;:[0,&quot;No Page for Locale&quot;],&quot;etEE&quot;:[0,&quot;No Page for Locale&quot;],&quot;ltLT&quot;:[0,&quot;No Page for Locale&quot;]}],&quot;url&quot;:[0,&quot;https://blog.cloudflare.com/building-agents-at-knock-agents-sdk&quot;],&quot;metadata&quot;:[0,{&quot;title&quot;:[0,&quot;Building an AI Agent that puts humans in the loop with Knock and Cloudflare’s Agents SDK&quot;],&quot;description&quot;:[0,&quot;How Knock shipped an AI Agent with human-in-the-loop capabilities with Cloudflare’s Agents SDK and Cloudflare Workers.&quot;],&quot;imgPreview&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/4QDMGATQYFYtzw9CfEpZeA/b850ebb2dd2b22fd415807c4a7a09cf2/hero-knock-cloudflare-agents.png&quot;]}],&quot;publicly_index&quot;:[0,true]}],[0,{&quot;id&quot;:[0,&quot;2dJV7VMudIGAhdS2pL32lv&quot;],&quot;title&quot;:[0,&quot;Let’s DO this: detecting Workers Builds errors across 1 million Durable Objects&quot;],&quot;slug&quot;:[0,&quot;detecting-workers-builds-errors-across-1-million-durable-durable-objects&quot;],&quot;excerpt&quot;:[0,&quot;Workers Builds, our CI/CD product for deploying Workers, monitors build issues by analyzing build failure metadata spread across over one million Durable Objects.&quot;],&quot;featured&quot;:[0,false],&quot;html&quot;:[0,&quot;&lt;p&gt;Cloudflare Workers Builds is our &lt;a href=\&quot;https://en.wikipedia.org/wiki/CI/CD\&quot;&gt;&lt;u&gt;CI/CD&lt;/u&gt;&lt;/a&gt; product that makes it easy to build and deploy Workers applications every time code is pushed to GitHub or GitLab. What makes Workers Builds special is that projects can be built and deployed with minimal configuration.&lt;a href=\&quot;https://developers.cloudflare.com/workers/ci-cd/builds/#get-started\&quot;&gt; &lt;u&gt;Just hook up your project and let us take care of the rest!&lt;/u&gt;&lt;/a&gt;&lt;/p&gt;&lt;p&gt;But what happens when things go wrong, such as failing to install tools or dependencies? What usually happens is that we don’t fix the problem until a customer contacts us about it, at which point many other customers have likely faced the same issue. This can be a frustrating experience for both us and our customers because of the lag time between issues occurring and us fixing them.&lt;/p&gt;&lt;p&gt;We want Workers Builds to be reliable, fast, and easy to use so that developers can focus on building, not dealing with our bugs. That’s why we recently started building an error detection system that can detect, categorize, and surface all build issues occurring on Workers Builds, enabling us to proactively fix issues and add missing features.&lt;/p&gt;&lt;p&gt;It’s also no secret that we’re big fans of being “Customer Zero” at Cloudflare, and Workers Builds is itself a product that’s built end-to-end on our &lt;a href=\&quot;https://www.cloudflare.com/developer-platform/\&quot;&gt;&lt;u&gt;Developer Platform&lt;/u&gt;&lt;/a&gt; using &lt;a href=\&quot;https://developers.cloudflare.com/workers/\&quot;&gt;&lt;u&gt;Workers&lt;/u&gt;&lt;/a&gt;, &lt;a href=\&quot;https://developers.cloudflare.com/durable-objects/\&quot;&gt;&lt;u&gt;Durable Objects&lt;/u&gt;&lt;/a&gt;, &lt;a href=\&quot;https://developers.cloudflare.com/hyperdrive/\&quot;&gt;&lt;u&gt;Hyperdrive&lt;/u&gt;&lt;/a&gt;, &lt;a href=\&quot;https://blog.cloudflare.com/cloudflare-containers-coming-2025/\&quot;&gt;&lt;u&gt;Containers&lt;/u&gt;&lt;/a&gt;, &lt;a href=\&quot;https://developers.cloudflare.com/queues/\&quot;&gt;&lt;u&gt;Queues&lt;/u&gt;&lt;/a&gt;, &lt;a href=\&quot;https://developers.cloudflare.com/kv/\&quot;&gt;&lt;u&gt;Workers KV&lt;/u&gt;&lt;/a&gt;, &lt;a href=\&quot;https://developers.cloudflare.com/r2/\&quot;&gt;&lt;u&gt;R2&lt;/u&gt;&lt;/a&gt;, and &lt;a href=\&quot;https://developers.cloudflare.com/workers/observability/\&quot;&gt;&lt;u&gt;Workers Observability&lt;/u&gt;&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;In this post, we will dive into how we used the Cloudflare Developer Platform to check for issues across more than &lt;b&gt;1 million Durable Objects&lt;/b&gt;.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;background-workers-builds-architecture\&quot;&gt;Background: Workers Builds architecture&lt;/h2&gt;\n            &lt;a href=\&quot;#background-workers-builds-architecture\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;Back in October 2024, we wrote about&lt;a href=\&quot;https://blog.cloudflare.com/workers-builds-integrated-ci-cd-built-on-the-workers-platform/\&quot;&gt; &lt;u&gt;how we built Workers Builds entirely on the Workers platform&lt;/u&gt;&lt;/a&gt;. To recap, Builds is built using Workers, Durable Objects, Workers KV, R2, Queues, Hyperdrive, and a Postgres database. Some of these things were not present when launched back in October (for example, Queues and KV). But the core of the architecture is the same.&lt;/p&gt;&lt;p&gt;A client Worker receives GitHub/GitLab webhooks and stores build metadata in Postgres (via Hyperdrive). A build management Worker uses two Durable Object classes: a Scheduler class to find builds in Postgres that need scheduling, and a class called BuildBuddy to manage the lifecycle of a build. When a build needs to be started, Scheduler creates a new BuildBuddy instance which is responsible for creating a container for the build (using&lt;a href=\&quot;https://blog.cloudflare.com/container-platform-preview/\&quot;&gt; &lt;u&gt;Cloudflare Containers&lt;/u&gt;&lt;/a&gt;), monitoring the container with health checks, and receiving build logs so that they can be viewed in the Cloudflare Dashboard.&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/2Zf6QSXafUJOxn6isLsqar/fd8eaa3428185c3da2ef96ddd1fdc43c/image2.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1999\&quot; height=\&quot;1112\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;In addition to this core scheduling logic, we have several Workers Queues for background work such as sending PR comments to GitHub/GitLab.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;the-problem-builds-are-failing\&quot;&gt;The problem: builds are failing&lt;/h2&gt;\n            &lt;a href=\&quot;#the-problem-builds-are-failing\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;While this architecture has worked well for us so far, we found ourselves with a problem: compared to&lt;a href=\&quot;https://developers.cloudflare.com/pages/\&quot;&gt; &lt;u&gt;Cloudflare Pages&lt;/u&gt;&lt;/a&gt;, a concerning percentage of builds were failing. We needed to dig deeper and figure out what was wrong, and understand how we could improve Workers Builds so that developers can focus more on shipping instead of build failures.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;types-of-build-failures\&quot;&gt;Types of build failures&lt;/h2&gt;\n            &lt;a href=\&quot;#types-of-build-failures\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;Not all build failures are the same. We have several categories of failures that we monitor:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;Initialization failures: when the container fails to start.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Clone failures: failing to clone the repository from GitHub/GitLab.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Build timeouts: builds that ran past the limit and were terminated by BuildBuddy.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Builds failing health checks: the container stopped responding to health checks, e.g. the container crashed for an unknown reason.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Failure to install tools or dependencies.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Failed user build/deploy commands.&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;The first few failure types were straightforward, and we’ve been able to track down and fix issues in our build system and control plane to improve what we call “build completion rate”. We define build completion as the following:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;&lt;p&gt;We successfully started the build.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;We attempted to install tools/dependencies (considering failures as “user error”).&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;We attempted to run the user-defined build/deploy commands (again, considering failures as “user error”).&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;We successfully marked the build as stopped in our database.&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;For example, we had a bug where builds for a deleted Worker would attempt to run and continuously fail, which affected our build completion rate metric.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;user-error\&quot;&gt;User error&lt;/h3&gt;\n            &lt;a href=\&quot;#user-error\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;We’ve made a lot of progress improving the reliability of build and container orchestration, but we had a significant percentage of build failures in the “user error” metric. We started asking ourselves “is this actually user error? Or is there a problem with the product itself?”&lt;/p&gt;&lt;p&gt;This presented a challenge because questions like “did the build command fail due to a bug in the build system, or user error?” are a lot harder to answer than pass/fail issues like failing to create a container for the build. To answer these questions, we had to build something new, something smarter.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;build-logs\&quot;&gt;Build logs&lt;/h3&gt;\n            &lt;a href=\&quot;#build-logs\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;The most obvious way to determine why a build failed is to look at its logs. When spot-checking build failures, we can typically identify what went wrong. For example, some builds fail to install dependencies because of an out of date lockfile (e.g. package-lock.json out of date with package.json). But looking through build failures one by one doesn’t scale. We didn’t want engineers looking through customer build logs without at least suspecting that there was an issue with our build system that we could fix.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;automating-error-detection\&quot;&gt;Automating error detection&lt;/h2&gt;\n            &lt;a href=\&quot;#automating-error-detection\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;At this point, next steps were clear: we needed an automated way to identify why a build failed based on build logs, and provide a way for engineers to see what the top issues were while ensuring privacy (e.g. removing account-specific identifiers and file paths from the aggregate data).&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;detecting-errors-in-build-logs-using-workers-queues\&quot;&gt;Detecting errors in build logs using Workers Queues&lt;/h3&gt;\n            &lt;a href=\&quot;#detecting-errors-in-build-logs-using-workers-queues\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;The first thing we needed was a way to categorize build errors after a build fails. To do this, we created a queue named BuildErrorsQueue to process builds and look for errors. After a build fails, BuildBuddy will send the build ID to BuildErrorsQueue which fetches the logs, checks for issues, and saves results to Postgres.&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/3423WCenScTudEv27TCMnJ/86b621a957d4249449c99db43a43bb9a/image7.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1968\&quot; height=\&quot;1386\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;We started out with a few static patterns to match things like Wrangler errors in log lines:&lt;/p&gt;\n            &lt;pre class=\&quot;language-JavaScript\&quot;&gt;&lt;code class=\&quot;language-JavaScript\&quot;&gt;export const DetectedErrorCodes = {\n  wrangler_error: {\n    detect: async (lines: LogLines) =&amp;gt; {\n      const errors: DetectedError[] = []\n      for (const line of lines) {\n        if (line[2].trim().startsWith(&amp;#039;✘ [ERROR]&amp;#039;)) {\n          errors.push({\n            error_code: &amp;#039;wrangler_error&amp;#039;,\n            error_group: getWranglerLogGroupFromLogLine(line, wranglerRegexMatchers),\n            detected_on: new Date(),\n            lines_matched: [line],\n          })\n        }\n      }\n      return errors\n    },\n  },\n  installing_tools_or_dependencies_failed: { ... },\n}&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;It wouldn’t be useful if all Wrangler errors were grouped under a single generic “wrangler_error” code, so we further grouped them by normalizing the log lines into groups:&lt;/p&gt;\n            &lt;pre class=\&quot;language-JavaScript\&quot;&gt;&lt;code class=\&quot;language-JavaScript\&quot;&gt;function getWranglerLogGroupFromLogLine(\n  logLine: LogLine,\n  regexMatchers: RegexMatcher[]\n): string {\n  const original = logLine[2].trim().replaceAll(/[\\t\\n\\r]+/g, &amp;#039; &amp;#039;)\n  let message = original\n  let group = original\n  for (const { mustMatch, patterns, stopOnMatch, name, useNameAsGroup } of regexMatchers) {\n    if (mustMatch !== undefined) {\n      const matched = matchLineToRegexes(message, mustMatch)\n      if (!matched) continue\n    }\n    if (patterns) {\n      for (const [pattern, mask] of patterns) {\n        message = message.replaceAll(pattern, mask)\n      }\n    }\n    if (useNameAsGroup === true) {\n      group = name\n    } else {\n      group = message\n    }\n    if (Boolean(stopOnMatch) &amp;amp;&amp;amp; message !== original) break\n  }\n  return group\n}\n\nconst wranglerRegexMatchers: RegexMatcher[] = [\n  {\n    name: &amp;#039;could_not_resolve&amp;#039;,\n    // ✘ [ERROR] Could not resolve &amp;quot;./balance&amp;quot;\n    // ✘ [ERROR] Could not resolve &amp;quot;node:string_decoder&amp;quot; (originally &amp;quot;string_decoder/&amp;quot;)\n    mustMatch: [/^✘ \\[ERROR\\] Could not resolve &amp;quot;[@\\w :/\\\\.-]*&amp;quot;/i],\n    stopOnMatch: true,\n    patterns: [\n      [/(?&amp;lt;=^✘ \\[ERROR\\] Could not resolve &amp;quot;)[@\\w :/\\\\.-]*(?=&amp;quot;)/gi, &amp;#039;&amp;lt;MODULE&amp;gt;&amp;#039;],\n      [/(?&amp;lt;=\\(originally &amp;quot;)[@\\w :/\\\\.-]*(?=&amp;quot;)/gi, &amp;#039;&amp;lt;MODULE&amp;gt;&amp;#039;],\n    ],\n  },\n  {\n    name: &amp;#039;no_matching_export_for_import&amp;#039;,\n    // ✘ [ERROR] No matching export in &amp;quot;src/db/schemas/index.ts&amp;quot; for import &amp;quot;someCoolTable&amp;quot;\n    mustMatch: [/^✘ \\[ERROR\\] No matching export in &amp;quot;/i],\n    stopOnMatch: true,\n    patterns: [\n      [/(?&amp;lt;=^✘ \\[ERROR\\] No matching export in &amp;quot;)[@~\\w:/\\\\.-]*(?=&amp;quot;)/gi, &amp;#039;&amp;lt;MODULE&amp;gt;&amp;#039;],\n      [/(?&amp;lt;=&amp;quot; for import &amp;quot;)[\\w-]*(?=&amp;quot;)/gi, &amp;#039;&amp;lt;IMPORT&amp;gt;&amp;#039;],\n    ],\n  },\n  // ...many more added over time\n]&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;Once we had our error detection matchers and normalizing logic in place, implementing the BuildErrorsQueue consumer was easy:&lt;/p&gt;\n            &lt;pre class=\&quot;language-JavaScript\&quot;&gt;&lt;code class=\&quot;language-JavaScript\&quot;&gt;export async function handleQueue(\n  batch: MessageBatch,\n  env: Bindings,\n  ctx: ExecutionContext\n): Promise&amp;lt;void&amp;gt; {\n  ...\n  await pMap(batch.messages, async (msg) =&amp;gt; {\n    try {\n      const { build_id } = BuildErrorsQueueMessageBody.parse(msg.body)\n      await store.buildErrors.deleteErrorsByBuildId({ build_id })\n      const bb = getBuildBuddy(env, build_id)\n      const errors: DetectedError[] = []\n      let cursor: LogsCursor | undefined\n      let hasMore = false\n\n      do {\n        using maybeNewLogs = await bb.getLogs(cursor, false)\n        const newLogs = LogsWithCursor.parse(maybeNewLogs)\n        cursor = newLogs.cursor\n        const newErrors = await detectErrorsInLogLines(newLogs.lines)\n        errors.push(...newErrors)\n        hasMore = Boolean(cursor) &amp;amp;&amp;amp; newLogs.lines.length &amp;gt; 0\n      } while (hasMore)\n\n      if (errors.length &amp;gt; 0) {\n        await store.buildErrors.insertErrors(\n          errors.map((e) =&amp;gt; ({\n            build_id,\n            error_code: e.error_code,\n            error_group: e.error_group,\n          }))\n        )\n      }\n      msg.ack()\n    } catch (e) {\n      msg.retry()\n      sentry.captureException(e)\n    }\n  })\n}&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;Here, we’re fetching logs from each build’s BuildBuddy Durable Object, detecting why it failed using the matchers we wrote, and saving errors to the Postgres DB. We also delete any existing errors for when we improve our error detection patterns to prevent subsequent runs from adding duplicate data to our database.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;what-about-historical-builds\&quot;&gt;What about historical builds?&lt;/h2&gt;\n            &lt;a href=\&quot;#what-about-historical-builds\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;The BuildErrorsQueue was great for new builds, but this meant we still didn’t know why all the previous build failures happened other than “user error”. We considered only tracking errors in new builds, but this was unacceptable because it would significantly slow down our ability to improve our error detection system because each iteration would require us to wait days to identify issues we need to prioritize.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;problem-logs-are-stored-across-one-million-durable-objects\&quot;&gt;Problem: logs are stored across one million+ Durable Objects&lt;/h3&gt;\n            &lt;a href=\&quot;#problem-logs-are-stored-across-one-million-durable-objects\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Remember how every build has an associated BuildBuddy DO to store logs? This is a great design for ensuring our logging pipeline scales with our customers, but it presented a challenge when trying to aggregate issues based on logs because something would need to go through all historical builds (&amp;gt;1 million at the time) to fetch logs and detect why they failed.&lt;/p&gt;&lt;p&gt;If we were using Go and Kubernetes, we might solve this using a long-running container that goes through all builds and runs our error detection. But how do we solve this in Workers?&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;how-do-we-backfill-errors-for-historical-builds\&quot;&gt;How do we backfill errors for historical builds?&lt;/h3&gt;\n            &lt;a href=\&quot;#how-do-we-backfill-errors-for-historical-builds\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;At this point, we already had the Queue to process new builds. If we could somehow send all of the old build IDs to the queue, it could scan them all quickly using&lt;a href=\&quot;https://developers.cloudflare.com/queues/configuration/consumer-concurrency/\&quot;&gt; &lt;u&gt;Queues concurrent consumers&lt;/u&gt;&lt;/a&gt; to quickly work through all builds. We thought about hacking together a local script to fetch all of the log IDs and sending them to an API to put them on a queue. But we wanted something more secure and easier to use so that running a new backfill was as simple as an API call.&lt;/p&gt;&lt;p&gt;That’s when an idea hit us: what if we used a Durable Object with alarms to fetch a range of builds and send them to BuildErrorsQueue? At first, it seemed far-fetched, given that Durable Object alarms have a limited amount of work they can do per invocation. But wait, if&lt;a href=\&quot;https://agents.cloudflare.com/\&quot;&gt; &lt;u&gt;AI Agents built on Durable Objects&lt;/u&gt;&lt;/a&gt; can manage background tasks, why can’t we fetch millions of build IDs and forward them to queues?&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;building-a-build-errors-agent-with-durable-objects\&quot;&gt;Building a Build Errors Agent with Durable Objects&lt;/h3&gt;\n            &lt;a href=\&quot;#building-a-build-errors-agent-with-durable-objects\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;The idea was simple: create a Durable Object class named BuildErrorsAgent and run a single instance that loops through the specified range of builds in the database and sends them to BuildErrorsQueue.&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/3kmsS4LACzLUUoECSJT08g/b6a9ccffcbe8a41c300a74546a17ba85/image5.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1999\&quot; height=\&quot;1119\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;The first thing we did was set up an RPC method to start a backfill and save the parameters in&lt;a href=\&quot;https://developers.cloudflare.com/durable-objects/api/storage-api/#kv-api\&quot;&gt; &lt;u&gt;Durable Object KV storage&lt;/u&gt;&lt;/a&gt; so that it can be read each time the alarm executes:&lt;/p&gt;\n            &lt;pre class=\&quot;language-JavaScript\&quot;&gt;&lt;code class=\&quot;language-JavaScript\&quot;&gt;async start({\n  min_build_id,\n  max_build_id,\n}: {\n  min_build_id: BuildRecord[&amp;#039;build_id&amp;#039;]\n  max_build_id: BuildRecord[&amp;#039;build_id&amp;#039;]\n}): Promise&amp;lt;void&amp;gt; {\n  logger.setTags({ handler: &amp;#039;start&amp;#039;, environment: this.env.ENVIRONMENT })\n  try {\n    if (min_build_id &amp;lt; 0) throw new Error(&amp;#039;min_build_id cannot be negative&amp;#039;)\n    if (max_build_id &amp;lt; min_build_id) {\n      throw new Error(&amp;#039;max_build_id cannot be less than min_build_id&amp;#039;)\n    }\n    const [started_on, stopped_on] = await Promise.all([\n      this.kv.get(&amp;#039;started_on&amp;#039;),\n      this.kv.get(&amp;#039;stopped_on&amp;#039;),\n    ])\n    await match({ started_on, stopped_on })\n      .with({ started_on: P.not(null), stopped_on: P.nullish }, () =&amp;gt; {\n        throw new Error(&amp;#039;BuildErrorsAgent is already running&amp;#039;)\n      })\n      .otherwise(async () =&amp;gt; {\n        // delete all existing data and start queueing failed builds\n        await this.state.storage.deleteAlarm()\n        await this.state.storage.deleteAll()\n        this.kv.put(&amp;#039;started_on&amp;#039;, new Date())\n        this.kv.put(&amp;#039;config&amp;#039;, { min_build_id, max_build_id })\n        void this.state.storage.setAlarm(this.getNextAlarmDate())\n      })\n  } catch (e) {\n    this.sentry.captureException(e)\n    throw e\n  }\n}&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;The most important part of the implementation is the alarm that runs every second until the job is complete. Each alarm invocation has the following steps:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;&lt;p&gt;Set a new alarm (always first to ensure an error doesn’t cause it to stop).&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Retrieve state from KV.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Validate that the agent is supposed to be running:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;&lt;p&gt;Ensure the agent is supposed to be running.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Ensure we haven’t reached the max build ID set in the config.&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Finally, queue up another batch of builds by querying Postgres and sending to the BuildErrorsQueue.&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/6Ab6VC49luyio3t5QamgMD/273c77158ff4ac7af662669360d5f485/image6.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1999\&quot; height=\&quot;1666\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;\n            &lt;pre class=\&quot;language-JavaScript\&quot;&gt;&lt;code class=\&quot;language-JavaScript\&quot;&gt;async alarm(): Promise&amp;lt;void&amp;gt; {\n  logger.setTags({ handler: &amp;#039;alarm&amp;#039;, environment: this.env.ENVIRONMENT })\n  try {\n    void this.state.storage.setAlarm(Date.now() + 1000)\n    const kvState = await this.getKVState()\n    this.sentry.setContext(&amp;#039;BuildErrorsAgent&amp;#039;, kvState)\n    const ctxLogger = logger.withFields({ state: JSON.stringify(kvState) })\n\n    await match(kvState)\n      .with({ started_on: P.nullish }, async () =&amp;gt; {\n        ctxLogger.info(&amp;#039;BuildErrorsAgent is not started, cancelling alarm&amp;#039;)\n        await this.state.storage.deleteAlarm()\n      })\n      .with({ stopped_on: P.not(null) }, async () =&amp;gt; {\n        ctxLogger.info(&amp;#039;BuildErrorsAgent is stopped, cancelling alarm&amp;#039;)\n        await this.state.storage.deleteAlarm()\n      })\n      .with(\n        // we should never have started_on set without config set, but just in case\n        { started_on: P.not(null), config: P.nullish },\n        async () =&amp;gt; {\n          const msg =\n            &amp;#039;BuildErrorsAgent started but config is empty, stopping and cancelling alarm&amp;#039;\n          ctxLogger.error(msg)\n          this.sentry.captureException(new Error(msg))\n          this.kv.put(&amp;#039;stopped_on&amp;#039;, new Date())\n          await this.state.storage.deleteAlarm()\n        }\n      )\n      .when(\n        // make sure there are still builds to enqueue\n        (s) =&amp;gt;\n          s.latest_build_id !== null &amp;amp;&amp;amp;\n          s.config !== null &amp;amp;&amp;amp;\n          s.latest_build_id &amp;gt;= s.config.max_build_id,\n        async () =&amp;gt; {\n          ctxLogger.info(&amp;#039;BuildErrorsAgent job complete, cancelling alarm&amp;#039;)\n          this.kv.put(&amp;#039;stopped_on&amp;#039;, new Date())\n          await this.state.storage.deleteAlarm()\n        }\n      )\n      .with(\n        {\n          started_on: P.not(null),\n          stopped_on: P.nullish,\n          config: P.not(null),\n          latest_build_id: P.any,\n        },\n        async ({ config, latest_build_id }) =&amp;gt; {\n          // 1. select batch of ~1000 builds\n          // 2. send them to Queues 100 at a time, updating\n          //    latest_build_id after each batch is sent\n          const failedBuilds = await this.store.builds.selectFailedBuilds({\n            min_build_id: latest_build_id !== null ? latest_build_id + 1 : config.min_build_id,\n            max_build_id: config.max_build_id,\n            limit: 1000,\n          })\n          if (failedBuilds.length === 0) {\n            ctxLogger.info(`BuildErrorsAgent: ran out of builds, stopping and cancelling alarm`)\n            this.kv.put(&amp;#039;stopped_on&amp;#039;, new Date())\n            await this.state.storage.deleteAlarm()\n          }\n\n          for (\n            let i = 0;\n            i &amp;lt; BUILDS_PER_ALARM_RUN &amp;amp;&amp;amp; i &amp;lt; failedBuilds.length;\n            i += QUEUES_BATCH_SIZE\n          ) {\n            const batch = failedBuilds\n              .slice(i, QUEUES_BATCH_SIZE)\n              .map((build) =&amp;gt; ({ body: build }))\n\n            if (batch.length === 0) {\n              ctxLogger.info(`BuildErrorsAgent: ran out of builds in current batch`)\n              break\n            }\n            ctxLogger.info(\n              `BuildErrorsAgent: sending ${batch.length} builds to build errors queue`\n            )\n            await this.env.BUILD_ERRORS_QUEUE.sendBatch(batch)\n            this.kv.put(\n              &amp;#039;latest_build_id&amp;#039;,\n              Math.max(...batch.map((m) =&amp;gt; m.body.build_id).concat(latest_build_id ?? 0))\n            )\n\n            this.kv.put(\n              &amp;#039;total_builds_processed&amp;#039;,\n              ((await this.kv.get(&amp;#039;total_builds_processed&amp;#039;)) ?? 0) + batch.length\n            )\n          }\n        }\n      )\n      .otherwise(() =&amp;gt; {\n        const msg = &amp;#039;BuildErrorsAgent has nothing to do - this should never happen&amp;#039;\n        this.sentry.captureException(msg)\n        ctxLogger.info(msg)\n      })\n  } catch (e) {\n    this.sentry.captureException(e)\n    throw e\n  }\n}&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;Using pattern matching with &lt;a href=\&quot;https://github.com/gvergnaud/ts-pattern\&quot;&gt;&lt;u&gt;ts-pattern&lt;/u&gt;&lt;/a&gt; made it much easier to understand what states we were expecting and what will happen compared to procedural code. We considered using a more powerful library like &lt;a href=\&quot;https://stately.ai/docs/xstate\&quot;&gt;&lt;u&gt;XState&lt;/u&gt;&lt;/a&gt;, but decided on ts-pattern due to its simplicity.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;running-the-backfill\&quot;&gt;Running the backfill&lt;/h3&gt;\n            &lt;a href=\&quot;#running-the-backfill\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Once everything rolled out, we were able to trigger an errors backfill for over a million failed builds in a couple of hours with a single API call, categorizing 80% of failed builds on the first run. With a fast backfill process, we were able to iterate on our regex matchers to further refine our error detection and improve error grouping. Here’s what the error list looks like in our staging environment:&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/5rdNvB1SpjGpeiCOCs86Tj/74141402e67fbd9ced673a98cb3c57f6/image4.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1999\&quot; height=\&quot;537\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;fixes-and-improvements\&quot;&gt;Fixes and improvements&lt;/h2&gt;\n            &lt;a href=\&quot;#fixes-and-improvements\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;Having a better understanding of what’s going wrong has already enabled us to make several improvements:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;Wrangler now shows a&lt;a href=\&quot;https://github.com/cloudflare/workers-sdk/pull/8534\&quot;&gt; &lt;u&gt;clearer error message when no config file is found&lt;/u&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Fixed multiple edge-cases where the wrong package manager was used in TypeScript/JavaScript projects.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Added support for bun.lock (previously only checked for bun.lockb).&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Fixed several edge cases where build caching did not work in monorepos.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Projects that use a runtime.txt file to specify a Python version no longer fail.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;….and more!&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;We’re still working on fixing other bugs we’ve found, but we’re making steady progress. Reliability is a feature we’re striving for in Workers Builds, and this project has helped us make meaningful progress towards that goal. Instead of waiting for people to contact support for issues, we’re able to proactively identify and fix issues (and catch regressions more easily).&lt;/p&gt;&lt;p&gt;One of the great things about building on the Developer Platform is how easy it is to ship things. The core of this error detection pipeline (the Queue and Durable Object) &lt;b&gt;only took two days to build&lt;/b&gt;, which meant we could spend more time working on improving Workers Builds instead of spending weeks on the error detection pipeline itself.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;whats-next\&quot;&gt;What’s next?&lt;/h2&gt;\n            &lt;a href=\&quot;#whats-next\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;In addition to continuing to improve build reliability and speed, we’ve also started thinking about other ways to help developers build their applications on Workers. For example, we built a&lt;a href=\&quot;https://github.com/cloudflare/mcp-server-cloudflare/tree/main/apps/workers-builds\&quot;&gt; &lt;u&gt;Builds MCP server&lt;/u&gt;&lt;/a&gt; that allows users to debug builds directly in Cursor/Claude/etc. We’re also thinking about ways we can expose these detected issues in the Cloudflare Dashboard so that users can identify issues more easily without scrolling through hundreds of logs.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;ready-to-get-started\&quot;&gt;Ready to get started?&lt;/h2&gt;\n            &lt;a href=\&quot;#ready-to-get-started\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;Building applications on Workers has never been easier! Try deploying a Durable Object-backed &lt;a href=\&quot;https://github.com/cloudflare/templates/tree/main/durable-chat-template\&quot;&gt;&lt;u&gt;chat application&lt;/u&gt;&lt;/a&gt; with Workers Builds: &lt;/p&gt;&lt;a href=\&quot;https://deploy.workers.cloudflare.com/?url=https://github.com/cloudflare/templates/tree/main/durable-chat-template\&quot;&gt;&lt;img src=\&quot;https://deploy.workers.cloudflare.com/button\&quot; alt=\&quot;Deploy to Cloudflare\&quot;/&gt;&lt;/a&gt;&lt;p&gt;&lt;/p&gt;&quot;],&quot;published_at&quot;:[0,&quot;2025-05-29T14:00+01:00&quot;],&quot;updated_at&quot;:[0,&quot;2025-05-29T17:54:30.954Z&quot;],&quot;feature_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/5S97X9X0Cv2pBhrhD8NfTw/bef505a8d29d024f0cf4e89c7491e349/image3.png&quot;],&quot;tags&quot;:[1,[[0,{&quot;id&quot;:[0,&quot;6hbkItfupogJP3aRDAq6v8&quot;],&quot;name&quot;:[0,&quot;Cloudflare Workers&quot;],&quot;slug&quot;:[0,&quot;workers&quot;]}],[0,{&quot;id&quot;:[0,&quot;5v2UZdTRX1Rw9akmhexnxs&quot;],&quot;name&quot;:[0,&quot;Durable Objects&quot;],&quot;slug&quot;:[0,&quot;durable-objects&quot;]}],[0,{&quot;id&quot;:[0,&quot;4a93Z8FeOvcDI3HEoiIiXI&quot;],&quot;name&quot;:[0,&quot;Dogfooding&quot;],&quot;slug&quot;:[0,&quot;dogfooding&quot;]}]]],&quot;relatedTags&quot;:[0],&quot;authors&quot;:[1,[[0,{&quot;name&quot;:[0,&quot;Jacob Hands&quot;],&quot;slug&quot;:[0,&quot;jacob-hands&quot;],&quot;bio&quot;:[0,null],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1u48WVfES8uNb77aB2z9bk/9bfef685adbdef1298e57959119d5931/jacob-hands.jpeg&quot;],&quot;location&quot;:[0,null],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,&quot;@jachands&quot;],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}]]],&quot;meta_description&quot;:[0,&quot;Workers Builds, our CI/CD product for deploying Workers, monitors build issues by analyzing build failure metadata spread across over one million Durable Objects.&quot;],&quot;primary_author&quot;:[0,{}],&quot;localeList&quot;:[0,{&quot;name&quot;:[0,&quot;blog-english-only&quot;],&quot;enUS&quot;:[0,&quot;English for Locale&quot;],&quot;zhCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhHansCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhTW&quot;:[0,&quot;No Page for Locale&quot;],&quot;frFR&quot;:[0,&quot;No Page for Locale&quot;],&quot;deDE&quot;:[0,&quot;No Page for Locale&quot;],&quot;itIT&quot;:[0,&quot;No Page for Locale&quot;],&quot;jaJP&quot;:[0,&quot;No Page for Locale&quot;],&quot;koKR&quot;:[0,&quot;No Page for Locale&quot;],&quot;ptBR&quot;:[0,&quot;No Page for Locale&quot;],&quot;esLA&quot;:[0,&quot;No Page for Locale&quot;],&quot;esES&quot;:[0,&quot;No Page for Locale&quot;],&quot;enAU&quot;:[0,&quot;No Page for Locale&quot;],&quot;enCA&quot;:[0,&quot;No Page for Locale&quot;],&quot;enIN&quot;:[0,&quot;No Page for Locale&quot;],&quot;enGB&quot;:[0,&quot;No Page for Locale&quot;],&quot;idID&quot;:[0,&quot;No Page for Locale&quot;],&quot;ruRU&quot;:[0,&quot;No Page for Locale&quot;],&quot;svSE&quot;:[0,&quot;No Page for Locale&quot;],&quot;viVN&quot;:[0,&quot;No Page for Locale&quot;],&quot;plPL&quot;:[0,&quot;No Page for Locale&quot;],&quot;arAR&quot;:[0,&quot;No Page for Locale&quot;],&quot;nlNL&quot;:[0,&quot;No Page for Locale&quot;],&quot;thTH&quot;:[0,&quot;No Page for Locale&quot;],&quot;trTR&quot;:[0,&quot;No Page for Locale&quot;],&quot;heIL&quot;:[0,&quot;No Page for Locale&quot;],&quot;lvLV&quot;:[0,&quot;No Page for Locale&quot;],&quot;etEE&quot;:[0,&quot;No Page for Locale&quot;],&quot;ltLT&quot;:[0,&quot;No Page for Locale&quot;]}],&quot;url&quot;:[0,&quot;https://blog.cloudflare.com/detecting-workers-builds-errors-across-1-million-durable-durable-objects&quot;],&quot;metadata&quot;:[0,{&quot;title&quot;:[0,&quot;Let’s DO this: detecting Workers Builds errors across 1 million Durable Objects&quot;],&quot;description&quot;:[0,&quot;Workers Builds, our CI/CD product for deploying Workers, monitors build issues by analyzing build failure metadata spread across over one million Durable Objects.&quot;],&quot;imgPreview&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/GRE2R7EEIitm7wTKct6Lo/ab0c8a86937384dca8bb41fd9c07eaa0/Let%C3%A2__s_DO_this-_detecting_Workers_Builds_errors_across_1_million_Durable_Objects-OG.png&quot;]}],&quot;publicly_index&quot;:[0,true]}],[0,{&quot;id&quot;:[0,&quot;17j3OSuM89oMb5wurF4Tij&quot;],&quot;title&quot;:[0,&quot;Thirteen new MCP servers from Cloudflare you can use today&quot;],&quot;slug&quot;:[0,&quot;thirteen-new-mcp-servers-from-cloudflare&quot;],&quot;excerpt&quot;:[0,&quot;You can now connect to Cloudflare&#39;s first publicly available remote Model Context Protocol (MCP) servers from any MCP client that supports remote servers. &quot;],&quot;featured&quot;:[0,false],&quot;html&quot;:[0,&quot;&lt;p&gt;You can now connect to Cloudflare&amp;#39;s first publicly available &lt;a href=\&quot;https://blog.cloudflare.com/remote-model-context-protocol-servers-mcp/\&quot;&gt;&lt;u&gt;remote Model Context Protocol (MCP) servers&lt;/u&gt;&lt;/a&gt; from Claude.ai (&lt;a href=\&quot;http://anthropic.com/news/integrations\&quot;&gt;&lt;u&gt;now supporting remote MCP connections!&lt;/u&gt;&lt;/a&gt;) and other &lt;a href=\&quot;https://modelcontextprotocol.io/clients\&quot;&gt;&lt;u&gt;MCP clients&lt;/u&gt;&lt;/a&gt; like Cursor, Windsurf, or our own &lt;a href=\&quot;https://playground.ai.cloudflare.com/\&quot;&gt;&lt;u&gt;AI Playground&lt;/u&gt;&lt;/a&gt;. Unlock Cloudflare tools, resources, and real time information through our new suite of MCP servers including: &lt;/p&gt;&lt;style type=\&quot;text/css\&quot;&gt;\n.tg  {border-collapse:collapse;border-spacing:0;margin:0px auto;}\n.tg td{border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;\n  overflow:hidden;padding:10px 5px;word-break:normal;}\n.tg th{border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;\n  font-weight:normal;overflow:hidden;padding:10px 5px;word-break:normal;}\n.tg .tg-2tr3{background-color:#F60;color:#FFF;font-weight:bold;text-align:left;vertical-align:top}\n.tg .tg-8fnt{color:#15C;font-weight:bold;text-align:left;text-decoration:underline;vertical-align:top}\n.tg .tg-0lax{text-align:left;vertical-align:top}\n@media screen and (max-width: 767px) {.tg {width: auto !important;}.tg col {width: auto !important;}.tg-wrap {overflow-x: auto;-webkit-overflow-scrolling: touch;margin: auto 0px;}}&lt;/style&gt;\n&lt;div class=\&quot;tg-wrap\&quot;&gt;&lt;table class=\&quot;tg\&quot;&gt;&lt;thead&gt;\n  &lt;tr&gt;\n    &lt;th class=\&quot;tg-2tr3\&quot;&gt;&lt;span style=\&quot;font-weight:700;font-style:normal;text-decoration:none;color:#FFF;background-color:transparent\&quot;&gt;Server&lt;/span&gt;&lt;/th&gt;\n    &lt;th class=\&quot;tg-2tr3\&quot;&gt;&lt;span style=\&quot;font-weight:700;font-style:normal;text-decoration:none;color:#FFF;background-color:transparent\&quot;&gt;Description &lt;/span&gt;&lt;/th&gt;\n  &lt;/tr&gt;&lt;/thead&gt;\n&lt;tbody&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-8fnt\&quot;&gt;&lt;a href=\&quot;https://github.com/cloudflare/mcp-server-cloudflare/tree/main/apps/docs-vectorize\&quot;&gt;&lt;span style=\&quot;font-weight:700;font-style:normal;text-decoration:underline;color:#15C;background-color:transparent\&quot;&gt;Cloudflare Documentation server&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Get up to date reference information from Cloudflare Developer Documentation&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-8fnt\&quot;&gt;&lt;a href=\&quot;https://github.com/cloudflare/mcp-server-cloudflare/tree/main/apps/workers-bindings\&quot;&gt;&lt;span style=\&quot;font-weight:700;font-style:normal;text-decoration:underline;color:#15C;background-color:transparent\&quot;&gt;Workers Bindings server &lt;/span&gt;&lt;/a&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Build Workers applications with storage, AI, and compute primitives&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-8fnt\&quot;&gt;&lt;a href=\&quot;https://github.com/cloudflare/mcp-server-cloudflare/tree/main/apps/workers-observability\&quot;&gt;&lt;span style=\&quot;font-weight:700;font-style:normal;text-decoration:underline;color:#15C;background-color:transparent\&quot;&gt;Workers Observability server &lt;/span&gt;&lt;/a&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Debug and get insight into your Workers application’s logs and analytics&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-8fnt\&quot;&gt;&lt;a href=\&quot;https://github.com/cloudflare/mcp-server-cloudflare/tree/main/apps/sandbox-container\&quot;&gt;&lt;span style=\&quot;font-weight:700;font-style:normal;text-decoration:underline;color:#15C;background-color:transparent\&quot;&gt;Container server&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Spin up a sandbox development environment &lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-8fnt\&quot;&gt;&lt;a href=\&quot;https://github.com/cloudflare/mcp-server-cloudflare/tree/main/apps/browser-rendering\&quot;&gt;&lt;span style=\&quot;font-weight:700;font-style:normal;text-decoration:underline;color:#15C;background-color:transparent\&quot;&gt;Browser rendering server&lt;/span&gt;&lt;/a&gt;&lt;span style=\&quot;font-weight:700;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt; &lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Fetch web pages, convert them to markdown and take screenshots&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-8fnt\&quot;&gt;&lt;a href=\&quot;https://github.com/cloudflare/mcp-server-cloudflare/tree/main/apps/radar\&quot;&gt;&lt;span style=\&quot;font-weight:700;font-style:normal;text-decoration:underline;color:#15C;background-color:transparent\&quot;&gt;Radar server &lt;/span&gt;&lt;/a&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Get global Internet traffic insights, trends, URL scans, and other utilities&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-8fnt\&quot;&gt;&lt;a href=\&quot;https://github.com/cloudflare/mcp-server-cloudflare/tree/main/apps/logpush\&quot;&gt;&lt;span style=\&quot;font-weight:700;font-style:normal;text-decoration:underline;color:#15C;background-color:transparent\&quot;&gt;Logpush server &lt;/span&gt;&lt;/a&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Get quick summaries for Logpush job health&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-8fnt\&quot;&gt;&lt;a href=\&quot;https://github.com/cloudflare/mcp-server-cloudflare/tree/main/apps/ai-gateway\&quot;&gt;&lt;span style=\&quot;font-weight:700;font-style:normal;text-decoration:underline;color:#15C;background-color:transparent\&quot;&gt;AI Gateway server &lt;/span&gt;&lt;/a&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Search your logs, get details about the prompts and responses&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-8fnt\&quot;&gt;&lt;a href=\&quot;https://github.com/cloudflare/mcp-server-cloudflare/tree/main/apps/autorag\&quot;&gt;&lt;span style=\&quot;font-weight:700;font-style:normal;text-decoration:underline;color:#15C;background-color:transparent\&quot;&gt;AutoRAG server&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;List and search documents on your AutoRAGs&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-8fnt\&quot;&gt;&lt;a href=\&quot;https://github.com/cloudflare/mcp-server-cloudflare/tree/main/apps/auditlogs\&quot;&gt;&lt;span style=\&quot;font-weight:700;font-style:normal;text-decoration:underline;color:#15C;background-color:transparent\&quot;&gt;Audit Logs server &lt;/span&gt;&lt;/a&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Query audit logs and generate reports for review&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-8fnt\&quot;&gt;&lt;a href=\&quot;https://github.com/cloudflare/mcp-server-cloudflare/tree/main/apps/dns-analytics\&quot;&gt;&lt;span style=\&quot;font-weight:700;font-style:normal;text-decoration:underline;color:#15C;background-color:transparent\&quot;&gt;DNS Analytics server &lt;/span&gt;&lt;/a&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Optimize DNS performance and debug issues based on current set up&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-8fnt\&quot;&gt;&lt;a href=\&quot;https://github.com/cloudflare/mcp-server-cloudflare/tree/main/apps/dex-analysis\&quot;&gt;&lt;span style=\&quot;font-weight:700;font-style:normal;text-decoration:underline;color:#15C;background-color:transparent\&quot;&gt;Digital Experience Monitoring server &lt;/span&gt;&lt;/a&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Get quick insight on critical applications for your organization&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-8fnt\&quot;&gt;&lt;a href=\&quot;https://github.com/cloudflare/mcp-server-cloudflare/tree/main/apps/cloudflare-one-casb\&quot;&gt;&lt;span style=\&quot;font-weight:700;font-style:normal;text-decoration:underline;color:#15C;background-color:transparent\&quot;&gt;Cloudflare One CASB server &lt;/span&gt;&lt;/a&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Quickly identify any security misconfigurations for SaaS applications to safeguard applications, users, and data&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;… all through a natural language interface! &lt;/p&gt;&lt;p&gt;Today, we also &lt;a href=\&quot;http://blog.cloudflare.com/mcp-demo-day\&quot;&gt;&lt;u&gt;announced our collaboration with Anthropic&lt;/u&gt;&lt;/a&gt; to bring remote MCP to &lt;a href=\&quot;https://claude.ai/\&quot;&gt;&lt;u&gt;Claude&lt;/u&gt;&lt;/a&gt; users, and showcased how other leading companies such as &lt;a href=\&quot;https://www.atlassian.com/platform/remote-mcp-server\&quot;&gt;&lt;u&gt;Atlassian&lt;/u&gt;&lt;/a&gt;, &lt;a href=\&quot;https://developer.paypal.com/tools/mcp-server/\&quot;&gt;&lt;u&gt;PayPal&lt;/u&gt;&lt;/a&gt;, &lt;a href=\&quot;https://docs.sentry.io/product/sentry-mcp/\&quot;&gt;&lt;u&gt;Sentry&lt;/u&gt;&lt;/a&gt;, and &lt;a href=\&quot;https://mcp.webflow.com\&quot;&gt;&lt;u&gt;Webflow&lt;/u&gt;&lt;/a&gt; have built remote MCP servers on Cloudflare to extend their service to their users. We’ve also been using the same infrastructure and tooling to build out our own suite of remote servers, and today we’re excited to show customers what’s ready for use and share what we’ve learned along the way. &lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;cloudflares-mcp-servers-available-today\&quot;&gt;Cloudflare’s MCP servers available today: &lt;/h3&gt;\n            &lt;a href=\&quot;#cloudflares-mcp-servers-available-today\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;These &lt;a href=\&quot;https://www.cloudflare.com/learning/ai/what-is-model-context-protocol-mcp/\&quot;&gt;MCP servers&lt;/a&gt; allow your &lt;a href=\&quot;https://modelcontextprotocol.io/clients\&quot;&gt;&lt;u&gt;MCP Client&lt;/u&gt;&lt;/a&gt; to read configurations from your account, process information, make suggestions based on data, and even make those suggested changes for you. All of these actions can happen across Cloudflare&amp;#39;s many services including application development, security, and performance.&lt;/p&gt;&lt;h4&gt;&lt;b&gt;Cloudflare Documentation Server: &lt;/b&gt;Get up-to-date reference information on Cloudflare &lt;/h4&gt;&lt;p&gt;Our &lt;a href=\&quot;https://github.com/cloudflare/mcp-server-cloudflare/tree/main/apps/docs-vectorize\&quot;&gt;&lt;u&gt;Cloudflare Documentation server&lt;/u&gt;&lt;/a&gt; enables any MCP Client to access up-to-date &lt;a href=\&quot;https://developers.cloudflare.com/\&quot;&gt;&lt;u&gt;documentation&lt;/u&gt;&lt;/a&gt; in real-time, rather than relying on potentially outdated information from the model&amp;#39;s training data. If you’re new to building with Cloudflare, this server synthesizes information right from our documentation and exposes it to your MCP Client, so you can get reliable, up-to-date responses to any complex question like “Search Cloudflare for the best way to build an AI Agent”.  &lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/3vanQPwy6YSwI7bsDTk2md/09cb4763ddbd4858fcd90aca00106bb9/BLOG-2808_2.png\&quot; alt=\&quot;BLOG-2808 2\&quot; class=\&quot;kg-image\&quot; width=\&quot;762\&quot; height=\&quot;806\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;h4&gt;&lt;b&gt;Workers Bindings server: &lt;/b&gt;Build with developer resources &lt;/h4&gt;&lt;p&gt;Connecting to the &lt;a href=\&quot;https://github.com/cloudflare/mcp-server-cloudflare/tree/main/apps/workers-bindings\&quot;&gt;&lt;u&gt;Bindings MCP server&lt;/u&gt;&lt;/a&gt; lets you leverage application development primitives like D1 databases, R2 object storage and Key Value stores on the fly as you build out a Workers application. If you&amp;#39;re leveraging your MCP Client to generate code, the bindings server provides access to read existing resources from your account or create fresh resources to implement in your application. In combination with our &lt;a href=\&quot;https://developers.cloudflare.com/workers/get-started/prompting/\&quot;&gt;&lt;u&gt;base prompt&lt;/u&gt;&lt;/a&gt; designed to help you build robust Workers applications, you can add the Bindings MCP server to give your client all it needs to start generating full stack applications from natural language. &lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/6N0Y8BCBz5ULSHbj0JCIkL/3a6a9ef269202a6c05d18444f313ce87/BLOG-2808_3.png\&quot; alt=\&quot;BLOG-2808 3\&quot; class=\&quot;kg-image\&quot; width=\&quot;1358\&quot; height=\&quot;1116\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;\nFull example output using the Workers Bindings MCP server can be found &lt;a href=\&quot;https://claude.ai/share/273dadf7-b060-422d-b2b6-4f436d537136\&quot;&gt;&lt;u&gt;here&lt;/u&gt;&lt;/a&gt;.&lt;/p&gt;&lt;h4&gt;&lt;b&gt;Workers Observability server: &lt;/b&gt;Debug your application &lt;/h4&gt;&lt;p&gt;The &lt;a href=\&quot;https://github.com/cloudflare/mcp-server-cloudflare/tree/main/apps/workers-observability\&quot;&gt;&lt;u&gt;Workers Observability MCP server&lt;/u&gt;&lt;/a&gt; integrates with &lt;a href=\&quot;https://developers.cloudflare.com/workers/observability/logs/workers-logs/\&quot;&gt;&lt;u&gt;Workers Logs&lt;/u&gt;&lt;/a&gt; to browse invocation logs and errors, compute statistics across invocations, and find specific invocations matching specific criteria. By querying logs across all of your Workers, this MCP server can help isolate errors and trends quickly. The telemetry data that the MCP server returns can also be used to create new visualizations and improve observability.&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1rydyUALBbwtPrT477xAKM/81547e1fb3cec5ffadd90ee5e68e1a5e/BLOG-2808_4.png\&quot; alt=\&quot;BLOG-2808 4\&quot; class=\&quot;kg-image\&quot; width=\&quot;1505\&quot; height=\&quot;895\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;h4&gt;&lt;b&gt;Container server:&lt;/b&gt; Spin up a development environment&lt;/h4&gt;&lt;p&gt;The &lt;a href=\&quot;https://github.com/cloudflare/mcp-server-cloudflare/tree/main/apps/sandbox-container\&quot;&gt;&lt;u&gt;Container MCP server&lt;/u&gt;&lt;/a&gt; provides any MCP client with access to a secure, isolated execution environment running on Cloudflare’s network where it can run and test code if your MCP client does not have a built in development environment (e.g. claude.ai). When building and generating application code, this lets the AI run its own commands and validate its assumptions in real time. &lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1rXgpQ3znIE01ccY1Qd2cQ/058902719a90af14175b8e838b09b78e/BLOG-2808_5.png\&quot; alt=\&quot;BLOG-2808 5\&quot; class=\&quot;kg-image\&quot; width=\&quot;657\&quot; height=\&quot;804\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;h4&gt;&lt;b&gt;Browser Rendering server: &lt;/b&gt;Fetch and convert web pages, take screenshots &lt;/h4&gt;&lt;p&gt;The &lt;a href=\&quot;https://developers.cloudflare.com/browser-rendering/\&quot;&gt;&lt;u&gt;Browser Rendering&lt;/u&gt;&lt;/a&gt; MCP server provides AI friendly tools from our &lt;a href=\&quot;https://developers.cloudflare.com/browser-rendering/rest-api/\&quot;&gt;&lt;u&gt;RESTful interface&lt;/u&gt;&lt;/a&gt; for common browser actions such as capturing screenshots, extracting HTML content, and converting pages to Markdown. These are particularly useful when building agents that require interacting with a web browser.&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/3aQtQxzj1hP6cbtbY4CHXI/27535e9f9a041187c12f6b41ba36afdb/BLOG-2808_6.png\&quot; alt=\&quot;BLOG-2808 6\&quot; class=\&quot;kg-image\&quot; width=\&quot;1999\&quot; height=\&quot;1515\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;h4&gt;&lt;b&gt;Radar server: &lt;/b&gt;Ask questions about how we see the Internet and Scan URLs&lt;/h4&gt;&lt;p&gt;The &lt;a href=\&quot;https://github.com/cloudflare/mcp-server-cloudflare/tree/main/apps/radar\&quot;&gt;&lt;u&gt;Cloudflare Radar MCP server&lt;/u&gt;&lt;/a&gt; exposes tools that allow any MCP client to explore our aggregated &lt;a href=\&quot;https://radar.cloudflare.com/traffic#http-traffic\&quot;&gt;&lt;u&gt;HTTP traffic data&lt;/u&gt;&lt;/a&gt;, get information on &lt;a href=\&quot;https://radar.cloudflare.com/traffic/as701\&quot;&gt;&lt;u&gt;Autonomous Systems&lt;/u&gt;&lt;/a&gt; (AS) and &lt;a href=\&quot;https://radar.cloudflare.com/ip/72.74.50.251\&quot;&gt;&lt;u&gt;IP addresses&lt;/u&gt;&lt;/a&gt;, list traffic anomalies from our &lt;a href=\&quot;https://radar.cloudflare.com/outage-center\&quot;&gt;&lt;u&gt;Outage Center&lt;/u&gt;&lt;/a&gt;, get &lt;a href=\&quot;https://radar.cloudflare.com/domains\&quot;&gt;&lt;u&gt;trending domains&lt;/u&gt;&lt;/a&gt;, and domain rank information. It can even create charts. Here’s a chat where we ask &amp;quot;show me the &lt;a href=\&quot;https://claude.ai/public/artifacts/34c8a494-abdc-4755-9ca7-cd8e0a8bea41\&quot;&gt;&lt;u&gt;HTTP traffic from Portugal&lt;/u&gt;&lt;/a&gt; for the last week&amp;quot;:&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/9yg9Fnkoz6t6QOwUK1a5r/b11756fd82058f04037740678160cc7c/BLOG-2808_7.png\&quot; alt=\&quot;BLOG-2808 7\&quot; class=\&quot;kg-image\&quot; width=\&quot;1999\&quot; height=\&quot;1515\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;h4&gt;&lt;b&gt;Logpush server: &lt;/b&gt;Get quick summaries for Logpush job health &lt;/h4&gt;&lt;p&gt;&lt;a href=\&quot;https://developers.cloudflare.com/logs/about/\&quot;&gt;&lt;u&gt;Logpush&lt;/u&gt;&lt;/a&gt; jobs deliver comprehensive logs to your destination of choice, allowing near real-time information processing. The Logpush MCP server can help you analyze your Logpush job results and understand your job health at a high level, allowing you to filter and narrow down for jobs or scenarios you care about. For example, you can ask “provide me with a list of recently failed jobs.” Now, you can quickly find out which jobs are failing with which error message and when, summarized in a human-readable format. &lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/4ltuXD2TgEhiblx6aNhm4d/d63b14f151fd3a239b0a3cf0dfb92ebf/BLOG-2808_8.png\&quot; alt=\&quot;BLOG-2808 8\&quot; class=\&quot;kg-image\&quot; width=\&quot;960\&quot; height=\&quot;946\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;h4&gt;&lt;b&gt;AI Gateway server: &lt;/b&gt;Check out your AI Gateway logs &lt;/h4&gt;&lt;p&gt;Use this &lt;a href=\&quot;https://github.com/cloudflare/mcp-server-cloudflare/tree/main/apps/ai-gateway\&quot;&gt;&lt;u&gt;MCP server&lt;/u&gt;&lt;/a&gt; to inspect your AI Gateway logs and get details about the data from your prompts and the AI models responses. In this example we ask our agent “What is my average latency for my AI Gateway logs in the &lt;i&gt;Cloudflare Radar&lt;/i&gt; account?”&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/7dYzkZ0cYcXPjFKlhdqkMp/52f2b7e62fe2bb05c91fc563738ddfc2/BLOG-2808_9.png\&quot; alt=\&quot;BLOG-2808 9\&quot; class=\&quot;kg-image\&quot; width=\&quot;549\&quot; height=\&quot;655\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;h4&gt;&lt;b&gt;AutoRAG server:&lt;/b&gt; List and search documents on your AutoRAGs&lt;/h4&gt;&lt;p&gt;Having AutoRAG RAGs available to query as MCP tools greatly expands the typical static one-shot retrieval​ and opens doors to use cases where the agent can dynamically decide if and when to retrieve information from one or more &lt;a href=\&quot;https://www.cloudflare.com/learning/ai/retrieval-augmented-generation-rag/\&quot;&gt;RAGs&lt;/a&gt;, combine them with other tools and APIs, cross-check information and generate a much more rich and complete final answer.&lt;/p&gt;&lt;p&gt;Here we have a RAG that has a few blog posts that talk about retrocomputers. If we ask &amp;quot;tell me about restoring an amiga 1000 using the blog-celso autorag&amp;quot; the agent will go into a sequence of &lt;a href=\&quot;https://claude.ai/share/18f1be31-9936-48c0-9de0-151d64f3534e\&quot;&gt;&lt;u&gt;reasoning steps&lt;/u&gt;&lt;/a&gt;:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;“Now that I have some information about Amiga 1000 restoration from blog-celso, let me search for more specific details.”&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;“Let me get more specific information about hardware upgrades and fixes for the Amiga 1000.”&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;“Let me get more information about the DiagROM and other tools used in the restoration.”&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;“Let me search for information about GBA1000 and other expansions mentioned in the blog.”&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;And finally, “Based on the comprehensive information I&amp;#39;ve gathered from the blog-celso AutoRAG, I can now provide you with a detailed guide on restoring an Amiga 1000.”&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;And at the end, it generates a very detailed answer based on all the data from all the queries:&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/4Z8BJSvd4x233FPZDePeSk/e59b8676a92f828d32feb1d28381a216/BLOG-2808_10.png\&quot; alt=\&quot;BLOG-2808 10\&quot; class=\&quot;kg-image\&quot; width=\&quot;1999\&quot; height=\&quot;1515\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;h4&gt;&lt;b&gt;Audit Logs server: &lt;/b&gt;Query audit logs and generate reports for review&lt;/h4&gt;&lt;p&gt;Audit Logs record detailed information about actions and events within a system, providing a transparent history of all activity. However, because these logs can be large and complex, it may take effort to query and reconstruct a clear sequence of events. The &lt;a href=\&quot;https://github.com/cloudflare/mcp-server-cloudflare/tree/main/apps/auditlogs\&quot;&gt;&lt;u&gt;Audit Logs MCP server&lt;/u&gt;&lt;/a&gt; helps by allowing you to query audit logs and generate reports. Common queries include if anything notable happened in a Cloudflare account under a user around a particular time of the day, or identifying whether any users used API keys to perform actions on the account. For example, you can ask “Were there any suspicious changes made to my Cloudflare account yesterday around lunchtime?” and obtain the following response: &lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/YdV73LhsCmjdQtOK8U7Ii/89f11db15e079190a234665ac4794754/BLOG-2808_11.png\&quot; alt=\&quot;BLOG-2808 11\&quot; class=\&quot;kg-image\&quot; width=\&quot;1282\&quot; height=\&quot;960\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;h4&gt;&lt;b&gt;DNS Analytics server: &lt;/b&gt;Optimize DNS performance and debug issues based on current set up&lt;/h4&gt;&lt;p&gt;&lt;a href=\&quot;https://www.cloudflare.com/application-services/products/analytics/\&quot;&gt;&lt;u&gt;Cloudflare’s DNS Analytics&lt;/u&gt;&lt;/a&gt; provides detailed insights into DNS traffic, which helps you monitor, analyze, and troubleshoot DNS performance and security across your domains. With Cloudflare’s &lt;a href=\&quot;https://github.com/cloudflare/mcp-server-cloudflare/tree/main/apps/dns-analytics\&quot;&gt;&lt;u&gt;DNS Analytics MCP server&lt;/u&gt;&lt;/a&gt;, you can review DNS configurations across all domains in your account, access comprehensive DNS performance reports, and receive recommendations for performance improvements. By leveraging documentation, the MCP server can help identify opportunities for improving performance. &lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/3X7w64xQvvFbv24HaFeLDv/3fefb7ff9e912207c5897200beefd26f/image4.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1498\&quot; height=\&quot;1514\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;h4&gt;&lt;b&gt;Digital Experience Monitoring server&lt;/b&gt;: Get quick insight on critical applications for your organization &lt;/h4&gt;&lt;p&gt;Cloudflare Digital Experience Monitoring (DEM) was built to help network professionals understand the performance and availability of their critical applications from self-hosted applications like Jira and Bitbucket to SaaS applications like Figma or Salesforce. The &lt;a href=\&quot;https://github.com/cloudflare/mcp-server-cloudflare/tree/main/apps/dex-analysis\&quot;&gt;&lt;u&gt;Digital Experience Monitoring MCP server&lt;/u&gt;&lt;/a&gt; fetches DEM test results to surface performance and availability trends within your Cloudflare One deployment, providing quick insights on users, applications, and the networks they are connected to. You can ask questions like: Which users had the worst experience? What times of the day were applications most and least performant? When do I see the most HTTP status errors? When do I see the shortest, longest, or most instability in the network path? &lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/7Ctxdt7tw04Rfzl9Ihxnkw/fc9c9ab553daa58f59e024dd66dd3dea/BLOG-2808_12.png\&quot; alt=\&quot;BLOG-2808 12\&quot; class=\&quot;kg-image\&quot; width=\&quot;1266\&quot; height=\&quot;1282\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;h4&gt;&lt;b&gt;CASB server&lt;/b&gt;: Insights from SaaS Integrations&lt;/h4&gt;&lt;p&gt;&lt;a href=\&quot;https://www.cloudflare.com/zero-trust/products/casb/\&quot;&gt;&lt;u&gt;Cloudflare CASB&lt;/u&gt;&lt;/a&gt; provides the ability to integrate with your organization’s &lt;a href=\&quot;https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/\&quot;&gt;&lt;u&gt;SaaS and cloud applications&lt;/u&gt;&lt;/a&gt; to discover assets and surface any security misconfigurations that may be present. A core task is helping security teams understand information about users, files, and other assets they care about that transcends any one SaaS application. The &lt;a href=\&quot;https://github.com/cloudflare/mcp-server-cloudflare/tree/main/apps/cloudflare-one-casb\&quot;&gt;&lt;u&gt;CASB MCP server&lt;/u&gt;&lt;/a&gt; can explore across users, files, and the many other asset categories to help understand relationships from data that can exist across many different integrations. A common query may include “Tell me about “Frank Meszaros” and what SaaS tools they appear to have accessed”.&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/3aJOta5YYZ1FqZyHF0wVnx/2c79512fb674eb2762395e5ccaac9700/BLOG-2808_13.png\&quot; alt=\&quot;BLOG-2808 13\&quot; class=\&quot;kg-image\&quot; width=\&quot;1008\&quot; height=\&quot;1148\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;get-started-with-our-mcp-servers\&quot;&gt;Get started with our MCP servers &lt;/h3&gt;\n            &lt;a href=\&quot;#get-started-with-our-mcp-servers\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;You can start using our Cloudflare MCP servers today! If you’d like to read more about specific tools available in each server, you can find them in our &lt;a href=\&quot;https://github.com/cloudflare/mcp-server-cloudflare/tree/main\&quot;&gt;&lt;u&gt;public GitHub repository&lt;/u&gt;&lt;/a&gt;. Each server is deployed to a server URL, such as&lt;/p&gt;&lt;p&gt;&lt;code&gt;https://observability.mcp.cloudflare.com/sse.&lt;/code&gt;&lt;/p&gt;&lt;p&gt;If your MCP client has first class support for remote MCP servers, the client will provide a way to accept the server URL directly within its interface. For example, if you are using &lt;a href=\&quot;https://claude.ai/settings/profile\&quot;&gt;&lt;u&gt;claude.ai&lt;/u&gt;&lt;/a&gt;, you can: &lt;/p&gt;&lt;ol&gt;&lt;li&gt;&lt;p&gt;Navigate to your &lt;a href=\&quot;https://claude.ai/settings/profile\&quot;&gt;&lt;u&gt;settings&lt;/u&gt;&lt;/a&gt; and add a new “Integration” by entering the URL of your MCP server&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Authenticate with Cloudflare&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Select the tools you’d like claude.ai to be able to call&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/5zWyWq2gS08CZsCQNB2fFZ/4e2c88abc90e11055159127e2abaf7b2/BLOG-2808_14.png\&quot; alt=\&quot;BLOG-2808 14\&quot; class=\&quot;kg-image\&quot; width=\&quot;1999\&quot; height=\&quot;567\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;If your client does not yet support remote MCP servers, you will need to set up its respective configuration file (mcp_config.json) using &lt;a href=\&quot;https://www.npmjs.com/package/mcp-remote\&quot;&gt;&lt;u&gt;mcp-remote&lt;/u&gt;&lt;/a&gt; to specify which servers your client can access.&lt;/p&gt;\n            &lt;pre class=\&quot;language-javascript\&quot;&gt;&lt;code class=\&quot;language-javascript\&quot;&gt;{\n\t&amp;quot;mcpServers&amp;quot;: {\n\t\t&amp;quot;cloudflare-observability&amp;quot;: {\n\t\t\t&amp;quot;command&amp;quot;: &amp;quot;npx&amp;quot;,\n\t\t\t&amp;quot;args&amp;quot;: [&amp;quot;mcp-remote&amp;quot;, &amp;quot;https://observability.mcp.cloudflare.com/sse&amp;quot;]\n\t\t},\n\t\t&amp;quot;cloudflare-bindings&amp;quot;: {\n\t\t\t&amp;quot;command&amp;quot;: &amp;quot;npx&amp;quot;,\n\t\t\t&amp;quot;args&amp;quot;: [&amp;quot;mcp-remote&amp;quot;, &amp;quot;https://bindings.mcp.cloudflare.com/sse&amp;quot;]\n\t\t}\n\t}\n}\n&lt;/pre&gt;&lt;/code&gt;\n            \n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;have-feedback-on-our-servers\&quot;&gt;Have feedback on our servers?&lt;/h3&gt;\n            &lt;a href=\&quot;#have-feedback-on-our-servers\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;While we&amp;#39;re launching with these initial 13 MCP servers, we are just getting started! We want to hear your feedback as we shape existing and build out more Cloudflare MCP servers that unlock the most value for your teams leveraging AI in their daily workflows. If you’d like to provide feedback, request a new MCP server, or report bugs, please raise an issue on our &lt;a href=\&quot;https://github.com/cloudflare/mcp-server-cloudflare/tree/main\&quot;&gt;&lt;u&gt;GitHub repository. &lt;/u&gt;&lt;/a&gt; &lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;building-your-own-mcp-server\&quot;&gt;Building your own MCP server?&lt;/h3&gt;\n            &lt;a href=\&quot;#building-your-own-mcp-server\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;If you’re interested in building your own servers, we&amp;#39;ve discovered valuable best practices that we&amp;#39;re excited to share with you as we’ve been building ours. While MCP is really starting to gain momentum and many organizations are just beginning to build their own servers, these principals should help guide you as you start building out MCP servers for your customers. &lt;/p&gt;&lt;ol&gt;&lt;li&gt;&lt;p&gt;&lt;b&gt;An MCP server is not our entire API schema: &lt;/b&gt;Our goal isn&amp;#39;t to build a large wrapper around all of Cloudflare’s API schema, but instead focus on optimizing for specific jobs to be done and reliability of the outcome. This means while one tool from our MCP server may map to one API, another tool may map to many. We’ve found that fewer but more powerful tools may be better for the agent with smaller context windows, less costs, a faster output, and likely more valid answers from LLMs. Our MCP servers were created directly by the product teams who are responsible for each of these areas of Cloudflare – application development, security and performance – and are designed with user stories in mind. This is a pattern you will continue to see us use as we build out more Cloudflare servers. &lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;b&gt;Specialize permissions with multiple servers:&lt;/b&gt; We built out several specialized servers rather than one for a critical reason: security through precise permission scoping. Each MCP server operates with exactly the permissions needed for its specific task – nothing more. By separating capabilities across multiple servers, each with its own authentication scope, we prevent the common security pitfall of over-privileged access. &lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;b&gt;Add robust server descriptions within parameters:&lt;/b&gt; Tool descriptions were core to providing helpful context to the agent. We’ve found that more detailed descriptions help the agent understand not just the expected data type, but also the parameter&amp;#39;s purpose, acceptable value ranges, and impact on server behavior. This context allows agents to make intelligent decisions about parameter values rather than providing arbitrary and potentially problematic inputs, allowing your natural language to go further with the agent. &lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;b&gt;Using evals at each iteration:&lt;/b&gt; For each server, we implemented evaluation tests or “evals” to assess the model&amp;#39;s ability to follow instructions, select appropriate tools, and provide correct arguments to those tools. This gave us a programmatic way to understand if any regressions occurred through each iteration, especially when tweaking tool descriptions. &lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;Ready to start building? Click the button below to deploy your first remote MCP server to production: &lt;/p&gt;&lt;a href=\&quot;https://deploy.workers.cloudflare.com/?url=https://github.com/cloudflare/ai/tree/main/demos/remote-mcp-authless\&quot;&gt;&lt;img src=\&quot;https://deploy.workers.cloudflare.com/button\&quot; alt=\&quot;Deploy to Cloudflare\&quot;/&gt;&lt;/a&gt;\n&lt;p&gt;&lt;p&gt;Or check out our documentation to learn more! If you have any questions or feedback for us, you can reach us via email at &lt;a href=\&quot;mailto:1800-mcp@cloudflare.com\&quot;&gt;&lt;u&gt;1800-mcp@cloudflare.com&lt;/u&gt;&lt;/a&gt; or join the chatter in the &lt;a href=\&quot;https://discord.com/channels/595317990191398933/1354548448635912324\&quot;&gt;&lt;u&gt;Cloudflare Developers Discord&lt;/u&gt;&lt;/a&gt;.&lt;/p&gt;&quot;],&quot;published_at&quot;:[0,&quot;2025-05-01T13:01:19.509Z&quot;],&quot;updated_at&quot;:[0,&quot;2025-06-06T20:37:20.946Z&quot;],&quot;feature_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/4PApvLyvZ23hcLXCAAte0k/8b31682bfe25ef4d6e8551e5c11555bf/BLOG-2808_1.png&quot;],&quot;tags&quot;:[1,[[0,{&quot;id&quot;:[0,&quot;6Wqde8DfPQiDn7CAhj6lu2&quot;],&quot;name&quot;:[0,&quot;Model Context Protocol&quot;],&quot;slug&quot;:[0,&quot;model-context-protocol&quot;]}],[0,{&quot;id&quot;:[0,&quot;6hbkItfupogJP3aRDAq6v8&quot;],&quot;name&quot;:[0,&quot;Cloudflare Workers&quot;],&quot;slug&quot;:[0,&quot;workers&quot;]}],[0,{&quot;id&quot;:[0,&quot;22RkiaggH3NV4u6qyMmC42&quot;],&quot;name&quot;:[0,&quot;Agents&quot;],&quot;slug&quot;:[0,&quot;agents&quot;]}],[0,{&quot;id&quot;:[0,&quot;3txfsA7N73yBL9g3VPBLL0&quot;],&quot;name&quot;:[0,&quot;Open Source&quot;],&quot;slug&quot;:[0,&quot;open-source&quot;]}],[0,{&quot;id&quot;:[0,&quot;6Lfy7VaNvl5G8gOYMKFiux&quot;],&quot;name&quot;:[0,&quot;MCP&quot;],&quot;slug&quot;:[0,&quot;mcp&quot;]}],[0,{&quot;id&quot;:[0,&quot;4HIPcb68qM0e26fIxyfzwQ&quot;],&quot;name&quot;:[0,&quot;Developers&quot;],&quot;slug&quot;:[0,&quot;developers&quot;]}],[0,{&quot;id&quot;:[0,&quot;3JAY3z7p7An94s6ScuSQPf&quot;],&quot;name&quot;:[0,&quot;Developer Platform&quot;],&quot;slug&quot;:[0,&quot;developer-platform&quot;]}]]],&quot;relatedTags&quot;:[0],&quot;authors&quot;:[1,[[0,{&quot;name&quot;:[0,&quot;Nevi Shah&quot;],&quot;slug&quot;:[0,&quot;nevi&quot;],&quot;bio&quot;:[0,null],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/2WVp9J8BoRJaBMR7crkqWH/f7814ed0df05b50babb47c6ff5b936e5/nevi.png&quot;],&quot;location&quot;:[0,null],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,&quot;@nevikashah&quot;],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}],[0,{&quot;name&quot;:[0,&quot;Maximo Guk &quot;],&quot;slug&quot;:[0,&quot;maximo-guk&quot;],&quot;bio&quot;:[0],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1hotGFbBMQzcqRxXZ7QBhR/fcf5b06d0a22c5e3146d3496af1ac80e/Maximo_Guk.jpg&quot;],&quot;location&quot;:[0],&quot;website&quot;:[0],&quot;twitter&quot;:[0],&quot;facebook&quot;:[0],&quot;publiclyIndex&quot;:[0,true]}],[0,{&quot;name&quot;:[0,&quot;Christian Sparks&quot;],&quot;slug&quot;:[0,&quot;christian&quot;],&quot;bio&quot;:[0,null],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/5QdnC6oyxIqp5KSZOyBAhS/0b43ca9c2f91ecb7828eecb3ee04e247/christian.JPG&quot;],&quot;location&quot;:[0,&quot;Chicago, IL&quot;],&quot;website&quot;:[0,&quot;https://cmsparks.com&quot;],&quot;twitter&quot;:[0,&quot;@csparks1919&quot;],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}]]],&quot;meta_description&quot;:[0,&quot;You can now connect to Cloudflare&#39;s first publicly available remote Model Context Protocol (MCP) servers from any MCP client that supports remote servers. &quot;],&quot;primary_author&quot;:[0,{}],&quot;localeList&quot;:[0,{&quot;name&quot;:[0,&quot;LOC: Thirteen new MCP servers from Cloudflare you can use today&quot;],&quot;enUS&quot;:[0,&quot;English for Locale&quot;],&quot;zhCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhHansCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhTW&quot;:[0,&quot;English for Locale&quot;],&quot;frFR&quot;:[0,&quot;No Page for Locale&quot;],&quot;deDE&quot;:[0,&quot;No Page for Locale&quot;],&quot;itIT&quot;:[0,&quot;No Page for Locale&quot;],&quot;jaJP&quot;:[0,&quot;Translated for Locale&quot;],&quot;koKR&quot;:[0,&quot;No Page for Locale&quot;],&quot;ptBR&quot;:[0,&quot;No Page for Locale&quot;],&quot;esLA&quot;:[0,&quot;No Page for Locale&quot;],&quot;esES&quot;:[0,&quot;No Page for Locale&quot;],&quot;enAU&quot;:[0,&quot;No Page for Locale&quot;],&quot;enCA&quot;:[0,&quot;No Page for Locale&quot;],&quot;enIN&quot;:[0,&quot;No Page for Locale&quot;],&quot;enGB&quot;:[0,&quot;No Page for Locale&quot;],&quot;idID&quot;:[0,&quot;No Page for Locale&quot;],&quot;ruRU&quot;:[0,&quot;No Page for Locale&quot;],&quot;svSE&quot;:[0,&quot;No Page for Locale&quot;],&quot;viVN&quot;:[0,&quot;No Page for Locale&quot;],&quot;plPL&quot;:[0,&quot;No Page for Locale&quot;],&quot;arAR&quot;:[0,&quot;No Page for Locale&quot;],&quot;nlNL&quot;:[0,&quot;English for Locale&quot;],&quot;thTH&quot;:[0,&quot;English for Locale&quot;],&quot;trTR&quot;:[0,&quot;English for Locale&quot;],&quot;heIL&quot;:[0,&quot;English for Locale&quot;],&quot;lvLV&quot;:[0,&quot;English for Locale&quot;],&quot;etEE&quot;:[0,&quot;English for Locale&quot;],&quot;ltLT&quot;:[0,&quot;English for Locale&quot;]}],&quot;url&quot;:[0,&quot;https://blog.cloudflare.com/thirteen-new-mcp-servers-from-cloudflare&quot;],&quot;metadata&quot;:[0,{&quot;title&quot;:[0],&quot;description&quot;:[0,&quot;You can now connect to Cloudflare&#39;s first publicly available remote Model Context Protocol (MCP) servers from any MCP client that supports remote servers. &quot;],&quot;imgPreview&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/9xfy9FKmYPkZue7bAS6qx/cab211b9bf14c7624277808baeb4a5ce/OG_Share_2024.png&quot;]}],&quot;publicly_index&quot;:[0,true]}]]],&quot;locale&quot;:[0,&quot;en-us&quot;],&quot;translations&quot;:[0,{&quot;posts.by&quot;:[0,&quot;By&quot;],&quot;footer.gdpr&quot;:[0,&quot;GDPR&quot;],&quot;lang_blurb1&quot;:[0,&quot;This post is also available in {lang1}.&quot;],&quot;lang_blurb2&quot;:[0,&quot;This post is also available in {lang1} and {lang2}.&quot;],&quot;lang_blurb3&quot;:[0,&quot;This post is also available in {lang1}, {lang2} and {lang3}.&quot;],&quot;footer.press&quot;:[0,&quot;Press&quot;],&quot;header.title&quot;:[0,&quot;The Cloudflare Blog&quot;],&quot;search.clear&quot;:[0,&quot;Clear&quot;],&quot;search.filter&quot;:[0,&quot;Filter&quot;],&quot;search.source&quot;:[0,&quot;Source&quot;],&quot;footer.careers&quot;:[0,&quot;Careers&quot;],&quot;footer.company&quot;:[0,&quot;Company&quot;],&quot;footer.support&quot;:[0,&quot;Support&quot;],&quot;footer.the_net&quot;:[0,&quot;theNet&quot;],&quot;search.filters&quot;:[0,&quot;Filters&quot;],&quot;footer.our_team&quot;:[0,&quot;Our team&quot;],&quot;footer.webinars&quot;:[0,&quot;Webinars&quot;],&quot;page.more_posts&quot;:[0,&quot;More posts&quot;],&quot;posts.time_read&quot;:[0,&quot;{time} min read&quot;],&quot;search.language&quot;:[0,&quot;Language&quot;],&quot;footer.community&quot;:[0,&quot;Community&quot;],&quot;footer.resources&quot;:[0,&quot;Resources&quot;],&quot;footer.solutions&quot;:[0,&quot;Solutions&quot;],&quot;footer.trademark&quot;:[0,&quot;Trademark&quot;],&quot;header.subscribe&quot;:[0,&quot;Subscribe&quot;],&quot;footer.compliance&quot;:[0,&quot;Compliance&quot;],&quot;footer.free_plans&quot;:[0,&quot;Free plans&quot;],&quot;footer.impact_ESG&quot;:[0,&quot;Impact/ESG&quot;],&quot;posts.follow_on_X&quot;:[0,&quot;Follow on X&quot;],&quot;footer.help_center&quot;:[0,&quot;Help center&quot;],&quot;footer.network_map&quot;:[0,&quot;Network Map&quot;],&quot;header.please_wait&quot;:[0,&quot;Please Wait&quot;],&quot;page.related_posts&quot;:[0,&quot;Related posts&quot;],&quot;search.result_stat&quot;:[0,&quot;Results &lt;strong&gt;{search_range}&lt;/strong&gt; of &lt;strong&gt;{search_total}&lt;/strong&gt; for &lt;strong&gt;{search_keyword}&lt;/strong&gt;&quot;],&quot;footer.case_studies&quot;:[0,&quot;Case Studies&quot;],&quot;footer.connect_2024&quot;:[0,&quot;Connect 2024&quot;],&quot;footer.terms_of_use&quot;:[0,&quot;Terms of Use&quot;],&quot;footer.white_papers&quot;:[0,&quot;White Papers&quot;],&quot;footer.cloudflare_tv&quot;:[0,&quot;Cloudflare TV&quot;],&quot;footer.community_hub&quot;:[0,&quot;Community Hub&quot;],&quot;footer.compare_plans&quot;:[0,&quot;Compare plans&quot;],&quot;footer.contact_sales&quot;:[0,&quot;Contact Sales&quot;],&quot;header.contact_sales&quot;:[0,&quot;Contact Sales&quot;],&quot;header.email_address&quot;:[0,&quot;Email Address&quot;],&quot;page.error.not_found&quot;:[0,&quot;Page not found&quot;],&quot;footer.developer_docs&quot;:[0,&quot;Developer docs&quot;],&quot;footer.privacy_policy&quot;:[0,&quot;Privacy Policy&quot;],&quot;footer.request_a_demo&quot;:[0,&quot;Request a demo&quot;],&quot;page.continue_reading&quot;:[0,&quot;Continue reading&quot;],&quot;footer.analysts_report&quot;:[0,&quot;Analyst reports&quot;],&quot;footer.for_enterprises&quot;:[0,&quot;For enterprises&quot;],&quot;footer.getting_started&quot;:[0,&quot;Getting Started&quot;],&quot;footer.learning_center&quot;:[0,&quot;Learning Center&quot;],&quot;footer.project_galileo&quot;:[0,&quot;Project Galileo&quot;],&quot;pagination.newer_posts&quot;:[0,&quot;Newer Posts&quot;],&quot;pagination.older_posts&quot;:[0,&quot;Older Posts&quot;],&quot;posts.social_buttons.x&quot;:[0,&quot;Discuss on X&quot;],&quot;search.icon_aria_label&quot;:[0,&quot;Search&quot;],&quot;search.source_location&quot;:[0,&quot;Source/Location&quot;],&quot;footer.about_cloudflare&quot;:[0,&quot;About Cloudflare&quot;],&quot;footer.athenian_project&quot;:[0,&quot;Athenian Project&quot;],&quot;footer.become_a_partner&quot;:[0,&quot;Become a partner&quot;],&quot;footer.cloudflare_radar&quot;:[0,&quot;Cloudflare Radar&quot;],&quot;footer.network_services&quot;:[0,&quot;Network services&quot;],&quot;footer.trust_and_safety&quot;:[0,&quot;Trust &amp; Safety&quot;],&quot;header.get_started_free&quot;:[0,&quot;Get Started Free&quot;],&quot;page.search.placeholder&quot;:[0,&quot;Search Cloudflare&quot;],&quot;footer.cloudflare_status&quot;:[0,&quot;Cloudflare Status&quot;],&quot;footer.cookie_preference&quot;:[0,&quot;Cookie Preferences&quot;],&quot;header.valid_email_error&quot;:[0,&quot;Must be valid email.&quot;],&quot;search.result_stat_empty&quot;:[0,&quot;Results &lt;strong&gt;{search_range}&lt;/strong&gt; of &lt;strong&gt;{search_total}&lt;/strong&gt;&quot;],&quot;footer.connectivity_cloud&quot;:[0,&quot;Connectivity cloud&quot;],&quot;footer.developer_services&quot;:[0,&quot;Developer services&quot;],&quot;footer.investor_relations&quot;:[0,&quot;Investor relations&quot;],&quot;page.not_found.error_code&quot;:[0,&quot;Error Code: 404&quot;],&quot;search.autocomplete_title&quot;:[0,&quot;Insert a query. Press enter to send&quot;],&quot;footer.logos_and_press_kit&quot;:[0,&quot;Logos &amp; press kit&quot;],&quot;footer.application_services&quot;:[0,&quot;Application services&quot;],&quot;footer.get_a_recommendation&quot;:[0,&quot;Get a recommendation&quot;],&quot;posts.social_buttons.reddit&quot;:[0,&quot;Discuss on Reddit&quot;],&quot;footer.sse_and_sase_services&quot;:[0,&quot;SSE and SASE services&quot;],&quot;page.not_found.outdated_link&quot;:[0,&quot;You may have used an outdated link, or you may have typed the address incorrectly.&quot;],&quot;footer.report_security_issues&quot;:[0,&quot;Report Security Issues&quot;],&quot;page.error.error_message_page&quot;:[0,&quot;Sorry, we can&#39;t find the page you are looking for.&quot;],&quot;header.subscribe_notifications&quot;:[0,&quot;Subscribe to receive notifications of new posts:&quot;],&quot;footer.cloudflare_for_campaigns&quot;:[0,&quot;Cloudflare for Campaigns&quot;],&quot;header.subscription_confimation&quot;:[0,&quot;Subscription confirmed. Thank you for subscribing!&quot;],&quot;posts.social_buttons.hackernews&quot;:[0,&quot;Discuss on Hacker News&quot;],&quot;footer.diversity_equity_inclusion&quot;:[0,&quot;Diversity, equity &amp; inclusion&quot;],&quot;footer.critical_infrastructure_defense_project&quot;:[0,&quot;Critical Infrastructure Defense Project&quot;]}],&quot;localesAvailable&quot;:[1,[]],&quot;footerBlurb&quot;:[0,&quot;Cloudflare&#39;s connectivity cloud protects &lt;a target=&#39;_blank&#39; href=&#39;https://www.cloudflare.com/network-services/&#39; rel=&#39;noreferrer&#39;&gt;entire corporate networks&lt;/a&gt;, helps customers build &lt;a target=&#39;_blank&#39; href=&#39;https://workers.cloudflare.com/&#39; rel=&#39;noreferrer&#39;&gt;Internet-scale applications efficiently&lt;/a&gt;, accelerates any &lt;a target=&#39;_blank&#39; href=&#39;https://www.cloudflare.com/performance/accelerate-internet-applications/&#39; rel=&#39;noreferrer&#39;&gt;website or Internet application&lt;/a&gt;, &lt;a target=&#39;_blank&#39; href=&#39;https://www.cloudflare.com/ddos/&#39; rel=&#39;noreferrer&#39;&gt;wards off DDoS attacks&lt;/a&gt;, keeps &lt;a target=&#39;_blank&#39; href=&#39;https://www.cloudflare.com/application-security/&#39; rel=&#39;noreferrer&#39;&gt;hackers at bay&lt;/a&gt;, and can help you on &lt;a target=&#39;_blank&#39; href=&#39;https://www.cloudflare.com/products/zero-trust/&#39; rel=&#39;noreferrer&#39;&gt;your journey to Zero Trust&lt;/a&gt;.&lt;br/&gt;&lt;br/&gt;Visit &lt;a target=&#39;_blank&#39; href=&#39;https://one.one.one.one/&#39; rel=&#39;noreferrer&#39;&gt;1.1.1.1&lt;/a&gt; from any device to get started with our free app that makes your Internet faster and safer.&lt;br/&gt;&lt;br/&gt;To learn more about our mission to help build a better Internet, &lt;a target=&#39;_blank&#39; href=&#39;https://www.cloudflare.com/learning/what-is-cloudflare/&#39; rel=&#39;noreferrer&#39;&gt;start here&lt;/a&gt;. If you&amp;apos;re looking for a new career direction, check out &lt;a target=&#39;_blank&#39; href=&#39;http://www.cloudflare.com/careers&#39; rel=&#39;noreferrer&#39;&gt;our open positions&lt;/a&gt;.&quot;]}" ssr client="load" opts="{&quot;name&quot;:&quot;Post&quot;,&quot;value&quot;:true}" await-children><main id="post" class="flex flex-row flex-wrap items-center justify-center pt2 pt4-l"><article class="post-full mw-100 ph3 ph0-l fs-20px"><h1 class="f6 f7-l fw4 gray1 pt1 pt3-l mb1">We shipped FinalizationRegistry in Workers: why you should never use it</h1><p class="f3 fw5 gray5 db di-l mt2">2025-06-11</p><ul class="author-lists flex pl0 mt4"><li class="list flex items-center pr2 mb1-ns"><a href="/author/ketan-gupta/" class="static-avatar pr1"><img class="author-profile-image br-100 mr2" src="https://blog.cloudflare.com/cdn-cgi/image/format=auto,dpr=3,width=64,height=64,gravity=face,fit=crop,zoom=0.5/https://cf-assets.www.cloudflare.com/zkvhlag99gkb/4HNGL8tqmoWI8yZJEEynzY/4dc4778dc00d47cc7da853c61c224fd7/Ketan_Gupta.webp" alt="Ketan Gupta" width="62" height="62"/></a><div class="author-name-tooltip"><a href="/author/ketan-gupta/" class="fw4 f3 no-underline black mr3">Ketan Gupta</a></div></li><li class="list flex items-center pr2 mb1-ns"><a href="/author/harris-hancock/" class="static-avatar pr1"><img class="author-profile-image br-100 mr2" src="https://blog.cloudflare.com/cdn-cgi/image/format=auto,dpr=3,width=64,height=64,gravity=face,fit=crop,zoom=0.5/https://cf-assets.www.cloudflare.com/zkvhlag99gkb/kl1szOUahVoAesAqM5x8w/18cf3fe1108e24731361523b5c51e45c/Harris_Hancock.webp" alt="Harris Hancock" width="62" height="62"/></a><div class="author-name-tooltip"><a href="/author/harris-hancock/" class="fw4 f3 no-underline black mr3">Harris Hancock</a></div></li></ul><section class="post-full-content"><div class="mb2 gray5">9 min read</div><img class="mr2" src="https://cf-assets.www.cloudflare.com/zkvhlag99gkb/7cLMMILFb6WD9qrMUeJoWO/57652dbdb6f77038eedffd08bef442e4/image4.png" alt=""/><div class="post-content lh-copy gray1"><p>We’ve recently added support for the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/FinalizationRegistry"><u>FinalizationRegistry API</u></a> in Cloudflare Workers. This API allows developers to request a callback when a JavaScript object is garbage-collected, a feature that can be particularly relevant for managing external resources, such as memory allocated by <a href="https://developer.mozilla.org/en-US/docs/WebAssembly"><u>WebAssembly</u></a> (Wasm). However, despite its availability, our general advice is: <b>avoid using it directly in most scenarios.</b></p><p>Our decision to add <code>FinalizationRegistry</code> — while still cautioning against using it — opens up a bigger conversation: how memory management works when JavaScript and WebAssembly share the same runtime. This is becoming more common in high-performance web apps, and getting it wrong can lead to memory leaks, out-of-memory errors, and performance issues, especially in resource-constrained environments like Cloudflare Workers.</p><p>In this post, we’ll look at how JavaScript and Wasm handle memory differently, why that difference matters, and what <code>FinalizationRegistry</code> is actually useful for. We’ll also explain its limitations, particularly around timing and predictability, walk through why we decided to support it, and how we’ve made it safer to use. Finally, we’ll talk about how newer JavaScript language features offer a more reliable and structured approach to solving these problems.</p>
          <div class="flex anchor relative">
            <h2 id="memory-management-101">Memory management 101</h2>
            <a href="#memory-management-101" aria-hidden="true" class="relative sm:absolute sm:-left-5">
              <svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg>
            </a>
          </div>
          
          <div class="flex anchor relative">
            <h3 id="javascript">JavaScript</h3>
            <a href="#javascript" aria-hidden="true" class="relative sm:absolute sm:-left-5">
              <svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg>
            </a>
          </div>
        <p>JavaScript relies on automatic memory management through a process called <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Memory_management#garbage_collection"><u>garbage collection</u></a>. This means developers do not need to worry about freeing allocated memory, or lifetimes. The garbage collector identifies and reclaims memory occupied by objects that are no longer needed by the program (that is, garbage). This helps prevent memory leaks and simplifies memory management for developers.</p>
            <pre class="language-JavaScript"><code class="language-JavaScript">function greet() {
  let name = &quot;Alice&quot;;         // String is allocated in memory
  console.log(&quot;Hello, &quot; + name);
}                             // &#039;name&#039; goes out of scope

greet();
// JavaScript automatically frees allocated memory at some point in future</pre></code>
            
          <div class="flex anchor relative">
            <h3 id="webassembly">WebAssembly</h3>
            <a href="#webassembly" aria-hidden="true" class="relative sm:absolute sm:-left-5">
              <svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg>
            </a>
          </div>
        <p>WebAssembly (Wasm) is an assembly-like instruction format designed to run high-performance applications on the web. While it initially gained prominence in web browsers, Wasm is also highly effective on the server side. At Cloudflare, we leverage Wasm to enable users to run code written in a variety of programming languages, such as <a href="https://developers.cloudflare.com/workers/languages/rust/"><u>Rust</u></a> and <a href="https://developers.cloudflare.com/workers/languages/python/"><u>Python</u></a>, directly within our <a href="https://www.cloudflare.com/learning/serverless/glossary/what-is-chrome-v8/"><u>V8 isolates</u></a>, offering both performance and versatility.</p><p>Wasm runtimes are designed to be simple stack machines, and lack built-in garbage collectors. This necessitates manual memory management (allocation and deallocation of memory used by Wasm code), making it an ideal compilation target for languages like Rust and C++ that handle their own memory.</p><p>Wasm modules operate on <a href="https://webassembly.github.io/spec/core/exec/runtime.html#memory-instances"><u>linear memory</u></a>: a resizable block of raw bytes, which JavaScript views as an <a href="https://developer.mozilla.org/en-US/docs/WebAssembly/Reference/JavaScript_interface/Memory"><u>ArrayBuffer</u></a>. This memory is organized in 64 KB pages, and its initial size is defined when the module is compiled or loaded. Wasm code interacts with this memory using 32-bit offsets — integer values functioning as direct pointers that specify a byte offset from the start of its linear memory. This direct memory access model is crucial for Wasm&#39;s high performance. The host environment (which in Cloudflare Workers is JavaScript) also shares this ArrayBuffer, reading and writing (often via <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/TypedArray"><u>TypedArrays</u></a>) to enable vital data exchange between Wasm and JavaScript.</p>
          <figure class="kg-card kg-image-card">
          <Image src="https://cf-assets.www.cloudflare.com/zkvhlag99gkb/3nWyMj5xginVWLxCnPpUdY/f939bb0b4f0007999aff876854645f16/image3.png" alt="" class="kg-image" width="1494" height="672" loading="lazy"/>
          </figure><p>A core Wasm design is its <a href="https://webassembly.org/docs/security/"><u>secure sandbox</u></a>. This confines Wasm code strictly to its own linear memory and explicitly declared imports from the host, preventing unauthorized memory access or system calls. Direct interaction with JavaScript objects is blocked; communication occurs through numeric values, function references, or operations on the shared ArrayBuffer. This strong isolation is vital for security, ensuring Wasm modules don&#39;t interfere with the host or other application components, which is especially important in multi-tenant environments like Cloudflare Workers.</p>
          <figure class="kg-card kg-image-card">
          <Image src="https://cf-assets.www.cloudflare.com/zkvhlag99gkb/3Ck9v7opkB5Mg1agKNnQm7/c328cc0a2d1c3145a527e1267594fe1d/image2.png" alt="" class="kg-image" width="1984" height="844" loading="lazy"/>
          </figure><p>Bridging WebAssembly memory with JavaScript often involves writing low-level &quot;glue&quot; code to convert raw byte arrays from Wasm into usable JavaScript types. Doing this manually for every function or data structure is both tedious and error-prone. Fortunately, tools like <a href="https://rustwasm.github.io/wasm-bindgen/"><u>wasm-bindgen</u></a> and <a href="https://emscripten.org/"><u>Emscripten (Embind)</u></a> handle this interop automatically, generating the binding code needed to pass data cleanly between the two environments. We use these same tools under the hood — wasm-bindgen for Rust-based <a href="https://github.com/cloudflare/workers-rs"><u>workers-rs</u></a> projects, and Emscripten for <a href="https://developers.cloudflare.com/workers/languages/python/how-python-workers-work/"><u>Python Workers</u></a> — to simplify integration and let developers focus on application logic rather than memory translation.</p>
          <div class="flex anchor relative">
            <h2 id="interoperability">Interoperability</h2>
            <a href="#interoperability" aria-hidden="true" class="relative sm:absolute sm:-left-5">
              <svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg>
            </a>
          </div>
          <p>High-performance web apps often use JavaScript for interactive UIs and data fetching, while WebAssembly handles demanding operations like media processing and complex calculations for significant performance gains, allowing developers to maximize efficiency. Given the difference in memory management models, developers need  to be careful when using WebAssembly memory in JavaScript.</p><p>For this example, we&#39;ll use Rust to compile a WebAssembly module manually. Rust is a popular choice for WebAssembly because it offers precise control over memory and easy Wasm compilation using standard toolchains.</p>
          <div class="flex anchor relative">
            <h3 id="rust">Rust</h3>
            <a href="#rust" aria-hidden="true" class="relative sm:absolute sm:-left-5">
              <svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg>
            </a>
          </div>
        <p>Here we have two simple functions. <code>make_buffer</code> creates a string and returns a raw pointer back to JavaScript. The function intentionally “forgets” the memory allocated so that it doesn’t get cleaned up after the function returns. <code>free_buffer</code>, on the other hand, expects the initial string reference handed back and frees the memory.</p>
            <pre class="language-Rust"><code class="language-Rust">// Allocate a fresh byte buffer and hand the raw pointer + length to JS.
// *We intentionally “forget” the Vec so Rust will not free it right away;
//   JS now owns it and must call `free_buffer` later.*
#[no_mangle]
pub extern &quot;C&quot; fn make_buffer(out_len: *mut usize) -&gt; *mut u8 {
    let mut data = b&quot;Hello from Rust&quot;.to_vec();
    let ptr = data.as_mut_ptr();
    let len  = data.len();

    unsafe { *out_len = len };

    std::mem::forget(data);
    return ptr;
}

/// Counterpart that **must** be called by JS to avoid a leak.
#[no_mangle]
pub unsafe extern &quot;C&quot; fn free_buffer(ptr: *mut u8, len: usize) {
    let _ = Vec::from_raw_parts(ptr, len, len);
}</pre></code>
            
          <div class="flex anchor relative">
            <h3 id="javascript">JavaScript</h3>
            <a href="#javascript" aria-hidden="true" class="relative sm:absolute sm:-left-5">
              <svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg>
            </a>
          </div>
        <p>Back in JavaScript land, we’ll call these Wasm functions and output them using console.log. This is a common pattern in Wasm-based applications since WebAssembly doesn’t have direct access to Web APIs, and rely on a JavaScript “glue” to interface with the outer world in order to do anything useful.</p>
            <pre class="language-JavaScript"><code class="language-JavaScript">const { instance } = await WebAssembly.instantiate(WasmBytes, {});

const { memory, make_buffer, free_buffer } = instance.exports;

//  Use the Rust functions
const lenPtr = 0;                 // scratch word in Wasm memory
const ptr = make_buffer(lenPtr);

const len = new DataView(memory.buffer).getUint32(lenPtr, true);
const data = new Uint8Array(memory.buffer, ptr, len);

console.log(new TextDecoder().decode(data)); // “Hello from Rust”

free_buffer(ptr, len); // free_buffer must be called to prevent memory leaks</pre></code>
            <p>You can find all code samples along with setup instructions <a href="https://github.com/cloudflare/cloudflare-blog/tree/master/2025-06-finalization-registry"><u>here</u></a>.</p><p>As you can see, working with Wasm memory from JavaScript requires care, as it introduces the risk of memory leaks if allocated memory isn’t properly released. JavaScript developers are often unfamiliar with manual memory management, and it’s easy to forget returning memory to WebAssembly after use. This can become especially tricky when Wasm-allocated data is passed into JavaScript libraries, making ownership and lifetime harder to track.</p><p>While occasional leaks may not cause immediate issues, over time they can lead to increased memory usage and degrade performance, particularly in memory-constrained environments like Cloudflare Workers.</p>
          <div class="flex anchor relative">
            <h2 id="finalizationregistry">FinalizationRegistry</h2>
            <a href="#finalizationregistry" aria-hidden="true" class="relative sm:absolute sm:-left-5">
              <svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg>
            </a>
          </div>
          <p><code>FinalizationRegistry</code>, introduced as part of the <a href="https://tc39.es/proposal-weakrefs/"><u>TC-39 WeakRef proposal</u></a>, is a JavaScript API which lets you run “finalizers” (aka cleanup callbacks) when an object gets garbage-collected. Let’s look at a simple example to demonstrate the API:</p>
            <pre class="language-JavaScript"><code class="language-JavaScript">const my_registry = new FinalizationRegistry((obj) =&gt; { console.log(&quot;Cleaned up: &quot; + obj); });

{
  let temporary = { key: &quot;value&quot; };
  // Register this object in our FinalizationRegistry -- the second argument,
  // &quot;temporary&quot;, will be passed to our callback as its obj parameter
  my_registry.register(temporary, &quot;temporary&quot;);
}

// At some point in the future when temporary object gets garbage collected, we&#039;ll see &quot;Cleaned up: temporary&quot; in our logs.</pre></code>
            <p>Let’s see how we can use this API in our Wasm-based application:</p>
            <pre class="language-JavaScript"><code class="language-JavaScript">const { instance } = await WebAssembly.instantiate(WasmBytes, {});

const { memory, make_buffer, free_buffer } = instance.exports;

// FinalizationRegistry would be responsible for returning memory back to Wasm
const cleanupFr = new FinalizationRegistry(({ ptr, len }) =&gt; {
  free_buffer(ptr, len);
});

//  Use the Rust functions
const lenPtr = 0;                 // scratch word in Wasm memory
const ptr = make_buffer(lenPtr);

const len = new DataView(memory.buffer).getUint32(lenPtr, true);
const data = new Uint8Array(memory.buffer, ptr, len);

// Register the data buffer in our FinalizationRegistry so that it gets cleaned up automatically
cleanupFr.register(data, { ptr, len });

console.log(new TextDecoder().decode(data));   // → “Hello from Rust”

// No need to manually call free_buffer, FinalizationRegistry will do this for us</pre></code>
            <p>We can use a <code>FinalizationRegistry</code> to manage any object borrowed from WebAssembly by registering it with a finalizer that calls the appropriate free function. This is the same approach used by <a href="https://rustwasm.github.io/docs/wasm-bindgen/reference/weak-references.html"><u>wasm-bindgen</u></a>. It shifts the burden of manual cleanup away from the JavaScript developer and delegates it to the JavaScript garbage collector. However, in practice, things aren’t quite that simple.</p>
          <div class="flex anchor relative">
            <h2 id="inherent-issues-with-finalizationregistry">Inherent issues with FinalizationRegistry</h2>
            <a href="#inherent-issues-with-finalizationregistry" aria-hidden="true" class="relative sm:absolute sm:-left-5">
              <svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg>
            </a>
          </div>
          <p>There is a fundamental issue with <code>FinalizationRegistry</code>: garbage collection is non-deterministic, and may clean up your unused memory at some arbitrary point in the future. In some cases, garbage collection might not even run and your “finalizers” will never be triggered.</p><p>This is part of its <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/FinalizationRegistry#notes_on_cleanup_callbacks"><u>documentation</u></a> as well:</p><blockquote><p><i>“A conforming JavaScript implementation, even one that does garbage collection, is not required to call cleanup callbacks. When and whether it does so is entirely down to the implementation of the JavaScript engine. When a registered object is reclaimed, any cleanup callbacks for it may be called then, or some time later, or not at all.”</i></p></blockquote><p>Even Emscripten mentions this in their <a href="https://emscripten.org/docs/porting/connecting_cpp_and_javascript/embind.html#automatic-memory-management"><u>documentation</u></a>: “<i>... finalizers are not guaranteed to be called, and even if they are, there are no guarantees about their timing or order of execution, which makes them unsuitable for general RAII-style resource management.</i>”</p><p>Given their non-deterministic nature, developers seldom use finalizers for any essential program logic. Treat them as a last-ditch safety net, not as a primary cleanup mechanism — explicit, deterministic teardown logic is almost always safer, faster, and easier to reason about.</p>
          <div class="flex anchor relative">
            <h2 id="enabling-finalizationregistry-in-workers">Enabling FinalizationRegistry in Workers</h2>
            <a href="#enabling-finalizationregistry-in-workers" aria-hidden="true" class="relative sm:absolute sm:-left-5">
              <svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg>
            </a>
          </div>
          <p>Given its non-deterministic nature and limited early adoption, we initially disabled the <code>FinalizationRegistry</code> API in our runtime. However, as usage of Wasm-based Workers grew — particularly among high-traffic customers — we began to see new demands emerge. One such customer was running an extremely high requests per second (RPS) workload using WebAssembly, and needed tight control over memory to sustain massive traffic spikes without degradation. This highlighted a gap in our memory management capabilities, especially in cases where manual cleanup wasn’t always feasible or reliable. As a result, we re-evaluated our stance and began exploring the challenges and trade-offs of enabling <code>FinalizationRegistry</code> within the Workers environment, despite its known limitations.</p>
          <div class="flex anchor relative">
            <h3 id="preventing-footguns-with-safe-defaults">Preventing footguns with safe defaults</h3>
            <a href="#preventing-footguns-with-safe-defaults" aria-hidden="true" class="relative sm:absolute sm:-left-5">
              <svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg>
            </a>
          </div>
        <p>Because this API could be misused and cause unpredictable results for our customers, we’ve added a few safeguards. Most importantly, cleanup callbacks are run without an active async context, which means they cannot perform any I/O. This includes sending events to a tail Worker, logging metrics, or making fetch requests.</p><p>While this might sound limiting, it’s very intentional. Finalization callbacks are meant for cleanup — especially for releasing WebAssembly memory — not for triggering side effects. If we allowed I/O here, developers might (accidentally) rely on finalizers to perform critical logic that depends on when garbage collection happens. That timing is non-deterministic and outside your control, which could lead to flaky, hard-to-debug behavior.</p><p>We don’t have full control over when V8’s garbage collector performs cleanup, but V8 does let us nudge the timing of finalizer execution. Like Node and Deno, Workers queue <code>FinalizationRegistry</code> jobs only after the microtask queue has drained, so each cleanup batch slips into the quiet slots between I/O phases of the event loop.</p>
          <figure class="kg-card kg-image-card">
          <Image src="https://cf-assets.www.cloudflare.com/zkvhlag99gkb/69QSYwmiAueWyP2KlvBwGi/183345cbb043acbe4d76c0fdb2ebf4dd/image1.png" alt="" class="kg-image" width="1992" height="344" loading="lazy"/>
          </figure>
          <div class="flex anchor relative">
            <h3 id="security-concerns">Security concerns</h3>
            <a href="#security-concerns" aria-hidden="true" class="relative sm:absolute sm:-left-5">
              <svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg>
            </a>
          </div>
        <p>The Cloudflare Workers runtime is <a href="https://blog.cloudflare.com/mitigating-spectre-and-other-security-threats-the-cloudflare-workers-security-model"><u>specifically engineered</u></a> to prevent side-channel attacks in a multi-tenant environment. Prior to enabling the <code>FinalizationRegistry</code> API, we did a thorough analysis to assess its impact on our security model and determine the necessity of additional safeguards. The non-deterministic nature of <code>FinalizationRegistry</code> raised concerns about potential information leaks leading to Spectre-like vulnerabilities, particularly regarding the possibility of exploiting the garbage collector (GC) as a confused deputy or using it to create a timer.</p><h4>GC as confused deputy</h4><p>One concern was whether the garbage collector (GC) could act as a confused deputy — a security antipattern where a privileged component is tricked into misusing its authority on behalf of untrusted code. In theory, a clever attacker could try to exploit the GC&#39;s ability to access internal object lifetimes and memory behavior in order to infer or manipulate sensitive information across isolation boundaries.</p><p>However, our analysis indicated that the V8 GC is effectively contained and not exposed to confused deputy risks within the runtime. This is attributed to our existing threat models and security measures, such as the isolation of user code, where the V8 Isolate serves as the primary security boundary. Furthermore, even though FinalizationRegistry involves some internal GC mechanics, the callbacks themselves execute in the same isolate that registered them — never across isolates — ensuring isolation remains intact.</p><h4>GC as timer</h4><p>We also evaluated the possibility of using FinalizationRegistry as a high-resolution timing mechanism — a common vector in side-channel attacks like Spectre. The concern here is that an attacker could schedule object finalization in a way that indirectly leaks information via the timing of callbacks.</p><p>In practice, though, the resolution of such a &quot;GC timer&quot; is low and highly variable, offering poor reliability for side-channel attacks. Additionally, we control when finalizer callbacks are scheduled — delaying them until after the microtask queue has drained — giving us an extra layer of control to limit timing precision and reduce risk.</p><p>Following a review with our security research team, we determined that our existing security model is sufficient to support this API.</p>
          <div class="flex anchor relative">
            <h2 id="predictable-cleanups">Predictable cleanups?</h2>
            <a href="#predictable-cleanups" aria-hidden="true" class="relative sm:absolute sm:-left-5">
              <svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg>
            </a>
          </div>
          <p>JavaScript&#39;s <a href="https://tc39.es/proposal-explicit-resource-management/"><u>Explicit Resource Management</u></a> proposal introduces a deterministic approach to handle resources needing manual cleanup, such as file handles, network connections, or database sessions. Drawing inspiration from constructs like C#&#39;s <a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/using"><u>using</u></a> and Python&#39;s <a href="https://docs.python.org/3/reference/compound_stmts.html#with"><u>with</u></a>, this proposal introduces the using and <code>await using</code> syntax. This new syntax guarantees that objects adhering to a specific cleanup protocol are automatically disposed of when they are no longer within their scope.</p><p>Let’s look at a simple example to understand it a bit better.</p>
            <pre class="language-JavaScript"><code class="language-JavaScript">class MyResource {
  [Symbol.dispose]() {
    console.log(&quot;Resource cleaned up!&quot;);
  }

  use() {
    console.log(&quot;Using the resource...&quot;);
  }
}

{
  using res = new MyResource();
  res.use();
} // When this block ends, Symbol.dispose is called automatically (and deterministically).</pre></code>
            <p>The proposal also includes additional features that offer finer control over when dispose methods are called. But at a high level, it provides a much-needed, deterministic way to manage resource cleanup. Let’s now update our earlier WebAssembly-based example to take advantage of this new mechanism instead of relying on <code>FinalizationRegistry</code>:</p>
            <pre class="language-JavaScript"><code class="language-JavaScript">const { instance } = await WebAssembly.instantiate(WasmBytes, {});
const { memory, make_buffer, free_buffer } = instance.exports;

class WasmBuffer {
  constructor(ptr, len) {
    this.ptr = ptr;
    this.len = len;
  }

  [Symbol.dispose]() {
    free_buffer(this.ptr, this.len);
  }
}

{
  const lenPtr = 0;
  const ptr = make_buffer(lenPtr);
  const len = new DataView(memory.buffer).getUint32(lenPtr, true);

  using buf = new WasmBuffer(ptr, len);

  const data = new Uint8Array(memory.buffer, ptr, len);
  console.log(new TextDecoder().decode(data));  // → “Hello from Rust”
} // Symbol.dispose or free_buffer gets called deterministically here</pre></code>
            <p>Explicit Resource Management provides a more dependable way to clean up resources than <code>FinalizationRegistry</code>, as it runs cleanup logic — such as calling <code>free_buffer</code> in WasmBuffer via <code>[Symbol.dispose]()</code> and the <code>using</code> syntax — deterministically, rather than relying on the garbage collector’s unpredictable timing. This makes it a more reliable choice for managing critical resources, especially memory.</p>
          <div class="flex anchor relative">
            <h2 id="future">Future</h2>
            <a href="#future" aria-hidden="true" class="relative sm:absolute sm:-left-5">
              <svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg>
            </a>
          </div>
          <p>Emscripten <a href="https://emscripten.org/docs/porting/connecting_cpp_and_javascript/embind.html#automatic-memory-management"><u>already makes use</u></a> of Explicit Resource Management for handling Wasm memory, using <code>FinalizationRegistry</code> as a last resort, while wasm-bindgen <a href="https://github.com/rustwasm/wasm-bindgen/pull/4118"><u>supports it in experimental mode</u></a>. The proposal has seen growing adoption across the ecosystem and was recently conditionally advanced to Stage 4 in the TC39 process, meaning it’ll soon officially be part of the JavaScript language standard. This reflects a broader shift toward more predictable and structured memory cleanup in WebAssembly applications.</p><p>We <a href="https://developers.cloudflare.com/workers/platform/changelog/#2025-05-22"><u>recently added support</u></a> for this feature in Cloudflare Workers as well, enabling developers to take advantage of deterministic resource cleanup in edge environments. As support for the feature matures, it&#39;s likely to become a standard practice for managing linear memory safely and reliably.</p>
          <div class="flex anchor relative">
            <h3 id="finalizationregistry-still-not-dead-yet">FinalizationRegistry: still not dead yet?</h3>
            <a href="#finalizationregistry-still-not-dead-yet" aria-hidden="true" class="relative sm:absolute sm:-left-5">
              <svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg>
            </a>
          </div>
        <p>Explicit Resource Management brings much-needed structure and predictability to resource cleanup in WebAssembly and JavaScript interop applications, but it doesn’t make <code>FinalizationRegistry</code> obsolete. There are still important use cases, particularly when a Wasm-allocated object’s lifecycle is out of your hands or when explicit disposal isn’t practical. In scenarios involving third-party libraries, dynamic lifecycles, or integration layers that don’t follow <code>using</code> patterns, <code>FinalizationRegistry</code> remains a valuable fallback to prevent memory leaks.</p><p>Looking ahead, a hybrid approach will likely become the standard in Wasm-JavaScript applications. Developers can use ERM for deterministic cleanup of Wasm memory and other resources, while relying on <code>FinalizationRegistry</code> as a safety net when full control isn’t possible. Together, they offer a more reliable and flexible foundation for managing memory across the JavaScript and WebAssembly boundary.</p><p>Ready to try it yourself? Deploy a <a href="https://developers.cloudflare.com/workers/runtime-apis/webassembly/"><u>WebAssembly-powered Worker</u></a> and experiment with memory management — start building with <a href="https://developers.cloudflare.com/workers/"><u>Cloudflare Workers</u></a> today.</p></div></section><section class="post-full-content flex flex-row flex-wrap mw7 center mb4"><div class="post-content lh-copy w-100 gray1 bt b--gray8 pt4">Cloudflare's connectivity cloud protects <a target='_blank' href='https://www.cloudflare.com/network-services/' rel='noreferrer'>entire corporate networks</a>, helps customers build <a target='_blank' href='https://workers.cloudflare.com/' rel='noreferrer'>Internet-scale applications efficiently</a>, accelerates any <a target='_blank' href='https://www.cloudflare.com/performance/accelerate-internet-applications/' rel='noreferrer'>website or Internet application</a>, <a target='_blank' href='https://www.cloudflare.com/ddos/' rel='noreferrer'>wards off DDoS attacks</a>, keeps <a target='_blank' href='https://www.cloudflare.com/application-security/' rel='noreferrer'>hackers at bay</a>, and can help you on <a target='_blank' href='https://www.cloudflare.com/products/zero-trust/' rel='noreferrer'>your journey to Zero Trust</a>.<br/><br/>Visit <a target='_blank' href='https://one.one.one.one/' rel='noreferrer'>1.1.1.1</a> from any device to get started with our free app that makes your Internet faster and safer.<br/><br/>To learn more about our mission to help build a better Internet, <a target='_blank' href='https://www.cloudflare.com/learning/what-is-cloudflare/' rel='noreferrer'>start here</a>. If you&apos;re looking for a new career direction, check out <a target='_blank' href="https://www.cloudflare.com/careers" rel='noreferrer'>our open positions</a>.</div></section><div class="pv2 ph0-l mw7 center" id="social-buttons"><div class="mt5-l mt2 mb4 f2 flex flex-row-ns flex-column flex-wrap"><a id="social-button-hn" title="Discuss on Hacker News" href="https://news.ycombinator.com/submitlink?u=https://blog.cloudflare.com/we-shipped-finalizationregistry-in-workers-why-you-should-never-use-it" target="_blank" rel="noreferrer" class="mr2-ns mb0-l white link b pv3 ph3 mb3 " style="background-color:#0055DC"><svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 512 512" class="mr2"><g><path d="M31,31v450h450V31H31z M270.1,287.6v94.9h-28.1v-94.9L165,143.5h31.9L256,254.3l59.1-110.8H347
C347,143.5,270.1,287.6,270.1,287.6z"></path></g></svg><span class="v-mid">Discuss on Hacker News</span></a></div></div><iframe sandbox="allow-scripts allow-popups allow-popups-to-escape-sandbox" title="cloudflare-tv-live-link" id="cloudflare-tv-embed" src="https://cloudflare.tv/embed/live.html" loading="lazy"></iframe><a href="/tag/workers/" class="dib pl2 pr2 pt1 pb1 mb2 bg-gray8 no-underline blue3 f2 mr1">Cloudflare Workers</a><a href="/tag/webassembly/" class="dib pl2 pr2 pt1 pb1 mb2 bg-gray8 no-underline blue3 f2 mr1">WebAssembly</a><a href="/tag/javascript/" class="dib pl2 pr2 pt1 pb1 mb2 bg-gray8 no-underline blue3 f2 mr1">JavaScript</a></article></main><div class="ph3 pv3"><div class=" flex flex-row flex-wrap mw7 center"><div class="w-100 bt b--gray8"><p class="black fw5 f4 mt4">Follow on X</p></div><div class="w-100 pb2"><span>Cloudflare</span><span class="ph2">|</span><a href="https://x.com/@cloudflare" class="no-underline">@cloudflare</a></div></div></div><div data-testid="related-posts-section" class="pv4 ph3 ph0-l flex flex-row flex-wrap mw7 center"><div class="w-100 bt b--gray8"><p class="orange fw5 f4 mt4 ttu">Related posts</p></div><article data-testid="related-posts-article" class="w-100 w-100-m w-50-l ph3 mb4"><p data-testid="related-posts-article-date" class="f3 fw5 gray5" data-iso-date="2025-06-18T14:00+01:00">June 18, 2025  1:00 PM</p><a data-testid="related-posts-article-title" href="/connect-any-react-application-to-an-mcp-server-in-three-lines-of-code/" class="no-underline gray1 f4 fw5"><h2 class="gray1 f4 fw5 mt2">Connect any React application to an MCP server in three lines of code</h2></a><p data-testid="related-posts-article-excerpt" class="gray1 lh-copy">We&#x27;re open-sourcing use-mcp, a React library that connects to any MCP server in just 3 lines of code, as well as our AI Playground, a complete chat interface that can connect to remote MCP servers. <!-- -->...</p><ul class="flex pl0 fw6 f2 mb3 flex flex-wrap"><span>By<!-- --> </span><li class="list flex items-center" style="white-space:nowrap"><div class="author-name-tooltip"><a href="/author/dina/" class="fw5 f2 black no-underline">Dina Kozlov</a><span class="fw5 f2 black no-underline">, </span></div></li><li class="list flex items-center" style="white-space:nowrap"><div class="author-name-tooltip"><a href="/author/glen/" class="fw5 f2 black no-underline">Glen Maddern</a><span class="fw5 f2 black no-underline">, </span></div></li><li class="list flex items-center" style="white-space:nowrap"><div class="author-name-tooltip"><a href="/author/sunil/" class="fw5 f2 black no-underline">Sunil Pai</a></div></li></ul><div data-testid="related-posts-article-tags" class="flex flex-row flex-wrap"><span><a href="/tag/ai/" class="no-underline f1 fw2 blue3 underline-hover">AI<!-- -->,</a> </span><span><a href="/tag/agents/" class="no-underline f1 fw2 blue3 underline-hover">Agents<!-- -->,</a> </span><span><a href="/tag/mcp/" class="no-underline f1 fw2 blue3 underline-hover">MCP<!-- -->,</a> </span><span><a href="/tag/workers/" class="no-underline f1 fw2 blue3 underline-hover">Cloudflare Workers<!-- -->,</a> </span><span><a href="/tag/developers/" class="no-underline f1 fw2 blue3 underline-hover">Developers</a> </span></div></article><article data-testid="related-posts-article" class="w-100 w-100-m w-50-l ph3 mb4"><p data-testid="related-posts-article-date" class="f3 fw5 gray5" data-iso-date="2025-06-03T14:00+01:00">June 03, 2025  1:00 PM</p><a data-testid="related-posts-article-title" href="/building-agents-at-knock-agents-sdk/" class="no-underline gray1 f4 fw5"><h2 class="gray1 f4 fw5 mt2">Building an AI Agent that puts humans in the loop with Knock and Cloudflare’s Agents SDK</h2></a><p data-testid="related-posts-article-excerpt" class="gray1 lh-copy">How Knock shipped an AI Agent with human-in-the-loop capabilities with Cloudflare’s Agents SDK and Cloudflare Workers.<!-- -->...</p><ul class="flex pl0 fw6 f2 mb3 flex flex-wrap"><span>By<!-- --> </span><li class="list flex items-center" style="white-space:nowrap"><div class="author-name-tooltip"><a href="/author/Chris Bell (Guest author)/" class="fw5 f2 black no-underline">Chris Bell (Guest author)</a></div></li></ul><div data-testid="related-posts-article-tags" class="flex flex-row flex-wrap"><span><a href="/tag/ai/" class="no-underline f1 fw2 blue3 underline-hover">AI<!-- -->,</a> </span><span><a href="/tag/agents/" class="no-underline f1 fw2 blue3 underline-hover">Agents<!-- -->,</a> </span><span><a href="/tag/workers/" class="no-underline f1 fw2 blue3 underline-hover">Cloudflare Workers<!-- -->,</a> </span><span><a href="/tag/durable-objects/" class="no-underline f1 fw2 blue3 underline-hover">Durable Objects<!-- -->,</a> </span><span><a href="/tag/developer-platform/" class="no-underline f1 fw2 blue3 underline-hover">Developer Platform<!-- -->,</a> </span><span><a href="/tag/developers/" class="no-underline f1 fw2 blue3 underline-hover">Developers</a> </span></div></article><article data-testid="related-posts-article" class="w-100 w-100-m w-50-l ph3 mb4"><p data-testid="related-posts-article-date" class="f3 fw5 gray5" data-iso-date="2025-05-29T14:00+01:00">May 29, 2025  1:00 PM</p><a data-testid="related-posts-article-title" href="/detecting-workers-builds-errors-across-1-million-durable-durable-objects/" class="no-underline gray1 f4 fw5"><h2 class="gray1 f4 fw5 mt2">Let’s DO this: detecting Workers Builds errors across 1 million Durable Objects</h2></a><p data-testid="related-posts-article-excerpt" class="gray1 lh-copy">Workers Builds, our CI/CD product for deploying Workers, monitors build issues by analyzing build failure metadata spread across over one million Durable Objects.<!-- -->...</p><ul class="flex pl0 fw6 f2 mb3 flex flex-wrap"><span>By<!-- --> </span><li class="list flex items-center" style="white-space:nowrap"><div class="author-name-tooltip"><a href="/author/jacob-hands/" class="fw5 f2 black no-underline">Jacob Hands</a></div></li></ul><div data-testid="related-posts-article-tags" class="flex flex-row flex-wrap"><span><a href="/tag/workers/" class="no-underline f1 fw2 blue3 underline-hover">Cloudflare Workers<!-- -->,</a> </span><span><a href="/tag/durable-objects/" class="no-underline f1 fw2 blue3 underline-hover">Durable Objects<!-- -->,</a> </span><span><a href="/tag/dogfooding/" class="no-underline f1 fw2 blue3 underline-hover">Dogfooding</a> </span></div></article><article data-testid="related-posts-article" class="w-100 w-100-m w-50-l ph3 mb4"><p data-testid="related-posts-article-date" class="f3 fw5 gray5" data-iso-date="2025-05-01T13:01:19.509Z">May 01, 2025  1:01 PM</p><a data-testid="related-posts-article-title" href="/thirteen-new-mcp-servers-from-cloudflare/" class="no-underline gray1 f4 fw5"><h2 class="gray1 f4 fw5 mt2">Thirteen new MCP servers from Cloudflare you can use today</h2></a><p data-testid="related-posts-article-excerpt" class="gray1 lh-copy">You can now connect to Cloudflare&#x27;s first publicly available remote Model Context Protocol (MCP) servers from any MCP client that supports remote servers. <!-- -->...</p><ul class="flex pl0 fw6 f2 mb3 flex flex-wrap"><span>By<!-- --> </span><li class="list flex items-center" style="white-space:nowrap"><div class="author-name-tooltip"><a href="/author/nevi/" class="fw5 f2 black no-underline">Nevi Shah</a><span class="fw5 f2 black no-underline">, </span></div></li><li class="list flex items-center" style="white-space:nowrap"><div class="author-name-tooltip"><a href="/author/maximo-guk/" class="fw5 f2 black no-underline">Maximo Guk </a><span class="fw5 f2 black no-underline">, </span></div></li><li class="list flex items-center" style="white-space:nowrap"><div class="author-name-tooltip"><a href="/author/christian/" class="fw5 f2 black no-underline">Christian Sparks</a></div></li></ul><div data-testid="related-posts-article-tags" class="flex flex-row flex-wrap"><span><a href="/tag/model-context-protocol/" class="no-underline f1 fw2 blue3 underline-hover">Model Context Protocol<!-- -->,</a> </span><span><a href="/tag/workers/" class="no-underline f1 fw2 blue3 underline-hover">Cloudflare Workers<!-- -->,</a> </span><span><a href="/tag/agents/" class="no-underline f1 fw2 blue3 underline-hover">Agents<!-- -->,</a> </span><span><a href="/tag/open-source/" class="no-underline f1 fw2 blue3 underline-hover">Open Source<!-- -->,</a> </span><span><a href="/tag/mcp/" class="no-underline f1 fw2 blue3 underline-hover">MCP<!-- -->,</a> </span><span><a href="/tag/developers/" class="no-underline f1 fw2 blue3 underline-hover">Developers<!-- -->,</a> </span><span><a href="/tag/developer-platform/" class="no-underline f1 fw2 blue3 underline-hover">Developer Platform</a> </span></div></article></div><!--astro:end--></astro-island><footer class="pt4 pb4 pl1 pr1 main-footer"><div class="mw8 center dn db-l ph3"><div class="flex flex-row justify-between"><div class="main-footer__menu-group"><ul id="getting-started-menu" class="list pl0"><li class="pt1 pb1 f1 main-footer__menu-group__header js-toggle-footer-group" data-submenu="getting-started-menu">Getting Started<i class="icon-caret-down"></i></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/plans/free/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="free-plans" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Free plans</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/enterprise/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="enterprise" class="f1 blue3 no-underline underline-hover" rel="noreferrer">For enterprises</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/plans/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="compare-plans" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Compare plans</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/about-your-website/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="get-a-recommendation" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Get a recommendation</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/plans/enterprise/demo/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="request-a-demo" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Request a demo</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/plans/enterprise/contact/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="contact-sales" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Contact Sales</a></li></ul></div><div class="main-footer__menu-group"><ul id="company-menu" class="list pl0"><li class="pt1 pb1 f1" data-submenu="company-menu">Resources<i class="icon-caret-down"></i></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/learning/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="learning-center" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Learning Center</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/analysts/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="analysts-report" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Analyst reports</a></li><li class="pt1 pb1"><a href="https://radar.cloudflare.com/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="overview" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Cloudflare Radar</a></li><li class="pt1 pb1"><a href="https://cloudflare.tv/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="tv" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Cloudflare TV</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/case-studies/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="case-studies" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Case Studies</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/resource-hub/?resourcetype=Webinar" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="webinars" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Webinars</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/resource-hub/?resourcetype=Whitepaper" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="white-papers" class="f1 blue3 no-underline underline-hover" rel="noreferrer">White Papers</a></li><li class="pt1 pb1"><a href="https://developers.cloudflare.com" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="developer-docs" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Developer docs</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/the-net/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="theNet" class="f1 blue3 no-underline underline-hover" rel="noreferrer">theNet</a></li></ul></div><div class="main-footer__menu-group"><ul id="sales-menu" class="list pl0"><li class="pt1 pb1 f1 main-footer__menu-group__header js-toggle-footer-group" data-submenu="sales-menu">Solutions<i class="icon-caret-down"></i></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/connectivity-cloud/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="connectivity-cloud" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Connectivity cloud</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/zero-trust/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="zero-trust" class="f1 blue3 no-underline underline-hover" rel="noreferrer">SSE and SASE services</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/application-services/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="application-services" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Application services</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/network-services/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="network-services" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Network services</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/developer-platform/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="developer-services" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Developer services</a></li></ul></div><div class="main-footer__menu-group"><ul id="community-menu" class="list pl0"><li class="pt1 pb1 f1 main-footer__menu-group__header js-toggle-footer-group" data-submenu="community-menu">Community<i class="icon-caret-down"></i></li><li class="pt1 pb1"><a href="https://community.cloudflare.com" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="community_hub" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Community Hub</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/galileo/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="galileo" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Project Galileo</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/athenian/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="athenian" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Athenian Project</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/campaigns/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="cloudflare-for-campaigns" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Cloudflare for Campaigns</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/partners/technology-partners/cidp/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="critical-infrastructure-defense-project" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Critical Infrastructure Defense Project</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/connect2024/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="connect-2024" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Connect 2024</a></li></ul></div><div class="main-footer__menu-group"><ul id="support-menu" class="list pl0"><li class="pt1 pb1 f1 main-footer__menu-group__header js-toggle-footer-group" data-submenu="support-menu">Support<i class="icon-caret-down"></i></li><li class="pt1 pb1"><a href="https://support.cloudflare.com" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="help-center" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Help center</a></li><li class="pt1 pb1"><a href="https://www.cloudflarestatus.com" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="status" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Cloudflare Status</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/compliance/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="compliance" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Compliance</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/gdpr/introduction/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="gdpr" class="f1 blue3 no-underline underline-hover" rel="noreferrer">GDPR</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/trust-hub/abuse-approach/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="trust-and-safety" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Trust &amp; Safety</a></li></ul></div><div class="main-footer__menu-group"><ul id="company-menu" class="list pl0"><li class="pt1 pb1 f1 main-footer__menu-group__header js-toggle-footer-group" data-submenu="company-menu">Company<i class="icon-caret-down"></i></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/about-overview/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="overview" class="f1 blue3 no-underline underline-hover" rel="noreferrer">About Cloudflare</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/people/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="our_team" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Our team</a></li><li class="pt1 pb1"><a href="https://cloudflare.net/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="investor-relations" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Investor relations</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/press/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="press" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Press</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/careers/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="careers" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Careers</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/diversity-equity-and-inclusion/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="diversity-equity-inclusion" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Diversity, equity &amp; inclusion</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/impact/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="impact-ESG" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Impact/ESG</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/network/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="network_map" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Network Map</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/press-kit/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="press-kit" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Logos &amp; press kit</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/partners/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="partners" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Become a partner</a></li></ul></div></div></div><div class="mw8 center ph3"><div class="flex flex-row flex-wrap justify-center md:justify-between items-center pt4"><div class="flex flex-row space-x-4 items-start w-25-l pb4 pb0-l"><a target="_blank" rel="noreferrer" href="https://www.facebook.com/Cloudflare/" class="w-8"><img class="w-8" src="https://www.cloudflare.com/img/footer/facebook.svg" alt="facebook"/></a><a target=" _blank" rel="noreferrer" href="https://x.com/Cloudflare" class="w-8"><img class="w-8" src="https://www.cloudflare.com/img/footer/twitter.svg" alt="X"/></a><a target="_blank" rel="noreferrer" href="https://www.linkedin.com/company/cloudflare" class="w-8"><img class="w-8" src="https://www.cloudflare.com/img/footer/linkedin.svg" alt="linkedin"/></a><a target="_blank" rel="noreferrer" href="https://www.youtube.com/cloudflare" class="w-8"><img class="w-8" src="https://www.cloudflare.com/img/footer/youtube.svg" alt="youtube"/></a><a target="_blank" rel="noreferrer" href="https://www.instagram.com/cloudflare" class="w-8"><img class="w-8" src="https://www.cloudflare.com/img/footer/instagram.svg" alt="instagram"/></a></div><div class="w-70-l tr-l tl-ns"><div><span class="main-footer__copyright f1">© <!-- -->2025<!-- --> Cloudflare, Inc.<!-- --> </span><span class="main-footer__copyright f1">|</span><a href="https://www.cloudflare.com/privacypolicy/" target="_blank" class="main-footer__copyright f1 no-underline underline-hover" rel="noreferrer"> <!-- -->Privacy Policy<!-- --> </a><span class="main-footer__copyright f1">|</span><a href="https://www.cloudflare.com/website-terms/" target="_blank" class="main-footer__copyright f1 no-underline underline-hover" rel="noreferrer"> <!-- -->Terms of Use<!-- --> </a><span class="main-footer__copyright f1">|</span><a href="https://www.cloudflare.com/disclosure/" target="_blank" class="main-footer__copyright f1 no-underline underline-hover" rel="noreferrer"> <!-- -->Report Security Issues<!-- --> </a><span class="main-footer__copyright f1">|</span><img class="mw2 ph1" src="/images/privacy-options.svg" alt="Privacy Options"/><a href="#cookie-settings" id="ot-sdk-btn" class="ot-sdk-show-settings main-footer__copyright f1 no-underline underline-hover"><span class="brandGray5">Cookie Preferences</span> </a><span class="main-footer__copyright f1">|</span><a href="https://www.cloudflare.com/trademark/" target="_blank" class="main-footer__copyright f1 no-underline underline-hover" rel="noreferrer"> <!-- -->Trademark<!-- --> </a></div></div></div></div></footer></html>
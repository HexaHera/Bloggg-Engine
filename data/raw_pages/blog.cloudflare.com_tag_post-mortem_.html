<!DOCTYPE html><html lang="en-us" dir="ltr"> <head><script async src="https://ot.www.cloudflare.com/public/vendor/onetrust/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" data-domain-script="b1e05d49-f072-4bae-9116-bdb78af15448"></script><meta name="HandheldFriendly" content="True"><meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="baidu-site-verification" content="KeThzeyMOr"><meta name="baidu-site-verification" content="code-NIlrS7gNhx"><meta charset="UTF-8"><meta name="description" content="Get the latest news on how products at Cloudflare are built, technologies used, and open positions to join the teams helping to build a better Internet."><title>Post Mortem</title><meta name="title" content="Post Mortem"><meta name="msvalidate.01" content="CF295E1604697F9CAD18B5A232E871F6"><meta class="swiftype" name="language" data-type="string" content="en"><script src="/static/z/i.js" type="text/javascript" referrerpolicy="origin"></script><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/favicon-32x32.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-32x32.png"><link rel="mask-icon" href="/images/favicon-32x32.png" color="#f78100"><link rel="stylesheet" href="/themes/ashes.min.css"><link rel="sitemap" href="/sitemap.xml"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"><link rel="canonical" href="https://blog.cloudflare.com/tag/post-mortem/"><link rel="alternate" type="application/rss+xml" title="Cloudflare Post Mortem RSS Feed" href="/tag/post-mortem/rss"><link rel="alternate" hreflang="en-us" href="https://blog.cloudflare.com/tag/post-mortem/"><link rel="alternate" hreflang="de-de" href="https://blog.cloudflare.com/de-de/tag/post-mortem/"><link rel="alternate" hreflang="es-es" href="https://blog.cloudflare.com/es-es/tag/post-mortem/"><link rel="alternate" hreflang="fr-fr" href="https://blog.cloudflare.com/fr-fr/tag/post-mortem/"><link rel="alternate" hreflang="ja-jp" href="https://blog.cloudflare.com/ja-jp/tag/post-mortem/"><link rel="alternate" hreflang="ko-kr" href="https://blog.cloudflare.com/ko-kr/tag/post-mortem/"><link rel="alternate" hreflang="zh-tw" href="https://blog.cloudflare.com/zh-tw/tag/post-mortem/"><link rel="alternate" hreflang="zh-cn" href="https://blog.cloudflare.com/zh-cn/tag/post-mortem/"><link rel="alternate" hreflang="pt-br" href="https://blog.cloudflare.com/pt-br/tag/post-mortem/"><link rel="alternate" hreflang="ru-ru" href="https://blog.cloudflare.com/ru-ru/tag/post-mortem/"><link rel="alternate" hreflang="th-th" href="https://blog.cloudflare.com/th-th/tag/post-mortem/"><link rel="alternate" hreflang="pl-pl" href="https://blog.cloudflare.com/pl-pl/tag/post-mortem/"><link rel="alternate" hreflang="nl-nl" href="https://blog.cloudflare.com/nl-nl/tag/post-mortem/"><!-- General Meta Tags --><meta property="article:publisher" content="https://www.facebook.com/cloudflare"><!-- Facebook Meta Tags --><meta property="og:site_name" content="The Cloudflare Blog"><meta property="og:type" content="website"><meta property="og:title" content="The Cloudflare Blog: Post Mortem"><meta property="og:description" content="Collection of Cloudflare blog posts tagged 'Post Mortem'"><meta property="og:url" content="https://blog.cloudflare.com/tag/post-mortem/"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="628"><!-- Twitter/X Meta Tags --><meta name="twitter:title" content="The Cloudflare Blog: Post Mortem"><meta name="twitter:description" content="Collection of Cloudflare blog posts tagged 'Post Mortem'"><meta name="twitter:url" content="https://blog.cloudflare.com/tag/post-mortem/"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@cloudflare"><meta property="og:image"><meta name="twitter:image"><link rel="stylesheet" href="/_astro/index.DAblDsYO.css"></head><style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).only=e;window.dispatchEvent(new Event("astro:only"));})();;(()=>{var A=Object.defineProperty;var g=(i,o,a)=>o in i?A(i,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[o]=a;var d=(i,o,a)=>g(i,typeof o!="symbol"?o+"":o,a);{let i={0:t=>m(t),1:t=>a(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(a(t)),5:t=>new Set(a(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t),11:t=>1/0*t},o=t=>{let[l,e]=t;return l in i?i[l](e):void 0},a=t=>t.map(o),m=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([l,e])=>[l,o(e)]));class y extends HTMLElement{constructor(){super(...arguments);d(this,"Component");d(this,"hydrator");d(this,"hydrate",async()=>{var b;if(!this.hydrator||!this.isConnected)return;let e=(b=this.parentElement)==null?void 0:b.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let c=this.querySelectorAll("astro-slot"),n={},h=this.querySelectorAll("template[data-astro-template]");for(let r of h){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of c){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("name")||"default"]=r.innerHTML)}let p;try{p=this.hasAttribute("props")?m(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",v=this.getAttribute("component-export");throw v&&(s+=` (export ${v})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}let u;await this.hydrator(this)(this.Component,p,n,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))});d(this,"unmount",()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))})}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(!this.hasAttribute("await-children")||document.readyState==="interactive"||document.readyState==="complete")this.childrenConnectedCallback();else{let e=()=>{document.removeEventListener("DOMContentLoaded",e),c.disconnect(),this.childrenConnectedCallback()},c=new MutationObserver(()=>{var n;((n=this.lastChild)==null?void 0:n.nodeType)===Node.COMMENT_NODE&&this.lastChild.nodeValue==="astro:end"&&(this.lastChild.remove(),e())});c.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",e)}}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}async start(){let e=JSON.parse(this.getAttribute("opts")),c=this.getAttribute("client");if(Astro[c]===void 0){window.addEventListener(`astro:${c}`,()=>this.start(),{once:!0});return}try{await Astro[c](async()=>{let n=this.getAttribute("renderer-url"),[h,{default:p}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),u=this.getAttribute("component-export")||"default";if(!u.includes("."))this.Component=h[u];else{this.Component=h;for(let f of u.split("."))this.Component=this.Component[f]}return this.hydrator=p,this.hydrate},e,this)}catch(n){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,n)}}attributeChangedCallback(){this.hydrate()}}d(y,"observedAttributes",["props"]),customElements.get("astro-island")||customElements.define("astro-island",y)}})();</script><astro-island uid="tfYAp" component-url="/_astro/GoogleAnalytics.o7SaAFZX.js" component-export="GoogleAnalytics" renderer-url="/_astro/client.DLO1yDVm.js" props="{&quot;title&quot;:[0,&quot;Post Mortem&quot;],&quot;canonical&quot;:[0,&quot;https://blog.cloudflare.com/tag/post-mortem&quot;],&quot;info&quot;:[0],&quot;tagInfo&quot;:[0,{&quot;id&quot;:[0,&quot;3cCNoJJ5uusKFBLYKFX1jB&quot;],&quot;slug&quot;:[0,&quot;post-mortem&quot;],&quot;url&quot;:[0,&quot;https://blog.cloudflare.com/post-mortem&quot;],&quot;name&quot;:[0,&quot;Post Mortem&quot;],&quot;visibility&quot;:[0,&quot;public&quot;],&quot;feature_image&quot;:[0,&quot;&quot;],&quot;publicly_index&quot;:[0,true]}],&quot;authorInfo&quot;:[0],&quot;translatedPosts&quot;:[1,[]]}" ssr client="only" opts="{&quot;name&quot;:&quot;GoogleAnalytics&quot;,&quot;value&quot;:&quot;react&quot;}"></astro-island><script>(()=>{var l=(n,t)=>{let i=async()=>{await(await n())()},e=typeof t.value=="object"?t.value:void 0,s={timeout:e==null?void 0:e.timeout};"requestIdleCallback"in window?window.requestIdleCallback(i,s):setTimeout(i,s.timeout||200)};(self.Astro||(self.Astro={})).idle=l;window.dispatchEvent(new Event("astro:idle"));})();</script><astro-island uid="1HDdTY" prefix="r8" component-url="/_astro/Navigation.JWiNRNo9.js" component-export="Navigation" renderer-url="/_astro/client.DLO1yDVm.js" props="{&quot;title&quot;:[0,&quot;The Cloudflare Blog&quot;],&quot;logo&quot;:[0,&quot;//images.ctfassets.net/zkvhlag99gkb/69RwBidpiEHCDZ9rFVVk7T/092507edbed698420b89658e5a6d5105/CF_logo_stacked_blktype.png&quot;],&quot;pagesStore&quot;:[0,{&quot;page&quot;:[0,&quot;Tag&quot;],&quot;slug&quot;:[0,&quot;post-mortem&quot;],&quot;translationsAvailable&quot;:[1,[[0,&quot;de-de&quot;],[0,&quot;es-es&quot;],[0,&quot;fr-fr&quot;],[0,&quot;ja-jp&quot;],[0,&quot;ko-kr&quot;],[0,&quot;zh-tw&quot;],[0,&quot;zh-cn&quot;],[0,&quot;pt-br&quot;],[0,&quot;ru-ru&quot;],[0,&quot;th-th&quot;],[0,&quot;pl-pl&quot;],[0,&quot;nl-nl&quot;]]],&quot;navData&quot;:[1,[[0,{&quot;metadata&quot;:[0,{&quot;tags&quot;:[1,[]],&quot;concepts&quot;:[1,[]]}],&quot;sys&quot;:[0,{&quot;space&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Space&quot;],&quot;id&quot;:[0,&quot;zkvhlag99gkb&quot;]}]}],&quot;id&quot;:[0,&quot;6Foe3R8of95cWVnQwe5Toi&quot;],&quot;type&quot;:[0,&quot;Entry&quot;],&quot;createdAt&quot;:[0,&quot;2024-10-09T22:44:28.803Z&quot;],&quot;updatedAt&quot;:[0,&quot;2025-06-17T05:04:39.288Z&quot;],&quot;environment&quot;:[0,{&quot;sys&quot;:[0,{&quot;id&quot;:[0,&quot;master&quot;],&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Environment&quot;]}]}],&quot;publishedVersion&quot;:[0,153],&quot;revision&quot;:[0,44],&quot;contentType&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;ContentType&quot;],&quot;id&quot;:[0,&quot;blogTag&quot;]}]}],&quot;locale&quot;:[0,&quot;en-US&quot;]}],&quot;fields&quot;:[0,{&quot;entryTitle&quot;:[0,&quot;AI&quot;],&quot;name&quot;:[0,&quot;AI&quot;],&quot;slug&quot;:[0,&quot;ai&quot;],&quot;featured&quot;:[0,true],&quot;publiclyIndex&quot;:[0,true]}]}],[0,{&quot;metadata&quot;:[0,{&quot;tags&quot;:[1,[]],&quot;concepts&quot;:[1,[]]}],&quot;sys&quot;:[0,{&quot;space&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Space&quot;],&quot;id&quot;:[0,&quot;zkvhlag99gkb&quot;]}]}],&quot;id&quot;:[0,&quot;4HIPcb68qM0e26fIxyfzwQ&quot;],&quot;type&quot;:[0,&quot;Entry&quot;],&quot;createdAt&quot;:[0,&quot;2024-10-09T19:43:21.536Z&quot;],&quot;updatedAt&quot;:[0,&quot;2025-05-19T05:03:04.375Z&quot;],&quot;environment&quot;:[0,{&quot;sys&quot;:[0,{&quot;id&quot;:[0,&quot;master&quot;],&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Environment&quot;]}]}],&quot;publishedVersion&quot;:[0,135],&quot;revision&quot;:[0,46],&quot;contentType&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;ContentType&quot;],&quot;id&quot;:[0,&quot;blogTag&quot;]}]}],&quot;locale&quot;:[0,&quot;en-US&quot;]}],&quot;fields&quot;:[0,{&quot;entryTitle&quot;:[0,&quot;Developers&quot;],&quot;name&quot;:[0,&quot;Developers&quot;],&quot;slug&quot;:[0,&quot;developers&quot;],&quot;featured&quot;:[0,true]}]}],[0,{&quot;metadata&quot;:[0,{&quot;tags&quot;:[1,[]],&quot;concepts&quot;:[1,[]]}],&quot;sys&quot;:[0,{&quot;space&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Space&quot;],&quot;id&quot;:[0,&quot;zkvhlag99gkb&quot;]}]}],&quot;id&quot;:[0,&quot;5kZtWqjqa7aOUoZr8NFGwI&quot;],&quot;type&quot;:[0,&quot;Entry&quot;],&quot;createdAt&quot;:[0,&quot;2024-10-09T19:43:26.040Z&quot;],&quot;updatedAt&quot;:[0,&quot;2025-04-30T14:03:57.409Z&quot;],&quot;environment&quot;:[0,{&quot;sys&quot;:[0,{&quot;id&quot;:[0,&quot;master&quot;],&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Environment&quot;]}]}],&quot;publishedVersion&quot;:[0,142],&quot;revision&quot;:[0,43],&quot;contentType&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;ContentType&quot;],&quot;id&quot;:[0,&quot;blogTag&quot;]}]}],&quot;locale&quot;:[0,&quot;en-US&quot;]}],&quot;fields&quot;:[0,{&quot;entryTitle&quot;:[0,&quot;Cloudflare Radar&quot;],&quot;name&quot;:[0,&quot;Radar&quot;],&quot;slug&quot;:[0,&quot;cloudflare-radar&quot;],&quot;featured&quot;:[0,true]}]}],[0,{&quot;metadata&quot;:[0,{&quot;tags&quot;:[1,[]],&quot;concepts&quot;:[1,[]]}],&quot;sys&quot;:[0,{&quot;space&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Space&quot;],&quot;id&quot;:[0,&quot;zkvhlag99gkb&quot;]}]}],&quot;id&quot;:[0,&quot;6QktrXeEFcl4e2dZUTZVGl&quot;],&quot;type&quot;:[0,&quot;Entry&quot;],&quot;createdAt&quot;:[0,&quot;2024-10-09T19:43:20.198Z&quot;],&quot;updatedAt&quot;:[0,&quot;2025-04-09T11:02:56.665Z&quot;],&quot;environment&quot;:[0,{&quot;sys&quot;:[0,{&quot;id&quot;:[0,&quot;master&quot;],&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Environment&quot;]}]}],&quot;publishedVersion&quot;:[0,68],&quot;revision&quot;:[0,28],&quot;contentType&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;ContentType&quot;],&quot;id&quot;:[0,&quot;blogTag&quot;]}]}],&quot;locale&quot;:[0,&quot;en-US&quot;]}],&quot;fields&quot;:[0,{&quot;entryTitle&quot;:[0,&quot;Product News&quot;],&quot;name&quot;:[0,&quot;Product News&quot;],&quot;slug&quot;:[0,&quot;product-news&quot;],&quot;featured&quot;:[0,true]}]}],[0,{&quot;metadata&quot;:[0,{&quot;tags&quot;:[1,[]],&quot;concepts&quot;:[1,[]]}],&quot;sys&quot;:[0,{&quot;space&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Space&quot;],&quot;id&quot;:[0,&quot;zkvhlag99gkb&quot;]}]}],&quot;id&quot;:[0,&quot;6Mp7ouACN2rT3YjL1xaXJx&quot;],&quot;type&quot;:[0,&quot;Entry&quot;],&quot;createdAt&quot;:[0,&quot;2024-10-09T19:42:46.231Z&quot;],&quot;updatedAt&quot;:[0,&quot;2025-04-09T11:02:54.136Z&quot;],&quot;environment&quot;:[0,{&quot;sys&quot;:[0,{&quot;id&quot;:[0,&quot;master&quot;],&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Environment&quot;]}]}],&quot;publishedVersion&quot;:[0,134],&quot;revision&quot;:[0,41],&quot;contentType&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;ContentType&quot;],&quot;id&quot;:[0,&quot;blogTag&quot;]}]}],&quot;locale&quot;:[0,&quot;en-US&quot;]}],&quot;fields&quot;:[0,{&quot;entryTitle&quot;:[0,&quot;Security&quot;],&quot;name&quot;:[0,&quot;Security&quot;],&quot;slug&quot;:[0,&quot;security&quot;],&quot;featured&quot;:[0,true]}]}],[0,{&quot;metadata&quot;:[0,{&quot;tags&quot;:[1,[]],&quot;concepts&quot;:[1,[]]}],&quot;sys&quot;:[0,{&quot;space&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Space&quot;],&quot;id&quot;:[0,&quot;zkvhlag99gkb&quot;]}]}],&quot;id&quot;:[0,&quot;16yk8DVbNNifxov5cWvAov&quot;],&quot;type&quot;:[0,&quot;Entry&quot;],&quot;createdAt&quot;:[0,&quot;2024-10-09T19:56:23.848Z&quot;],&quot;updatedAt&quot;:[0,&quot;2025-04-07T23:03:54.104Z&quot;],&quot;environment&quot;:[0,{&quot;sys&quot;:[0,{&quot;id&quot;:[0,&quot;master&quot;],&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Environment&quot;]}]}],&quot;publishedVersion&quot;:[0,65],&quot;revision&quot;:[0,29],&quot;contentType&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;ContentType&quot;],&quot;id&quot;:[0,&quot;blogTag&quot;]}]}],&quot;locale&quot;:[0,&quot;en-US&quot;]}],&quot;fields&quot;:[0,{&quot;entryTitle&quot;:[0,&quot;Policy &amp; Legal&quot;],&quot;name&quot;:[0,&quot;Policy &amp; Legal&quot;],&quot;slug&quot;:[0,&quot;policy&quot;],&quot;featured&quot;:[0,true]}]}],[0,{&quot;metadata&quot;:[0,{&quot;tags&quot;:[1,[]],&quot;concepts&quot;:[1,[]]}],&quot;sys&quot;:[0,{&quot;space&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Space&quot;],&quot;id&quot;:[0,&quot;zkvhlag99gkb&quot;]}]}],&quot;id&quot;:[0,&quot;J61Eszqn98amrYHq4IhTx&quot;],&quot;type&quot;:[0,&quot;Entry&quot;],&quot;createdAt&quot;:[0,&quot;2024-10-09T19:43:46.068Z&quot;],&quot;updatedAt&quot;:[0,&quot;2025-04-07T23:03:53.720Z&quot;],&quot;environment&quot;:[0,{&quot;sys&quot;:[0,{&quot;id&quot;:[0,&quot;master&quot;],&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Environment&quot;]}]}],&quot;publishedVersion&quot;:[0,136],&quot;revision&quot;:[0,44],&quot;contentType&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;ContentType&quot;],&quot;id&quot;:[0,&quot;blogTag&quot;]}]}],&quot;locale&quot;:[0,&quot;en-US&quot;]}],&quot;fields&quot;:[0,{&quot;entryTitle&quot;:[0,&quot;Zero Trust&quot;],&quot;name&quot;:[0,&quot;Zero Trust&quot;],&quot;slug&quot;:[0,&quot;zero-trust&quot;],&quot;featured&quot;:[0,true]}]}],[0,{&quot;metadata&quot;:[0,{&quot;tags&quot;:[1,[]],&quot;concepts&quot;:[1,[]]}],&quot;sys&quot;:[0,{&quot;space&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Space&quot;],&quot;id&quot;:[0,&quot;zkvhlag99gkb&quot;]}]}],&quot;id&quot;:[0,&quot;48r7QV00gLMWOIcM1CSDRy&quot;],&quot;type&quot;:[0,&quot;Entry&quot;],&quot;createdAt&quot;:[0,&quot;2024-10-09T19:54:22.790Z&quot;],&quot;updatedAt&quot;:[0,&quot;2025-04-07T23:03:52.422Z&quot;],&quot;environment&quot;:[0,{&quot;sys&quot;:[0,{&quot;id&quot;:[0,&quot;master&quot;],&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Environment&quot;]}]}],&quot;publishedVersion&quot;:[0,66],&quot;revision&quot;:[0,28],&quot;contentType&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;ContentType&quot;],&quot;id&quot;:[0,&quot;blogTag&quot;]}]}],&quot;locale&quot;:[0,&quot;en-US&quot;]}],&quot;fields&quot;:[0,{&quot;entryTitle&quot;:[0,&quot;Speed &amp; Reliability&quot;],&quot;name&quot;:[0,&quot;Speed &amp; Reliability&quot;],&quot;slug&quot;:[0,&quot;speed-and-reliability&quot;],&quot;featured&quot;:[0,true]}]}],[0,{&quot;metadata&quot;:[0,{&quot;tags&quot;:[1,[]],&quot;concepts&quot;:[1,[]]}],&quot;sys&quot;:[0,{&quot;space&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Space&quot;],&quot;id&quot;:[0,&quot;zkvhlag99gkb&quot;]}]}],&quot;id&quot;:[0,&quot;4g8tPriKOAUwdUT4jNPebe&quot;],&quot;type&quot;:[0,&quot;Entry&quot;],&quot;createdAt&quot;:[0,&quot;2024-10-09T19:46:40.927Z&quot;],&quot;updatedAt&quot;:[0,&quot;2025-04-07T23:03:51.235Z&quot;],&quot;environment&quot;:[0,{&quot;sys&quot;:[0,{&quot;id&quot;:[0,&quot;master&quot;],&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Environment&quot;]}]}],&quot;publishedVersion&quot;:[0,77],&quot;revision&quot;:[0,29],&quot;contentType&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;ContentType&quot;],&quot;id&quot;:[0,&quot;blogTag&quot;]}]}],&quot;locale&quot;:[0,&quot;en-US&quot;]}],&quot;fields&quot;:[0,{&quot;entryTitle&quot;:[0,&quot;Life at Cloudflare&quot;],&quot;name&quot;:[0,&quot;Life at Cloudflare&quot;],&quot;slug&quot;:[0,&quot;life-at-cloudflare&quot;],&quot;featured&quot;:[0,true]}]}],[0,{&quot;metadata&quot;:[0,{&quot;tags&quot;:[1,[]],&quot;concepts&quot;:[1,[]]}],&quot;sys&quot;:[0,{&quot;space&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Space&quot;],&quot;id&quot;:[0,&quot;zkvhlag99gkb&quot;]}]}],&quot;id&quot;:[0,&quot;V86khSc459Yi1AhTlvtY7&quot;],&quot;type&quot;:[0,&quot;Entry&quot;],&quot;createdAt&quot;:[0,&quot;2024-10-09T19:46:53.657Z&quot;],&quot;updatedAt&quot;:[0,&quot;2025-02-04T17:12:59.473Z&quot;],&quot;environment&quot;:[0,{&quot;sys&quot;:[0,{&quot;id&quot;:[0,&quot;master&quot;],&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;Environment&quot;]}]}],&quot;publishedVersion&quot;:[0,57],&quot;revision&quot;:[0,21],&quot;contentType&quot;:[0,{&quot;sys&quot;:[0,{&quot;type&quot;:[0,&quot;Link&quot;],&quot;linkType&quot;:[0,&quot;ContentType&quot;],&quot;id&quot;:[0,&quot;blogTag&quot;]}]}],&quot;locale&quot;:[0,&quot;en-US&quot;]}],&quot;fields&quot;:[0,{&quot;entryTitle&quot;:[0,&quot;Partners&quot;],&quot;name&quot;:[0,&quot;Partners&quot;],&quot;slug&quot;:[0,&quot;partners&quot;],&quot;featured&quot;:[0,true]}]}]]]}],&quot;locale&quot;:[0,&quot;en-us&quot;],&quot;translations&quot;:[0,{&quot;posts.by&quot;:[0,&quot;By&quot;],&quot;footer.gdpr&quot;:[0,&quot;GDPR&quot;],&quot;lang_blurb1&quot;:[0,&quot;This post is also available in {lang1}.&quot;],&quot;lang_blurb2&quot;:[0,&quot;This post is also available in {lang1} and {lang2}.&quot;],&quot;lang_blurb3&quot;:[0,&quot;This post is also available in {lang1}, {lang2} and {lang3}.&quot;],&quot;footer.press&quot;:[0,&quot;Press&quot;],&quot;header.title&quot;:[0,&quot;The Cloudflare Blog&quot;],&quot;search.clear&quot;:[0,&quot;Clear&quot;],&quot;search.filter&quot;:[0,&quot;Filter&quot;],&quot;search.source&quot;:[0,&quot;Source&quot;],&quot;footer.careers&quot;:[0,&quot;Careers&quot;],&quot;footer.company&quot;:[0,&quot;Company&quot;],&quot;footer.support&quot;:[0,&quot;Support&quot;],&quot;footer.the_net&quot;:[0,&quot;theNet&quot;],&quot;search.filters&quot;:[0,&quot;Filters&quot;],&quot;footer.our_team&quot;:[0,&quot;Our team&quot;],&quot;footer.webinars&quot;:[0,&quot;Webinars&quot;],&quot;page.more_posts&quot;:[0,&quot;More posts&quot;],&quot;posts.time_read&quot;:[0,&quot;{time} min read&quot;],&quot;search.language&quot;:[0,&quot;Language&quot;],&quot;footer.community&quot;:[0,&quot;Community&quot;],&quot;footer.resources&quot;:[0,&quot;Resources&quot;],&quot;footer.solutions&quot;:[0,&quot;Solutions&quot;],&quot;footer.trademark&quot;:[0,&quot;Trademark&quot;],&quot;header.subscribe&quot;:[0,&quot;Subscribe&quot;],&quot;footer.compliance&quot;:[0,&quot;Compliance&quot;],&quot;footer.free_plans&quot;:[0,&quot;Free plans&quot;],&quot;footer.impact_ESG&quot;:[0,&quot;Impact/ESG&quot;],&quot;posts.follow_on_X&quot;:[0,&quot;Follow on X&quot;],&quot;footer.help_center&quot;:[0,&quot;Help center&quot;],&quot;footer.network_map&quot;:[0,&quot;Network Map&quot;],&quot;header.please_wait&quot;:[0,&quot;Please Wait&quot;],&quot;page.related_posts&quot;:[0,&quot;Related posts&quot;],&quot;search.result_stat&quot;:[0,&quot;Results &lt;strong&gt;{search_range}&lt;/strong&gt; of &lt;strong&gt;{search_total}&lt;/strong&gt; for &lt;strong&gt;{search_keyword}&lt;/strong&gt;&quot;],&quot;footer.case_studies&quot;:[0,&quot;Case Studies&quot;],&quot;footer.connect_2024&quot;:[0,&quot;Connect 2024&quot;],&quot;footer.terms_of_use&quot;:[0,&quot;Terms of Use&quot;],&quot;footer.white_papers&quot;:[0,&quot;White Papers&quot;],&quot;footer.cloudflare_tv&quot;:[0,&quot;Cloudflare TV&quot;],&quot;footer.community_hub&quot;:[0,&quot;Community Hub&quot;],&quot;footer.compare_plans&quot;:[0,&quot;Compare plans&quot;],&quot;footer.contact_sales&quot;:[0,&quot;Contact Sales&quot;],&quot;header.contact_sales&quot;:[0,&quot;Contact Sales&quot;],&quot;header.email_address&quot;:[0,&quot;Email Address&quot;],&quot;page.error.not_found&quot;:[0,&quot;Page not found&quot;],&quot;footer.developer_docs&quot;:[0,&quot;Developer docs&quot;],&quot;footer.privacy_policy&quot;:[0,&quot;Privacy Policy&quot;],&quot;footer.request_a_demo&quot;:[0,&quot;Request a demo&quot;],&quot;page.continue_reading&quot;:[0,&quot;Continue reading&quot;],&quot;footer.analysts_report&quot;:[0,&quot;Analyst reports&quot;],&quot;footer.for_enterprises&quot;:[0,&quot;For enterprises&quot;],&quot;footer.getting_started&quot;:[0,&quot;Getting Started&quot;],&quot;footer.learning_center&quot;:[0,&quot;Learning Center&quot;],&quot;footer.project_galileo&quot;:[0,&quot;Project Galileo&quot;],&quot;pagination.newer_posts&quot;:[0,&quot;Newer Posts&quot;],&quot;pagination.older_posts&quot;:[0,&quot;Older Posts&quot;],&quot;posts.social_buttons.x&quot;:[0,&quot;Discuss on X&quot;],&quot;search.icon_aria_label&quot;:[0,&quot;Search&quot;],&quot;search.source_location&quot;:[0,&quot;Source/Location&quot;],&quot;footer.about_cloudflare&quot;:[0,&quot;About Cloudflare&quot;],&quot;footer.athenian_project&quot;:[0,&quot;Athenian Project&quot;],&quot;footer.become_a_partner&quot;:[0,&quot;Become a partner&quot;],&quot;footer.cloudflare_radar&quot;:[0,&quot;Cloudflare Radar&quot;],&quot;footer.network_services&quot;:[0,&quot;Network services&quot;],&quot;footer.trust_and_safety&quot;:[0,&quot;Trust &amp; Safety&quot;],&quot;header.get_started_free&quot;:[0,&quot;Get Started Free&quot;],&quot;page.search.placeholder&quot;:[0,&quot;Search Cloudflare&quot;],&quot;footer.cloudflare_status&quot;:[0,&quot;Cloudflare Status&quot;],&quot;footer.cookie_preference&quot;:[0,&quot;Cookie Preferences&quot;],&quot;header.valid_email_error&quot;:[0,&quot;Must be valid email.&quot;],&quot;search.result_stat_empty&quot;:[0,&quot;Results &lt;strong&gt;{search_range}&lt;/strong&gt; of &lt;strong&gt;{search_total}&lt;/strong&gt;&quot;],&quot;footer.connectivity_cloud&quot;:[0,&quot;Connectivity cloud&quot;],&quot;footer.developer_services&quot;:[0,&quot;Developer services&quot;],&quot;footer.investor_relations&quot;:[0,&quot;Investor relations&quot;],&quot;page.not_found.error_code&quot;:[0,&quot;Error Code: 404&quot;],&quot;search.autocomplete_title&quot;:[0,&quot;Insert a query. Press enter to send&quot;],&quot;footer.logos_and_press_kit&quot;:[0,&quot;Logos &amp; press kit&quot;],&quot;footer.application_services&quot;:[0,&quot;Application services&quot;],&quot;footer.get_a_recommendation&quot;:[0,&quot;Get a recommendation&quot;],&quot;posts.social_buttons.reddit&quot;:[0,&quot;Discuss on Reddit&quot;],&quot;footer.sse_and_sase_services&quot;:[0,&quot;SSE and SASE services&quot;],&quot;page.not_found.outdated_link&quot;:[0,&quot;You may have used an outdated link, or you may have typed the address incorrectly.&quot;],&quot;footer.report_security_issues&quot;:[0,&quot;Report Security Issues&quot;],&quot;page.error.error_message_page&quot;:[0,&quot;Sorry, we can&#39;t find the page you are looking for.&quot;],&quot;header.subscribe_notifications&quot;:[0,&quot;Subscribe to receive notifications of new posts:&quot;],&quot;footer.cloudflare_for_campaigns&quot;:[0,&quot;Cloudflare for Campaigns&quot;],&quot;header.subscription_confimation&quot;:[0,&quot;Subscription confirmed. Thank you for subscribing!&quot;],&quot;posts.social_buttons.hackernews&quot;:[0,&quot;Discuss on Hacker News&quot;],&quot;footer.diversity_equity_inclusion&quot;:[0,&quot;Diversity, equity &amp; inclusion&quot;],&quot;footer.critical_infrastructure_defense_project&quot;:[0,&quot;Critical Infrastructure Defense Project&quot;]}]}" ssr client="idle" opts="{&quot;name&quot;:&quot;NavigationComponent&quot;,&quot;value&quot;:true}" await-children><header class="flex flex-row flex-wrap justify-between items-flex-end mw8 center mv3 pl3 pr1"><div class="w-100 flex items-flex-end justify-between justify-start-l"><div class="w-100 tr flex justify-end"><div class="flex justify-between items-center"><span class="dn di-l pr1"><a href="https://dash.cloudflare.com/sign-up" class="f1 blue1 dn di-l b no-underline underline-hover" target="_blank" rel="noreferrer">Get Started Free</a></span><span class="f1 gray4 dn di-l pr1">|</span><span class="dn di-l"><a target="_blank" href="https://www.cloudflare.com/plans/enterprise/contact/" class="f1 gray4 no-underline underline-hover pr1" rel="noreferrer">Contact Sales</a></span><span class="f1 gray4 dn di-l pr1">|</span><div class="relative flex cf-dropdown"><div class="flex items-center" dir="ltr"><button type="button" class="f1 gray4 no-underline language-picker js-language-picker" style="background:transparent;border:none;padding:0"><span class="language-picker__globe-icon"></span><span class="language-picker__caret-icon ph1">▼</span></button></div></div></div></div></div><div class="w-100 w-50-l flex items-end nb5 nb1-l"><a href="/" class="header-logo mr4 dn db-l"><img class="header-logo" src="https://cf-assets.www.cloudflare.com/zkvhlag99gkb/69RwBidpiEHCDZ9rFVVk7T/092507edbed698420b89658e5a6d5105/CF_logo_stacked_blktype.png" alt="The Cloudflare Blog" width="170" height="57"/></a><h2 class="mt0 mb1 dn di-l"><a href="/" class="fw5 f5 gray3 no-underline"><span class="dn di-l">The Cloudflare Blog</span></a></h2></div><div class="w-100 w-50-l dn db-l"><div class="w-100 tr mkto-sub-message"><p class="f2">Subscribe to receive notifications of new posts:</p></div><div class="w-100 tr"><div class="marketo-form-container"><form id="mktoForm_1653"><div class="top-subscribe-form-container"><div class="top-subscribe-form-field"><input placeholder="Email Address" class="top-subscribe-form-input" name="email" type="email" title="Must be valid email."/></div><button class="top-subscribe-form-button" type="button">Subscribe</button></div></form></div></div></div></header><nav dir="ltr" class="bb b--black-10 db dn-l w-100 ph3 "><div class=" flex justify-between items-center" style="height:44px"><a href="/search/"><img class="h-6 w-6" src="/images/magnifier.svg" alt="magnifier icon"/></a><button type="button" style="background:transparent;border:none"><img src="/images/hamburger.svg" alt="hamburger menu"/></button></div><div class="js-mobile-nav-container dn"><div class="flex flex-column flex-wrap bg-gray9 o-95 absolute ph3 z-1 left-0 right-0 mx-4"><div class="pv3 ph2 tl"><a href="/tag/ai/" class="no-underline gray1 f4 fw7">AI</a></div><div class="pv3 ph2 tl"><a href="/tag/developers/" class="no-underline gray1 f4 fw7">Developers</a></div><div class="pv3 ph2 tl"><a href="/tag/cloudflare-radar/" class="no-underline gray1 f4 fw7">Radar</a></div><div class="pv3 ph2 tl"><a href="/tag/product-news/" class="no-underline gray1 f4 fw7">Product News</a></div><div class="pv3 ph2 tl"><a href="/tag/security/" class="no-underline gray1 f4 fw7">Security</a></div><div class="pv3 ph2 tl"><a href="/tag/policy/" class="no-underline gray1 f4 fw7">Policy &amp; Legal</a></div><div class="pv3 ph2 tl"><a href="/tag/zero-trust/" class="no-underline gray1 f4 fw7">Zero Trust</a></div><div class="pv3 ph2 tl"><a href="/tag/speed-and-reliability/" class="no-underline gray1 f4 fw7">Speed &amp; Reliability</a></div><div class="pv3 ph2 tl"><a href="/tag/life-at-cloudflare/" class="no-underline gray1 f4 fw7">Life at Cloudflare</a></div><div class="pv3 ph2 tl"><a href="/tag/partners/" class="no-underline gray1 f4 fw7">Partners</a></div></div></div></nav><nav id="nav" class="w-100 bb-0 bb-l b--black-10 z-1"><div id="desktop-nav-items-container" class="flex flex-wrap justify-between items-center mw8 center mv3 mv0-l"><div data-tag="ai" class="nav-item nav-item-desktop ml3 mr2 dn db-l pv3"><a href="/tag/ai/" class="no-underline gray1 f2 fw5 pv3">AI</a></div><div data-tag="developers" class="nav-item nav-item-desktop ml3 mr2 dn db-l pv3"><a href="/tag/developers/" class="no-underline gray1 f2 fw5 pv3">Developers</a></div><div data-tag="cloudflare-radar" class="nav-item nav-item-desktop ml3 mr2 dn db-l pv3"><a href="/tag/cloudflare-radar/" class="no-underline gray1 f2 fw5 pv3">Radar</a></div><div data-tag="product-news" class="nav-item nav-item-desktop ml3 mr2 dn db-l pv3"><a href="/tag/product-news/" class="no-underline gray1 f2 fw5 pv3">Product News</a></div><div data-tag="security" class="nav-item nav-item-desktop ml3 mr2 dn db-l pv3"><a href="/tag/security/" class="no-underline gray1 f2 fw5 pv3">Security</a></div><div data-tag="policy" class="nav-item nav-item-desktop ml3 mr2 dn db-l pv3"><a href="/tag/policy/" class="no-underline gray1 f2 fw5 pv3">Policy &amp; Legal</a></div><div data-tag="zero-trust" class="nav-item nav-item-desktop ml3 mr2 dn db-l pv3"><a href="/tag/zero-trust/" class="no-underline gray1 f2 fw5 pv3">Zero Trust</a></div><div data-tag="speed-and-reliability" class="nav-item nav-item-desktop ml3 mr2 dn db-l pv3"><a href="/tag/speed-and-reliability/" class="no-underline gray1 f2 fw5 pv3">Speed &amp; Reliability</a></div><div data-tag="life-at-cloudflare" class="nav-item nav-item-desktop ml3 mr2 dn db-l pv3"><a href="/tag/life-at-cloudflare/" class="no-underline gray1 f2 fw5 pv3">Life at Cloudflare</a></div><div data-tag="partners" class="nav-item nav-item-desktop ml3 mr2 dn db-l pv3"><a href="/tag/partners/" class="no-underline gray1 f2 fw5 pv3">Partners</a></div><div class="nav-item ml2 mr3 dn db-l pv3" data-tag="search icon"><a href="/search/"><img id="search-icon" class="h-6 w-6" src="/images/magnifier.svg" alt="magnifier icon"/></a></div></div></nav><!--astro:end--></astro-island> <script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();</script> <div class="flex flex-row flex-wrap mw8 center bb b--gray8 ph3"> <h1 class="site-title f7 fw4 mt4 mb3 mv4-l">Post Mortem</h1> </div> <main id="site-main" class="flex flex-row flex-wrap mw8 center pt0 pt3-l mt4-l"> <astro-island uid="dpuzB" prefix="r0" component-url="/_astro/PostCard.DalyEN7z.js" component-export="PostCard" renderer-url="/_astro/client.DLO1yDVm.js" props="{&quot;currentPage&quot;:[0,1],&quot;isFeaturedImageFirstPost&quot;:[0,true],&quot;post&quot;:[0,{&quot;id&quot;:[0,&quot;2dN6tdkhtvWTTgAgbfzaSX&quot;],&quot;title&quot;:[0,&quot;Cloudflare service outage June 12, 2025&quot;],&quot;slug&quot;:[0,&quot;cloudflare-service-outage-june-12-2025&quot;],&quot;excerpt&quot;:[0,&quot;Multiple Cloudflare services, including Workers KV, Access, WARP and the Cloudflare dashboard, experienced an outage for up to 2 hours and 28 minutes on June 12, 2025.&quot;],&quot;featured&quot;:[0,false],&quot;html&quot;:[0,&quot;&lt;p&gt;On June 12, 2025, Cloudflare suffered a significant service outage that affected a large set of our critical services, including Workers KV, WARP, Access, Gateway, Images, Stream, Workers AI, Turnstile and Challenges, AutoRAG, Zaraz, and parts of the Cloudflare Dashboard.&lt;/p&gt;&lt;p&gt;This outage lasted 2 hours and 28 minutes, and globally impacted all Cloudflare customers using the affected services. The cause of this outage was due to a failure in the underlying storage infrastructure used by our Workers KV service, which is a critical dependency for many Cloudflare products and relied upon for configuration, authentication and asset delivery across the affected services. Part of this infrastructure is backed by a third-party cloud provider, which experienced an outage today and directly impacted availability of our KV service.&lt;/p&gt;&lt;p&gt;We’re deeply sorry for this outage: this was a failure on our part, and while the proximate cause (or trigger) for this outage was a third-party vendor failure, we are ultimately responsible for our chosen dependencies and how we choose to architect around them.&lt;/p&gt;&lt;p&gt;This was not the result of an attack or other security event. No data was lost as a result of this incident. Cloudflare Magic Transit and Magic WAN, DNS, Cache, proxy, WAF and related services were not directly impacted by this incident.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;what-was-impacted\&quot;&gt;What was impacted?&lt;/h2&gt;\n            &lt;a href=\&quot;#what-was-impacted\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;As a rule, Cloudflare designs and builds our services on our own platform building blocks, and as such many of Cloudflare’s products are built to rely on the Workers KV service. &lt;/p&gt;&lt;p&gt;The following table details the impacted services, including the user-facing impact, operation failures, and increases in error rates observed:&lt;/p&gt;&lt;table&gt;&lt;tr&gt;&lt;th&gt;&lt;p&gt;&lt;b&gt;Product/Service&lt;/b&gt;&lt;/p&gt;&lt;/th&gt;&lt;th&gt;&lt;p&gt;&lt;b&gt;Impact&lt;/b&gt;&lt;/p&gt;&lt;/th&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;&lt;b&gt;Workers KV&lt;/b&gt;&lt;/p&gt;&lt;p&gt;\n\n&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;Workers KV saw 90.22% of requests failing: any key-value pair not cached and that required to retrieve the value from Workers KV&amp;#39;s origin storage backends resulted in failed requests with response code 503 or 500. &lt;/p&gt;&lt;p&gt;The remaining requests were successfully served from Workers KV&amp;#39;s cache (status code 200 and 404) or returned errors within our expected limits and/or error budget.&lt;/p&gt;&lt;p&gt;This did not impact data stored in Workers KV.&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;&lt;b&gt;Access&lt;/b&gt;&lt;/p&gt;&lt;p&gt;\n\n&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;Access uses Workers KV to store application and policy configuration along with user identity information.&lt;/p&gt;&lt;p&gt;During the incident Access failed 100% of identity based logins for all application types including Self-Hosted, SaaS and Infrastructure. User Identity information was unavailable to other services like WARP and Gateway during this incident. Access is designed to fail closed when it cannot successfully fetch policy configuration or a user’s identity. &lt;/p&gt;&lt;p&gt;Active Infrastructure Application SSH sessions with command logging enabled failed to save logs due to a Workers KV dependency. &lt;/p&gt;&lt;p&gt;Access’ System for Cross Domain Identity (SCIM) service was also impacted due to its reliance on Workers KV and Durable Objects (which depended on KV) to store user information. During this incident, user identities were not updated due to Workers KV updates failures. These failures would result in a 500 returned to identity providers. Some providers may require a manual re-synchronization but most customers would have seen immediate service restoration once Access’ SCIM service was restored due to retry logic by the identity provider.&lt;/p&gt;&lt;p&gt;Service authentication based logins (e.g. service token, Mutual TLS, and IP-based policies) and Bypass policies were unaffected. No Access policy edits or changes were lost during this time.&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;&lt;b&gt;Gateway&lt;/b&gt;&lt;/p&gt;&lt;p&gt;\n\n&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;This incident did not affect most Gateway DNS queries, including those over IPv4, IPv6, DNS over TLS (DoT), and DNS over HTTPS (DoH).&lt;/p&gt;&lt;p&gt;However, there were two exceptions:&lt;/p&gt;&lt;p&gt;DoH queries with identity-based rules failed. This happened because Gateway couldn&amp;#39;t retrieve the required user’s identity information.&lt;/p&gt;&lt;p&gt;Authenticated DoH was disrupted for some users. Users with active sessions with valid authentication tokens were unaffected, but those needing to start new sessions or refresh authentication tokens could not.&lt;/p&gt;&lt;p&gt;Users of Gateway proxy, egress, and TLS decryption were unable to connect, register, proxy, or log traffic.&lt;/p&gt;&lt;p&gt;This was due to our reliance on Workers KV to retrieve up-to-date identity and device posture information. Each of these actions requires a call to Workers KV, and when unavailable, Gateway is designed to fail closed to prevent traffic from bypassing customer-configured rules.&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;&lt;b&gt;WARP&lt;/b&gt;&lt;/p&gt;&lt;p&gt;\n\n\n&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;The WARP client was impacted due to core dependencies on Access and Workers KV, which is required for device registration and authentication. As a result, no new clients were able to connect or sign up during the incident.&lt;/p&gt;&lt;p&gt;Existing WARP client users sessions that were routed through the Gateway proxy experienced disruptions, as Gateway was unable to perform its required policy evaluations.&lt;/p&gt;&lt;p&gt;Additionally, the WARP emergency disconnect override was rendered unavailable because of a failure in its underlying dependency, Workers KV.&lt;/p&gt;&lt;p&gt;Consumer WARP saw a similar sporadic impact as the Zero Trust version.&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;&lt;b&gt;Dashboard&lt;/b&gt;&lt;/p&gt;&lt;p&gt;\n\n&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;Dashboard user logins and most of the existing dashboard sessions were unavailable. This was due to an outage affecting Turnstile, DO, KV, and Access. The specific causes for login failures were:&lt;/p&gt;&lt;p&gt;Standard Logins (User/Password): Failed due to Turnstile unavailability.&lt;/p&gt;&lt;p&gt;Sign-in with Google (OIDC) Logins: Failed due to a KV dependency issue.&lt;/p&gt;&lt;p&gt;SSO Logins: Failed due to a full dependency on Access.&lt;/p&gt;&lt;p&gt;The Cloudflare v4 API was not impacted during this incident.&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;&lt;b&gt;Challenges and Turnstile&lt;/b&gt;&lt;/p&gt;&lt;p&gt;\n\n&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;The Challenge platform that powers Cloudflare Challenges and Turnstile saw a high rate of failure and timeout for siteverify API requests during the incident window due to its dependencies on Workers KV and Durable Objects.&lt;/p&gt;&lt;p&gt;We have kill switches in place to disable these calls in case of incidents and outages such as this. We activated these kill switches as a mitigation so that eyeballs are not blocked from proceeding. Notably, while these kill switches were active, Turnstile’s siteverify API (the API that validates issued tokens) could redeem valid tokens multiple times, potentially allowing for attacks where a bad actor might try to use a previously valid token to bypass. &lt;/p&gt;&lt;p&gt;There was no impact to Turnstile’s ability to detect bots. A bot attempting to solve a challenge would still have failed the challenge and thus, not receive a token. &lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;&lt;b&gt;Browser Isolation&lt;/b&gt;&lt;/p&gt;&lt;p&gt;\n\n&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;Existing Browser Isolation sessions via Link-based isolation were impacted due to a reliance on Gateway for policy evaluation.&lt;/p&gt;&lt;p&gt;New link-based Browser Isolation sessions could not be initiated due to a dependency on Cloudflare Access. All Gateway-initiated isolation sessions failed due its Gateway dependency.&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;&lt;b&gt;Images&lt;/b&gt;&lt;/p&gt;&lt;p&gt;\n\n&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;Batch uploads to Cloudflare Images were impacted during the incident window, with a 100% failure rate at the peak of the incident. Other uploads were not impacted.&lt;/p&gt;&lt;p&gt;Overall image delivery dipped to around 97% success rate. Image Transformations were not significantly impacted, and Polish was not impacted.&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;&lt;b&gt;Stream&lt;/b&gt;&lt;/p&gt;&lt;p&gt;\n\n&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;Stream’s error rate exceeded 90% during the incident window as video playlists were unable to be served. Stream Live observed a 100% error rate.&lt;/p&gt;&lt;p&gt;Video uploads were not impacted.&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;&lt;b&gt;Realtime&lt;/b&gt;&lt;/p&gt;&lt;p&gt;\n\n&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;The Realtime TURN (Traversal Using Relays around NAT) service uses KV and was heavily impacted. Error rates were near 100% for the duration of the incident window.&lt;/p&gt;&lt;p&gt;The Realtime SFU service (Selective Forwarding Unit) was unable to create new sessions, although existing connections were maintained. This caused a reduction to 20% of normal traffic during the impact window. &lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;&lt;b&gt;Workers AI&lt;/b&gt;&lt;/p&gt;&lt;p&gt;\n\n&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;All inference requests to Workers AI failed for the duration of the incident. Workers AI depends on Workers KV for distributing configuration and routing information for AI requests globally.&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;&lt;b&gt;Pages &amp;amp; Workers Assets&lt;/b&gt;&lt;/p&gt;&lt;p&gt;\n\n&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;Static assets served by Cloudflare Pages and Workers Assets (such as HTML, JavaScript, CSS, images, etc) are stored in Workers KV, cached, and retrieved at request time. Workers Assets saw an average error rate increase of around 0.06% of total requests during this time. &lt;/p&gt;&lt;p&gt;During the incident window, Pages error rate peaked to ~100% and all Pages builds could not complete. &lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;&lt;b&gt;AutoRAG&lt;/b&gt;&lt;/p&gt;&lt;p&gt;\n\n&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;AutoRAG relies on Workers AI models for both document conversion and generating vector embeddings during indexing, as well as LLM models for querying and search. AutoRAG was unavailable during the incident window because of the Workers AI dependency.&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;&lt;b&gt;Durable Objects&lt;/b&gt;&lt;/p&gt;&lt;p&gt;\n\n&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;SQLite-backed Durable Objects share the same underlying storage infrastructure as Workers KV. The average error rate during the incident window peaked at 22%, and dropped to 2% as services started to recover.&lt;/p&gt;&lt;p&gt;Durable Object namespaces using the legacy key-value storage were not impacted.&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;&lt;b&gt;D1&lt;/b&gt;&lt;/p&gt;&lt;p&gt;\n&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;D1 databases share the same underlying storage infrastructure as Workers KV and Durable Objects.&lt;/p&gt;&lt;p&gt;Similar to Durable Objects, the average error rate during the incident window peaked at 22%, and dropped to 2% as services started to recover.&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;&lt;b&gt;Queues &amp;amp; Event Notifications&lt;/b&gt;&lt;/p&gt;&lt;p&gt;\n&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;Queues message operations including–pushing and consuming–were unavailable during the incident window.&lt;/p&gt;&lt;p&gt;Queues uses KV to map each Queue to underlying Durable Objects that contain queued messages.&lt;/p&gt;&lt;p&gt;Event Notifications use Queues as their underlying delivery mechanism.&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;&lt;b&gt;AI Gateway&lt;/b&gt;&lt;/p&gt;&lt;p&gt;\n\n&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;AI Gateway is built on top of Workers and relies on Workers KV for client and internal configurations. During the incident window, AI Gateway saw error rates peak at 97% of requests until dependencies recovered.&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;&lt;b&gt;CDN&lt;/b&gt;&lt;/p&gt;&lt;p&gt;\n\n&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;Automated traffic management infrastructure was operational but acted with reduced efficacy during the impact period. In particular, registration requests from Zero Trust clients increased substantially as a result of the outage.&lt;/p&gt;&lt;p&gt;The increase in requests imposed additional load in several Cloudflare locations, triggering response from automated traffic management. In response to these conditions, systems rerouted incoming CDN traffic to nearby locations, reducing impact to customers. There was a portion of traffic that was not rerouted as expected and is under investigation. CDN requests impacted by this issue would experience elevated latency, HTTP 499 errors, and / or HTTP 503 errors. Impacted Cloudflare service areas included São Paulo, Philadelphia, Atlanta, and Raleigh.&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;&lt;b&gt;Workers / Workers for Platforms&lt;/b&gt;&lt;/p&gt;&lt;p&gt;\n\n&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;Workers and Workers for Platforms rely on a third party service for uploads. During the incident window, Workers saw an overall error rate peak to ~2% of total requests. Workers for Platforms saw an overall error rate peak to ~10% of total requests during the same time period. &lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;&lt;b&gt;Workers Builds (CI/CD)\n &lt;/b&gt;&lt;/p&gt;&lt;p&gt;\n&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;Starting at 18:03 UTC Workers builds could not receive new source code management push events due to Access being down.&lt;/p&gt;&lt;p&gt;100% of new Workers Builds failed during the incident window.&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;&lt;b&gt;Browser Rendering&lt;/b&gt;&lt;/p&gt;&lt;p&gt;\n\n&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;Browser Rendering depends on Browser Isolation for browser instance infrastructure.&lt;/p&gt;&lt;p&gt;Requests to both the REST API and via the Workers Browser Binding were 100% impacted during the incident window.&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;&lt;b&gt;Zaraz&lt;/b&gt;&lt;/p&gt;&lt;p&gt;\n&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;100% of requests were impacted during the incident window. Zaraz relies on Workers KV configs for websites when handling eyeball traffic. Due to the same dependency, attempts to save updates to Zaraz configs were unsuccessful during this period, but our monitoring shows that only a single user was affected.&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;background\&quot;&gt;Background&lt;/h2&gt;\n            &lt;a href=\&quot;#background\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;Workers KV is built as what we call a “coreless” service which means there should be no single point of failure as the service runs independently in each of our locations worldwide. However, Workers KV today relies on a central data store to provide a source of truth for data. A failure of that store caused a complete outage for cold reads and writes to the KV namespaces used by services across Cloudflare.&lt;/p&gt;&lt;p&gt;Workers KV is in the process of being transitioned to significantly more resilient infrastructure for its central store: regrettably, we had a gap in coverage which was exposed during this incident. Workers KV removed a storage provider as we worked to re-architect KV’s backend, including migrating it to Cloudflare R2, to prevent data consistency issues (caused by the original data syncing architecture), and to improve support for data residency requirements.&lt;/p&gt;&lt;p&gt;One of our principles is to build Cloudflare services on our own platform as much as possible, and Workers KV is no exception. Many of our internal and external services rely heavily on Workers KV, which under normal circumstances helps us deliver the most robust services possible, instead of service teams attempting to build their own storage services. In this case, the cascading impact from the failure from Workers KV exacerbated the issue and significantly broadened the blast radius. &lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;incident-timeline-and-impact\&quot;&gt;Incident timeline and impact&lt;/h2&gt;\n            &lt;a href=\&quot;#incident-timeline-and-impact\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;The incident timeline, including the initial impact, investigation, root cause, and remediation, are detailed below. &lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/7CBPPVgr3GroJP2EcD3yvB/6073457ce6263e7e05f6eb3d796ddd48/BLOG-2847_2.png\&quot; alt=\&quot;BLOG-2847 2\&quot; class=\&quot;kg-image\&quot; width=\&quot;1686\&quot; height=\&quot;794\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;&lt;i&gt;&lt;sub&gt;Workers KV error rates to storage infrastructure. 91% of requests to KV failed during the incident window.&lt;/sub&gt;&lt;/i&gt;&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/5sGFmSsNHD9yXwJ9Ea5jov/78349be4318cb738cdd72643e69f7bdb/BLOG-2847_1.png\&quot; alt=\&quot;BLOG-2847 1\&quot; class=\&quot;kg-image\&quot; width=\&quot;978\&quot; height=\&quot;501\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;&lt;i&gt;&lt;sub&gt;Cloudflare Access percentage of successful requests. Cloudflare Access relies directly on Workers KV and serves as a good proxy to measure Workers KV availability over time.&lt;/sub&gt;&lt;/i&gt;&lt;/p&gt;&lt;p&gt;All timestamps referenced are in Coordinated Universal Time (UTC).&lt;/p&gt;&lt;table&gt;&lt;tr&gt;&lt;th&gt;&lt;p&gt;&lt;b&gt;Time&lt;/b&gt;&lt;/p&gt;&lt;/th&gt;&lt;th&gt;&lt;p&gt;&lt;b&gt;Event&lt;/b&gt;&lt;/p&gt;&lt;/th&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;2025-06-12 17:52&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;&lt;b&gt;INCIDENT START\n&lt;/b&gt;Cloudflare WARP team begins to see registrations of new devices fail and begin to investigate these failures and declares an incident.&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;2025-06-12 18:05&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;Cloudflare Access team received an alert due to a rapid increase in error rates.&lt;/p&gt;&lt;p&gt;Service Level Objectives for multiple services drop below targets and trigger alerts across those teams.&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;2025-06-12 18:06&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;Multiple service-specific incidents are combined into a single incident as we identify a shared cause (Workers KV unavailability). Incident priority upgraded to P1.&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;2025-06-12 18:21&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;Incident priority upgraded to P0 from P1 as severity of impact becomes clear.&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;2025-06-12 18:43&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;Cloudflare Access begins exploring options to remove Workers KV dependency by migrating to a different backing datastore with the Workers KV engineering team. This was proactive in the event the storage infrastructure continued to be down.&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;2025-06-12 19:09&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;Zero Trust Gateway began working to remove dependencies on Workers KV by gracefully degrading rules that referenced Identity or Device Posture state.&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;2025-06-12 19:32&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;Access and Device Posture force drop identity and device posture requests to shed load on Workers KV until third-party service comes back online.&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;2025-06-12 19:45&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;Cloudflare teams continue to work on a path to deploying a Workers KV release against an alternative backing datastore and having critical services write configuration data to that store.&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;2025-06-12 20:23&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;Services begin to recover as storage infrastructure begins to recover. We continue to see a non-negligible error rate and infrastructure rate limits due to the influx of services repopulating caches.&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;2025-06-12 20:25&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;Access and Device Posture restore calling Workers KV as third-party service is restored.&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;2025-06-12 20:28&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;&lt;b&gt;IMPACT END \n&lt;/b&gt;Service Level Objectives return to pre-incident level. Cloudflare teams continue to monitor systems to ensure services do not degrade as dependent systems recover.&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;\n&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;&lt;b&gt;INCIDENT END\n&lt;/b&gt;Cloudflare team see all affected services return to normal function. Service level objective alerts are recovered.&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;remediation-and-follow-up-steps\&quot;&gt;Remediation and follow-up steps&lt;/h2&gt;\n            &lt;a href=\&quot;#remediation-and-follow-up-steps\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;We’re taking immediate steps to improve the resiliency of services that depend on Workers KV and our storage infrastructure. This includes existing planned work that we are accelerating as a result of this incident.&lt;/p&gt;&lt;p&gt;This encompasses several workstreams, including efforts to avoid singular dependencies on storage infrastructure we do not own, improving the ability for us to recover critical services (including Access, Gateway and WARP) &lt;/p&gt;&lt;p&gt;Specifically:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;(Actively in-flight): Bringing forward our work to improve the redundancy within Workers KV’s storage infrastructure, removing the dependency on any single provider. During the incident window we began work to cut over and backfill critical KV namespaces to our own infrastructure, in the event the incident continued. &lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;(Actively in-flight): Short-term blast radius remediations for individual products that were impacted by this incident so that each product becomes resilient to any loss of service caused by any single point of failure, including third party dependencies.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;(Actively in-flight): Implementing tooling that allows us to progressively re-enable namespaces during storage infrastructure incidents. This will allow us to ensure that key dependencies, including Access and WARP, are able to come up without risking a denial-of-service against our own infrastructure as caches are repopulated.&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;This list is not exhaustive: our teams continue to revisit design decisions and assess the infrastructure changes we need to make in both the near (immediate) term and long term to mitigate the incidents like this going forward.&lt;/p&gt;&lt;p&gt;This was a serious outage, and we understand that organizations and institutions that are large and small depend on us to protect and/or run their websites, applications, zero trust and network infrastructure.  Again we are deeply sorry for the impact and are working diligently to improve our service resiliency. &lt;/p&gt;&quot;],&quot;published_at&quot;:[0,&quot;2025-06-12T14:00-08:00&quot;],&quot;updated_at&quot;:[0,&quot;2025-06-19T13:58:52.829Z&quot;],&quot;feature_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/CvsaXPEHDPXb5sf0jWB1a/4e152d7ff5e4ccaa8d9d4ee09636e539/image1.png&quot;],&quot;tags&quot;:[1,[[0,{&quot;id&quot;:[0,&quot;4yliZlpBPZpOwBDZzo1tTh&quot;],&quot;name&quot;:[0,&quot;Outage&quot;],&quot;slug&quot;:[0,&quot;outage&quot;]}],[0,{&quot;id&quot;:[0,&quot;3cCNoJJ5uusKFBLYKFX1jB&quot;],&quot;name&quot;:[0,&quot;Post Mortem&quot;],&quot;slug&quot;:[0,&quot;post-mortem&quot;]}]]],&quot;relatedTags&quot;:[0],&quot;authors&quot;:[1,[[0,{&quot;name&quot;:[0,&quot;Jeremy Hartman&quot;],&quot;slug&quot;:[0,&quot;jeremy-hartman&quot;],&quot;bio&quot;:[0,null],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1yTvNpd60qmjgY8fbItcDp/f964f6cd281c1693cee7b4a43a6e3845/jeremy-hartman.jpeg&quot;],&quot;location&quot;:[0,null],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,null],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}],[0,{&quot;name&quot;:[0,&quot;CJ Desai&quot;],&quot;slug&quot;:[0,&quot;cj-desai&quot;],&quot;bio&quot;:[0],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/38fnsyN8gdlupsCRxEBMar/1bfb2964eb7c9221efe9fa4af3c694cd/CJ_Desai__President_of_Product_and_Engineering__Cloudflare.JPG&quot;],&quot;location&quot;:[0],&quot;website&quot;:[0],&quot;twitter&quot;:[0],&quot;facebook&quot;:[0],&quot;publiclyIndex&quot;:[0,true]}]]],&quot;meta_description&quot;:[0,&quot;Multiple Cloudflare services, including Workers KV, Access, WARP and the Cloudflare dashboard, experienced an outage for up to 2 hours and 28 minutes on June 12, 2025.&quot;],&quot;primary_author&quot;:[0,{}],&quot;localeList&quot;:[0,{&quot;name&quot;:[0,&quot;LOC: Cloudflare service outage June 12, 2025&quot;],&quot;enUS&quot;:[0,&quot;English for Locale&quot;],&quot;zhCN&quot;:[0,&quot;Translated for Locale&quot;],&quot;zhHansCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhTW&quot;:[0,&quot;Translated for Locale&quot;],&quot;frFR&quot;:[0,&quot;Translated for Locale&quot;],&quot;deDE&quot;:[0,&quot;Translated for Locale&quot;],&quot;itIT&quot;:[0,&quot;No Page for Locale&quot;],&quot;jaJP&quot;:[0,&quot;Translated for Locale&quot;],&quot;koKR&quot;:[0,&quot;Translated for Locale&quot;],&quot;ptBR&quot;:[0,&quot;No Page for Locale&quot;],&quot;esLA&quot;:[0,&quot;No Page for Locale&quot;],&quot;esES&quot;:[0,&quot;Translated for Locale&quot;],&quot;enAU&quot;:[0,&quot;No Page for Locale&quot;],&quot;enCA&quot;:[0,&quot;No Page for Locale&quot;],&quot;enIN&quot;:[0,&quot;No Page for Locale&quot;],&quot;enGB&quot;:[0,&quot;No Page for Locale&quot;],&quot;idID&quot;:[0,&quot;No Page for Locale&quot;],&quot;ruRU&quot;:[0,&quot;No Page for Locale&quot;],&quot;svSE&quot;:[0,&quot;No Page for Locale&quot;],&quot;viVN&quot;:[0,&quot;No Page for Locale&quot;],&quot;plPL&quot;:[0,&quot;No Page for Locale&quot;],&quot;arAR&quot;:[0,&quot;No Page for Locale&quot;],&quot;nlNL&quot;:[0,&quot;Translated for Locale&quot;],&quot;thTH&quot;:[0,&quot;English for Locale&quot;],&quot;trTR&quot;:[0,&quot;English for Locale&quot;],&quot;heIL&quot;:[0,&quot;English for Locale&quot;],&quot;lvLV&quot;:[0,&quot;English for Locale&quot;],&quot;etEE&quot;:[0,&quot;English for Locale&quot;],&quot;ltLT&quot;:[0,&quot;English for Locale&quot;]}],&quot;url&quot;:[0,&quot;https://blog.cloudflare.com/cloudflare-service-outage-june-12-2025&quot;],&quot;metadata&quot;:[0,{&quot;title&quot;:[0,&quot;Cloudflare service outage June 12, 2025&quot;],&quot;description&quot;:[0,&quot;Today, June 12, 2025, Cloudflare suffered a significant service outage that affected a large set of our critical services, including Workers KV, WARP, Access, Gateway, Images, Stream, Workers AI, Turnstile and Challenges, AutoRAG, and parts of the Cloudflare Dashboard.&quot;],&quot;imgPreview&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1PPINmVPRc1emQMpc5JIXe/1bf284f6d9c8ccb36bb40b7cffb1cab3/Cloudflare_service_outage_June_12__2025-OG.png&quot;]}],&quot;publicly_index&quot;:[0,true]}],&quot;translations&quot;:[0,{&quot;posts.by&quot;:[0,&quot;By&quot;],&quot;footer.gdpr&quot;:[0,&quot;GDPR&quot;],&quot;lang_blurb1&quot;:[0,&quot;This post is also available in {lang1}.&quot;],&quot;lang_blurb2&quot;:[0,&quot;This post is also available in {lang1} and {lang2}.&quot;],&quot;lang_blurb3&quot;:[0,&quot;This post is also available in {lang1}, {lang2} and {lang3}.&quot;],&quot;footer.press&quot;:[0,&quot;Press&quot;],&quot;header.title&quot;:[0,&quot;The Cloudflare Blog&quot;],&quot;search.clear&quot;:[0,&quot;Clear&quot;],&quot;search.filter&quot;:[0,&quot;Filter&quot;],&quot;search.source&quot;:[0,&quot;Source&quot;],&quot;footer.careers&quot;:[0,&quot;Careers&quot;],&quot;footer.company&quot;:[0,&quot;Company&quot;],&quot;footer.support&quot;:[0,&quot;Support&quot;],&quot;footer.the_net&quot;:[0,&quot;theNet&quot;],&quot;search.filters&quot;:[0,&quot;Filters&quot;],&quot;footer.our_team&quot;:[0,&quot;Our team&quot;],&quot;footer.webinars&quot;:[0,&quot;Webinars&quot;],&quot;page.more_posts&quot;:[0,&quot;More posts&quot;],&quot;posts.time_read&quot;:[0,&quot;{time} min read&quot;],&quot;search.language&quot;:[0,&quot;Language&quot;],&quot;footer.community&quot;:[0,&quot;Community&quot;],&quot;footer.resources&quot;:[0,&quot;Resources&quot;],&quot;footer.solutions&quot;:[0,&quot;Solutions&quot;],&quot;footer.trademark&quot;:[0,&quot;Trademark&quot;],&quot;header.subscribe&quot;:[0,&quot;Subscribe&quot;],&quot;footer.compliance&quot;:[0,&quot;Compliance&quot;],&quot;footer.free_plans&quot;:[0,&quot;Free plans&quot;],&quot;footer.impact_ESG&quot;:[0,&quot;Impact/ESG&quot;],&quot;posts.follow_on_X&quot;:[0,&quot;Follow on X&quot;],&quot;footer.help_center&quot;:[0,&quot;Help center&quot;],&quot;footer.network_map&quot;:[0,&quot;Network Map&quot;],&quot;header.please_wait&quot;:[0,&quot;Please Wait&quot;],&quot;page.related_posts&quot;:[0,&quot;Related posts&quot;],&quot;search.result_stat&quot;:[0,&quot;Results &lt;strong&gt;{search_range}&lt;/strong&gt; of &lt;strong&gt;{search_total}&lt;/strong&gt; for &lt;strong&gt;{search_keyword}&lt;/strong&gt;&quot;],&quot;footer.case_studies&quot;:[0,&quot;Case Studies&quot;],&quot;footer.connect_2024&quot;:[0,&quot;Connect 2024&quot;],&quot;footer.terms_of_use&quot;:[0,&quot;Terms of Use&quot;],&quot;footer.white_papers&quot;:[0,&quot;White Papers&quot;],&quot;footer.cloudflare_tv&quot;:[0,&quot;Cloudflare TV&quot;],&quot;footer.community_hub&quot;:[0,&quot;Community Hub&quot;],&quot;footer.compare_plans&quot;:[0,&quot;Compare plans&quot;],&quot;footer.contact_sales&quot;:[0,&quot;Contact Sales&quot;],&quot;header.contact_sales&quot;:[0,&quot;Contact Sales&quot;],&quot;header.email_address&quot;:[0,&quot;Email Address&quot;],&quot;page.error.not_found&quot;:[0,&quot;Page not found&quot;],&quot;footer.developer_docs&quot;:[0,&quot;Developer docs&quot;],&quot;footer.privacy_policy&quot;:[0,&quot;Privacy Policy&quot;],&quot;footer.request_a_demo&quot;:[0,&quot;Request a demo&quot;],&quot;page.continue_reading&quot;:[0,&quot;Continue reading&quot;],&quot;footer.analysts_report&quot;:[0,&quot;Analyst reports&quot;],&quot;footer.for_enterprises&quot;:[0,&quot;For enterprises&quot;],&quot;footer.getting_started&quot;:[0,&quot;Getting Started&quot;],&quot;footer.learning_center&quot;:[0,&quot;Learning Center&quot;],&quot;footer.project_galileo&quot;:[0,&quot;Project Galileo&quot;],&quot;pagination.newer_posts&quot;:[0,&quot;Newer Posts&quot;],&quot;pagination.older_posts&quot;:[0,&quot;Older Posts&quot;],&quot;posts.social_buttons.x&quot;:[0,&quot;Discuss on X&quot;],&quot;search.icon_aria_label&quot;:[0,&quot;Search&quot;],&quot;search.source_location&quot;:[0,&quot;Source/Location&quot;],&quot;footer.about_cloudflare&quot;:[0,&quot;About Cloudflare&quot;],&quot;footer.athenian_project&quot;:[0,&quot;Athenian Project&quot;],&quot;footer.become_a_partner&quot;:[0,&quot;Become a partner&quot;],&quot;footer.cloudflare_radar&quot;:[0,&quot;Cloudflare Radar&quot;],&quot;footer.network_services&quot;:[0,&quot;Network services&quot;],&quot;footer.trust_and_safety&quot;:[0,&quot;Trust &amp; Safety&quot;],&quot;header.get_started_free&quot;:[0,&quot;Get Started Free&quot;],&quot;page.search.placeholder&quot;:[0,&quot;Search Cloudflare&quot;],&quot;footer.cloudflare_status&quot;:[0,&quot;Cloudflare Status&quot;],&quot;footer.cookie_preference&quot;:[0,&quot;Cookie Preferences&quot;],&quot;header.valid_email_error&quot;:[0,&quot;Must be valid email.&quot;],&quot;search.result_stat_empty&quot;:[0,&quot;Results &lt;strong&gt;{search_range}&lt;/strong&gt; of &lt;strong&gt;{search_total}&lt;/strong&gt;&quot;],&quot;footer.connectivity_cloud&quot;:[0,&quot;Connectivity cloud&quot;],&quot;footer.developer_services&quot;:[0,&quot;Developer services&quot;],&quot;footer.investor_relations&quot;:[0,&quot;Investor relations&quot;],&quot;page.not_found.error_code&quot;:[0,&quot;Error Code: 404&quot;],&quot;search.autocomplete_title&quot;:[0,&quot;Insert a query. Press enter to send&quot;],&quot;footer.logos_and_press_kit&quot;:[0,&quot;Logos &amp; press kit&quot;],&quot;footer.application_services&quot;:[0,&quot;Application services&quot;],&quot;footer.get_a_recommendation&quot;:[0,&quot;Get a recommendation&quot;],&quot;posts.social_buttons.reddit&quot;:[0,&quot;Discuss on Reddit&quot;],&quot;footer.sse_and_sase_services&quot;:[0,&quot;SSE and SASE services&quot;],&quot;page.not_found.outdated_link&quot;:[0,&quot;You may have used an outdated link, or you may have typed the address incorrectly.&quot;],&quot;footer.report_security_issues&quot;:[0,&quot;Report Security Issues&quot;],&quot;page.error.error_message_page&quot;:[0,&quot;Sorry, we can&#39;t find the page you are looking for.&quot;],&quot;header.subscribe_notifications&quot;:[0,&quot;Subscribe to receive notifications of new posts:&quot;],&quot;footer.cloudflare_for_campaigns&quot;:[0,&quot;Cloudflare for Campaigns&quot;],&quot;header.subscription_confimation&quot;:[0,&quot;Subscription confirmed. Thank you for subscribing!&quot;],&quot;posts.social_buttons.hackernews&quot;:[0,&quot;Discuss on Hacker News&quot;],&quot;footer.diversity_equity_inclusion&quot;:[0,&quot;Diversity, equity &amp; inclusion&quot;],&quot;footer.critical_infrastructure_defense_project&quot;:[0,&quot;Critical Infrastructure Defense Project&quot;]}]}" ssr client="load" opts="{&quot;name&quot;:&quot;PostCard&quot;,&quot;value&quot;:true}" await-children><article class="w-100 featured-post  flex flex-row flex-wrap mb4 items-center bb b--gray8 bn-l  mt4 mt2-l mb4 ph3 bb b--gray8 bn-l"><div class="w-50-l"><a href="/cloudflare-service-outage-june-12-2025/" class="fw5 no-underline gray1" data-testid="post-title"><h2 class="fw5 mt2">Cloudflare service outage June 12, 2025</h2></a><p class="f3 fw5 gray5 my" data-testid="post-date">2025-06-12</p><p class="f4 fw3 lh-copy " data-testid="post-content">Multiple Cloudflare services, including Workers KV, Access, WARP and the Cloudflare dashboard, experienced an outage for up to 2 hours and 28 minutes on June 12, 2025.<!-- -->...</p><a href="/cloudflare-service-outage-june-12-2025/" class="no-underline gray1 f4 lh-copy fw3 underline-hover" data-testid="post-continue-reading">Continue reading »</a><ul class="author-lists flex pl0"><li class="list flex items-center pr2 mb3"><a href="/author/jeremy-hartman/" class="static-avatar pr1"><img class="author-profile-image br-100 mr2" src="https://blog.cloudflare.com/cdn-cgi/image/format=auto,dpr=3,width=64,height=64,gravity=face,fit=crop,zoom=0.5/https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1yTvNpd60qmjgY8fbItcDp/f964f6cd281c1693cee7b4a43a6e3845/jeremy-hartman.jpeg" alt="Jeremy Hartman" width="62" height="62"/></a><div class="author-name-tooltip"><a href="/author/jeremy-hartman/" class="fw5 f4 no-underline black">Jeremy Hartman</a></div></li><li class="list flex items-center pr2 mb3"><a href="/author/cj-desai/" class="static-avatar pr1"><img class="author-profile-image br-100 mr2" src="https://blog.cloudflare.com/cdn-cgi/image/format=auto,dpr=3,width=64,height=64,gravity=face,fit=crop,zoom=0.5/https://cf-assets.www.cloudflare.com/zkvhlag99gkb/38fnsyN8gdlupsCRxEBMar/1bfb2964eb7c9221efe9fa4af3c694cd/CJ_Desai__President_of_Product_and_Engineering__Cloudflare.JPG" alt="CJ Desai" width="62" height="62"/></a><div class="author-name-tooltip"><a href="/author/cj-desai/" class="fw5 f4 no-underline black">CJ Desai</a></div></li></ul></div><div class="w-50-l"><img class="dn di-l " src="https://cf-assets.www.cloudflare.com/zkvhlag99gkb/CvsaXPEHDPXb5sf0jWB1a/4e152d7ff5e4ccaa8d9d4ee09636e539/image1.png" alt="Cloudflare service outage June 12, 2025"/></div></article><!--astro:end--></astro-island><astro-island uid="Z1vYdoM" prefix="r1" component-url="/_astro/PostCard.DalyEN7z.js" component-export="PostCard" renderer-url="/_astro/client.DLO1yDVm.js" props="{&quot;currentPage&quot;:[0,1],&quot;isFeaturedImageFirstPost&quot;:[0,false],&quot;post&quot;:[0,{&quot;id&quot;:[0,&quot;4I4XNCQlRirlf9SaA9ySTS&quot;],&quot;title&quot;:[0,&quot;Cloudflare incident on March 21, 2025&quot;],&quot;slug&quot;:[0,&quot;cloudflare-incident-march-21-2025&quot;],&quot;excerpt&quot;:[0,&quot;On March 21, 2025, multiple Cloudflare services, including R2 object storage experienced an elevated rate of error responses. Here’s what caused the incident, the impact, and how we are making sure it&quot;],&quot;featured&quot;:[0,false],&quot;html&quot;:[0,&quot;&lt;p&gt;Multiple Cloudflare services, including &lt;a href=\&quot;https://developers.cloudflare.com/r2/\&quot;&gt;&lt;u&gt;R2 object storage&lt;/u&gt;&lt;/a&gt;, experienced an elevated rate of errors for 1 hour and 7 minutes on March 21, 2025 (starting at 21:38 UTC and ending 22:45 UTC). During the incident window, 100% of write operations failed and approximately 35% of read operations to R2 failed globally. Although this incident started with R2, it impacted other Cloudflare services including &lt;a href=\&quot;https://www.cloudflare.com/developer-platform/products/cache-reserve/\&quot;&gt;&lt;u&gt;Cache Reserve&lt;/u&gt;&lt;/a&gt;, &lt;a href=\&quot;https://www.cloudflare.com/developer-platform/products/cloudflare-images/\&quot;&gt;&lt;u&gt;Images&lt;/u&gt;&lt;/a&gt;, &lt;a href=\&quot;https://developers.cloudflare.com/logs/edge-log-delivery/\&quot;&gt;&lt;u&gt;Log Delivery&lt;/u&gt;&lt;/a&gt;, &lt;a href=\&quot;https://www.cloudflare.com/developer-platform/products/cloudflare-stream/\&quot;&gt;&lt;u&gt;Stream&lt;/u&gt;&lt;/a&gt;, and &lt;a href=\&quot;https://developers.cloudflare.com/vectorize/\&quot;&gt;&lt;u&gt;Vectorize&lt;/u&gt;&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;While rotating credentials used by the R2 Gateway service (R2&amp;#39;s API frontend) to authenticate with our storage infrastructure, the R2 engineering team inadvertently deployed the new credentials (ID and key pair) to a development instance of the service instead of production. When the old credentials were deleted from our storage infrastructure (as part of the key rotation process), the production R2 Gateway service did not have access to the new credentials. This ultimately resulted in R2’s Gateway service not being able to authenticate with our storage backend. There was no data loss or corruption that occurred as part of this incident: any in-flight uploads or mutations that returned successful HTTP status codes were persisted.&lt;/p&gt;&lt;p&gt;Once the root cause was identified and we realized we hadn’t deployed the new credentials to the production R2 Gateway service, we deployed the updated credentials and service availability was restored. &lt;/p&gt;&lt;p&gt;This incident happened because of human error and lasted longer than it should have because we didn’t have proper visibility into which credentials were being used by the Gateway Worker to authenticate with our storage infrastructure. &lt;/p&gt;&lt;p&gt;We’re deeply sorry for this incident and the disruption it may have caused to you or your users. We hold ourselves to a high standard and this is not acceptable. This blog post exactly explains the impact, what happened and when, and the steps we are taking to make sure this failure (and others like it) doesn’t happen again.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;what-was-impacted\&quot;&gt;What was impacted?&lt;/h2&gt;\n            &lt;a href=\&quot;#what-was-impacted\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;&lt;b&gt;The primary incident window occurred between 21:38 UTC and 22:45 UTC.&lt;/b&gt;&lt;/p&gt;&lt;p&gt;The following table details the specific impact to R2 and Cloudflare services that depend on, or interact with, R2:&lt;/p&gt;&lt;style type=\&quot;text/css\&quot;&gt;\n.tg  {border-collapse:collapse;border-spacing:0;margin:0px auto;}\n.tg td{border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;\n  overflow:hidden;padding:10px 5px;word-break:normal;}\n.tg th{border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;\n  font-weight:normal;overflow:hidden;padding:10px 5px;word-break:normal;}\n.tg .tg-fymr{border-color:inherit;font-weight:bold;text-align:left;vertical-align:top}\n.tg .tg-0pky{border-color:inherit;text-align:left;vertical-align:top}\n@media screen and (max-width: 767px) {.tg {width: auto !important;}.tg col {width: auto !important;}.tg-wrap {overflow-x: auto;-webkit-overflow-scrolling: touch;margin: auto 0px;}}&lt;/style&gt;\n&lt;div class=\&quot;tg-wrap\&quot;&gt;&lt;table class=\&quot;tg\&quot;&gt;&lt;thead&gt;\n  &lt;tr&gt;\n    &lt;th class=\&quot;tg-fymr\&quot;&gt;&lt;span style=\&quot;font-weight:bold;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Product/Service&lt;/span&gt;&lt;/th&gt;\n    &lt;th class=\&quot;tg-0pky\&quot;&gt;&lt;span style=\&quot;font-weight:700;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Impact&lt;/span&gt;&lt;/th&gt;\n  &lt;/tr&gt;&lt;/thead&gt;\n&lt;tbody&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-fymr\&quot;&gt;&lt;span style=\&quot;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;R2&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0pky\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;All customers using Cloudflare R2 would have experienced an elevated error rate during the primary incident window. Specifically:&lt;/span&gt;&lt;br&gt;&lt;br&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;* Object write operations had a 100% error rate.&lt;/span&gt;&lt;br&gt;&lt;br&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;* Object reads had an approximate error rate of 35% globally. Individual customer error rate varied during this window depending on access patterns. Customers accessing public assets through custom domains would have seen a reduced error rate as cached object reads were not impacted.&lt;/span&gt;&lt;br&gt;&lt;br&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;* Operations involving metadata only (e.g., head and list operations) were not impacted.&lt;/span&gt;&lt;br&gt;&lt;br&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;There was no data loss or risk to data integrity within R2&#39;s storage subsystem. This incident was limited to a temporary authentication issue between R2&#39;s API frontend and our storage infrastructure.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-fymr\&quot;&gt;&lt;span style=\&quot;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Billing&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0pky\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Billing uses R2 to store customer invoices. During the primary incident window, customers may have experienced errors when attempting to download/access past Cloudflare invoices.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-fymr\&quot;&gt;&lt;span style=\&quot;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Cache Reserve&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0pky\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Cache Reserve customers observed an increase in requests to their origin during the incident window as an increased percentage of reads to R2 failed. This resulted in an increase in requests to origins to fetch assets unavailable in Cache Reserve during this period.&lt;/span&gt;&lt;br&gt;&lt;br&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;User-facing requests for assets to sites with Cache Reserve did not observe failures as cache misses failed over to the origin.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-fymr\&quot;&gt;&lt;span style=\&quot;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Email Security&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0pky\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Email Security depends on R2 for customer-facing metrics. During the primary incident window, customer-facing metrics would not have updated.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-fymr\&quot;&gt;&lt;span style=\&quot;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Images&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0pky\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;All (100% of) uploads failed during the primary incident window. Successful delivery of stored images dropped to approximately 25%.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-fymr\&quot;&gt;&lt;span style=\&quot;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Key Transparency Auditor&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0pky\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;All (100% of) operations failed during the primary incident window due to dependence on R2 writes and/or reads. Once the incident was resolved, service returned to normal operation immediately.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-fymr\&quot;&gt;&lt;span style=\&quot;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Log Delivery&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0pky\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Log delivery (for Logpush and Logpull) was delayed during the primary incident window, resulting in significant delays (up to 70 minutes) in log processing. All logs were delivered after incident resolution.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-fymr\&quot;&gt;&lt;span style=\&quot;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Stream&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0pky\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;All (100% of) uploads failed during the primary incident window. Successful Stream video segment delivery dropped to 94%. Viewers may have seen video stalls every minute or so, although actual impact would have varied.&lt;/span&gt;&lt;br&gt;&lt;br&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Stream Live was down during the primary incident window as it depends on object writes.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-fymr\&quot;&gt;&lt;span style=\&quot;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Vectorize&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0pky\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Queries and operations against Vectorize indexes were impacted during the incident window. During the incident window, Vectorize customers would have seen an increased error rate for read queries to indexes and all (100% of) insert and upsert operation failed as Vectorize depends on R2 for persistent storage.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;incident-timeline\&quot;&gt;Incident timeline&lt;/h2&gt;\n            &lt;a href=\&quot;#incident-timeline\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;&lt;b&gt;All timestamps referenced are in Coordinated Universal Time (UTC).&lt;/b&gt;&lt;/p&gt;&lt;style type=\&quot;text/css\&quot;&gt;\n.tg  {border-collapse:collapse;border-spacing:0;margin:0px auto;}\n.tg td{border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;\n  overflow:hidden;padding:10px 5px;word-break:normal;}\n.tg th{border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;\n  font-weight:normal;overflow:hidden;padding:10px 5px;word-break:normal;}\n.tg .tg-1wig{font-weight:bold;text-align:left;vertical-align:top}\n.tg .tg-0lax{text-align:left;vertical-align:top}\n@media screen and (max-width: 767px) {.tg {width: auto !important;}.tg col {width: auto !important;}.tg-wrap {overflow-x: auto;-webkit-overflow-scrolling: touch;margin: auto 0px;}}&lt;/style&gt;\n&lt;div class=\&quot;tg-wrap\&quot;&gt;&lt;table class=\&quot;tg\&quot; style=\&quot;undefined;table-layout: fixed; width: 762px\&quot;&gt;&lt;colgroup&gt;\n&lt;col style=\&quot;width: 185.88889px\&quot;&gt;\n&lt;col style=\&quot;width: 575.88889px\&quot;&gt;\n&lt;/colgroup&gt;\n&lt;thead&gt;\n  &lt;tr&gt;\n    &lt;th class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:bold;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Time&lt;/span&gt;&lt;/th&gt;\n    &lt;th class=\&quot;tg-1wig\&quot;&gt;&lt;span style=\&quot;font-weight:700;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Event&lt;/span&gt;&lt;/th&gt;\n  &lt;/tr&gt;&lt;/thead&gt;\n&lt;tbody&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-1wig\&quot;&gt;&lt;span style=\&quot;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Mar 21, 2025 - 19:49 UTC&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;The R2 engineering team started the credential rotation process. A new set of credentials (ID and key pair) for storage infrastructure was created. Old credentials were maintained to avoid downtime during credential change over.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-1wig\&quot;&gt;&lt;span style=\&quot;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Mar 21, 2025 - 20:19 UTC&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Set updated production secret (&lt;/span&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#188038;background-color:transparent\&quot;&gt;wrangler secret put&lt;/span&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;) and executed &lt;/span&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#188038;background-color:transparent\&quot;&gt;wrangler deploy&lt;/span&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt; command to deploy R2 Gateway service with updated credentials. &lt;/span&gt;&lt;br&gt;&lt;br&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Note: We later discovered the &lt;/span&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#188038;background-color:transparent\&quot;&gt;--env&lt;/span&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt; parameter was inadvertently omitted for both Wrangler commands. This resulted in credentials being deployed to the Worker assigned to the &lt;/span&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#188038;background-color:transparent\&quot;&gt;default&lt;/span&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt; environment instead of the Worker assigned to the &lt;/span&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#188038;background-color:transparent\&quot;&gt;production&lt;/span&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt; environment.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-1wig\&quot;&gt;&lt;span style=\&quot;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Mar 21, 2025 - 20:20 UTC&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;The R2 Gateway service Worker assigned to the &lt;/span&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#188038;background-color:transparent\&quot;&gt;default&lt;/span&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt; environment is now using the updated storage infrastructure credentials.&lt;/span&gt;&lt;br&gt;&lt;br&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Note: This was the wrong Worker, the &lt;/span&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#188038;background-color:transparent\&quot;&gt;production&lt;/span&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt; environment should have been explicitly set. But, at this point, we incorrectly believed the credentials were updated on the correct production Worker.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-1wig\&quot;&gt;&lt;span style=\&quot;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Mar 21, 2025 - 20:37 UTC&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Old credentials were removed from our storage infrastructure to complete the credential rotation process.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-1wig\&quot;&gt;&lt;span style=\&quot;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Mar 21, 2025 - 21:38 UTC&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-1wig\&quot;&gt;&lt;span style=\&quot;font-weight:700;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;– IMPACT BEGINS –&lt;/span&gt;&lt;br&gt;&lt;br&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;R2 availability metrics begin to show signs of service degradation. The impact to R2 availability metrics was gradual and not immediately obvious because there was a delay in the propagation of the previous credential deletion to storage infrastructure.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-1wig\&quot;&gt;&lt;span style=\&quot;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Mar 21, 2025 - 21:45 UTC&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;R2 global availability alerts are triggered (indicating 2% of error budget burn rate).&lt;/span&gt;&lt;br&gt;&lt;br&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;The R2 engineering team began looking at operational dashboards and logs to understand impact.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-1wig\&quot;&gt;&lt;span style=\&quot;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Mar 21, 2025 - 21:50 UTC&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Internal incident declared.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-1wig\&quot;&gt;&lt;span style=\&quot;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Mar 21, 2025 - 21:51 UTC&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;R2 engineering team observes gradual but consistent decline in R2 availability metrics for both read and write operations. Operations involving metadata only (e.g., head and list operations) were not impacted.&lt;/span&gt;&lt;br&gt;&lt;br&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Given gradual decline in availability metrics, R2 engineering team suspected a potential regression in propagation of new credentials in storage infrastructure.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-1wig\&quot;&gt;&lt;span style=\&quot;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Mar 21, 2025 - 22:05 UTC&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Public incident status page published.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-1wig\&quot;&gt;&lt;span style=\&quot;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Mar 21, 2025 - 22:15 UTC&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;R2 engineering team created a new set of credentials (ID and key pair) for storage infrastructure in an attempt to force re-propagation.&lt;/span&gt;&lt;br&gt;&lt;br&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Continued monitoring operational dashboards and logs.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-1wig\&quot;&gt;&lt;span style=\&quot;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Mar 21, 2025 - 22:20 UTC&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;R2 engineering team saw no improvement in availability metrics. Continued investigating other potential root causes.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-1wig\&quot;&gt;&lt;span style=\&quot;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Mar 21, 2025 - 22:30 UTC&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;R2 engineering team deployed a new set of credentials (ID and key pair) to R2 Gateway service Worker. This was to validate whether there was an issue with the credentials we had pushed to gateway service.&lt;/span&gt;&lt;br&gt;&lt;br&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Environment parameter was still omitted in the &lt;/span&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#188038;background-color:transparent\&quot;&gt;deploy&lt;/span&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt; and &lt;/span&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#188038;background-color:transparent\&quot;&gt;secret put&lt;/span&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt; commands, so this deployment was still to the wrong non-production Worker.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-1wig\&quot;&gt;&lt;span style=\&quot;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Mar 21, 2025 - 22:36 UTC&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-1wig\&quot;&gt;&lt;span style=\&quot;font-weight:700;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;– ROOT CAUSE IDENTIFIED –&lt;/span&gt;&lt;br&gt;&lt;br&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;The R2 engineering team discovered that credentials had been deployed to a non-production Worker by reviewing production Worker release history.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-1wig\&quot;&gt;&lt;span style=\&quot;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Mar 21, 2025 - 22:45 UTC&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-1wig\&quot;&gt;&lt;span style=\&quot;font-weight:700;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;– IMPACT ENDS –&lt;/span&gt;&lt;br&gt;&lt;br&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Deployed credentials to correct production Worker. R2 availability recovered.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-1wig\&quot;&gt;&lt;span style=\&quot;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Mar 21, 2025 - 22:54 UTC&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;The incident is considered resolved.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;analysis\&quot;&gt;Analysis&lt;/h2&gt;\n            &lt;a href=\&quot;#analysis\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;R2’s architecture is primarily composed of three parts: R2 production gateway Worker (serves requests from S3 API, REST API, Workers API), metadata service, and storage infrastructure (stores encrypted object data).&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1G9gfdEE4RIuMIUeNz42RN/25d1b4cca187a4a24c600a43ba51fb71/BLOG-2793_2.png\&quot; alt=\&quot;BLOG-2793 2\&quot; class=\&quot;kg-image\&quot; width=\&quot;1840\&quot; height=\&quot;1000\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;The R2 Gateway Worker uses credentials (ID and key pair) to securely authenticate with our distributed storage infrastructure. We rotate these credentials regularly as a best practice security precaution.&lt;/p&gt;&lt;p&gt;Our key rotation process involves the following high-level steps:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;&lt;p&gt;Create a new set of credentials (ID and key pair) for our storage infrastructure. At this point, the old credentials are maintained to avoid downtime during credential change over.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Set the new credential secret for the R2 production gateway Worker using the &lt;code&gt;wrangler secret put&lt;/code&gt; command.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Set the new updated credential ID as an environment variable in the R2 production gateway Worker using the &lt;code&gt;wrangler deploy&lt;/code&gt; command. At this point, new storage credentials start being used by the gateway Worker.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Remove previous credentials from our storage infrastructure to complete the credential rotation process.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Monitor operational dashboards and logs to validate change over.&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;The R2 engineering team uses &lt;a href=\&quot;https://developers.cloudflare.com/workers/wrangler/environments/\&quot;&gt;&lt;u&gt;Workers environments&lt;/u&gt;&lt;/a&gt; to separate production and development environments for the R2 Gateway Worker. Each environment defines a separate isolated Cloudflare Worker with separate environment variables and secrets. &lt;/p&gt;&lt;p&gt;Critically, both &lt;code&gt;wrangler secret put&lt;/code&gt; and &lt;code&gt;wrangler deploy&lt;/code&gt; commands default to the default environment if the --env command line parameter is not included. In this case, due to human error, we inadvertently omitted the --env parameter and deployed the new storage credentials to the wrong Worker (&lt;code&gt;default&lt;/code&gt; environment instead of &lt;code&gt;production&lt;/code&gt;). To correctly deploy storage credentials to the production R2 Gateway Worker, we need to specify &lt;code&gt;--env production&lt;/code&gt;.&lt;/p&gt;&lt;p&gt;The action we took on step 4 above to remove the old credentials from our storage infrastructure caused authentication errors, as the R2 Gateway production Worker still had the old credentials. This is ultimately what resulted in degraded availability.&lt;/p&gt;&lt;p&gt;The decline in R2 availability metrics was gradual and not immediately obvious because there was a delay in the propagation of the previous credential deletion to storage infrastructure. This accounted for a delay in our initial discovery of the problem. Instead of relying on availability metrics after updating the old set of credentials, we should have explicitly validated which token was being used by the R2 Gateway service to authenticate with R2&amp;#39;s storage infrastructure.&lt;/p&gt;&lt;p&gt;Overall, the impact on read availability was significantly mitigated by our intermediate cache that sits in front of storage and continued to serve requests.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;resolution\&quot;&gt;Resolution&lt;/h2&gt;\n            &lt;a href=\&quot;#resolution\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;Once we identified the root cause, we were able to resolve the incident quickly by deploying the new credentials to the production R2 Gateway Worker. This resulted in an immediate recovery of R2 availability.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;next-steps\&quot;&gt;Next steps&lt;/h2&gt;\n            &lt;a href=\&quot;#next-steps\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;This incident happened because of human error and lasted longer than it should have because we didn’t have proper visibility into which credentials were being used by the R2 Gateway Worker to authenticate with our storage infrastructure.&lt;/p&gt;&lt;p&gt;We have taken immediate steps to prevent this failure (and others like it) from happening again:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;Added logging tags that include the suffix of the credential ID the R2 Gateway Worker uses to authenticate with our storage infrastructure. With this change, we can explicitly confirm which credential is being used.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Related to the above step, our internal processes now require explicit confirmation that the suffix of the new token ID matches logs from our storage infrastructure before deleting the previous token.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Require that key rotation takes place through our hotfix release tooling instead of relying on manual wrangler command entry which introduces human error. Our hotfix release deploy tooling explicitly enforces the environment configuration and contains other safety checks.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;While it’s been an implicit standard that this process involves at least two humans to validate the changes ahead as we progress, we’ve updated our relevant SOPs (standard operating procedures) to include this explicitly.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;b&gt;In Progress&lt;/b&gt;: Extend our existing closed loop health check system that monitors our endpoints to test new keys, automate reporting of their status through our alerting platform, and ensure global propagation prior to releasing the gateway Worker.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;b&gt;In Progress&lt;/b&gt;: To expedite triage on any future issues with our distributed storage endpoints, we are updating our observability platform to include views of upstream success rates that bypass caching to give clearer indication of issues serving requests for any reason.&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;The list above is not exhaustive: as we work through the above items, we will likely uncover other improvements to our systems, controls, and processes that we’ll be applying to improve R2’s resiliency, on top of our business-as-usual efforts. We are confident that this set of changes will prevent this failure, and related credential rotation failure modes, from occurring again. Again, we sincerely apologize for this incident and deeply regret any disruption it has caused you or your users.&lt;/p&gt;&quot;],&quot;published_at&quot;:[0,&quot;2025-03-25T01:40:38.542Z&quot;],&quot;updated_at&quot;:[0,&quot;2025-04-07T23:11:40.989Z&quot;],&quot;feature_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1zVzYYX4Zs6rRox4hJO4wJ/c64947208676753e532135f9393df5c5/BLOG-2793_1.png&quot;],&quot;tags&quot;:[1,[[0,{&quot;id&quot;:[0,&quot;7JpaihvGGjNhG2v4nTxeFV&quot;],&quot;name&quot;:[0,&quot;R2 Storage&quot;],&quot;slug&quot;:[0,&quot;cloudflare-r2&quot;]}],[0,{&quot;id&quot;:[0,&quot;4yliZlpBPZpOwBDZzo1tTh&quot;],&quot;name&quot;:[0,&quot;Outage&quot;],&quot;slug&quot;:[0,&quot;outage&quot;]}],[0,{&quot;id&quot;:[0,&quot;3cCNoJJ5uusKFBLYKFX1jB&quot;],&quot;name&quot;:[0,&quot;Post Mortem&quot;],&quot;slug&quot;:[0,&quot;post-mortem&quot;]}]]],&quot;relatedTags&quot;:[0],&quot;authors&quot;:[1,[[0,{&quot;name&quot;:[0,&quot;Phillip Jones&quot;],&quot;slug&quot;:[0,&quot;phillip&quot;],&quot;bio&quot;:[0,null],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/5KTNNpw9VHuwoZlwWsA7MN/c50f3f98d822a0fdce3196d7620d714e/phillip.jpg&quot;],&quot;location&quot;:[0,null],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,&quot;@akaphill&quot;],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}]]],&quot;meta_description&quot;:[0,&quot;On March 21, 2025, multiple Cloudflare services, including R2 object storage experienced an elevated rate of error responses. Here’s what caused the incident, the impact, and how we are making sure it doesn’t happen again.&quot;],&quot;primary_author&quot;:[0,{}],&quot;localeList&quot;:[0,{&quot;name&quot;:[0,&quot;LOC: Cloudflare incident on March 21, 2025&quot;],&quot;enUS&quot;:[0,&quot;English for Locale&quot;],&quot;zhCN&quot;:[0,&quot;Translated for Locale&quot;],&quot;zhHansCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhTW&quot;:[0,&quot;No Page for Locale&quot;],&quot;frFR&quot;:[0,&quot;No Page for Locale&quot;],&quot;deDE&quot;:[0,&quot;No Page for Locale&quot;],&quot;itIT&quot;:[0,&quot;No Page for Locale&quot;],&quot;jaJP&quot;:[0,&quot;Translated for Locale&quot;],&quot;koKR&quot;:[0,&quot;No Page for Locale&quot;],&quot;ptBR&quot;:[0,&quot;No Page for Locale&quot;],&quot;esLA&quot;:[0,&quot;No Page for Locale&quot;],&quot;esES&quot;:[0,&quot;No Page for Locale&quot;],&quot;enAU&quot;:[0,&quot;No Page for Locale&quot;],&quot;enCA&quot;:[0,&quot;No Page for Locale&quot;],&quot;enIN&quot;:[0,&quot;No Page for Locale&quot;],&quot;enGB&quot;:[0,&quot;No Page for Locale&quot;],&quot;idID&quot;:[0,&quot;No Page for Locale&quot;],&quot;ruRU&quot;:[0,&quot;No Page for Locale&quot;],&quot;svSE&quot;:[0,&quot;No Page for Locale&quot;],&quot;viVN&quot;:[0,&quot;No Page for Locale&quot;],&quot;plPL&quot;:[0,&quot;No Page for Locale&quot;],&quot;arAR&quot;:[0,&quot;No Page for Locale&quot;],&quot;nlNL&quot;:[0,&quot;No Page for Locale&quot;],&quot;thTH&quot;:[0,&quot;No Page for Locale&quot;],&quot;trTR&quot;:[0,&quot;No Page for Locale&quot;],&quot;heIL&quot;:[0,&quot;No Page for Locale&quot;],&quot;lvLV&quot;:[0,&quot;No Page for Locale&quot;],&quot;etEE&quot;:[0,&quot;No Page for Locale&quot;],&quot;ltLT&quot;:[0,&quot;No Page for Locale&quot;]}],&quot;url&quot;:[0,&quot;https://blog.cloudflare.com/cloudflare-incident-march-21-2025&quot;],&quot;metadata&quot;:[0,{&quot;title&quot;:[0],&quot;description&quot;:[0,&quot;On March 21, 2025, multiple Cloudflare services, including R2 object storage experienced an elevated rate of error responses. Here’s what caused the incident, the impact, and how we are making sure it doesn’t happen again.&quot;],&quot;imgPreview&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/4Snz5aLHm9r8iuQrJu1PFo/b08d68ab5199b08dfc096237501e8bf9/BLOG-2793_OG_Share.png&quot;]}],&quot;publicly_index&quot;:[0,true]}],&quot;translations&quot;:[0,{&quot;posts.by&quot;:[0,&quot;By&quot;],&quot;footer.gdpr&quot;:[0,&quot;GDPR&quot;],&quot;lang_blurb1&quot;:[0,&quot;This post is also available in {lang1}.&quot;],&quot;lang_blurb2&quot;:[0,&quot;This post is also available in {lang1} and {lang2}.&quot;],&quot;lang_blurb3&quot;:[0,&quot;This post is also available in {lang1}, {lang2} and {lang3}.&quot;],&quot;footer.press&quot;:[0,&quot;Press&quot;],&quot;header.title&quot;:[0,&quot;The Cloudflare Blog&quot;],&quot;search.clear&quot;:[0,&quot;Clear&quot;],&quot;search.filter&quot;:[0,&quot;Filter&quot;],&quot;search.source&quot;:[0,&quot;Source&quot;],&quot;footer.careers&quot;:[0,&quot;Careers&quot;],&quot;footer.company&quot;:[0,&quot;Company&quot;],&quot;footer.support&quot;:[0,&quot;Support&quot;],&quot;footer.the_net&quot;:[0,&quot;theNet&quot;],&quot;search.filters&quot;:[0,&quot;Filters&quot;],&quot;footer.our_team&quot;:[0,&quot;Our team&quot;],&quot;footer.webinars&quot;:[0,&quot;Webinars&quot;],&quot;page.more_posts&quot;:[0,&quot;More posts&quot;],&quot;posts.time_read&quot;:[0,&quot;{time} min read&quot;],&quot;search.language&quot;:[0,&quot;Language&quot;],&quot;footer.community&quot;:[0,&quot;Community&quot;],&quot;footer.resources&quot;:[0,&quot;Resources&quot;],&quot;footer.solutions&quot;:[0,&quot;Solutions&quot;],&quot;footer.trademark&quot;:[0,&quot;Trademark&quot;],&quot;header.subscribe&quot;:[0,&quot;Subscribe&quot;],&quot;footer.compliance&quot;:[0,&quot;Compliance&quot;],&quot;footer.free_plans&quot;:[0,&quot;Free plans&quot;],&quot;footer.impact_ESG&quot;:[0,&quot;Impact/ESG&quot;],&quot;posts.follow_on_X&quot;:[0,&quot;Follow on X&quot;],&quot;footer.help_center&quot;:[0,&quot;Help center&quot;],&quot;footer.network_map&quot;:[0,&quot;Network Map&quot;],&quot;header.please_wait&quot;:[0,&quot;Please Wait&quot;],&quot;page.related_posts&quot;:[0,&quot;Related posts&quot;],&quot;search.result_stat&quot;:[0,&quot;Results &lt;strong&gt;{search_range}&lt;/strong&gt; of &lt;strong&gt;{search_total}&lt;/strong&gt; for &lt;strong&gt;{search_keyword}&lt;/strong&gt;&quot;],&quot;footer.case_studies&quot;:[0,&quot;Case Studies&quot;],&quot;footer.connect_2024&quot;:[0,&quot;Connect 2024&quot;],&quot;footer.terms_of_use&quot;:[0,&quot;Terms of Use&quot;],&quot;footer.white_papers&quot;:[0,&quot;White Papers&quot;],&quot;footer.cloudflare_tv&quot;:[0,&quot;Cloudflare TV&quot;],&quot;footer.community_hub&quot;:[0,&quot;Community Hub&quot;],&quot;footer.compare_plans&quot;:[0,&quot;Compare plans&quot;],&quot;footer.contact_sales&quot;:[0,&quot;Contact Sales&quot;],&quot;header.contact_sales&quot;:[0,&quot;Contact Sales&quot;],&quot;header.email_address&quot;:[0,&quot;Email Address&quot;],&quot;page.error.not_found&quot;:[0,&quot;Page not found&quot;],&quot;footer.developer_docs&quot;:[0,&quot;Developer docs&quot;],&quot;footer.privacy_policy&quot;:[0,&quot;Privacy Policy&quot;],&quot;footer.request_a_demo&quot;:[0,&quot;Request a demo&quot;],&quot;page.continue_reading&quot;:[0,&quot;Continue reading&quot;],&quot;footer.analysts_report&quot;:[0,&quot;Analyst reports&quot;],&quot;footer.for_enterprises&quot;:[0,&quot;For enterprises&quot;],&quot;footer.getting_started&quot;:[0,&quot;Getting Started&quot;],&quot;footer.learning_center&quot;:[0,&quot;Learning Center&quot;],&quot;footer.project_galileo&quot;:[0,&quot;Project Galileo&quot;],&quot;pagination.newer_posts&quot;:[0,&quot;Newer Posts&quot;],&quot;pagination.older_posts&quot;:[0,&quot;Older Posts&quot;],&quot;posts.social_buttons.x&quot;:[0,&quot;Discuss on X&quot;],&quot;search.icon_aria_label&quot;:[0,&quot;Search&quot;],&quot;search.source_location&quot;:[0,&quot;Source/Location&quot;],&quot;footer.about_cloudflare&quot;:[0,&quot;About Cloudflare&quot;],&quot;footer.athenian_project&quot;:[0,&quot;Athenian Project&quot;],&quot;footer.become_a_partner&quot;:[0,&quot;Become a partner&quot;],&quot;footer.cloudflare_radar&quot;:[0,&quot;Cloudflare Radar&quot;],&quot;footer.network_services&quot;:[0,&quot;Network services&quot;],&quot;footer.trust_and_safety&quot;:[0,&quot;Trust &amp; Safety&quot;],&quot;header.get_started_free&quot;:[0,&quot;Get Started Free&quot;],&quot;page.search.placeholder&quot;:[0,&quot;Search Cloudflare&quot;],&quot;footer.cloudflare_status&quot;:[0,&quot;Cloudflare Status&quot;],&quot;footer.cookie_preference&quot;:[0,&quot;Cookie Preferences&quot;],&quot;header.valid_email_error&quot;:[0,&quot;Must be valid email.&quot;],&quot;search.result_stat_empty&quot;:[0,&quot;Results &lt;strong&gt;{search_range}&lt;/strong&gt; of &lt;strong&gt;{search_total}&lt;/strong&gt;&quot;],&quot;footer.connectivity_cloud&quot;:[0,&quot;Connectivity cloud&quot;],&quot;footer.developer_services&quot;:[0,&quot;Developer services&quot;],&quot;footer.investor_relations&quot;:[0,&quot;Investor relations&quot;],&quot;page.not_found.error_code&quot;:[0,&quot;Error Code: 404&quot;],&quot;search.autocomplete_title&quot;:[0,&quot;Insert a query. Press enter to send&quot;],&quot;footer.logos_and_press_kit&quot;:[0,&quot;Logos &amp; press kit&quot;],&quot;footer.application_services&quot;:[0,&quot;Application services&quot;],&quot;footer.get_a_recommendation&quot;:[0,&quot;Get a recommendation&quot;],&quot;posts.social_buttons.reddit&quot;:[0,&quot;Discuss on Reddit&quot;],&quot;footer.sse_and_sase_services&quot;:[0,&quot;SSE and SASE services&quot;],&quot;page.not_found.outdated_link&quot;:[0,&quot;You may have used an outdated link, or you may have typed the address incorrectly.&quot;],&quot;footer.report_security_issues&quot;:[0,&quot;Report Security Issues&quot;],&quot;page.error.error_message_page&quot;:[0,&quot;Sorry, we can&#39;t find the page you are looking for.&quot;],&quot;header.subscribe_notifications&quot;:[0,&quot;Subscribe to receive notifications of new posts:&quot;],&quot;footer.cloudflare_for_campaigns&quot;:[0,&quot;Cloudflare for Campaigns&quot;],&quot;header.subscription_confimation&quot;:[0,&quot;Subscription confirmed. Thank you for subscribing!&quot;],&quot;posts.social_buttons.hackernews&quot;:[0,&quot;Discuss on Hacker News&quot;],&quot;footer.diversity_equity_inclusion&quot;:[0,&quot;Diversity, equity &amp; inclusion&quot;],&quot;footer.critical_infrastructure_defense_project&quot;:[0,&quot;Critical Infrastructure Defense Project&quot;]}]}" ssr client="load" opts="{&quot;name&quot;:&quot;PostCard&quot;,&quot;value&quot;:true}" await-children><article class="w-50-l  mt4 mt2-l mb4 ph3 bb b--gray8 bn-l"><div class="w-100"><a href="/cloudflare-incident-march-21-2025/" class="fw5 no-underline gray1" data-testid="post-title"><h2 class="fw5 mt2">Cloudflare incident on March 21, 2025</h2></a><p class="f3 fw5 gray5 my" data-testid="post-date">2025-03-25</p><div class=""><a href="/tag/cloudflare-r2/" class="dib pl2 pr2 pt1 pb1 mb2 bg-gray8 no-underline blue3 f2 mr1" data-testid="post-tag">R2 Storage</a><a href="/tag/outage/" class="dib pl2 pr2 pt1 pb1 mb2 bg-gray8 no-underline blue3 f2 mr1" data-testid="post-tag">Outage</a><a href="/tag/post-mortem/" class="dib pl2 pr2 pt1 pb1 mb2 bg-gray8 no-underline blue3 f2 mr1" data-testid="post-tag">Post Mortem</a></div><p class="f3 fw4 gray1 lh-copy " data-testid="post-content">On March 21, 2025, multiple Cloudflare services, including R2 object storage experienced an elevated rate of error responses. Here’s what caused the incident, the impact, and how we are making sure it<!-- -->...</p><ul class="author-lists flex pl0"><li class="list flex items-center pr2 mb3"><a href="/author/phillip/" class="static-avatar pr1"><img class="author-profile-image br-100 mr2" src="https://blog.cloudflare.com/cdn-cgi/image/format=auto,dpr=3,width=64,height=64,gravity=face,fit=crop,zoom=0.5/https://cf-assets.www.cloudflare.com/zkvhlag99gkb/5KTNNpw9VHuwoZlwWsA7MN/c50f3f98d822a0fdce3196d7620d714e/phillip.jpg" alt="Phillip Jones" width="62" height="62"/></a><div class="author-name-tooltip"><a href="/author/phillip/" class="fw4 f3 no-underline black">Phillip Jones</a></div></li></ul></div></article><!--astro:end--></astro-island><astro-island uid="c5ouN" prefix="r2" component-url="/_astro/PostCard.DalyEN7z.js" component-export="PostCard" renderer-url="/_astro/client.DLO1yDVm.js" props="{&quot;currentPage&quot;:[0,1],&quot;isFeaturedImageFirstPost&quot;:[0,false],&quot;post&quot;:[0,{&quot;id&quot;:[0,&quot;mDiwAePfMfpVHMlYrfrFu&quot;],&quot;title&quot;:[0,&quot;Cloudflare incident on February 6, 2025&quot;],&quot;slug&quot;:[0,&quot;cloudflare-incident-on-february-6-2025&quot;],&quot;excerpt&quot;:[0,&quot;On Thursday, February 6, 2025, we experienced an outage with our object storage service (R2) and products that rely on it. Here&#39;s what happened and what we&#39;re doing to fix this going forward.&quot;],&quot;featured&quot;:[0],&quot;html&quot;:[0,&quot;&lt;p&gt;Multiple Cloudflare services, including our &lt;a href=\&quot;https://www.cloudflare.com/developer-platform/products/r2/\&quot;&gt;&lt;u&gt;R2 object storage&lt;/u&gt;&lt;/a&gt;, were unavailable for 59 minutes on Thursday, February 6, 2025. This caused all operations against R2 to fail for the duration of the incident, and caused a number of other Cloudflare services that depend on R2 — including &lt;a href=\&quot;https://www.cloudflare.com/developer-platform/products/cloudflare-stream/\&quot;&gt;&lt;u&gt;Stream&lt;/u&gt;&lt;/a&gt;, &lt;a href=\&quot;https://www.cloudflare.com/developer-platform/products/cloudflare-images/\&quot;&gt;&lt;u&gt;Images&lt;/u&gt;&lt;/a&gt;, &lt;a href=\&quot;https://www.cloudflare.com/developer-platform/products/cache-reserve/\&quot;&gt;&lt;u&gt;Cache Reserve&lt;/u&gt;&lt;/a&gt;, &lt;a href=\&quot;https://www.cloudflare.com/developer-platform/products/vectorize/\&quot;&gt;&lt;u&gt;Vectorize&lt;/u&gt;&lt;/a&gt; and &lt;a href=\&quot;https://developers.cloudflare.com/logs/edge-log-delivery/\&quot;&gt;&lt;u&gt;Log Delivery&lt;/u&gt;&lt;/a&gt; — to suffer significant failures.&lt;/p&gt;&lt;p&gt;The incident occurred due to human error and insufficient validation safeguards during a routine abuse remediation for a report about a phishing site hosted on R2. The action taken on the complaint resulted in an advanced product disablement action on the site that led to disabling the production R2 Gateway service responsible for the R2 API.  &lt;/p&gt;&lt;p&gt;Critically, this incident did &lt;b&gt;not&lt;/b&gt; result in the loss or corruption of any data stored on R2. &lt;/p&gt;&lt;p&gt;We’re deeply sorry for this incident: this was a failure of a number of controls, and we are prioritizing work to implement additional system-level controls related not only to our abuse processing systems, but so that we continue to reduce the blast radius of &lt;i&gt;any&lt;/i&gt; system- or human- action that could result in disabling any production service at Cloudflare.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;what-was-impacted\&quot;&gt;What was impacted?&lt;/h2&gt;\n            &lt;a href=\&quot;#what-was-impacted\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;All customers using Cloudflare R2 would have observed a 100% failure rate against their R2 buckets and objects during the primary incident window. Services that depend on R2 (detailed in the table below) observed heightened error rates and failure modes depending on their usage of R2.&lt;/p&gt;&lt;p&gt;The primary incident window occurred between 08:14 UTC to 09:13 UTC, when operations against R2 had a 100% error rate. Dependent services (detailed below) observed increased failure rates for operations that relied on R2.&lt;/p&gt;&lt;p&gt;From 09:13 UTC to 09:36 UTC, as R2 recovered and clients reconnected, the backlog and resulting spike in client operations caused load issues with R2&amp;#39;s metadata layer (built on Durable Objects). This impact was significantly more isolated: we observed a 0.09% increase in error rates in calls to Durable Objects running in North America during this window. &lt;/p&gt;&lt;p&gt;The following table details the impacted services, including the user-facing impact, operation failures, and increases in error rates observed:&lt;/p&gt;&lt;table&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;&lt;b&gt;Product/Service&lt;/b&gt;&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;&lt;b&gt;Impact&lt;/b&gt;&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;&lt;b&gt;R2&lt;/b&gt;&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;100% of operations against R2 buckets and objects, including uploads, downloads, and associated metadata operations were impacted during the primary incident window. During the secondary incident window, we observed a &amp;lt;1% increase in errors as clients reconnected and increased pressure on R2&amp;#39;s metadata layer.&lt;/p&gt;&lt;p&gt;There was no data loss within the R2 storage subsystem: this incident impacted the HTTP frontend of R2. Separation of concerns and blast radius management meant that the underlying R2 infrastructure was unaffected by this.&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;&lt;b&gt;Stream&lt;/b&gt;&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;100% of operations (upload &amp;amp; streaming delivery) against assets managed by Stream were impacted during the primary incident window.&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;&lt;b&gt;Images&lt;/b&gt;&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;100% of operations (uploads &amp;amp; downloads) against assets managed by Images were impacted during the primary incident window.&lt;/p&gt;&lt;p&gt;Impact to Image Delivery was minor: success rate dropped to 97% as these assets are fetched from existing customer backends and do not rely on intermediate storage.&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;&lt;b&gt;Cache Reserve&lt;/b&gt;&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;Cache Reserve customers observed an increase in requests to their origin during the incident window as 100% of operations failed. This resulted in an increase in requests to origins to fetch assets unavailable in Cache Reserve during this period. This impacted less than 0.049% of all cacheable requests served during the incident window.&lt;/p&gt;&lt;p&gt;User-facing requests for assets to sites with Cache Reserve did not observe failures as cache misses failed over to the origin.&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;&lt;b&gt;Log Delivery&lt;/b&gt;&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;Log delivery was delayed during the primary incident window, resulting in significant delays (up to an hour) in log processing, as well as some dropped logs. &lt;/p&gt;&lt;p&gt;Specifically:&lt;/p&gt;&lt;p&gt;Non-R2 delivery jobs would have experienced up to 4.5% data loss during the incident. This level of data loss could have been different between jobs depending on log volume and buffer capacity in a given location.&lt;/p&gt;&lt;p&gt;R2 delivery jobs would have experienced up to 13.6% data loss during the incident. &lt;/p&gt;&lt;p&gt;R2 is a major destination for Cloudflare Logs. During the primary incident window, all available resources became saturated attempting to buffer and deliver data to R2. This prevented other jobs from acquiring resources to process their queues. Data loss (dropped logs) occurred when the job queues expired their data (to allow for new, incoming data). The system recovered when we enabled a kill switch to stop processing jobs sending data to R2.&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;&lt;b&gt;Durable Objects&lt;/b&gt;&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;Durable Objects, and services that rely on it for coordination &amp;amp; storage, were impacted as the stampeding horde of clients re-connecting to R2 drove an increase in load.&lt;/p&gt;&lt;p&gt;We observed a 0.09% actual increase in error rates in calls to Durable Objects running in North America, starting at 09:13 UTC and recovering by 09:36 UTC.&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;&lt;b&gt;Cache Purge&lt;/b&gt;&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;Requests to the Cache Purge API saw a 1.8% error rate (HTTP 5xx) increase and a 10x increase in p90 latency for purge operations during the primary incident window. Error rates returned to normal immediately after this.&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;&lt;b&gt;Vectorize&lt;/b&gt;&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;Queries and operations against Vectorize indexes were impacted during the primary incident window. 75% of queries to indexes failed (the remainder were served out of cache) and 100% of insert, upsert, and delete operations failed during the incident window as Vectorize depends on R2 for persistent storage. Once R2 recovered, Vectorize systems recovered in full.&lt;/p&gt;&lt;p&gt;We observed no continued impact during the secondary incident window, and we have not observed any index corruption as the Vectorize system has protections in place for this.&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;&lt;b&gt;Key Transparency Auditor&lt;/b&gt;&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;100% of signature publish &amp;amp; read operations to the KT auditor service failed during the primary incident window. No third party reads occurred during this window and thus were not impacted by the incident.&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;&lt;b&gt;Workers &amp;amp; Pages&lt;/b&gt;&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;A small volume (0.002%) of deployments to Workers and Pages projects failed during the primary incident window. These failures were limited to services with bindings to R2, as our control plane was unable to communicate with the R2 service during this period.&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;incident-timeline-and-impact\&quot;&gt;Incident timeline and impact&lt;/h2&gt;\n            &lt;a href=\&quot;#incident-timeline-and-impact\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;The incident timeline, including the initial impact, investigation, root cause, and remediation, are detailed below.&lt;/p&gt;&lt;p&gt;&lt;b&gt;All timestamps referenced are in Coordinated Universal Time (UTC).&lt;/b&gt;&lt;/p&gt;&lt;style type=\&quot;text/css\&quot;&gt;\n.tg  {border-collapse:collapse;border-spacing:0;margin:0px auto;}\n.tg td{border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;\n  overflow:hidden;padding:10px 5px;word-break:normal;}\n.tg th{border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;\n  font-weight:normal;overflow:hidden;padding:10px 5px;word-break:normal;}\n.tg .tg-1wig{font-weight:bold;text-align:left;vertical-align:top}\n.tg .tg-mwxp{background-color:#FFF;color:#172B4D;font-style:italic;text-align:left;vertical-align:top}\n.tg .tg-amwm{font-weight:bold;text-align:center;vertical-align:top}\n.tg .tg-6t3r{font-style:italic;font-weight:bold;text-align:left;vertical-align:top}\n.tg .tg-0lax{text-align:left;vertical-align:top}\n@media screen and (max-width: 767px) {.tg {width: auto !important;}.tg col {width: auto !important;}.tg-wrap {overflow-x: auto;-webkit-overflow-scrolling: touch;margin: auto 0px;}}&lt;/style&gt;\n&lt;div class=\&quot;tg-wrap\&quot;&gt;&lt;table class=\&quot;tg\&quot; style=\&quot;undefined;table-layout: fixed; width: 689px\&quot;&gt;&lt;colgroup&gt;\n&lt;col style=\&quot;width: 137.444444px\&quot;&gt;\n&lt;col style=\&quot;width: 551.444444px\&quot;&gt;\n&lt;/colgroup&gt;\n&lt;thead&gt;\n  &lt;tr&gt;\n    &lt;th class=\&quot;tg-amwm\&quot;&gt;&lt;span style=\&quot;font-weight:700;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Time&lt;/span&gt;&lt;/th&gt;\n    &lt;th class=\&quot;tg-amwm\&quot;&gt;&lt;span style=\&quot;font-weight:700;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Event&lt;/span&gt;&lt;/th&gt;\n  &lt;/tr&gt;&lt;/thead&gt;\n&lt;tbody&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-6t3r\&quot;&gt;&lt;span style=\&quot;font-weight:700;font-style:italic;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;2025-02-06 08:12&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-mwxp\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:italic;text-decoration:none;color:#172B4D;background-color:#FFF\&quot;&gt;The R2 Gateway service is inadvertently disabled while responding to an abuse report.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-6t3r\&quot;&gt;&lt;span style=\&quot;font-weight:700;font-style:italic;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;2025-02-06 08:14&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-1wig\&quot;&gt;&lt;span style=\&quot;font-weight:700;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;-- IMPACT BEGINS --&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-6t3r\&quot;&gt;&lt;span style=\&quot;font-weight:700;font-style:italic;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;2025-02-06 08:15&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;R2 service metrics begin to show signs of service degradation.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-6t3r\&quot;&gt;&lt;span style=\&quot;font-weight:700;font-style:italic;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;2025-02-06 08:17&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Critical R2 alerts begin to fire due to our service no longer responding to our health checks.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-6t3r\&quot;&gt;&lt;span style=\&quot;font-weight:700;font-style:italic;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;2025-02-06 08:18&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;R2 on-call engaged and began looking at our operational dashboards and service logs to understand impact to availability.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-6t3r\&quot;&gt;&lt;span style=\&quot;font-weight:700;font-style:italic;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;2025-02-06 08:23&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Sales engineering escalated to the R2 engineering team that customers are experiencing a rapid increase in HTTP 500’s from all R2 APIs.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-6t3r\&quot;&gt;&lt;span style=\&quot;font-weight:700;font-style:italic;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;2025-02-06 08:25 &lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Internal incident declared.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-6t3r\&quot;&gt;&lt;span style=\&quot;font-weight:700;font-style:italic;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;2025-02-06 08:33&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;R2 on-call was unable to identify the root cause and escalated to the lead on-call for assistance.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-6t3r\&quot;&gt;&lt;span style=\&quot;font-weight:700;font-style:italic;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;2025-02-06 08:42&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Root cause identified as R2 team reviews service deployment history and configuration, which surfaces the action and the validation gap that allowed this to impact a production service.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-6t3r\&quot;&gt;&lt;span style=\&quot;font-weight:700;font-style:italic;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;2025-02-06 08:46&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;On-call attempts to re-enable the R2 Gateway service using our internal admin tooling, however this tooling was unavailable because it relies on R2.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-6t3r\&quot;&gt;&lt;span style=\&quot;font-weight:700;font-style:italic;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;2025-02-06 08:49&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;On-call escalates to an operations team who has lower level system access and can re-enable the R2 Gateway service. &lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-6t3r\&quot;&gt;&lt;span style=\&quot;font-weight:700;font-style:italic;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;2025-02-06 08:57&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;The operations team engaged and began to re-enable the R2 Gateway service.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-6t3r\&quot;&gt;&lt;span style=\&quot;font-weight:700;font-style:italic;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;2025-02-06 09:09&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;R2 team triggers a redeployment of the R2 Gateway service.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-6t3r\&quot;&gt;&lt;span style=\&quot;font-weight:700;font-style:italic;text-decoration:none;color:#000;background-color:transparent\&quot;&gt; 2025-02-06 09:10&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;R2 began to recover as the forced re-deployment rolled out as clients were able to reconnect to R2.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-6t3r\&quot;&gt;&lt;span style=\&quot;font-weight:700;font-style:italic;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;2025-02-06 09:13&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-1wig\&quot;&gt;&lt;span style=\&quot;font-weight:700;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;-- IMPACT ENDS --&lt;/span&gt;&lt;br&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;R2 availability recovers to within its service-level objective (SLO). Durable Objects begins to observe a slight increase in error rate (0.09%) for Durable Objects running in North America due to the spike in R2 clients reconnecting.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-6t3r\&quot;&gt;&lt;span style=\&quot;font-weight:700;font-style:italic;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;2025-02-06 09:36&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;The Durable Objects error rate recovers.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-6t3r\&quot;&gt;&lt;span style=\&quot;font-weight:700;font-style:italic;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;2025-02-06 10:29&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;The incident is closed after monitoring error rates.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;p&gt;At the R2 service level, our internal Prometheus metrics showed R2’s SLO near-immediately drop to 0% as R2’s Gateway service stopped serving all requests and terminated in-flight requests.&lt;/p&gt;&lt;p&gt;The slight delay in failure was due to the product disablement action taking 1–2 minutes to take effect as well as our configured metrics aggregation intervals:&lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/4pbONRcG99RWttIUyGqnI6/bad397f73762a706285ea143ed2418b3/BLOG-2685_2.png\&quot; alt=\&quot;BLOG-2685 2\&quot; class=\&quot;kg-image\&quot; width=\&quot;1999\&quot; height=\&quot;844\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;For context, R2’s architecture separates the Gateway service, which is responsible for authenticating and serving requests to R2’s S3 &amp;amp; REST APIs and is the “front door” for R2 — its metadata store (built on Durable Objects), our intermediate caches, and the underlying, distributed storage subsystem responsible for durably storing objects. &lt;/p&gt;\n          &lt;figure class=\&quot;kg-card kg-image-card\&quot;&gt;\n          &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/E2cgDKA2zGwaQDBs31tPk/4272c94625fd788148d16a90cc7cceaa/Image_20250206_172217_707.png\&quot; alt=\&quot;BLOG-2685 3\&quot; class=\&quot;kg-image\&quot; width=\&quot;2324\&quot; height=\&quot;1000\&quot; loading=\&quot;lazy\&quot;/&gt;\n          &lt;/figure&gt;&lt;p&gt;During the incident, all other components of R2 remained up: this is what allowed the service to recover so quickly once the R2 Gateway service was restored and re-deployed. The R2 Gateway acts as the coordinator for all work when operations are made against R2. During the request lifecycle, we validate authentication and authorization, write any new data to a new immutable key in our object store, then update our metadata layer to point to the new object. When the service was disabled, all running processes stopped.&lt;/p&gt;&lt;p&gt;While this means that all in-flight and subsequent requests fail, anything that had received a HTTP 200 response had already succeeded with no risk of reverting to a prior version when the service recovered. This is critical to R2’s consistency guarantees and mitigates the chance of a client receiving a successful API response without the underlying metadata &lt;i&gt;and &lt;/i&gt;storage infrastructure having persisted the change.  &lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;deep-dive\&quot;&gt;Deep dive &lt;/h2&gt;\n            &lt;a href=\&quot;#deep-dive\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;&lt;b&gt;Due to human error and insufficient validation safeguards in our admin tooling, the R2 Gateway service was taken down as part of a routine remediation for a phishing URL.&lt;/b&gt;&lt;/p&gt;&lt;p&gt;During a routine abuse remediation, action was taken on a complaint that inadvertently disabled the R2 Gateway service instead of the specific endpoint/bucket associated with the report. This was a failure of multiple system level controls (first and foremost) and operator training. &lt;/p&gt;&lt;p&gt;A key system-level control that led to this incident was in how we identify (or &amp;quot;tag&amp;quot;) internal accounts used by our teams. Teams typically have multiple accounts (dev, staging, prod) to reduce the blast radius of any configuration changes or deployments, but our abuse processing systems were not explicitly configured to identify these accounts and block disablement actions against them. Instead of disabling the specific endpoint associated with the abuse report, the system allowed the operator to (incorrectly) disable the R2 Gateway service. &lt;/p&gt;&lt;p&gt;Once we identified this as the cause of the outage, remediation and recovery was inhibited by the lack of direct controls to revert the product disablement action and the need to engage an operations team with lower level access than is routine. The R2 Gateway service then required a re-deployment in order to rebuild its routing pipeline across our edge network.&lt;/p&gt;&lt;p&gt;Once re-deployed, clients were able to re-connect to R2, and error rates for dependent services (including Stream, Images, Cache Reserve and Vectorize) returned to normal levels.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;remediation-and-follow-up-steps\&quot;&gt;Remediation and follow-up steps&lt;/h2&gt;\n            &lt;a href=\&quot;#remediation-and-follow-up-steps\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;We have taken immediate steps to resolve the validation gaps in our tooling to prevent this specific failure from occurring in the future.&lt;/p&gt;&lt;p&gt;We are prioritizing several work-streams to implement stronger, system-wide controls (defense-in-depth) to prevent this, including how we provision internal accounts so that we are not relying on our teams to correctly and reliably tag accounts. A key theme to our remediation efforts here is around removing the need to rely on training or process, and instead ensuring that our systems have the right guardrails and controls built-in to prevent operator errors.&lt;/p&gt;&lt;p&gt;These work-streams include (but are not limited to) the following:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;&lt;b&gt;Actioned: &lt;/b&gt;deployed additional guardrails implemented in the Admin API to prevent product disablement of services running in internal accounts.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;b&gt;Actioned&lt;/b&gt;: Product disablement actions in the abuse review UI have been disabled while we add more robust safeguards. This will prevent us from inadvertently repeating similar high-risk manual actions.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;b&gt;In-flight&lt;/b&gt;: Changing how we create all internal accounts (staging, dev, production) to ensure that all accounts are correctly provisioned into the correct organization. This must include protections against creating standalone accounts to avoid re-occurrence of this incident (or similar) in the future.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;b&gt;In-flight: &lt;/b&gt;Further restricting access to product disablement actions beyond the remediations recommended by the system to a smaller group of senior operators.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;b&gt;In-flight&lt;/b&gt;: Two-party approval required for ad-hoc product disablement actions. Going forward, if an investigator requires additional remediations, they must be submitted to a manager or a person on our approved remediation acceptance list to approve their additional actions on an abuse report. &lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;b&gt;In-flight&lt;/b&gt;: Expand existing abuse checks that prevent accidental blocking of internal hostnames to also prevent any product disablement action of products associated with an internal Cloudflare account.  &lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;b&gt;In-flight&lt;/b&gt;: Internal accounts are being moved to our new Organizations model ahead of public release of this feature. The R2 production account was a member of this organization, but our abuse remediation engine did not have the necessary protections to prevent acting against accounts within this organization.&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;We’re continuing to discuss &amp;amp; review additional steps and effort that can continue to reduce the blast radius of any system- or human- action that could result in disabling any production service at Cloudflare.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;conclusion\&quot;&gt;Conclusion&lt;/h2&gt;\n            &lt;a href=\&quot;#conclusion\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;We understand this was a serious incident, and we are painfully aware of — and extremely sorry for — the impact it caused to customers and teams building and running their businesses on Cloudflare.&lt;/p&gt;&lt;p&gt;This is the first (and ideally, the last) incident of this kind and duration for R2, and we’re committed to improving controls across our systems and workflows to prevent this in the future.&lt;/p&gt;&quot;],&quot;published_at&quot;:[0,&quot;2025-02-06T16:00-08:00&quot;],&quot;updated_at&quot;:[0,&quot;2025-02-07T20:37:36.839Z&quot;],&quot;feature_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1JR64uLhxWHgQPhhOlkyTt/dc50a43a0475ab8a0069bb8fce372e47/Screenshot_2025-02-06_at_4.54.16_PM.png&quot;],&quot;tags&quot;:[1,[[0,{&quot;id&quot;:[0,&quot;3cCNoJJ5uusKFBLYKFX1jB&quot;],&quot;name&quot;:[0,&quot;Post Mortem&quot;],&quot;slug&quot;:[0,&quot;post-mortem&quot;]}],[0,{&quot;id&quot;:[0,&quot;4yliZlpBPZpOwBDZzo1tTh&quot;],&quot;name&quot;:[0,&quot;Outage&quot;],&quot;slug&quot;:[0,&quot;outage&quot;]}],[0,{&quot;id&quot;:[0,&quot;7JpaihvGGjNhG2v4nTxeFV&quot;],&quot;name&quot;:[0,&quot;R2 Storage&quot;],&quot;slug&quot;:[0,&quot;cloudflare-r2&quot;]}]]],&quot;relatedTags&quot;:[0],&quot;authors&quot;:[1,[[0,{&quot;name&quot;:[0,&quot;Matt Silverlock&quot;],&quot;slug&quot;:[0,&quot;silverlock&quot;],&quot;bio&quot;:[0,&quot;Director of Product at Cloudflare.&quot;],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/7xP5qePZD9eyVtwIesXYxh/e714aaa573161ec9eb48d59bd1aa6225/silverlock.jpeg&quot;],&quot;location&quot;:[0,null],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,&quot;@elithrar&quot;],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}],[0,{&quot;name&quot;:[0,&quot;Javier Castro&quot;],&quot;slug&quot;:[0,&quot;javier&quot;],&quot;bio&quot;:[0,null],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/3hJsvxP0uRGmk4DjS9IdSW/0197c661fe20e1ebc9922768d727df02/javier.png&quot;],&quot;location&quot;:[0,null],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,null],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}]]],&quot;meta_description&quot;:[0,&quot;On Thursday February 6th, we experienced an outage with our object storage service (R2) and products that rely on it. Here&#39;s what happened and what we&#39;re doing to fix this going forward.&quot;],&quot;primary_author&quot;:[0,{}],&quot;localeList&quot;:[0,{&quot;name&quot;:[0,&quot;blog-english-only&quot;],&quot;enUS&quot;:[0,&quot;English for Locale&quot;],&quot;zhCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhHansCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhTW&quot;:[0,&quot;No Page for Locale&quot;],&quot;frFR&quot;:[0,&quot;No Page for Locale&quot;],&quot;deDE&quot;:[0,&quot;No Page for Locale&quot;],&quot;itIT&quot;:[0,&quot;No Page for Locale&quot;],&quot;jaJP&quot;:[0,&quot;No Page for Locale&quot;],&quot;koKR&quot;:[0,&quot;No Page for Locale&quot;],&quot;ptBR&quot;:[0,&quot;No Page for Locale&quot;],&quot;esLA&quot;:[0,&quot;No Page for Locale&quot;],&quot;esES&quot;:[0,&quot;No Page for Locale&quot;],&quot;enAU&quot;:[0,&quot;No Page for Locale&quot;],&quot;enCA&quot;:[0,&quot;No Page for Locale&quot;],&quot;enIN&quot;:[0,&quot;No Page for Locale&quot;],&quot;enGB&quot;:[0,&quot;No Page for Locale&quot;],&quot;idID&quot;:[0,&quot;No Page for Locale&quot;],&quot;ruRU&quot;:[0,&quot;No Page for Locale&quot;],&quot;svSE&quot;:[0,&quot;No Page for Locale&quot;],&quot;viVN&quot;:[0,&quot;No Page for Locale&quot;],&quot;plPL&quot;:[0,&quot;No Page for Locale&quot;],&quot;arAR&quot;:[0,&quot;No Page for Locale&quot;],&quot;nlNL&quot;:[0,&quot;No Page for Locale&quot;],&quot;thTH&quot;:[0,&quot;No Page for Locale&quot;],&quot;trTR&quot;:[0,&quot;No Page for Locale&quot;],&quot;heIL&quot;:[0,&quot;No Page for Locale&quot;],&quot;lvLV&quot;:[0,&quot;No Page for Locale&quot;],&quot;etEE&quot;:[0,&quot;No Page for Locale&quot;],&quot;ltLT&quot;:[0,&quot;No Page for Locale&quot;]}],&quot;url&quot;:[0,&quot;https://blog.cloudflare.com/cloudflare-incident-on-february-6-2025&quot;],&quot;metadata&quot;:[0,{&quot;title&quot;:[0,&quot;Cloudflare incident on February 6, 2025&quot;],&quot;description&quot;:[0,&quot;On Thursday, February 6, 2025, we experienced an outage with our object storage service (R2) and products that rely on it. Here&#39;s what happened and what we&#39;re doing to fix this going forward.&quot;],&quot;imgPreview&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/JjRBjBprqgy01LVreSbzM/9744518638a7c5c7072d3e29bdf8e267/BLOG-2685_OG.png&quot;]}],&quot;publicly_index&quot;:[0,true]}],&quot;translations&quot;:[0,{&quot;posts.by&quot;:[0,&quot;By&quot;],&quot;footer.gdpr&quot;:[0,&quot;GDPR&quot;],&quot;lang_blurb1&quot;:[0,&quot;This post is also available in {lang1}.&quot;],&quot;lang_blurb2&quot;:[0,&quot;This post is also available in {lang1} and {lang2}.&quot;],&quot;lang_blurb3&quot;:[0,&quot;This post is also available in {lang1}, {lang2} and {lang3}.&quot;],&quot;footer.press&quot;:[0,&quot;Press&quot;],&quot;header.title&quot;:[0,&quot;The Cloudflare Blog&quot;],&quot;search.clear&quot;:[0,&quot;Clear&quot;],&quot;search.filter&quot;:[0,&quot;Filter&quot;],&quot;search.source&quot;:[0,&quot;Source&quot;],&quot;footer.careers&quot;:[0,&quot;Careers&quot;],&quot;footer.company&quot;:[0,&quot;Company&quot;],&quot;footer.support&quot;:[0,&quot;Support&quot;],&quot;footer.the_net&quot;:[0,&quot;theNet&quot;],&quot;search.filters&quot;:[0,&quot;Filters&quot;],&quot;footer.our_team&quot;:[0,&quot;Our team&quot;],&quot;footer.webinars&quot;:[0,&quot;Webinars&quot;],&quot;page.more_posts&quot;:[0,&quot;More posts&quot;],&quot;posts.time_read&quot;:[0,&quot;{time} min read&quot;],&quot;search.language&quot;:[0,&quot;Language&quot;],&quot;footer.community&quot;:[0,&quot;Community&quot;],&quot;footer.resources&quot;:[0,&quot;Resources&quot;],&quot;footer.solutions&quot;:[0,&quot;Solutions&quot;],&quot;footer.trademark&quot;:[0,&quot;Trademark&quot;],&quot;header.subscribe&quot;:[0,&quot;Subscribe&quot;],&quot;footer.compliance&quot;:[0,&quot;Compliance&quot;],&quot;footer.free_plans&quot;:[0,&quot;Free plans&quot;],&quot;footer.impact_ESG&quot;:[0,&quot;Impact/ESG&quot;],&quot;posts.follow_on_X&quot;:[0,&quot;Follow on X&quot;],&quot;footer.help_center&quot;:[0,&quot;Help center&quot;],&quot;footer.network_map&quot;:[0,&quot;Network Map&quot;],&quot;header.please_wait&quot;:[0,&quot;Please Wait&quot;],&quot;page.related_posts&quot;:[0,&quot;Related posts&quot;],&quot;search.result_stat&quot;:[0,&quot;Results &lt;strong&gt;{search_range}&lt;/strong&gt; of &lt;strong&gt;{search_total}&lt;/strong&gt; for &lt;strong&gt;{search_keyword}&lt;/strong&gt;&quot;],&quot;footer.case_studies&quot;:[0,&quot;Case Studies&quot;],&quot;footer.connect_2024&quot;:[0,&quot;Connect 2024&quot;],&quot;footer.terms_of_use&quot;:[0,&quot;Terms of Use&quot;],&quot;footer.white_papers&quot;:[0,&quot;White Papers&quot;],&quot;footer.cloudflare_tv&quot;:[0,&quot;Cloudflare TV&quot;],&quot;footer.community_hub&quot;:[0,&quot;Community Hub&quot;],&quot;footer.compare_plans&quot;:[0,&quot;Compare plans&quot;],&quot;footer.contact_sales&quot;:[0,&quot;Contact Sales&quot;],&quot;header.contact_sales&quot;:[0,&quot;Contact Sales&quot;],&quot;header.email_address&quot;:[0,&quot;Email Address&quot;],&quot;page.error.not_found&quot;:[0,&quot;Page not found&quot;],&quot;footer.developer_docs&quot;:[0,&quot;Developer docs&quot;],&quot;footer.privacy_policy&quot;:[0,&quot;Privacy Policy&quot;],&quot;footer.request_a_demo&quot;:[0,&quot;Request a demo&quot;],&quot;page.continue_reading&quot;:[0,&quot;Continue reading&quot;],&quot;footer.analysts_report&quot;:[0,&quot;Analyst reports&quot;],&quot;footer.for_enterprises&quot;:[0,&quot;For enterprises&quot;],&quot;footer.getting_started&quot;:[0,&quot;Getting Started&quot;],&quot;footer.learning_center&quot;:[0,&quot;Learning Center&quot;],&quot;footer.project_galileo&quot;:[0,&quot;Project Galileo&quot;],&quot;pagination.newer_posts&quot;:[0,&quot;Newer Posts&quot;],&quot;pagination.older_posts&quot;:[0,&quot;Older Posts&quot;],&quot;posts.social_buttons.x&quot;:[0,&quot;Discuss on X&quot;],&quot;search.icon_aria_label&quot;:[0,&quot;Search&quot;],&quot;search.source_location&quot;:[0,&quot;Source/Location&quot;],&quot;footer.about_cloudflare&quot;:[0,&quot;About Cloudflare&quot;],&quot;footer.athenian_project&quot;:[0,&quot;Athenian Project&quot;],&quot;footer.become_a_partner&quot;:[0,&quot;Become a partner&quot;],&quot;footer.cloudflare_radar&quot;:[0,&quot;Cloudflare Radar&quot;],&quot;footer.network_services&quot;:[0,&quot;Network services&quot;],&quot;footer.trust_and_safety&quot;:[0,&quot;Trust &amp; Safety&quot;],&quot;header.get_started_free&quot;:[0,&quot;Get Started Free&quot;],&quot;page.search.placeholder&quot;:[0,&quot;Search Cloudflare&quot;],&quot;footer.cloudflare_status&quot;:[0,&quot;Cloudflare Status&quot;],&quot;footer.cookie_preference&quot;:[0,&quot;Cookie Preferences&quot;],&quot;header.valid_email_error&quot;:[0,&quot;Must be valid email.&quot;],&quot;search.result_stat_empty&quot;:[0,&quot;Results &lt;strong&gt;{search_range}&lt;/strong&gt; of &lt;strong&gt;{search_total}&lt;/strong&gt;&quot;],&quot;footer.connectivity_cloud&quot;:[0,&quot;Connectivity cloud&quot;],&quot;footer.developer_services&quot;:[0,&quot;Developer services&quot;],&quot;footer.investor_relations&quot;:[0,&quot;Investor relations&quot;],&quot;page.not_found.error_code&quot;:[0,&quot;Error Code: 404&quot;],&quot;search.autocomplete_title&quot;:[0,&quot;Insert a query. Press enter to send&quot;],&quot;footer.logos_and_press_kit&quot;:[0,&quot;Logos &amp; press kit&quot;],&quot;footer.application_services&quot;:[0,&quot;Application services&quot;],&quot;footer.get_a_recommendation&quot;:[0,&quot;Get a recommendation&quot;],&quot;posts.social_buttons.reddit&quot;:[0,&quot;Discuss on Reddit&quot;],&quot;footer.sse_and_sase_services&quot;:[0,&quot;SSE and SASE services&quot;],&quot;page.not_found.outdated_link&quot;:[0,&quot;You may have used an outdated link, or you may have typed the address incorrectly.&quot;],&quot;footer.report_security_issues&quot;:[0,&quot;Report Security Issues&quot;],&quot;page.error.error_message_page&quot;:[0,&quot;Sorry, we can&#39;t find the page you are looking for.&quot;],&quot;header.subscribe_notifications&quot;:[0,&quot;Subscribe to receive notifications of new posts:&quot;],&quot;footer.cloudflare_for_campaigns&quot;:[0,&quot;Cloudflare for Campaigns&quot;],&quot;header.subscription_confimation&quot;:[0,&quot;Subscription confirmed. Thank you for subscribing!&quot;],&quot;posts.social_buttons.hackernews&quot;:[0,&quot;Discuss on Hacker News&quot;],&quot;footer.diversity_equity_inclusion&quot;:[0,&quot;Diversity, equity &amp; inclusion&quot;],&quot;footer.critical_infrastructure_defense_project&quot;:[0,&quot;Critical Infrastructure Defense Project&quot;]}]}" ssr client="load" opts="{&quot;name&quot;:&quot;PostCard&quot;,&quot;value&quot;:true}" await-children><article class="w-50-l  mt4 mt2-l mb4 ph3 bb b--gray8 bn-l"><div class="w-100"><a href="/cloudflare-incident-on-february-6-2025/" class="fw5 no-underline gray1" data-testid="post-title"><h2 class="fw5 mt2">Cloudflare incident on February 6, 2025</h2></a><p class="f3 fw5 gray5 my" data-testid="post-date">2025-02-07</p><div class=""><a href="/tag/post-mortem/" class="dib pl2 pr2 pt1 pb1 mb2 bg-gray8 no-underline blue3 f2 mr1" data-testid="post-tag">Post Mortem</a><a href="/tag/outage/" class="dib pl2 pr2 pt1 pb1 mb2 bg-gray8 no-underline blue3 f2 mr1" data-testid="post-tag">Outage</a><a href="/tag/cloudflare-r2/" class="dib pl2 pr2 pt1 pb1 mb2 bg-gray8 no-underline blue3 f2 mr1" data-testid="post-tag">R2 Storage</a></div><p class="f3 fw4 gray1 lh-copy " data-testid="post-content">On Thursday, February 6, 2025, we experienced an outage with our object storage service (R2) and products that rely on it. Here&#x27;s what happened and what we&#x27;re doing to fix this going forward.<!-- -->...</p><ul class="author-lists flex pl0"><li class="list flex items-center pr2 mb3"><a href="/author/silverlock/" class="static-avatar pr1"><img class="author-profile-image br-100 mr2" src="https://blog.cloudflare.com/cdn-cgi/image/format=auto,dpr=3,width=64,height=64,gravity=face,fit=crop,zoom=0.5/https://cf-assets.www.cloudflare.com/zkvhlag99gkb/7xP5qePZD9eyVtwIesXYxh/e714aaa573161ec9eb48d59bd1aa6225/silverlock.jpeg" alt="Matt Silverlock" width="62" height="62"/></a><div class="author-name-tooltip"><a href="/author/silverlock/" class="fw4 f3 no-underline black">Matt Silverlock</a></div></li><li class="list flex items-center pr2 mb3"><a href="/author/javier/" class="static-avatar pr1"><img class="author-profile-image br-100 mr2" src="https://blog.cloudflare.com/cdn-cgi/image/format=auto,dpr=3,width=64,height=64,gravity=face,fit=crop,zoom=0.5/https://cf-assets.www.cloudflare.com/zkvhlag99gkb/3hJsvxP0uRGmk4DjS9IdSW/0197c661fe20e1ebc9922768d727df02/javier.png" alt="Javier Castro" width="62" height="62"/></a><div class="author-name-tooltip"><a href="/author/javier/" class="fw4 f3 no-underline black">Javier Castro</a></div></li></ul></div></article><!--astro:end--></astro-island><astro-island uid="1gVb4X" prefix="r3" component-url="/_astro/PostCard.DalyEN7z.js" component-export="PostCard" renderer-url="/_astro/client.DLO1yDVm.js" props="{&quot;currentPage&quot;:[0,1],&quot;isFeaturedImageFirstPost&quot;:[0,false],&quot;post&quot;:[0,{&quot;id&quot;:[0,&quot;1J7iIhkUBWQNj3JpbBTVEU&quot;],&quot;title&quot;:[0,&quot;Cloudflare incident on June 20, 2024&quot;],&quot;slug&quot;:[0,&quot;cloudflare-incident-on-june-20-2024&quot;],&quot;excerpt&quot;:[0,&quot;A new DDoS rule resulted in an increase in error responses and latency for Cloudflare customers. Here’s how it went wrong, and what we’ve learned&quot;],&quot;featured&quot;:[0,false],&quot;html&quot;:[0,&quot;&lt;p&gt;&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/18peGsB3IdmJIUOoqJalSs/b69735394144edb57ba12ff8e8516518/2459.png\&quot; alt=\&quot;Cloudflare incident on June 20, 2024\&quot; class=\&quot;kg-image\&quot; width=\&quot;1600\&quot; height=\&quot;900\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;On Thursday, June 20, 2024, two independent events caused an increase in latency and error rates for Internet properties and Cloudflare services that lasted 114 minutes. During the 30-minute peak of the impact, we saw that 1.4 - 2.1% of HTTP requests to our CDN received a generic error page, and observed a 3x increase for the 99th percentile Time To First Byte (TTFB) latency.&lt;/p&gt;&lt;p&gt;These events occurred because:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;&lt;p&gt;&lt;a href=\&quot;https://www.cloudflare.com/network-services/solutions/network-monitoring-tools/\&quot;&gt;Automated network monitoring&lt;/a&gt; detected performance degradation, re-routing traffic suboptimally and &lt;a href=\&quot;https://www.cloudflarestatus.com/incidents/k7d4c79c63lq\&quot;&gt;causing backbone congestion between 17:33 and 17:50 UTC&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;A new Distributed Denial-of-Service (DDoS) mitigation mechanism deployed between 14:14 and 17:06 UTC triggered a latent bug in our rate limiting system that allowed a specific form of HTTP request to cause a process handling it to enter an infinite loop &lt;a href=\&quot;https://www.cloudflarestatus.com/incidents/p7l6rrbhysck\&quot;&gt;between 17:47 and 19:27 UTC&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;Impact from these events were observed in many Cloudflare data centers around the world.&lt;/p&gt;&lt;p&gt;With respect to the backbone congestion event, we were already working on expanding backbone capacity in the affected data centers, and improving our network mitigations to use more information about the available capacity on alternative network paths when taking action. In the remainder of this blog post, we will go into more detail on the second and more impactful of these events.&lt;/p&gt;&lt;p&gt;As part of routine updates to our protection mechanisms, we created a new DDoS rule to prevent a specific type of abuse that we observed on our infrastructure. This DDoS rule worked as expected, however in a specific suspect traffic case it exposed a latent bug in our existing rate-limiting component. To be absolutely clear, we have no reason to believe this suspect traffic was intentionally exploiting this bug, and there is no evidence of a breach of any kind.&lt;/p&gt;&lt;p&gt;We are sorry for the impact and have already made changes to help prevent these problems from occurring again.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;background\&quot;&gt;Background&lt;/h2&gt;\n            &lt;a href=\&quot;#background\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          \n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;rate-limiting-suspicious-traffic\&quot;&gt;Rate-limiting suspicious traffic&lt;/h3&gt;\n            &lt;a href=\&quot;#rate-limiting-suspicious-traffic\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Depending on the profile of an HTTP request and the configuration of the requested Internet property, Cloudflare may protect our network and our customer’s origins by applying a limit to the number of requests a visitor can make within a certain time window. These &lt;a href=\&quot;https://www.cloudflare.com/en-gb/learning/bots/what-is-rate-limiting/\&quot;&gt;rate limits&lt;/a&gt; can activate through customer configuration or in response to DDoS rules detecting suspicious activity.&lt;/p&gt;&lt;p&gt;Usually, these rate limits will be applied based on the IP address of the visitor. As many institutions and Internet Service Providers (ISPs) can have &lt;a href=\&quot;https://en.wikipedia.org/wiki/Carrier-grade_NAT\&quot;&gt;many devices and individual users behind a single IP address&lt;/a&gt;, rate limiting based on the IP address is a broad brush that can unintentionally block legitimate traffic.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;balancing-traffic-across-our-network\&quot;&gt;Balancing traffic across our network&lt;/h3&gt;\n            &lt;a href=\&quot;#balancing-traffic-across-our-network\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Cloudflare has several systems that together provide continuous real-time capacity monitoring and rebalancing to ensure we serve as much traffic as we can as quickly and efficiently as we can.&lt;/p&gt;&lt;p&gt;The first of these is &lt;a href=\&quot;/unimog-cloudflares-edge-load-balancer\&quot;&gt;Unimog, Cloudflare’s edge load balancer&lt;/a&gt;. Every packet that reaches our anycast network passes through Unimog, which delivers it to an appropriate server to process that packet. That server may be in a different location from where the packet originally arrived into our network, depending on the availability of compute capacity. Within each data center, Unimog aims to keep the CPU load uniform across all active servers.&lt;/p&gt;&lt;p&gt;For a global view of our network, we rely on &lt;a href=\&quot;/meet-traffic-manager\&quot;&gt;Traffic Manager&lt;/a&gt;. Across all of our data center locations, it takes in a variety of signals, such as overall CPU utilization, HTTP request latency, and bandwidth utilization to instruct rebalancing decisions. It has built-in safety limits to prevent causing outsized traffic shifts, and also considers the expected resulting load in destination locations when making any decisions.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;incident-timeline-and-impact\&quot;&gt;Incident timeline and impact&lt;/h2&gt;\n            &lt;a href=\&quot;#incident-timeline-and-impact\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;All timestamps are UTC on 2024-06-20.&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;14:14 DDoS rule gradual deployment starts&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;17:06 DDoS rule deployed globally&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;17:47 First HTTP request handling process is poisoned&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;18:04 Incident declared automatically based on detected high CPU load&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;18:34 Service restart shown to recover on a server, full restart tested in one data center&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;18:44 CPU load normalized in data center after service restart&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;18:51 Continual global reloads of all servers with many stuck processes begin&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;19:05 Global eyeball HTTP error rate peaks at 2.1% service unavailable / 3.45% total&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;19:05 First Traffic Manager actions recovering service&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;19:11 Global eyeball HTTP error rate halved to 1% service unavailable / 1.96% total&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;19:27 Global eyeball HTTP error rate reduced to baseline levels&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;19:29 DDoS rule deployment identified as likely cause of process poisoning&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;19:34 DDoS rule is fully disabled&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;19:43 Engineers stop routine restarts of services on servers with many stuck processes&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;20:16 Incident response stood down&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;Below, we provide a view of the impact from some of Cloudflare’s internal metrics. The first graph illustrates the percentage of all eyeball (inbound from external devices) HTTP requests that were served an error response because the service suffering poisoning could not be reached. We saw an initial increase to 0.5% of requests, and then later a larger one reaching as much as 2.1% before recovery started due to our service reloads.&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card kg-width-wide\&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1EoCaNBt1Bss8RhwKO5s5B/155382a7f8eba337c39f48c803c9979b/image7-3.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1880\&quot; height=\&quot;442\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;For a broader view of errors, we can see all 5xx responses our network returned to eyeballs during the same window, including those from origin servers. These peaked at 3.45%, and you can more clearly see the gradual recovery between 19:25 and 20:00 UTC as Traffic Manager finished its re-routing activities. The dip at 19:25 UTC aligns with the last large reload, with the error increase afterwards primarily consisting of upstream DNS timeouts and connection limits which are consistent with high and unbalanced load.&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card kg-width-wide\&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/7G1ZnlpW9Qbw8DgW5MfsLv/9758cb94e7d6be79dcfac41e482114ea/image4-6.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1886\&quot; height=\&quot;446\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;And here’s what our TTFB measurements looked like at the 50th, 90th and 99th percentiles, showing an almost 3x increase in latency at p99:&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card kg-width-wide\&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/16tMNhSZdhkV3wH6MtAWd6/44a638b8f639d39026112c32cb80dc2e/image2-10.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1253\&quot; height=\&quot;295\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;technical-description-of-the-error-and-how-it-happened\&quot;&gt;Technical description of the error and how it happened&lt;/h2&gt;\n            &lt;a href=\&quot;#technical-description-of-the-error-and-how-it-happened\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          \n            &lt;figure class=\&quot;kg-card kg-image-card kg-width-wide\&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/MQYpmg1O82vEURJNsl2VU/da0b8e5c1afd70998bc928a533ee4160/image5-5.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1256\&quot; height=\&quot;294\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;&lt;i&gt;Global percentage of HTTP Request handling processes that were using excessive CPU during the event&lt;/i&gt;&lt;/p&gt;&lt;p&gt;Earlier on June 20, between 14:14 - 17:06 UTC, we gradually activated a new DDoS rule on our network. Cloudflare has recently been building a new way of mitigating HTTP DDoS attacks. This method is using a combination of rate-limits and cookies in order to allow legitimate clients that were falsely identified as being part of an attack to proceed anyway.&lt;/p&gt;&lt;p&gt;With this new method, an HTTP request that is considered suspicious runs through these key steps:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;&lt;p&gt;Check for the presence of a valid cookie, otherwise block the request&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;If a valid cookie is found, add a rate-limit rule based on the cookie value to be evaluated at a later point&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Once all the currently applied DDoS mitigation are run, apply rate-limit rules&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;We use this &amp;quot;asynchronous&amp;quot; workflow because it is more efficient to block a request without a rate-limit rule, so it gives a chance for other rule types to be applied.&lt;/p&gt;&lt;p&gt;So overall, the flow can be summarized with this pseudocode:&lt;/p&gt;\n            &lt;pre class=\&quot;language-bash\&quot;&gt;&lt;code class=\&quot;language-bash\&quot;&gt;for (rule in active_mitigations) {\n   // ... (ignore other rule types)\n   if (rule.match_current_request()) {\n       if (!has_valid_cookie()) {\n           // no cookie: serve error page\n           return serve_error_page();\n       } else {\n           // add a rate-limit rule to be evaluated later\n           add_rate_limit_rule(rule);\n       }\n   }\n}\n\n\nevaluate_rate_limit_rules();&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;When evaluating rate-limit rules, we need to make a &lt;i&gt;key&lt;/i&gt; for each client that is used to look up the correct counter and compare it with the target rate. Typically, this key is the client IP address, but other options are available, such as the value of a cookie as used here. We actually reused an existing portion of the rate-limit logic to achieve this. In pseudocode, it looks like:&lt;/p&gt;\n            &lt;pre class=\&quot;language-bash\&quot;&gt;&lt;code class=\&quot;language-bash\&quot;&gt;function get_cookie_key() {\n   // Validate that the cookie is valid before taking its value.\n   // Here the cookie has been checked before already, but this code is\n   // also used for &amp;quot;standalone&amp;quot; rate-limit rules.\n   if (!has_valid_cookie_broken()) { // more on the &amp;quot;broken&amp;quot; part later\n       return cookie_value;\n   } else {\n       return parent_key_generator();\n   }\n}&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;This simple &lt;i&gt;key&lt;/i&gt; generation function had two issues that, combined with a specific form of client request, caused an infinite loop in the process handling the HTTP request:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;&lt;p&gt;The rate-limit rules generated by the DDoS logic are using internal APIs in ways that haven&amp;#39;t been anticipated. This caused the &lt;code&gt;parent_key_generator&lt;/code&gt; in the pseudocode above to point to the &lt;code&gt;get_cookie_key&lt;/code&gt; function itself, meaning that if that code path was taken, the function would call itself indefinitely&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;As these rate-limit rules are added only after validating the cookie, validating it a second time should give the same result. The problem is that the &lt;code&gt;has_valid_cookie_broken&lt;/code&gt; function used here is actually different and both can disagree if the client sends multiple cookies where some are valid but not others&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;So, combining these two issues: the broken validation function tells &lt;code&gt;get_cookie_key&lt;/code&gt; that the cookie is invalid, causing the &lt;code&gt;else&lt;/code&gt; branch to be taken and calling the same function over and over.&lt;/p&gt;&lt;p&gt;A protection many programming languages have in place to help prevent loops like this is a run-time protection limit on how deep the stack of function calls can get. An attempt to call a function once already at this limit will result in a runtime error. When reading the logic above, an initial analysis might suggest we were reaching the limit in this case, and so requests eventually resulted in an error, with a stack containing those same function calls over and over.&lt;/p&gt;&lt;p&gt;However, this isn’t the case here. Some languages, including Lua, in which this logic is written, also implement an optimization called proper tail calls. A tail call is when the final action a function takes is to execute another function. Instead of adding that function as another layer in the stack, as we know for sure that we will not be returning execution context to the parent function afterwards, nor using any of its local variables, we can replace the top frame in the stack with this function call instead.&lt;/p&gt;&lt;p&gt;The end result is a loop in the request processing logic which never increases the size of the stack. Instead, it simply consumes 100% of available CPU resources, and never terminates. Once a process handling HTTP requests receives a single request on which the action should be applied and has a mixture of valid and invalid cookies, that process is poisoned and is never able to process any further requests.&lt;/p&gt;&lt;p&gt;Every Cloudflare server has dozens of such processes, so a single poisoned process does not have much of an impact. However, then some other things start happening:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;&lt;p&gt;The increase in CPU utilization for the server causes Unimog to lower the amount of new traffic that server receives, moving traffic to other servers, so at a certain point, more new connections are directed away from servers with a subset of their processes poisoned to those with fewer or no poisoned processes, and therefore lower CPU utilization.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;The gradual increase in CPU utilization in the data center starts to cause Traffic Manager to redirect traffic to other data centers. As this movement does not fix the poisoned processes, CPU utilization remains high, and so Traffic Manager continues to redirect more and more traffic away.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;The redirected traffic in both cases includes the requests that are poisoning processes, causing the servers and data centers to which this redirected traffic was sent to start failing in the same way.&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;Within a few minutes, multiple data centers had many poisoned processes, and Traffic Manager had redirected as much traffic away from them as possible, but was restricted from doing more. This was partly due to its built-in automation safety limits, but also because it was becoming more difficult to find a data center with sufficient available capacity to use as a target.&lt;/p&gt;&lt;p&gt;The first case of a poisoned process was at 17:47 UTC, and by 18:09 UTC – five minutes after the incident was declared – Traffic Manager was re-routing a lot of traffic out of Europe:&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card kg-width-wide\&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/2AVE8fJsh1ODNjAoAtduon/6d77ac4385ba78ddd251c887ef02b74a/image3-14.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1999\&quot; height=\&quot;1305\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;&lt;i&gt;A summary map of Traffic Manager capacity actions as of 18:09 UTC. Each circle represents a data center that traffic is being re-routed towards or away from. The color of the circle indicates the CPU load of that data center. The orange ribbons between them show how much traffic is re-routed, and where from/to.&lt;/i&gt;&lt;/p&gt;&lt;p&gt;It’s obvious to see why, if we look at the percentage of the HTTP request service’s processes that were saturating their CPUs. 10% of our capacity in Western Europe was already gone, and 4% in Eastern Europe, during peak traffic time for those timezones:&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card kg-width-wide\&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/7A71NY1brim2rjGowoewXo/a1c7f316d465b7dfb6c844b14c6408c3/image1-21.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1888\&quot; height=\&quot;438\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;&lt;i&gt;Percentage of all the HTTP request handling processes saturating their CPU, by geographic region&lt;/i&gt;&lt;/p&gt;&lt;p&gt;Partially poisoned servers in many locations struggled with the request load, and the remaining processes could not keep up, resulting in Cloudflare returning minimal HTTP error responses.&lt;/p&gt;&lt;p&gt;Cloudflare engineers were automatically notified at 18:04 UTC, once our global CPU utilization reached a certain sustained level, and started to investigate. Many of our on-duty incident responders were already working on the open incident caused by backbone network congestion, and in the early minutes we looked into likely correlation with the network congestion events. It took some time for us to realize that locations where the CPU was highest is where traffic was the lowest, drawing the investigation away from a network event being the trigger. At this point, the focus moved to two main streams:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;&lt;p&gt;Evaluating if restarting poisoned processes allowed them to recover, and if so, instigating mass-restarts of the service on affected servers&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Identifying the trigger of processes entering this CPU saturation state&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;It was 25 minutes after the initial incident was declared when we validated that restarts helped on one sample server. Five minutes after this, we started executing wider restarts – initially to entire data centers at once, and then as the identification method was refined, on servers with a large number of poisoned processes. Some engineers continued regular routine restarts of the affected service on impacted servers, whilst others moved to join the ongoing parallel effort to identify the trigger. At 19:36 UTC, the new DDoS rule was disabled globally, and the incident was declared resolved after executing one more round of mass restarts and monitoring.&lt;/p&gt;&lt;p&gt;At the same time, conditions presented by the incident triggered a latent bug in Traffic Manager. When triggered, the system would attempt to recover from the exception by initiating a graceful restart, halting its activity. The bug was first triggered at 18:17 UTC, then numerous times between 18:35 and 18:57 UTC. During two periods in this window (18:35-18:52 UTC and 18:56-19:05 UTC) the system did not issue any new traffic routing actions. This meant whilst we had recovered service in the most affected data centers, almost all traffic was still being re-routed away from them. Alerting notified on-call engineers of the issue at 18:34 UTC. By 19:05 UTC the Traffic team had written, tested, and deployed a fix. The first actions following restoration showed a positive impact on restoring service.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;remediation-and-follow-up-steps\&quot;&gt;Remediation and follow-up steps&lt;/h2&gt;\n            &lt;a href=\&quot;#remediation-and-follow-up-steps\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;To resolve the immediate impact to our network from the request poisoning, Cloudflare instigated mass rolling restarts of the affected service until the change that triggered the condition was identified and rolled back. The change, which was the activation of a new type of DDoS rule, remains fully rolled back, and the rule will not be reactivated until we have fixed the broken cookie validation check and are fully confident this situation cannot recur.&lt;/p&gt;&lt;p&gt;We take these incidents very seriously, and recognize the magnitude of impact they had. We have identified several steps we can take to address these specific situations, and the risk of these sorts of problems from recurring in the future.&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;&lt;b&gt;Design:&lt;/b&gt; The rate limiting implementation in use for our DDoS module is a legacy component, and rate limiting rules customers configure for their Internet properties use a newer engine with more modern technologies and protections.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;b&gt;Design:&lt;/b&gt; We are exploring options within and around the service which experienced process poisoning to limit the ability to loop forever through tail calls. Longer term, Cloudflare is entering the early implementation stages of replacing this service entirely. The design of this replacement service will allow us to apply limits on the non-interrupted and total execution time of a single request.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;b&gt;Process:&lt;/b&gt; The activation of the new rule for the first time was staged in a handful of production data centers for validation, and then to all data centers a few hours later. We will continue to enhance our staging and rollout procedures to minimize the potential change-related blast radius.&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;conclusion\&quot;&gt;Conclusion&lt;/h2&gt;\n            &lt;a href=\&quot;#conclusion\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;Cloudflare experienced two back-to-back incidents that affected a significant set of customers using our CDN and network services. The first was network backbone congestion that our systems automatically remediated. We mitigated the second by regularly restarting the faulty service whilst we identified and deactivated the DDoS rule that was triggering the fault. We are sorry for any disruption this caused our customers and to end users trying to access services.&lt;/p&gt;&lt;p&gt;The conditions necessary to activate the latent bug in the faulty service are no longer possible in our production environment, and we are putting further fixes and detections in place as soon as possible.&lt;/p&gt;&quot;],&quot;published_at&quot;:[0,&quot;2024-06-26T14:00:22.000+01:00&quot;],&quot;updated_at&quot;:[0,&quot;2024-11-06T17:20:01.691Z&quot;],&quot;feature_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/4cc09s6OD4CKawAsjgK3OJ/b7e75c41e30a7474401cbce97c6117fb/cloudflare-incident-on-june-20-2024.png&quot;],&quot;tags&quot;:[1,[[0,{&quot;id&quot;:[0,&quot;3cCNoJJ5uusKFBLYKFX1jB&quot;],&quot;name&quot;:[0,&quot;Post Mortem&quot;],&quot;slug&quot;:[0,&quot;post-mortem&quot;]}],[0,{&quot;id&quot;:[0,&quot;4yliZlpBPZpOwBDZzo1tTh&quot;],&quot;name&quot;:[0,&quot;Outage&quot;],&quot;slug&quot;:[0,&quot;outage&quot;]}]]],&quot;relatedTags&quot;:[0],&quot;authors&quot;:[1,[[0,{&quot;name&quot;:[0,&quot;Lloyd Wallis&quot;],&quot;slug&quot;:[0,&quot;lloyd&quot;],&quot;bio&quot;:[0,null],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1xDgId76v9OdjGsVHH31ed/b9c21c8e9f4e47e492bdb450e4817512/lloyd.jpg&quot;],&quot;location&quot;:[0,&quot;London, UK&quot;],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,&quot;@LloydW93&quot;],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}],[0,{&quot;name&quot;:[0,&quot;Julien Desgats&quot;],&quot;slug&quot;:[0,&quot;julien-desgats&quot;],&quot;bio&quot;:[0,null],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/7rDtCt8aM8HBmfsg6xuTiV/703907f4801e2b832079d9f78d019654/julien-desgats.jpg&quot;],&quot;location&quot;:[0,null],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,null],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}],[0,{&quot;name&quot;:[0,&quot;Manish Arora&quot;],&quot;slug&quot;:[0,&quot;manish&quot;],&quot;bio&quot;:[0,null],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/4u7fayYeIfvEDkEviluW6O/62548ae5a3f678a8e8f1ae566dbdb54d/manish.png&quot;],&quot;location&quot;:[0,null],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,null],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}]]],&quot;meta_description&quot;:[0,&quot;A new DDoS rule resulted in an increase in error responses and latency for Cloudflare customers. Here’s how it went wrong, and what we’ve learned&quot;],&quot;primary_author&quot;:[0,{}],&quot;localeList&quot;:[0,{&quot;name&quot;:[0,&quot;Cloudflare incident on June 20, 2024 Config&quot;],&quot;enUS&quot;:[0,&quot;English for Locale&quot;],&quot;zhCN&quot;:[0,&quot;Translated for Locale&quot;],&quot;zhHansCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhTW&quot;:[0,&quot;Translated for Locale&quot;],&quot;frFR&quot;:[0,&quot;No Page for Locale&quot;],&quot;deDE&quot;:[0,&quot;No Page for Locale&quot;],&quot;itIT&quot;:[0,&quot;No Page for Locale&quot;],&quot;jaJP&quot;:[0,&quot;Translated for Locale&quot;],&quot;koKR&quot;:[0,&quot;Translated for Locale&quot;],&quot;ptBR&quot;:[0,&quot;No Page for Locale&quot;],&quot;esLA&quot;:[0,&quot;No Page for Locale&quot;],&quot;esES&quot;:[0,&quot;No Page for Locale&quot;],&quot;enAU&quot;:[0,&quot;No Page for Locale&quot;],&quot;enCA&quot;:[0,&quot;No Page for Locale&quot;],&quot;enIN&quot;:[0,&quot;No Page for Locale&quot;],&quot;enGB&quot;:[0,&quot;No Page for Locale&quot;],&quot;idID&quot;:[0,&quot;No Page for Locale&quot;],&quot;ruRU&quot;:[0,&quot;No Page for Locale&quot;],&quot;svSE&quot;:[0,&quot;No Page for Locale&quot;],&quot;viVN&quot;:[0,&quot;No Page for Locale&quot;],&quot;plPL&quot;:[0,&quot;No Page for Locale&quot;],&quot;arAR&quot;:[0,&quot;No Page for Locale&quot;],&quot;nlNL&quot;:[0,&quot;No Page for Locale&quot;],&quot;thTH&quot;:[0,&quot;No Page for Locale&quot;],&quot;trTR&quot;:[0,&quot;No Page for Locale&quot;],&quot;heIL&quot;:[0,&quot;No Page for Locale&quot;],&quot;lvLV&quot;:[0,&quot;No Page for Locale&quot;],&quot;etEE&quot;:[0,&quot;No Page for Locale&quot;],&quot;ltLT&quot;:[0,&quot;No Page for Locale&quot;]}],&quot;url&quot;:[0,&quot;https://blog.cloudflare.com/cloudflare-incident-on-june-20-2024&quot;],&quot;metadata&quot;:[0,{&quot;title&quot;:[0,&quot;Cloudflare incident on June 20, 2024&quot;],&quot;description&quot;:[0,&quot;A new DDoS rule resulted in an increase in error responses and latency for Cloudflare customers. Here’s how it went wrong, and what we’ve learned&quot;],&quot;imgPreview&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/7JbteaUQFsFtVENbpaWebp/c67300fe5ef42861ecb2b788ba164d1c/cloudflare-incident-on-june-20-2024-yMwJXB.png&quot;]}],&quot;publicly_index&quot;:[0,true]}],&quot;translations&quot;:[0,{&quot;posts.by&quot;:[0,&quot;By&quot;],&quot;footer.gdpr&quot;:[0,&quot;GDPR&quot;],&quot;lang_blurb1&quot;:[0,&quot;This post is also available in {lang1}.&quot;],&quot;lang_blurb2&quot;:[0,&quot;This post is also available in {lang1} and {lang2}.&quot;],&quot;lang_blurb3&quot;:[0,&quot;This post is also available in {lang1}, {lang2} and {lang3}.&quot;],&quot;footer.press&quot;:[0,&quot;Press&quot;],&quot;header.title&quot;:[0,&quot;The Cloudflare Blog&quot;],&quot;search.clear&quot;:[0,&quot;Clear&quot;],&quot;search.filter&quot;:[0,&quot;Filter&quot;],&quot;search.source&quot;:[0,&quot;Source&quot;],&quot;footer.careers&quot;:[0,&quot;Careers&quot;],&quot;footer.company&quot;:[0,&quot;Company&quot;],&quot;footer.support&quot;:[0,&quot;Support&quot;],&quot;footer.the_net&quot;:[0,&quot;theNet&quot;],&quot;search.filters&quot;:[0,&quot;Filters&quot;],&quot;footer.our_team&quot;:[0,&quot;Our team&quot;],&quot;footer.webinars&quot;:[0,&quot;Webinars&quot;],&quot;page.more_posts&quot;:[0,&quot;More posts&quot;],&quot;posts.time_read&quot;:[0,&quot;{time} min read&quot;],&quot;search.language&quot;:[0,&quot;Language&quot;],&quot;footer.community&quot;:[0,&quot;Community&quot;],&quot;footer.resources&quot;:[0,&quot;Resources&quot;],&quot;footer.solutions&quot;:[0,&quot;Solutions&quot;],&quot;footer.trademark&quot;:[0,&quot;Trademark&quot;],&quot;header.subscribe&quot;:[0,&quot;Subscribe&quot;],&quot;footer.compliance&quot;:[0,&quot;Compliance&quot;],&quot;footer.free_plans&quot;:[0,&quot;Free plans&quot;],&quot;footer.impact_ESG&quot;:[0,&quot;Impact/ESG&quot;],&quot;posts.follow_on_X&quot;:[0,&quot;Follow on X&quot;],&quot;footer.help_center&quot;:[0,&quot;Help center&quot;],&quot;footer.network_map&quot;:[0,&quot;Network Map&quot;],&quot;header.please_wait&quot;:[0,&quot;Please Wait&quot;],&quot;page.related_posts&quot;:[0,&quot;Related posts&quot;],&quot;search.result_stat&quot;:[0,&quot;Results &lt;strong&gt;{search_range}&lt;/strong&gt; of &lt;strong&gt;{search_total}&lt;/strong&gt; for &lt;strong&gt;{search_keyword}&lt;/strong&gt;&quot;],&quot;footer.case_studies&quot;:[0,&quot;Case Studies&quot;],&quot;footer.connect_2024&quot;:[0,&quot;Connect 2024&quot;],&quot;footer.terms_of_use&quot;:[0,&quot;Terms of Use&quot;],&quot;footer.white_papers&quot;:[0,&quot;White Papers&quot;],&quot;footer.cloudflare_tv&quot;:[0,&quot;Cloudflare TV&quot;],&quot;footer.community_hub&quot;:[0,&quot;Community Hub&quot;],&quot;footer.compare_plans&quot;:[0,&quot;Compare plans&quot;],&quot;footer.contact_sales&quot;:[0,&quot;Contact Sales&quot;],&quot;header.contact_sales&quot;:[0,&quot;Contact Sales&quot;],&quot;header.email_address&quot;:[0,&quot;Email Address&quot;],&quot;page.error.not_found&quot;:[0,&quot;Page not found&quot;],&quot;footer.developer_docs&quot;:[0,&quot;Developer docs&quot;],&quot;footer.privacy_policy&quot;:[0,&quot;Privacy Policy&quot;],&quot;footer.request_a_demo&quot;:[0,&quot;Request a demo&quot;],&quot;page.continue_reading&quot;:[0,&quot;Continue reading&quot;],&quot;footer.analysts_report&quot;:[0,&quot;Analyst reports&quot;],&quot;footer.for_enterprises&quot;:[0,&quot;For enterprises&quot;],&quot;footer.getting_started&quot;:[0,&quot;Getting Started&quot;],&quot;footer.learning_center&quot;:[0,&quot;Learning Center&quot;],&quot;footer.project_galileo&quot;:[0,&quot;Project Galileo&quot;],&quot;pagination.newer_posts&quot;:[0,&quot;Newer Posts&quot;],&quot;pagination.older_posts&quot;:[0,&quot;Older Posts&quot;],&quot;posts.social_buttons.x&quot;:[0,&quot;Discuss on X&quot;],&quot;search.icon_aria_label&quot;:[0,&quot;Search&quot;],&quot;search.source_location&quot;:[0,&quot;Source/Location&quot;],&quot;footer.about_cloudflare&quot;:[0,&quot;About Cloudflare&quot;],&quot;footer.athenian_project&quot;:[0,&quot;Athenian Project&quot;],&quot;footer.become_a_partner&quot;:[0,&quot;Become a partner&quot;],&quot;footer.cloudflare_radar&quot;:[0,&quot;Cloudflare Radar&quot;],&quot;footer.network_services&quot;:[0,&quot;Network services&quot;],&quot;footer.trust_and_safety&quot;:[0,&quot;Trust &amp; Safety&quot;],&quot;header.get_started_free&quot;:[0,&quot;Get Started Free&quot;],&quot;page.search.placeholder&quot;:[0,&quot;Search Cloudflare&quot;],&quot;footer.cloudflare_status&quot;:[0,&quot;Cloudflare Status&quot;],&quot;footer.cookie_preference&quot;:[0,&quot;Cookie Preferences&quot;],&quot;header.valid_email_error&quot;:[0,&quot;Must be valid email.&quot;],&quot;search.result_stat_empty&quot;:[0,&quot;Results &lt;strong&gt;{search_range}&lt;/strong&gt; of &lt;strong&gt;{search_total}&lt;/strong&gt;&quot;],&quot;footer.connectivity_cloud&quot;:[0,&quot;Connectivity cloud&quot;],&quot;footer.developer_services&quot;:[0,&quot;Developer services&quot;],&quot;footer.investor_relations&quot;:[0,&quot;Investor relations&quot;],&quot;page.not_found.error_code&quot;:[0,&quot;Error Code: 404&quot;],&quot;search.autocomplete_title&quot;:[0,&quot;Insert a query. Press enter to send&quot;],&quot;footer.logos_and_press_kit&quot;:[0,&quot;Logos &amp; press kit&quot;],&quot;footer.application_services&quot;:[0,&quot;Application services&quot;],&quot;footer.get_a_recommendation&quot;:[0,&quot;Get a recommendation&quot;],&quot;posts.social_buttons.reddit&quot;:[0,&quot;Discuss on Reddit&quot;],&quot;footer.sse_and_sase_services&quot;:[0,&quot;SSE and SASE services&quot;],&quot;page.not_found.outdated_link&quot;:[0,&quot;You may have used an outdated link, or you may have typed the address incorrectly.&quot;],&quot;footer.report_security_issues&quot;:[0,&quot;Report Security Issues&quot;],&quot;page.error.error_message_page&quot;:[0,&quot;Sorry, we can&#39;t find the page you are looking for.&quot;],&quot;header.subscribe_notifications&quot;:[0,&quot;Subscribe to receive notifications of new posts:&quot;],&quot;footer.cloudflare_for_campaigns&quot;:[0,&quot;Cloudflare for Campaigns&quot;],&quot;header.subscription_confimation&quot;:[0,&quot;Subscription confirmed. Thank you for subscribing!&quot;],&quot;posts.social_buttons.hackernews&quot;:[0,&quot;Discuss on Hacker News&quot;],&quot;footer.diversity_equity_inclusion&quot;:[0,&quot;Diversity, equity &amp; inclusion&quot;],&quot;footer.critical_infrastructure_defense_project&quot;:[0,&quot;Critical Infrastructure Defense Project&quot;]}]}" ssr client="load" opts="{&quot;name&quot;:&quot;PostCard&quot;,&quot;value&quot;:true}" await-children><article class="w-50-l  mt4 mt2-l mb4 ph3 bb b--gray8 bn-l"><div class="w-100"><a href="/cloudflare-incident-on-june-20-2024/" class="fw5 no-underline gray1" data-testid="post-title"><h2 class="fw5 mt2">Cloudflare incident on June 20, 2024</h2></a><p class="f3 fw5 gray5 my" data-testid="post-date">2024-06-26</p><div class=""><a href="/tag/post-mortem/" class="dib pl2 pr2 pt1 pb1 mb2 bg-gray8 no-underline blue3 f2 mr1" data-testid="post-tag">Post Mortem</a><a href="/tag/outage/" class="dib pl2 pr2 pt1 pb1 mb2 bg-gray8 no-underline blue3 f2 mr1" data-testid="post-tag">Outage</a></div><p class="f3 fw4 gray1 lh-copy " data-testid="post-content">A new DDoS rule resulted in an increase in error responses and latency for Cloudflare customers. Here’s how it went wrong, and what we’ve learned<!-- -->...</p><ul class="author-lists flex pl0"><li class="list flex items-center pr2 mb3"><a href="/author/lloyd/" class="static-avatar pr1"><img class="author-profile-image br-100 mr2" src="https://blog.cloudflare.com/cdn-cgi/image/format=auto,dpr=3,width=64,height=64,gravity=face,fit=crop,zoom=0.5/https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1xDgId76v9OdjGsVHH31ed/b9c21c8e9f4e47e492bdb450e4817512/lloyd.jpg" alt="Lloyd Wallis" width="62" height="62"/></a><div class="author-name-tooltip"><a href="/author/lloyd/" class="fw4 f3 no-underline black">Lloyd Wallis</a></div></li><li class="list flex items-center pr2 mb3"><a href="/author/julien-desgats/" class="static-avatar pr1"><img class="author-profile-image br-100 mr2" src="https://blog.cloudflare.com/cdn-cgi/image/format=auto,dpr=3,width=64,height=64,gravity=face,fit=crop,zoom=0.5/https://cf-assets.www.cloudflare.com/zkvhlag99gkb/7rDtCt8aM8HBmfsg6xuTiV/703907f4801e2b832079d9f78d019654/julien-desgats.jpg" alt="Julien Desgats" width="62" height="62"/></a><div class="author-name-tooltip"><a href="/author/julien-desgats/" class="fw4 f3 no-underline black">Julien Desgats</a></div></li><li class="list flex items-center pr2 mb3"><a href="/author/manish/" class="static-avatar pr1"><img class="author-profile-image br-100 mr2" src="https://blog.cloudflare.com/cdn-cgi/image/format=auto,dpr=3,width=64,height=64,gravity=face,fit=crop,zoom=0.5/https://cf-assets.www.cloudflare.com/zkvhlag99gkb/4u7fayYeIfvEDkEviluW6O/62548ae5a3f678a8e8f1ae566dbdb54d/manish.png" alt="Manish Arora" width="62" height="62"/></a><div class="author-name-tooltip"><a href="/author/manish/" class="fw4 f3 no-underline black">Manish Arora</a></div></li></ul></div></article><!--astro:end--></astro-island><astro-island uid="Z2eyoV9" prefix="r4" component-url="/_astro/PostCard.DalyEN7z.js" component-export="PostCard" renderer-url="/_astro/client.DLO1yDVm.js" props="{&quot;currentPage&quot;:[0,1],&quot;isFeaturedImageFirstPost&quot;:[0,false],&quot;post&quot;:[0,{&quot;id&quot;:[0,&quot;3jSHB2RGdy2XNScvpyF1oX&quot;],&quot;title&quot;:[0,&quot;Major data center power failure (again): Cloudflare Code Orange tested&quot;],&quot;slug&quot;:[0,&quot;major-data-center-power-failure-again-cloudflare-code-orange-tested&quot;],&quot;excerpt&quot;:[0,&quot;Just four months after a complete power outage at a critical data center we were hit with the exact same scenario.  Here’s how we did this time, and what’s next&quot;],&quot;featured&quot;:[0,false],&quot;html&quot;:[0,&quot;&lt;p&gt;&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/4fn80cCKCVWYn0XOOh3eX2/e23f4144cdb106dc80bd3b8a27f27254/image3-11.png\&quot; alt=\&quot;Major data center power failure (again): Cloudflare Code Orange tested\&quot; class=\&quot;kg-image\&quot; width=\&quot;1800\&quot; height=\&quot;1013\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;Here&amp;#39;s a post we never thought we&amp;#39;d need to write: less than five months after one of our major data centers lost power, it happened again to the exact same data center. That sucks and, if you&amp;#39;re thinking &amp;quot;why do they keep using this facility??,&amp;quot; I don&amp;#39;t blame you. We&amp;#39;re thinking the same thing. But, here&amp;#39;s the thing, while a lot may not have changed at the data center, a lot changed over those five months at Cloudflare. So, while five months ago a major data center going offline was really painful, this time it was much less so.&lt;/p&gt;&lt;p&gt;This is a little bit about how a high availability data center lost power for the second time in five months. But, more so, it&amp;#39;s the story of how our team worked to ensure that even if one of our critical data centers lost power it wouldn&amp;#39;t impact our customers.&lt;/p&gt;&lt;p&gt;On November 2, 2023, one of our critical facilities in the Portland, Oregon region lost power for an extended period of time. It happened because of a cascading series of faults that appears to have been caused by maintenance by the electrical grid provider, climaxing with a ground fault at the facility, and was made worse by a series of unfortunate incidents that prevented the facility from getting back online in a timely fashion.&lt;/p&gt;&lt;p&gt;If you want to read all the gory details, they&amp;#39;re available &lt;a href=\&quot;/post-mortem-on-cloudflare-control-plane-and-analytics-outage/\&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;It&amp;#39;s painful whenever a data center has a complete loss of power, but it&amp;#39;s something that we were supposed to expect. Unfortunately, in spite of that expectation, we hadn&amp;#39;t enforced a number of requirements on our products that would ensure they continued running in spite of a major failure.&lt;/p&gt;&lt;p&gt;That was a mistake we were never going to allow to happen again.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;code-orange\&quot;&gt;Code Orange&lt;/h3&gt;\n            &lt;a href=\&quot;#code-orange\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;The incident was painful enough that we declared what we called Code Orange. We borrowed the idea from Google which, when they have an existential threat to their business, reportedly declares a Code Yellow or Code Red. Our logo is orange, so we altered the formula a bit.&lt;/p&gt;&lt;p&gt;Our conception of Code Orange was that the person who led the incident, in this case our SVP of Technical Operations, Jeremy Hartman, would be empowered to charge any engineer on our team to work on what he deemed the highest priority project. (Unless we declared a Code Red, which we actually ended up doing due to a hacking incident, and which would then take even higher priority. If you&amp;#39;re interested, you can read more about that &lt;a href=\&quot;/thanksgiving-2023-security-incident/\&quot;&gt;here&lt;/a&gt;.)&lt;/p&gt;&lt;p&gt;After getting through the immediate incident, Jeremy quickly triaged the most important work that needed to be done in order to ensure we&amp;#39;d be highly available even in the case of another catastrophic failure of a major data center facility. And the team got to work.&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/4Q7F31g2w6xPxdlq39dpDW/ad9a106fed84e8fcd728e165bfd2767a/image2-15.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1800\&quot; height=\&quot;338\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;howd-we-do\&quot;&gt;How&amp;#39;d we do?&lt;/h3&gt;\n            &lt;a href=\&quot;#howd-we-do\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;We didn’t expect such an extensive real-world test so quickly, but the universe works in mysterious ways. On Tuesday, March 26, 2024, — just shy of five months after the initial incident — the same facility had another major power outage. Below, we&amp;#39;ll get into what caused the outage this time, but what is most important is that it provided a perfect test for the work our team had done under Code Orange. So, what were the results?&lt;/p&gt;&lt;p&gt;First, let’s revisit what functions the Portland data centers at Cloudflare provide. As described in the November 2, 2023, &lt;a href=\&quot;/post-mortem-on-cloudflare-control-plane-and-analytics-outage/\&quot;&gt;post&lt;/a&gt;, the control plane of Cloudflare primarily consists of the customer-facing interface for all of our services including our website and API. Additionally, the underlying services that provide the Analytics and Logging pipelines are primarily served from these facilities.&lt;/p&gt;&lt;p&gt;Just like in November 2023, we were alerted immediately that we had lost connectivity to our PDX01 data center. Unlike in November, we very quickly knew with certainty that we had once again lost all power, putting us in the exact same situation as five months prior. We also knew, based on a successful internal cut test in February, how our systems should react. We had spent months preparing, updating countless systems and activating huge amounts of network and server capacity, culminating with a test to prove the work was having the intended effect, which in this case was an automatic failover to the redundant facilities.&lt;/p&gt;&lt;p&gt;Our Control Plane consists of hundreds of internal services, and the expectation is that when we lose one of the three critical data centers in Portland, these services continue to operate normally in the remaining two facilities, and we continue to operate primarily in Portland. We have the capability to fail over to our European data centers in case our Portland centers are completely unavailable. However, that is a secondary option, and not something we pursue immediately.&lt;/p&gt;&lt;p&gt;On March 26, 2024, at 14:58 UTC, PDX01 lost power and our systems began to react. By 15:05 UTC, our APIs and Dashboards were operating normally, all without human intervention. Our primary focus over the past few months has been to make sure that our customers would still be able to configure and operate their Cloudflare services in case of a similar outage. There were a few specific services that required human intervention and therefore took a bit longer to recover, however the primary interface mechanism was operating as expected.&lt;/p&gt;&lt;p&gt;To put a finer point on this, during the November 2, 2023, incident the following services had at least six hours of control plane downtime, with several of them functionally degraded for days.&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;API and Dashboard&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Zero Trust&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Magic Transit&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;SSL&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;SSL for SaaS&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Workers&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;KV&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Waiting Room&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Load Balancing&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Zero Trust Gateway&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Access&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Pages&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Stream&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Images&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;During the March 26, 2024, incident, all of these services were up and running within minutes of the power failure, and many of them did not experience any impact at all during the failover.&lt;/p&gt;&lt;p&gt;The data plane, which handles the traffic that Cloudflare customers pass through our data centers in over 300 cities worldwide, was not impacted.&lt;/p&gt;&lt;p&gt;Our Analytics platform, which provides a view into customer traffic, was impacted and wasn’t fully restored until later that day. This was expected behavior as the Analytics platform is reliant on the PDX01 data center. Just like the Control Plane work, we began building new Analytics capacity immediately after the November 2, 2023, incident. However, the scale of the work requires that it will take a bit more time to complete. We have been working as fast as we can to remove this dependency, and we expect to complete this work in the near future.&lt;/p&gt;&lt;p&gt;Once we had validated the functionality of our Control Plane services, we were faced yet again with the cold start of a very large data center. This activity took roughly 72 hours in November 2023, but this time around we were able to complete this in roughly 10 hours. There is still work to be done to make that even faster in the future, and we will continue to refine our procedures in case we have a similar incident in the future.&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/7cu18EGvfdwXuXIr81qHN8/eaa05db6a5944d0270ed685ce558b070/Incident-inspection.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1600\&quot; height=\&quot;284\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;how-did-we-get-here\&quot;&gt;How did we get here?&lt;/h3&gt;\n            &lt;a href=\&quot;#how-did-we-get-here\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;As mentioned above, the power outage event from last November led us to introduce Code Orange, a process where we shift most or all engineering resources to addressing the issue at hand when there’s a significant event or crisis. Over the past five months, we shifted all non-critical engineering functions to focusing on ensuring high reliability of our control plane.&lt;/p&gt;&lt;p&gt;Teams across our engineering departments rallied to ensure our systems would be more resilient in the face of a similar failure in the future. Though the March 26, 2024, incident was unexpected, it was something we’d been preparing for.&lt;/p&gt;&lt;p&gt;The most obvious difference is the speed at which the control plane and APIs regained service. Without human intervention, the ability to log in and make changes to Cloudflare configuration was possible seven minutes after PDX01 was lost. This is due to our efforts to move all of our configuration databases to a Highly Available (HA) topology, and pre-provision enough capacity that we could absorb the capacity loss. More than 100 databases across over 20 different database clusters simultaneously failed out of the affected facility and restored service automatically. This was actually the culmination of over a year’s worth of work, and we make sure we prove our ability to failover properly with weekly tests.&lt;/p&gt;&lt;p&gt;Another significant improvement is the updates to our Logpush infrastructure. In November 2023, the loss of the PDX01 datacenter meant that we were unable to push logs to our customers. During Code Orange, we invested in making the Logpush infrastructure HA in Portland, and additionally created an active failover option in Amsterdam. Logpush took advantage of our massively expanded Kubernetes cluster that spans all of our Portland facilities and provides a seamless way for service owners to deploy HA compliant services that have resiliency baked in. In fact, during our February chaos exercise, we found a flaw in our Portland HA deployment, but customers were not impacted because the Amsterdam Logpush infrastructure took over successfully. During this event, we saw that the fixes we’d made since then worked, and we were able to push logs from the Portland region.&lt;/p&gt;&lt;p&gt;A number of other improvements in our Stream and Zero Trust products resulted in little to no impact to their operation. Our Stream products, which use a lot of compute resources to transcode videos, were able to seamlessly hand off to our Amsterdam facility to continue operations. Teams were given specific availability targets for the services and were provided several options to achieve those targets. Stream is a good example of a service that chose a different resiliency architecture but was able to seamlessly deliver their service during this outage. Zero Trust, which was also impacted in November 2023, has since moved the vast majority of its functionally to our hundreds of data centers, which kept working seamlessly throughout this event. Ultimately this is the strategy we are pushing all Cloudflare products to adopt as our data centers in &lt;a href=\&quot;https://www.cloudflare.com/network\&quot;&gt;over 300 cities worldwide&lt;/a&gt; provide the highest level of availability possible.&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/4hnYtkVM6JHuvAOD3HGNmq/239ae0443184a22761245b4458e15ead/image1-12.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1800\&quot; height=\&quot;320\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;what-happened-to-the-power-in-the-data-center\&quot;&gt;What happened to the power in the data center?&lt;/h3&gt;\n            &lt;a href=\&quot;#what-happened-to-the-power-in-the-data-center\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;On March 26, 2024, at 14:58 UTC, PDX01 experienced a total loss of power to Cloudflare’s physical infrastructure following a reportedly simultaneous failure of four Flexential-owned and operated switchboards serving all of Cloudflare’s cages. This meant both primary and redundant power paths were deactivated across the entire environment. During the Flexential investigation, engineers focused on a set of equipment known as Circuit Switch Boards, or CSBs. CSBs are likened to an electrical panel board, consisting of a main input circuit breaker and series of smaller output breakers. Flexential engineers reported that infrastructure upstream of the CSBs (power feed, generator, UPS &amp;amp; PDU/transformer) was not impacted and continued to act normally. Similarly, infrastructure downstream from the CSBs such as Remote Power Panels and connected switchgear was not impacted – thus implying the outage was isolated to the CSBs themselves.&lt;/p&gt;&lt;p&gt;Initial assessment of the root cause of Flexential’s CSB failures points to incorrectly set breaker coordination settings within the four CSBs as one contributing factor. Trip settings which are too restrictive can result in overly sensitive overcurrent protection and the potential nuisance tripping of devices. In our case, Flexential’s breaker settings within the four CSBs were reportedly too low in relation to the downstream provisioned power capacities. When one or more of these breakers tripped, a cascading failure of the remaining active CSB boards resulted, thus causing a total loss of power serving Cloudflare’s cage and others on the shared infrastructure. During the triage of the incident, we were told that the Flexential facilities team noticed the incorrect trip settings, reset the CSBs and adjusted them to the expected values, enabling our team to power up our servers in a staged and controlled fashion. We do not know when these settings were established – typically, these would be set/adjusted as part of a data center commissioning process and/or breaker coordination study before customer critical loads are installed.&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/3lJDAVlXMNrU7Eyp7PP0lF/db9a86dfa40f4ca85965d8af8b36c634/Incident-inspection-3.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1600\&quot; height=\&quot;284\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;whats-next\&quot;&gt;What’s next?&lt;/h3&gt;\n            &lt;a href=\&quot;#whats-next\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Our top priority is completing the resilience program for our Analytics platform. Analytics aren’t simply pretty charts in a dashboard. When you want to check the status of attacks, activities a firewall is blocking, or even the status of Cloudflare Tunnels - you need analytics. We have evidence that the resiliency pattern we are adopting works as expected, so this remains our primary focus, and we will progress as quickly as possible.&lt;/p&gt;&lt;p&gt;There were some services that still required manual intervention to properly recover, and we have collected data and action items for each of them to ensure that further manual action is not required. We will continue to use production cut tests to prove all of these changes and enhancements provide the resiliency that our customers expect.&lt;/p&gt;&lt;p&gt;We will continue to work with Flexential on follow-up activities to expand our understanding of their operational and review procedures to the greatest extent possible. While this incident was limited to a single facility, we will turn this exercise into a process that ensures we have a similar view into all of our critical data center facilities.&lt;/p&gt;&lt;p&gt;Once again, we are very sorry for the impact to our customers, particularly those that rely on the Analytics engine who were unable to access that product feature during the incident. Our work over the past four months has yielded the results that we expected, and we will stay absolutely focused on completing the remaining body of work.&lt;/p&gt;&quot;],&quot;published_at&quot;:[0,&quot;2024-04-08T14:00:15.000+01:00&quot;],&quot;updated_at&quot;:[0,&quot;2024-10-09T23:28:01.244Z&quot;],&quot;feature_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/4bbrEk2RMnve9baEwW0cXh/a6d37e60317c9f7a7a4c172b3287ffd7/major-data-center-power-failure-again-cloudflare-code-orange-tested.png&quot;],&quot;tags&quot;:[1,[[0,{&quot;id&quot;:[0,&quot;3cCNoJJ5uusKFBLYKFX1jB&quot;],&quot;name&quot;:[0,&quot;Post Mortem&quot;],&quot;slug&quot;:[0,&quot;post-mortem&quot;]}],[0,{&quot;id&quot;:[0,&quot;4yliZlpBPZpOwBDZzo1tTh&quot;],&quot;name&quot;:[0,&quot;Outage&quot;],&quot;slug&quot;:[0,&quot;outage&quot;]}]]],&quot;relatedTags&quot;:[0],&quot;authors&quot;:[1,[[0,{&quot;name&quot;:[0,&quot;Matthew Prince&quot;],&quot;slug&quot;:[0,&quot;matthew-prince&quot;],&quot;bio&quot;:[0,&quot;A little bit geek, wonk, and nerd. Repeat entrepreneur, recovering lawyer, and former ski instructor. Co-founder &amp; CEO of Cloudflare (NYSE: NET).&quot;],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1VD9WePJ1jvjFwuSRF0IfQ/5e4f7d5fd4825358b33b2ead623140d8/matthew-prince.jpeg&quot;],&quot;location&quot;:[0,&quot;San Francisco, CA&quot;],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,&quot;@eastdakota&quot;],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}],[0,{&quot;name&quot;:[0,&quot;John Graham-Cumming&quot;],&quot;slug&quot;:[0,&quot;john-graham-cumming&quot;],&quot;bio&quot;:[0,null],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/5vGNsXzZrtSLn2X30pnpUY/6f350e7dd36058a6422f9199b452bb02/john-graham-cumming.jpg&quot;],&quot;location&quot;:[0,&quot;Lisbon, Portugal&quot;],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,null],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}],[0,{&quot;name&quot;:[0,&quot;Jeremy Hartman&quot;],&quot;slug&quot;:[0,&quot;jeremy-hartman&quot;],&quot;bio&quot;:[0,null],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1yTvNpd60qmjgY8fbItcDp/f964f6cd281c1693cee7b4a43a6e3845/jeremy-hartman.jpeg&quot;],&quot;location&quot;:[0,null],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,null],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}]]],&quot;meta_description&quot;:[0,&quot;Just four months after a complete power outage at a critical data center we were hit with the exact same scenario.  Here’s how we did this time, and what’s next.&quot;],&quot;primary_author&quot;:[0,{}],&quot;localeList&quot;:[0,{&quot;name&quot;:[0,&quot;Major data center power failure (again): Cloudflare Code Orange tested Config&quot;],&quot;enUS&quot;:[0,&quot;English for Locale&quot;],&quot;zhCN&quot;:[0,&quot;Translated for Locale&quot;],&quot;zhHansCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhTW&quot;:[0,&quot;Translated for Locale&quot;],&quot;frFR&quot;:[0,&quot;Translated for Locale&quot;],&quot;deDE&quot;:[0,&quot;Translated for Locale&quot;],&quot;itIT&quot;:[0,&quot;No Page for Locale&quot;],&quot;jaJP&quot;:[0,&quot;Translated for Locale&quot;],&quot;koKR&quot;:[0,&quot;Translated for Locale&quot;],&quot;ptBR&quot;:[0,&quot;No Page for Locale&quot;],&quot;esLA&quot;:[0,&quot;No Page for Locale&quot;],&quot;esES&quot;:[0,&quot;Translated for Locale&quot;],&quot;enAU&quot;:[0,&quot;No Page for Locale&quot;],&quot;enCA&quot;:[0,&quot;No Page for Locale&quot;],&quot;enIN&quot;:[0,&quot;No Page for Locale&quot;],&quot;enGB&quot;:[0,&quot;No Page for Locale&quot;],&quot;idID&quot;:[0,&quot;No Page for Locale&quot;],&quot;ruRU&quot;:[0,&quot;No Page for Locale&quot;],&quot;svSE&quot;:[0,&quot;No Page for Locale&quot;],&quot;viVN&quot;:[0,&quot;No Page for Locale&quot;],&quot;plPL&quot;:[0,&quot;No Page for Locale&quot;],&quot;arAR&quot;:[0,&quot;No Page for Locale&quot;],&quot;nlNL&quot;:[0,&quot;No Page for Locale&quot;],&quot;thTH&quot;:[0,&quot;No Page for Locale&quot;],&quot;trTR&quot;:[0,&quot;No Page for Locale&quot;],&quot;heIL&quot;:[0,&quot;No Page for Locale&quot;],&quot;lvLV&quot;:[0,&quot;No Page for Locale&quot;],&quot;etEE&quot;:[0,&quot;No Page for Locale&quot;],&quot;ltLT&quot;:[0,&quot;No Page for Locale&quot;]}],&quot;url&quot;:[0,&quot;https://blog.cloudflare.com/major-data-center-power-failure-again-cloudflare-code-orange-tested&quot;],&quot;metadata&quot;:[0,{&quot;title&quot;:[0,&quot;Major data center power failure (again): Cloudflare Code Orange tested&quot;],&quot;description&quot;:[0,&quot;Just four months after a complete power outage at a critical data center we were hit with the exact same scenario.  Here’s how we did this time, and what’s next.&quot;],&quot;imgPreview&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/5ARkdS88AEID6KoSFfQK4w/e5938547e4b3c6b6d98d48b0406a2400/major-data-center-power-failure-again-cloudflare-code-orange-tested-kT3ZCQ.png&quot;]}],&quot;publicly_index&quot;:[0,true]}],&quot;translations&quot;:[0,{&quot;posts.by&quot;:[0,&quot;By&quot;],&quot;footer.gdpr&quot;:[0,&quot;GDPR&quot;],&quot;lang_blurb1&quot;:[0,&quot;This post is also available in {lang1}.&quot;],&quot;lang_blurb2&quot;:[0,&quot;This post is also available in {lang1} and {lang2}.&quot;],&quot;lang_blurb3&quot;:[0,&quot;This post is also available in {lang1}, {lang2} and {lang3}.&quot;],&quot;footer.press&quot;:[0,&quot;Press&quot;],&quot;header.title&quot;:[0,&quot;The Cloudflare Blog&quot;],&quot;search.clear&quot;:[0,&quot;Clear&quot;],&quot;search.filter&quot;:[0,&quot;Filter&quot;],&quot;search.source&quot;:[0,&quot;Source&quot;],&quot;footer.careers&quot;:[0,&quot;Careers&quot;],&quot;footer.company&quot;:[0,&quot;Company&quot;],&quot;footer.support&quot;:[0,&quot;Support&quot;],&quot;footer.the_net&quot;:[0,&quot;theNet&quot;],&quot;search.filters&quot;:[0,&quot;Filters&quot;],&quot;footer.our_team&quot;:[0,&quot;Our team&quot;],&quot;footer.webinars&quot;:[0,&quot;Webinars&quot;],&quot;page.more_posts&quot;:[0,&quot;More posts&quot;],&quot;posts.time_read&quot;:[0,&quot;{time} min read&quot;],&quot;search.language&quot;:[0,&quot;Language&quot;],&quot;footer.community&quot;:[0,&quot;Community&quot;],&quot;footer.resources&quot;:[0,&quot;Resources&quot;],&quot;footer.solutions&quot;:[0,&quot;Solutions&quot;],&quot;footer.trademark&quot;:[0,&quot;Trademark&quot;],&quot;header.subscribe&quot;:[0,&quot;Subscribe&quot;],&quot;footer.compliance&quot;:[0,&quot;Compliance&quot;],&quot;footer.free_plans&quot;:[0,&quot;Free plans&quot;],&quot;footer.impact_ESG&quot;:[0,&quot;Impact/ESG&quot;],&quot;posts.follow_on_X&quot;:[0,&quot;Follow on X&quot;],&quot;footer.help_center&quot;:[0,&quot;Help center&quot;],&quot;footer.network_map&quot;:[0,&quot;Network Map&quot;],&quot;header.please_wait&quot;:[0,&quot;Please Wait&quot;],&quot;page.related_posts&quot;:[0,&quot;Related posts&quot;],&quot;search.result_stat&quot;:[0,&quot;Results &lt;strong&gt;{search_range}&lt;/strong&gt; of &lt;strong&gt;{search_total}&lt;/strong&gt; for &lt;strong&gt;{search_keyword}&lt;/strong&gt;&quot;],&quot;footer.case_studies&quot;:[0,&quot;Case Studies&quot;],&quot;footer.connect_2024&quot;:[0,&quot;Connect 2024&quot;],&quot;footer.terms_of_use&quot;:[0,&quot;Terms of Use&quot;],&quot;footer.white_papers&quot;:[0,&quot;White Papers&quot;],&quot;footer.cloudflare_tv&quot;:[0,&quot;Cloudflare TV&quot;],&quot;footer.community_hub&quot;:[0,&quot;Community Hub&quot;],&quot;footer.compare_plans&quot;:[0,&quot;Compare plans&quot;],&quot;footer.contact_sales&quot;:[0,&quot;Contact Sales&quot;],&quot;header.contact_sales&quot;:[0,&quot;Contact Sales&quot;],&quot;header.email_address&quot;:[0,&quot;Email Address&quot;],&quot;page.error.not_found&quot;:[0,&quot;Page not found&quot;],&quot;footer.developer_docs&quot;:[0,&quot;Developer docs&quot;],&quot;footer.privacy_policy&quot;:[0,&quot;Privacy Policy&quot;],&quot;footer.request_a_demo&quot;:[0,&quot;Request a demo&quot;],&quot;page.continue_reading&quot;:[0,&quot;Continue reading&quot;],&quot;footer.analysts_report&quot;:[0,&quot;Analyst reports&quot;],&quot;footer.for_enterprises&quot;:[0,&quot;For enterprises&quot;],&quot;footer.getting_started&quot;:[0,&quot;Getting Started&quot;],&quot;footer.learning_center&quot;:[0,&quot;Learning Center&quot;],&quot;footer.project_galileo&quot;:[0,&quot;Project Galileo&quot;],&quot;pagination.newer_posts&quot;:[0,&quot;Newer Posts&quot;],&quot;pagination.older_posts&quot;:[0,&quot;Older Posts&quot;],&quot;posts.social_buttons.x&quot;:[0,&quot;Discuss on X&quot;],&quot;search.icon_aria_label&quot;:[0,&quot;Search&quot;],&quot;search.source_location&quot;:[0,&quot;Source/Location&quot;],&quot;footer.about_cloudflare&quot;:[0,&quot;About Cloudflare&quot;],&quot;footer.athenian_project&quot;:[0,&quot;Athenian Project&quot;],&quot;footer.become_a_partner&quot;:[0,&quot;Become a partner&quot;],&quot;footer.cloudflare_radar&quot;:[0,&quot;Cloudflare Radar&quot;],&quot;footer.network_services&quot;:[0,&quot;Network services&quot;],&quot;footer.trust_and_safety&quot;:[0,&quot;Trust &amp; Safety&quot;],&quot;header.get_started_free&quot;:[0,&quot;Get Started Free&quot;],&quot;page.search.placeholder&quot;:[0,&quot;Search Cloudflare&quot;],&quot;footer.cloudflare_status&quot;:[0,&quot;Cloudflare Status&quot;],&quot;footer.cookie_preference&quot;:[0,&quot;Cookie Preferences&quot;],&quot;header.valid_email_error&quot;:[0,&quot;Must be valid email.&quot;],&quot;search.result_stat_empty&quot;:[0,&quot;Results &lt;strong&gt;{search_range}&lt;/strong&gt; of &lt;strong&gt;{search_total}&lt;/strong&gt;&quot;],&quot;footer.connectivity_cloud&quot;:[0,&quot;Connectivity cloud&quot;],&quot;footer.developer_services&quot;:[0,&quot;Developer services&quot;],&quot;footer.investor_relations&quot;:[0,&quot;Investor relations&quot;],&quot;page.not_found.error_code&quot;:[0,&quot;Error Code: 404&quot;],&quot;search.autocomplete_title&quot;:[0,&quot;Insert a query. Press enter to send&quot;],&quot;footer.logos_and_press_kit&quot;:[0,&quot;Logos &amp; press kit&quot;],&quot;footer.application_services&quot;:[0,&quot;Application services&quot;],&quot;footer.get_a_recommendation&quot;:[0,&quot;Get a recommendation&quot;],&quot;posts.social_buttons.reddit&quot;:[0,&quot;Discuss on Reddit&quot;],&quot;footer.sse_and_sase_services&quot;:[0,&quot;SSE and SASE services&quot;],&quot;page.not_found.outdated_link&quot;:[0,&quot;You may have used an outdated link, or you may have typed the address incorrectly.&quot;],&quot;footer.report_security_issues&quot;:[0,&quot;Report Security Issues&quot;],&quot;page.error.error_message_page&quot;:[0,&quot;Sorry, we can&#39;t find the page you are looking for.&quot;],&quot;header.subscribe_notifications&quot;:[0,&quot;Subscribe to receive notifications of new posts:&quot;],&quot;footer.cloudflare_for_campaigns&quot;:[0,&quot;Cloudflare for Campaigns&quot;],&quot;header.subscription_confimation&quot;:[0,&quot;Subscription confirmed. Thank you for subscribing!&quot;],&quot;posts.social_buttons.hackernews&quot;:[0,&quot;Discuss on Hacker News&quot;],&quot;footer.diversity_equity_inclusion&quot;:[0,&quot;Diversity, equity &amp; inclusion&quot;],&quot;footer.critical_infrastructure_defense_project&quot;:[0,&quot;Critical Infrastructure Defense Project&quot;]}]}" ssr client="load" opts="{&quot;name&quot;:&quot;PostCard&quot;,&quot;value&quot;:true}" await-children><article class="w-50-l  mt4 mt2-l mb4 ph3 bb b--gray8 bn-l"><div class="w-100"><a href="/major-data-center-power-failure-again-cloudflare-code-orange-tested/" class="fw5 no-underline gray1" data-testid="post-title"><h2 class="fw5 mt2">Major data center power failure (again): Cloudflare Code Orange tested</h2></a><p class="f3 fw5 gray5 my" data-testid="post-date">2024-04-08</p><div class=""><a href="/tag/post-mortem/" class="dib pl2 pr2 pt1 pb1 mb2 bg-gray8 no-underline blue3 f2 mr1" data-testid="post-tag">Post Mortem</a><a href="/tag/outage/" class="dib pl2 pr2 pt1 pb1 mb2 bg-gray8 no-underline blue3 f2 mr1" data-testid="post-tag">Outage</a></div><p class="f3 fw4 gray1 lh-copy " data-testid="post-content">Just four months after a complete power outage at a critical data center we were hit with the exact same scenario.  Here’s how we did this time, and what’s next<!-- -->...</p><ul class="author-lists flex pl0"><li class="list flex items-center pr2 mb3"><a href="/author/matthew-prince/" class="static-avatar pr1"><img class="author-profile-image br-100 mr2" src="https://blog.cloudflare.com/cdn-cgi/image/format=auto,dpr=3,width=64,height=64,gravity=face,fit=crop,zoom=0.5/https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1VD9WePJ1jvjFwuSRF0IfQ/5e4f7d5fd4825358b33b2ead623140d8/matthew-prince.jpeg" alt="Matthew Prince" width="62" height="62"/></a><div class="author-name-tooltip"><a href="/author/matthew-prince/" class="fw4 f3 no-underline black">Matthew Prince</a></div></li><li class="list flex items-center pr2 mb3"><a href="/author/john-graham-cumming/" class="static-avatar pr1"><img class="author-profile-image br-100 mr2" src="https://blog.cloudflare.com/cdn-cgi/image/format=auto,dpr=3,width=64,height=64,gravity=face,fit=crop,zoom=0.5/https://cf-assets.www.cloudflare.com/zkvhlag99gkb/5vGNsXzZrtSLn2X30pnpUY/6f350e7dd36058a6422f9199b452bb02/john-graham-cumming.jpg" alt="John Graham-Cumming" width="62" height="62"/></a><div class="author-name-tooltip"><a href="/author/john-graham-cumming/" class="fw4 f3 no-underline black">John Graham-Cumming</a></div></li><li class="list flex items-center pr2 mb3"><a href="/author/jeremy-hartman/" class="static-avatar pr1"><img class="author-profile-image br-100 mr2" src="https://blog.cloudflare.com/cdn-cgi/image/format=auto,dpr=3,width=64,height=64,gravity=face,fit=crop,zoom=0.5/https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1yTvNpd60qmjgY8fbItcDp/f964f6cd281c1693cee7b4a43a6e3845/jeremy-hartman.jpeg" alt="Jeremy Hartman" width="62" height="62"/></a><div class="author-name-tooltip"><a href="/author/jeremy-hartman/" class="fw4 f3 no-underline black">Jeremy Hartman</a></div></li></ul></div></article><!--astro:end--></astro-island> <astro-island uid="ZsTRPi" prefix="r5" component-url="/_astro/MorePosts.DyRVOquy.js" component-export="default" renderer-url="/_astro/client.DLO1yDVm.js" props="{&quot;locale&quot;:[0,&quot;en-us&quot;],&quot;posts&quot;:[1,[[0,{&quot;id&quot;:[0,&quot;73EdtHPXJkJx7fwtNqtJ2a&quot;],&quot;title&quot;:[0,&quot;Post mortem on the Cloudflare Control Plane and Analytics Outage&quot;],&quot;slug&quot;:[0,&quot;post-mortem-on-cloudflare-control-plane-and-analytics-outage&quot;],&quot;excerpt&quot;:[0,&quot;Beginning on Thursday, November 2, 2023, at 11:43 UTC Cloudflare&#39;s control plane and analytics services experienced an outage. Here are the details&quot;],&quot;featured&quot;:[0,false],&quot;html&quot;:[0,&quot;&lt;p&gt;&lt;/p&gt;&lt;p&gt;Beginning on Thursday, November 2, 2023, at 11:43 UTC Cloudflare&amp;#39;s control plane and analytics services experienced an outage. The control plane of Cloudflare consists primarily of the customer-facing interface for all of our services including our website and APIs. Our analytics services include logging and analytics reporting.&lt;/p&gt;&lt;p&gt;The incident lasted from November 2 at 11:44 UTC until November 4 at 04:25 UTC. We were able to restore most of our control plane at our disaster recovery facility as of November 2 at 17:57 UTC. Many customers would not have experienced issues with most of our products after the disaster recovery facility came online. However, other services took longer to restore and customers that used them may have seen issues until we fully resolved the incident. Our raw log services were unavailable for most customers for the duration of the incident.&lt;/p&gt;&lt;p&gt;Services have now been restored for all customers. Throughout the incident, Cloudflare&amp;#39;s network and security services continued to work as expected. While there were periods where customers were unable to make changes to those services, traffic through our network was not impacted.&lt;/p&gt;&lt;p&gt;This post outlines the events that caused this incident, the architecture we had in place to prevent issues like this, what failed, what worked and why, and the changes we&amp;#39;re making based on what we&amp;#39;ve learned over the last 36 hours.&lt;/p&gt;&lt;p&gt;To start, this never should have happened. We believed that we had high availability systems in place that should have stopped an outage like this, even when one of our core data center providers failed catastrophically. And, while many systems did remain online as designed, some critical systems had non-obvious dependencies that made them unavailable. I am sorry and embarrassed for this incident and the pain that it caused our customers and our team.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;intended-design\&quot;&gt;Intended Design&lt;/h3&gt;\n            &lt;a href=\&quot;#intended-design\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Cloudflare&amp;#39;s control plane and analytics systems run primarily on servers in three data centers around Hillsboro, Oregon. The three data centers are independent of one another, each have multiple utility power feeds, and each have multiple redundant and independent network connections.&lt;/p&gt;&lt;p&gt;The facilities were intentionally chosen to be at a distance apart that would minimize the chances that a natural disaster would cause all three to be impacted, while still close enough that they could all run active-active redundant data clusters. This means that they are continuously syncing data between the three facilities. By design, if any of the facilities goes offline then the remaining ones are able to continue to operate.&lt;/p&gt;&lt;p&gt;This is a system design that we began implementing four years ago. While most of our critical control plane systems had been migrated to the high availability cluster, some services, especially for some newer products, had not yet been added to the high availability cluster.&lt;/p&gt;&lt;p&gt;In addition, our logging systems were intentionally not part of the high availability cluster. The logic of that decision was that logging was already a distributed problem where logs were queued at the edge of our network and then sent back to the core in Oregon (or another regional facility for customers using regional services for logging). If our logging facility was offline then analytics logs would queue at the edge of our network until it came back online. We determined that analytics being delayed was acceptable.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;flexential-data-center-power-failure\&quot;&gt;Flexential Data Center Power Failure&lt;/h3&gt;\n            &lt;a href=\&quot;#flexential-data-center-power-failure\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;The largest of the three facilities in Oregon is run by Flexential. We refer to this facility as “PDX-DC04”. Cloudflare leases space in PDX-04 where we house our largest analytics cluster as well as more than a third of the machines for our high availability cluster. It is also the default location for services that have not yet been onboarded onto our high availability cluster. We are a relatively large customer of the facility, consuming approximately 10 percent of its total capacity.&lt;/p&gt;&lt;p&gt;On November 2 at 08:50 UTC Portland General Electric (PGE), the utility company that services PDX-04, had an unplanned maintenance event affecting one of their independent power feeds into the building. That event shut down one feed into PDX-04. The data center has multiple feeds with some level of independence that can power the facility. However, Flexential powered up their generators to effectively supplement the feed that was down.&lt;/p&gt;&lt;p&gt;Counter to best practices, Flexential did not inform Cloudflare that they had failed over to generator power. None of our observability tools were able to detect that the source of power had changed. Had they informed us, we would have stood up a team to monitor the facility closely and move control plane services that were dependent on that facility out while it was degraded.&lt;/p&gt;&lt;p&gt;It is also unusual that Flexential ran both the one remaining utility feed and the generators at the same time. It is not unusual for utilities to ask data centers to drop off the grid when power demands are high and run exclusively on generators. Flexential operates 10 generators, inclusive of redundant units, capable of supporting the facility at full load. It would also have been possible for Flexential to run the facility only from the remaining utility feed. We haven&amp;#39;t gotten a clear answer why they ran utility power and generator power.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;informed-speculation-on-what-happened-next\&quot;&gt;Informed Speculation On What Happened Next&lt;/h3&gt;\n            &lt;a href=\&quot;#informed-speculation-on-what-happened-next\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;From this decision onward, we don&amp;#39;t yet have clarity from Flexential on the root cause or some of the decisions they made or the events. We will update this post as we get more information from Flexential, as well as PGE, on what happened. Some of what follows is informed speculation based on the most likely series of events as well as what individual Flexential employees have shared with us unofficially.&lt;/p&gt;&lt;p&gt;One possible reason they may have left the utility line running is because Flexential was part of a program with PGE called DSG. DSG allows the local utility to run a data center&amp;#39;s generators to help supply additional power to the grid. In exchange, the power company helps maintain the generators and supplies fuel. We have been unable to locate any record of Flexential informing us about the DSG program. We&amp;#39;ve asked if DSG was active at the time and have not received an answer. We do not know if it contributed to the decisions that Flexential made, but it could explain why the utility line continued to remain online after the generators were started.&lt;/p&gt;&lt;p&gt;At approximately 11:40 UTC, there was a ground fault on a PGE transformer at PDX-04. We believe, but have not been able to get confirmation from Flexential or PGE, that this was the transformer that stepped down power from the grid for the second feed that was still running as it entered the data center. It seems likely, though we have not been able to confirm with Flexential or PGE, that the ground fault was caused by the unplanned maintenance PGE was performing that impacted the first feed. Or it was a very unlucky coincidence.&lt;/p&gt;&lt;p&gt;Ground faults with high voltage (12,470 volt) power lines are very bad. Electrical systems are designed to quickly shut down to prevent damage when one occurs. Unfortunately, in this case, the protective measure also shut down all of PDX-04’s generators. This meant that the two sources of power generation for the facility — both the redundant utility lines as well as the 10 generators — were offline.&lt;/p&gt;&lt;p&gt;Fortunately, in addition to the generators, PDX-04 also contains a bank of UPS batteries. These batteries are supposedly sufficient to power the facility for approximately 10 minutes. That time is meant to be enough to bridge the gap between the power going out and the generators automatically starting up. If Flexential could get the generators or a utility feed restored within 10 minutes then there would be no interruption. In reality, the batteries started to fail after only 4 minutes based on what we observed from our own equipment failing. And it took Flexential far longer than 10 minutes to get the generators restored.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;attempting-to-restore-power\&quot;&gt;Attempting to Restore Power&lt;/h3&gt;\n            &lt;a href=\&quot;#attempting-to-restore-power\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;While we haven&amp;#39;t gotten official confirmation, we have been told by employees that three things hampered getting the generators back online. First, they needed to be physically accessed and manually restarted because of the way the ground fault had tripped circuits. Second, Flexential&amp;#39;s access control system was not powered by the battery backups, so it was offline. And third, the overnight staffing at the site did not include an experienced operations or electrical expert — the overnight shift consisted of security and an unaccompanied technician who had only been on the job for a week.&lt;/p&gt;&lt;p&gt;Between 11:44 and 12:01 UTC, with the generators not fully restarted, the UPS batteries ran out of power and all customers of the data center lost power. Throughout this, Flexential never informed Cloudflare that there was any issue at the facility. We were first notified of issues in the data center when the two routers that connect the facility to the rest of the world went offline at 11:44 UTC. When we weren&amp;#39;t able to reach the routers directly or through out-of-band management, we attempted to contact Flexential and dispatched our local team to physically travel to the facility. The first message to us from Flexential that they were experiencing an issue was at 12:28 UTC.&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;&lt;i&gt;We are currently experiencing an issue with power at our [PDX-04] that began at approximately 0500AM PT [12:00 UTC]. Engineers are actively working to resolve the issue and restore service. We will communicate progress every 30 minutes or as more information becomes available as to the estimated time to restore. Thank you for your patience and understanding.&lt;/i&gt;&lt;/p&gt;&lt;/blockquote&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;designing-for-data-center-level-failure\&quot;&gt;Designing for Data Center Level Failure&lt;/h3&gt;\n            &lt;a href=\&quot;#designing-for-data-center-level-failure\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;While the PDX-04’s design was certified Tier III before construction and is expected to provide high availability SLAs, we planned for the possibility that it could go offline. Even well-run facilities can have bad days. And we planned for that. What we expected would happen in that case is that our analytics would be offline, logs would be queued at the edge and delayed, and certain lower priority services that were not integrated into our high availability cluster would go offline temporarily until they could be restored at another facility.&lt;/p&gt;&lt;p&gt;The other two data centers running in the area would take over responsibility for the high availability cluster and keep critical services online. Generally that worked as planned. Unfortunately, we discovered that a subset of services that were supposed to be on the high availability cluster had dependencies on services exclusively running in PDX-04.&lt;/p&gt;&lt;p&gt;In particular, two critical services that process logs and power our analytics — Kafka and ClickHouse — were only available in PDX-04 but had services that depended on them that were running in the high availability cluster. Those dependencies shouldn’t have been so tight, should have failed more gracefully, and we should have caught them.&lt;/p&gt;&lt;p&gt;We had performed testing of our high availability cluster by taking each (and both) of the other two data center facilities entirely offline. And we had also tested taking the high availability portion of PDX-04 offline. However, we had never tested fully taking the entire PDX-04 facility offline. As a result, we had missed the importance of some of these dependencies on our data plane.&lt;/p&gt;&lt;p&gt;We were also far too lax about requiring new products and their associated databases to integrate with the high availability cluster. Cloudflare allows multiple teams to innovate quickly. As such, products often take different paths toward their initial alpha. While, over time, our practice is to migrate the backend for these services to our best practices, we did not formally require that before products were declared generally available (GA). That was a mistake as it meant that the redundancy protections we had in place worked inconsistently depending on the product.&lt;/p&gt;&lt;p&gt;Moreover, far too many of our services depend on the availability of our core facilities. While this is the way a lot of software services are created, it does not play to Cloudflare’s strength. We are good at distributed systems. Throughout this incident, our global network continued to perform as expected. While some of our products and features are configurable and serviceable through the edge of our network without needing the core, far too many today fail if the core is unavailable. We need to use the distributed systems products that we make available to all our customers for all our services, so they continue to function mostly as normal even if our core facilities are disrupted.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;disaster-recovery\&quot;&gt;Disaster Recovery&lt;/h3&gt;\n            &lt;a href=\&quot;#disaster-recovery\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;At 12:48 UTC, Flexential was able to get the generators restarted. Power returned to portions of the facility. In order to not overwhelm the system, when power is restored to a data center it is typically done gradually by powering back on one circuit at a time. Like the circuit breakers in a residential home, each customer is serviced by redundant breakers. When Flexential attempted to power back up Cloudflare&amp;#39;s circuits, the circuit breakers were discovered to be faulty. We don&amp;#39;t know if the breakers failed due to the ground fault or some other surge as a result of the incident, or if they&amp;#39;d been bad before, and it was only discovered after they had been powered off.&lt;/p&gt;&lt;p&gt;Flexential began the process of replacing the failed breakers. That required them to source new breakers because more were bad than they had on hand in the facility. Because more services were offline than we expected, and because Flexential could not give us a time for restoration of our services, we made the call at 13:40 UTC to fail over to Cloudflare&amp;#39;s disaster recovery sites located in Europe. Thankfully, we only needed to fail over a small percentage of Cloudflare’s overall control plane. Most of our services continued to run across our high availability systems across the two active core data centers.&lt;/p&gt;&lt;p&gt;We turned up the first services on the disaster recovery site at 13:43 UTC. Cloudflare&amp;#39;s disaster recovery sites provide critical control plane services in the event of a disaster. While the disaster recovery site does not support some of our log processing services, it is designed to support the other portions of our control plane.&lt;/p&gt;&lt;p&gt;When services were turned up there, we experienced a thundering herd problem where the API calls that had been failing overwhelmed our services. We implemented rate limits to get the request volume under control. During this period, customers of most products would have seen intermittent errors when making modifications through our dashboard or API. By 17:57 UTC, the services that had been successfully moved to the disaster recovery site were stable and most customers were no longer directly impacted. However, some systems still required manual configuration (e.g., Magic WAN) and some other services, largely related to log processing and some bespoke APIs, remained unavailable until we were able to restore PDX-04.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;some-products-and-features-delayed-restart\&quot;&gt;Some Products and Features Delayed Restart&lt;/h3&gt;\n            &lt;a href=\&quot;#some-products-and-features-delayed-restart\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;A handful of products did not properly get stood up on our disaster recovery sites. These tended to be newer products where we had not fully implemented and tested a disaster recovery procedure. These included our Stream service for uploading new videos and some other services. Our team worked two simultaneous tracks to get these services restored: 1) reimplementing them on our disaster recovery sites; and 2) migrating them to our high-availability cluster.&lt;/p&gt;&lt;p&gt;Flexential replaced our failed circuit breakers, restored both utility feeds, and confirmed clean power at 22:48 UTC. Our team was all-hands-on-deck and had worked all day on the emergency, so I made the call that most of us should get some rest and start the move back to PDX-04 in the morning. That decision delayed our full recovery, but I believe made it less likely that we’d compound this situation with additional mistakes.&lt;/p&gt;&lt;p&gt;Beginning first thing on November 3, our team began restoring service in PDX-04. That began with physically booting our network gear then powering up thousands of servers and restoring their services. The state of our services in the data center was unknown as we believed multiple power cycles were likely to have occurred during the incident. Our only safe process to recover was to follow a complete bootstrap of the entire facility.&lt;/p&gt;&lt;p&gt;This involved a manual process of bringing our configuration management servers online to begin the restoration of the facility. Rebuilding these took 3 hours. From there, our team was able to bootstrap the rebuild of the rest of the servers that power our services. Each server took between 10 minutes and 2 hours to rebuild. While we were able to run this in parallel across multiple servers, there were inherent dependencies between services that required some to be brought back online in sequence.&lt;/p&gt;&lt;p&gt;Services are now fully restored as of November 4, 2023, at 04:25 UTC. For most customers, because we also store analytics in our European core data centers, you should see no data loss in most analytics across our dashboard and APIs. However, some datasets which are not replicated in the EU will have persistent gaps. For customers that use our log push feature, your logs will not have been processed for the majority of the event, so anything you did not receive will not be recovered.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;lessons-and-remediation\&quot;&gt;Lessons and Remediation&lt;/h3&gt;\n            &lt;a href=\&quot;#lessons-and-remediation\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;We have a number of questions that we need answered from Flexential. But we also must expect that entire data centers may fail. Google has a process where when there’s a significant event or crisis they can call a Code Yellow or Code Red. In these cases, most or all engineering resources are shifted to addressing the issue at hand.&lt;/p&gt;&lt;p&gt;We have not had such a process in the past, but it’s clear today we need to implement a version of it ourselves: Code Orange. We are shifting all non-critical engineering functions to focusing on ensuring high reliability of our control plane. As part of that, we expect the following changes:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;Remove dependencies on our core data centers for control plane configuration of all services and move them wherever possible to be powered first by our distributed network&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Ensure that the control plane running on the network continues to function even if all our core data centers are offline&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Require that all products and features that are designated Generally Available must rely on the high availability cluster (if they rely on any of our core data centers), without having any software dependencies on specific facilities&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Require all products and features that are designated Generally Available have a reliable disaster recovery plan that is tested&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Test the blast radius of system failures and minimize the number of services that are impacted by a failure&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Implement more rigorous chaos testing of all data center functions including the full removal of each of our core data center facilities&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Thorough auditing of all core data centers and a plan to reaudit to ensure they comply with our standards&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Logging and analytics disaster recovery plan that ensures no logs are dropped even in the case of a failure of all our core facilities&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;As I said earlier, I am sorry and embarrassed for this incident and the pain that it caused our customers and our team. We have the right systems and procedures in place to be able to withstand even the cascading string of failures we saw at our data center provider, but we need to be more rigorous about enforcing that they are followed and tested for unknown dependencies. This will have my full attention and the attention of a large portion of our team through the balance of the year. And the pain from the last couple of days will make us better.&lt;/p&gt;&quot;],&quot;published_at&quot;:[0,&quot;2023-11-04T06:18:55.000+00:00&quot;],&quot;updated_at&quot;:[0,&quot;2024-10-09T23:26:22.365Z&quot;],&quot;feature_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/2hQ5TSlADYT5qXRZtrOBc3/fb15e867d95ec9c4a34ae7e0762c9f8c/post-mortem-on-cloudflare-control-plane-and-analytics-outage.png&quot;],&quot;tags&quot;:[1,[[0,{&quot;id&quot;:[0,&quot;4yliZlpBPZpOwBDZzo1tTh&quot;],&quot;name&quot;:[0,&quot;Outage&quot;],&quot;slug&quot;:[0,&quot;outage&quot;]}],[0,{&quot;id&quot;:[0,&quot;3cCNoJJ5uusKFBLYKFX1jB&quot;],&quot;name&quot;:[0,&quot;Post Mortem&quot;],&quot;slug&quot;:[0,&quot;post-mortem&quot;]}]]],&quot;relatedTags&quot;:[0],&quot;authors&quot;:[1,[[0,{&quot;name&quot;:[0,&quot;Matthew Prince&quot;],&quot;slug&quot;:[0,&quot;matthew-prince&quot;],&quot;bio&quot;:[0,&quot;A little bit geek, wonk, and nerd. Repeat entrepreneur, recovering lawyer, and former ski instructor. Co-founder &amp; CEO of Cloudflare (NYSE: NET).&quot;],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1VD9WePJ1jvjFwuSRF0IfQ/5e4f7d5fd4825358b33b2ead623140d8/matthew-prince.jpeg&quot;],&quot;location&quot;:[0,&quot;San Francisco, CA&quot;],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,&quot;@eastdakota&quot;],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}]]],&quot;meta_description&quot;:[0,&quot;Beginning on Thursday, November 2, 2023 at 11:43 UTC Cloudflare&#39;s control plane and analytics services experienced an outage. Here are the details&quot;],&quot;primary_author&quot;:[0,{}],&quot;localeList&quot;:[0,{&quot;name&quot;:[0,&quot;Post mortem on the Cloudflare Control Plane and Analytics Outage Config&quot;],&quot;enUS&quot;:[0,&quot;English for Locale&quot;],&quot;zhCN&quot;:[0,&quot;Translated for Locale&quot;],&quot;zhHansCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhTW&quot;:[0,&quot;Translated for Locale&quot;],&quot;frFR&quot;:[0,&quot;Translated for Locale&quot;],&quot;deDE&quot;:[0,&quot;Translated for Locale&quot;],&quot;itIT&quot;:[0,&quot;No Page for Locale&quot;],&quot;jaJP&quot;:[0,&quot;Translated for Locale&quot;],&quot;koKR&quot;:[0,&quot;Translated for Locale&quot;],&quot;ptBR&quot;:[0,&quot;Translated for Locale&quot;],&quot;esLA&quot;:[0,&quot;No Page for Locale&quot;],&quot;esES&quot;:[0,&quot;Translated for Locale&quot;],&quot;enAU&quot;:[0,&quot;No Page for Locale&quot;],&quot;enCA&quot;:[0,&quot;No Page for Locale&quot;],&quot;enIN&quot;:[0,&quot;No Page for Locale&quot;],&quot;enGB&quot;:[0,&quot;No Page for Locale&quot;],&quot;idID&quot;:[0,&quot;No Page for Locale&quot;],&quot;ruRU&quot;:[0,&quot;No Page for Locale&quot;],&quot;svSE&quot;:[0,&quot;No Page for Locale&quot;],&quot;viVN&quot;:[0,&quot;No Page for Locale&quot;],&quot;plPL&quot;:[0,&quot;No Page for Locale&quot;],&quot;arAR&quot;:[0,&quot;No Page for Locale&quot;],&quot;nlNL&quot;:[0,&quot;No Page for Locale&quot;],&quot;thTH&quot;:[0,&quot;No Page for Locale&quot;],&quot;trTR&quot;:[0,&quot;No Page for Locale&quot;],&quot;heIL&quot;:[0,&quot;No Page for Locale&quot;],&quot;lvLV&quot;:[0,&quot;No Page for Locale&quot;],&quot;etEE&quot;:[0,&quot;No Page for Locale&quot;],&quot;ltLT&quot;:[0,&quot;No Page for Locale&quot;]}],&quot;url&quot;:[0,&quot;https://blog.cloudflare.com/post-mortem-on-cloudflare-control-plane-and-analytics-outage&quot;],&quot;metadata&quot;:[0,{&quot;title&quot;:[0,&quot;Post mortem on the Cloudflare Control Plane and Analytics Outage&quot;],&quot;description&quot;:[0,&quot;Beginning on Thursday, November 2, 2023 at 11:43 UTC Cloudflare&#39;s control plane and analytics services experienced an outage. Here are the details&quot;],&quot;imgPreview&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/FAzC6R46Fzv1aVB2GRmIB/417cc04cd38ffd46c42eee87da7963c4/post-mortem-on-cloudflare-control-plane-and-analytics-outage-YYVgR5.png&quot;]}],&quot;publicly_index&quot;:[0,true]}],[0,{&quot;id&quot;:[0,&quot;2RLr0QNONtOjY9xl3wKG1G&quot;],&quot;title&quot;:[0,&quot;Cloudflare incident on October 30, 2023&quot;],&quot;slug&quot;:[0,&quot;cloudflare-incident-on-october-30-2023&quot;],&quot;excerpt&quot;:[0,&quot;Multiple Cloudflare services were unavailable for 37 minutes on October 30, 2023, due to the misconfiguration of a deployment tool used by Workers KV.&quot;],&quot;featured&quot;:[0,false],&quot;html&quot;:[0,&quot;&lt;p&gt;&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1fuf2Zu6hQEVim57ZP2cze/0c4311c85148c448749069bf6cb900a4/Vulnerabilitiy-1.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;2401\&quot; height=\&quot;1350\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;Multiple Cloudflare services were unavailable for 37 minutes on October 30, 2023. This was due to the misconfiguration of a deployment tool used by Workers KV. This was a frustrating incident, made more difficult by Cloudflare’s reliance on our own suite of products. We are deeply sorry for the impact it had on customers. What follows is a discussion of what went wrong, how the incident was resolved, and the work we are undertaking to ensure it does not happen again.&lt;/p&gt;&lt;p&gt;Workers KV is our globally distributed key-value store. It is used by both customers and Cloudflare teams alike to manage configuration data, routing lookups, static asset bundles, authentication tokens, and other data that needs low-latency access.&lt;/p&gt;&lt;p&gt;During this incident, KV returned what it believed was a valid HTTP 401 (Unauthorized) status code instead of the requested key-value pair(s) due to a bug in a new deployment tool used by KV.&lt;/p&gt;&lt;p&gt;These errors manifested differently for each product depending on how KV is used by each service, with their impact detailed below.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;what-was-impacted\&quot;&gt;What was impacted&lt;/h3&gt;\n            &lt;a href=\&quot;#what-was-impacted\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;A number of Cloudflare services depend on Workers KV for distributing configuration, routing information, static asset serving, and authentication state globally. These services instead received an HTTP 401 (Unauthorized) error when performing any get, put, delete, or list operation against a KV namespace.&lt;/p&gt;&lt;p&gt;Customers using the following Cloudflare products would have observed heightened error rates and/or would have been unable to access some or all features for the duration of the incident:&lt;/p&gt;&lt;!--kg-card-begin: html--&gt;&lt;style type=\&quot;text/css\&quot;&gt;\n.tg  {border-collapse:collapse;border-color:#ccc;border-spacing:0;}\n.tg td{background-color:#fff;border-color:#ccc;border-style:solid;border-width:1px;color:#333;\n  font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;word-break:normal;}\n.tg th{background-color:#f0f0f0;border-color:#ccc;border-style:solid;border-width:1px;color:#333;\n  font-family:Arial, sans-serif;font-size:14px;font-weight:normal;overflow:hidden;padding:10px 5px;word-break:normal;}\n.tg .tg-7s56{background-color:#F4F5F7;text-align:left;vertical-align:top}\n.tg .tg-0lax{text-align:left;vertical-align:top}\n&lt;/style&gt;\n&lt;table class=\&quot;tg\&quot; width=\&quot;100%\&quot;&gt;\n&lt;thead&gt;\n  &lt;tr&gt;\n    &lt;th class=\&quot;tg-7s56\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Product&lt;/span&gt;&lt;/th&gt;\n    &lt;th class=\&quot;tg-7s56\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Impact&lt;/span&gt;&lt;/th&gt;\n  &lt;/tr&gt;\n&lt;/thead&gt;\n&lt;tbody&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Workers KV&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Customers with applications leveraging KV saw those applications fail during the duration of this incident, including both the KV API within Workers, and the REST API.&lt;/span&gt;&lt;br&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Workers applications not using KV were not impacted.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Pages&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Applications hosted on Pages were unreachable for the duration of the incident and returned HTTP 500 errors to users. New Pages deployments also returned HTTP 500 errors to users for the duration.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Access&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Users who were unauthenticated could not log in; any origin attempting to validate the JWT using the /certs endpoint would fail; any application with a device posture policy failed for all users.&lt;/span&gt;&lt;br&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Existing logged-in sessions that did not use the /certs endpoint or posture checks were unaffected. Overall, a large percentage of existing sessions were still affected.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;WARP / Zero Trust&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Users were unable to register new devices or connect to resources subject to policies that enforce Device Posture checks or WARP Session timeouts.&lt;/span&gt;&lt;br&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Devices already enrolled, resources not relying on device posture, or that had re-authorized outside of this window were unaffected.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Images&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;The Images API returned errors during the incident. Existing image delivery was not impacted.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Cache Purge (single file)&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Single file purge was partially unavailable for the duration of the incident as some data centers could not access configuration data in KV. Data centers that had existing configuration data locally cached were unaffected.&lt;/span&gt;&lt;br&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Other cache purge mechanisms, including purge by tag, were unaffected.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Workers&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Uploading or editing Workers through the dashboard, wrangler or API returned errors during the incident. Deployed Workers were not impacted, unless they used KV. &lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;AI Gateway&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;AI Gateway was not able to proxy requests for the duration of the incident.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Waiting Room&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Waiting Room configuration is stored at the edge in Workers KV. Waiting Room configurations, and configuration changes, were unavailable and the service failed open.&lt;/span&gt;&lt;br&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;When access to KV was restored, some Waiting Room users would have experienced queuing as the service came back up. &lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Turnstile and Challenge Pages&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Turnstile&#39;s JavaScript assets are stored in KV, and the entry point for Turnstile (api.js) was not able to be served. Clients accessing pages using Turnstile could not initialize the Turnstile widget and would have failed closed during the incident window.&lt;/span&gt;&lt;br&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Challenge Pages (which products like Custom, Managed and Rate Limiting rules use) also use Turnstile infrastructure for presenting challenge pages to users under specific conditions, and would have blocked users who were presented with a challenge during that period.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Cloudflare Dashboard&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Parts of the Cloudflare dashboard that rely on Turnstile and/or our internal feature flag tooling (which uses KV for configuration) returned errors to users for the duration. &lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n&lt;/tbody&gt;\n&lt;/table&gt;&lt;!--kg-card-end: html--&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;timeline\&quot;&gt;Timeline&lt;/h3&gt;\n            &lt;a href=\&quot;#timeline\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;&lt;i&gt;All timestamps referenced are in Coordinated Universal Time (UTC).&lt;/i&gt;&lt;/p&gt;&lt;!--kg-card-begin: html--&gt;&lt;style type=\&quot;text/css\&quot;&gt;\n.tg  {border-collapse:collapse;border-color:#ccc;border-spacing:0;}\n.tg td{background-color:#fff;border-color:#ccc;border-style:solid;border-width:1px;color:#333;\n  font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;word-break:normal;}\n.tg th{background-color:#f0f0f0;border-color:#ccc;border-style:solid;border-width:1px;color:#333;\n  font-family:Arial, sans-serif;font-size:14px;font-weight:normal;overflow:hidden;padding:10px 5px;word-break:normal;}\n.tg .tg-ppch{background-color:#F4F5F7;color:#000000;font-weight:bold;text-align:left;vertical-align:top}\n.tg .tg-096r{color:#000000;text-align:left;vertical-align:top}\n&lt;/style&gt;\n&lt;table class=\&quot;tg\&quot; width=\&quot;100%\&quot;&gt;\n&lt;thead&gt;\n  &lt;tr&gt;\n    &lt;th class=\&quot;tg-ppch\&quot;&gt;&lt;span style=\&quot;font-weight:700;font-style:normal;text-decoration:none;background-color:transparent\&quot;&gt;Time&lt;/span&gt;&lt;/th&gt;\n    &lt;th class=\&quot;tg-ppch\&quot;&gt;&lt;span style=\&quot;font-weight:700;font-style:normal;text-decoration:none;background-color:transparent\&quot;&gt;Description&lt;/span&gt;&lt;/th&gt;\n  &lt;/tr&gt;\n&lt;/thead&gt;\n&lt;tbody&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-096r\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;background-color:transparent\&quot;&gt;2023-10-30 18:58 UTC&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-096r\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;background-color:transparent\&quot;&gt;The Workers KV team began a progressive deployment of a new KV build to production.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-096r\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;background-color:transparent\&quot;&gt;2023-10-30 19:29 UTC&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-096r\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;background-color:transparent\&quot;&gt;The internal progressive deployment API returns staging build GUID to a call to list production builds. &lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-096r\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;background-color:transparent\&quot;&gt;2023-10-30 19:40 UTC&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-096r\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;background-color:transparent\&quot;&gt;The progressive deployment API was used to continue rolling out the release. This routed a percentage of traffic to the wrong destination, triggering alerting and leading to the decision to roll back.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-096r\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;background-color:transparent\&quot;&gt;2023-10-30 19:54 UTC&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-096r\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;background-color:transparent\&quot;&gt;Rollback via progressive deployment API attempted, traffic starts to fail at scale. &lt;/span&gt;&lt;span style=\&quot;font-weight:700;font-style:normal;text-decoration:none;background-color:transparent\&quot;&gt;— IMPACT START —&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-096r\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;background-color:transparent\&quot;&gt;2023-10-30 20:15 UTC&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-096r\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;background-color:transparent\&quot;&gt;Cloudflare engineers manually edit (via break glass mechanisms) deployment routes to revert to last known good build for the majority of traffic.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-096r\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;background-color:transparent\&quot;&gt;2023-10-30 20:29 UTC&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-096r\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;background-color:transparent\&quot;&gt;Workers KV error rates return to normal pre-incident levels, and impacted services recover within the following minute.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-096r\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;background-color:transparent\&quot;&gt;2023-10-30 20:31 UTC&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-096r\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;background-color:transparent\&quot;&gt;Impact resolved &lt;/span&gt;&lt;span style=\&quot;font-weight:700;font-style:normal;text-decoration:none;background-color:transparent\&quot;&gt;— IMPACT END — &lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n&lt;/tbody&gt;\n&lt;/table&gt;&lt;!--kg-card-end: html--&gt;&lt;p&gt;As shown in the above timeline, there was a delay between the time we realized we were having an issue at 19:54 UTC and the time we were actually able to perform the rollback at 20:15 UTC.&lt;/p&gt;&lt;p&gt;This was caused by the fact that multiple tools within Cloudflare rely on Workers KV including Cloudflare Access. Access leverages Workers KV as part of its request verification process. Due to this, we were unable to leverage our internal tooling and had to use break-glass mechanisms to bypass the normal tooling. As described below, we had not spent sufficient time testing the rollback mechanisms. We plan to harden this moving forward.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;resolution\&quot;&gt;Resolution&lt;/h3&gt;\n            &lt;a href=\&quot;#resolution\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Cloudflare engineers manually switched (via break glass mechanism) the production route to the previous working version of Workers KV, which immediately eliminated the failing request path and subsequently resolved the issue with the Workers KV deployment.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;analysis\&quot;&gt;Analysis&lt;/h3&gt;\n            &lt;a href=\&quot;#analysis\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Workers KV is a low-latency key-value store that allows users to store persistent data on Cloudflare&amp;#39;s network, as close to the users as possible. This distributed key-value store is used in many applications, some of which are first-party Cloudflare products like Pages, Access, and Zero Trust.&lt;/p&gt;&lt;p&gt;The Workers KV team was progressively deploying a new release using a specialized deployment tool. The deployment mechanism contains a staging and a production environment, and utilizes a process where the production environment is upgraded to the new version at progressive percentages until all production environments are upgraded to the most recent production build. The deployment tool had a latent bug with how it returns releases and their respective versions. Instead of returning releases from a single environment, the tool returned a broader list of releases than intended, resulting in production and staging releases being returned together.&lt;/p&gt;&lt;p&gt;In this incident, the service was deployed and tested in staging. But because of the deployment automation bug, when promoting to production, a script that had been deployed to the staging account was incorrectly referenced instead of the pre-production version on the production account. As a result, the deployment mechanism pointed the production environment to a version that was not running anywhere in the production environment, effectively black-holing traffic.&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1YKI1LYglUMvikcDlkZF41/ff8ba4a17059a4139884ee71524a8209/image1.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1749\&quot; height=\&quot;894\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;When this happened, Workers KV became unreachable in production, as calls to the product were directed to a version that was not authorized for production access, returning a HTTP 401 error code. This caused dependent products which stored key-value pairs in KV to fail, regardless of whether the key-value pair was cached locally or not.&lt;/p&gt;&lt;p&gt;Although automated alerting detected the issue immediately, there was a delay between the time we realized we were having an issue and the time we were actually able to perform the roll back. This was caused by the fact that multiple tools within Cloudflare rely on Workers KV including Cloudflare Access. Access uses Workers KV as part of the verification process for user JWTs (JSON Web Tokens).&lt;/p&gt;&lt;p&gt;These tools include the dashboard which was used to revert the change, and the authentication mechanism to access our continuous integration (CI) system. As Workers KV was down, so too were these services. Automatic rollbacks via our CI system had been successfully tested previously, but the authentication issues (Access relies on KV) due to the incident made accessing the necessary secrets to roll back the deploy impossible.&lt;/p&gt;&lt;p&gt;The fix ultimately was a manual change of the production build path to a previous and known good state. This path was known to have been deployed and was the previous production build before the attempted deployment.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;next-steps\&quot;&gt;Next steps&lt;/h3&gt;\n            &lt;a href=\&quot;#next-steps\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;As more teams at Cloudflare have built on Workers, we have &amp;quot;organically&amp;quot; ended up in a place where Workers KV now underpins a tremendous amount of our products and services. This incident has continued to reinforce the need for us to revisit how we can reduce the blast radius of critical dependencies, which includes improving the sophistication of our deployment tooling, its ease-of-use for our internal teams, and product-level controls for these dependencies. We’re prioritizing these efforts to ensure that there is not a repeat of this incident.&lt;/p&gt;&lt;p&gt;This also reinforces the need for Cloudflare to improve the tooling, and the safety of said tooling, around progressive deployments of Workers applications internally and for customers.&lt;/p&gt;&lt;p&gt;This includes (but is not limited) to the below list of key follow-up actions (in no specific order) this quarter:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;&lt;p&gt;Onboard KV deployments to standardized Workers deployment models which use automated systems for impact detection and recovery.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Ensure that the rollback process has access to a known good deployment identifier and that it works when Cloudflare Access is down.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Add pre-checks to deployments which will validate input parameters to ensure version mismatches don&amp;#39;t propagate to production environments.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Harden the progressive deployment tooling to operate in a way that is designed for multi-tenancy. The current design assumes a single-tenant model.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Add additional validation to progressive deployment scripts to verify that the deployment matches the app environment (production, staging, etc.).&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;Again, we’re extremely sorry this incident occurred, and take the impact of this incident on our customers extremely seriously.&lt;/p&gt;&quot;],&quot;published_at&quot;:[0,&quot;2023-11-01T16:39:43.000+00:00&quot;],&quot;updated_at&quot;:[0,&quot;2024-10-09T23:26:21.288Z&quot;],&quot;feature_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/aGFjt2xnNYMcO5Khj5no1/5c2e5b66f9a636343d6fc96cefaa766c/cloudflare-incident-on-october-30-2023.png&quot;],&quot;tags&quot;:[1,[[0,{&quot;id&quot;:[0,&quot;3cCNoJJ5uusKFBLYKFX1jB&quot;],&quot;name&quot;:[0,&quot;Post Mortem&quot;],&quot;slug&quot;:[0,&quot;post-mortem&quot;]}]]],&quot;relatedTags&quot;:[0],&quot;authors&quot;:[1,[[0,{&quot;name&quot;:[0,&quot;Matt Silverlock&quot;],&quot;slug&quot;:[0,&quot;silverlock&quot;],&quot;bio&quot;:[0,&quot;Director of Product at Cloudflare.&quot;],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/7xP5qePZD9eyVtwIesXYxh/e714aaa573161ec9eb48d59bd1aa6225/silverlock.jpeg&quot;],&quot;location&quot;:[0,null],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,&quot;@elithrar&quot;],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}],[0,{&quot;name&quot;:[0,&quot;Kris Evans&quot;],&quot;slug&quot;:[0,&quot;kris-evans&quot;],&quot;bio&quot;:[0,null],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/3lTRF3Io9Z4ejB4DM4XasI/13029949cc9a56fdcb152b48bfdb4617/kris-evans.jpeg&quot;],&quot;location&quot;:[0,&quot;Austin, TX&quot;],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,null],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}]]],&quot;meta_description&quot;:[0,&quot;Multiple Cloudflare services were unavailable for 37 minutes on October 30, 2023, due to the misconfiguration of a deployment tool used by Workers KV. We’re sorry that this incident — and its resulting impact on our customers — occurred, and in the spirit of transparency and improvement, we are sharing the details here.&quot;],&quot;primary_author&quot;:[0,{}],&quot;localeList&quot;:[0,{&quot;name&quot;:[0,&quot;Cloudflare incident on October 30, 2023 Config&quot;],&quot;enUS&quot;:[0,&quot;English for Locale&quot;],&quot;zhCN&quot;:[0,&quot;Translated for Locale&quot;],&quot;zhHansCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhTW&quot;:[0,&quot;Translated for Locale&quot;],&quot;frFR&quot;:[0,&quot;Translated for Locale&quot;],&quot;deDE&quot;:[0,&quot;Translated for Locale&quot;],&quot;itIT&quot;:[0,&quot;No Page for Locale&quot;],&quot;jaJP&quot;:[0,&quot;Translated for Locale&quot;],&quot;koKR&quot;:[0,&quot;Translated for Locale&quot;],&quot;ptBR&quot;:[0,&quot;No Page for Locale&quot;],&quot;esLA&quot;:[0,&quot;No Page for Locale&quot;],&quot;esES&quot;:[0,&quot;Translated for Locale&quot;],&quot;enAU&quot;:[0,&quot;No Page for Locale&quot;],&quot;enCA&quot;:[0,&quot;No Page for Locale&quot;],&quot;enIN&quot;:[0,&quot;No Page for Locale&quot;],&quot;enGB&quot;:[0,&quot;No Page for Locale&quot;],&quot;idID&quot;:[0,&quot;No Page for Locale&quot;],&quot;ruRU&quot;:[0,&quot;No Page for Locale&quot;],&quot;svSE&quot;:[0,&quot;No Page for Locale&quot;],&quot;viVN&quot;:[0,&quot;No Page for Locale&quot;],&quot;plPL&quot;:[0,&quot;No Page for Locale&quot;],&quot;arAR&quot;:[0,&quot;No Page for Locale&quot;],&quot;nlNL&quot;:[0,&quot;No Page for Locale&quot;],&quot;thTH&quot;:[0,&quot;No Page for Locale&quot;],&quot;trTR&quot;:[0,&quot;No Page for Locale&quot;],&quot;heIL&quot;:[0,&quot;No Page for Locale&quot;],&quot;lvLV&quot;:[0,&quot;No Page for Locale&quot;],&quot;etEE&quot;:[0,&quot;No Page for Locale&quot;],&quot;ltLT&quot;:[0,&quot;No Page for Locale&quot;]}],&quot;url&quot;:[0,&quot;https://blog.cloudflare.com/cloudflare-incident-on-october-30-2023&quot;],&quot;metadata&quot;:[0,{&quot;title&quot;:[0,&quot;Cloudflare incident on October 30, 2023&quot;],&quot;description&quot;:[0,&quot;Multiple Cloudflare services were unavailable for 37 minutes on October 30, 2023, due to the misconfiguration of a deployment tool used by Workers KV. We’re sorry that this incident — and its resulting impact on our customers — occurred, and in the spirit of transparency and improvement, we are sharing the details here.&quot;],&quot;imgPreview&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1S2SQCEWOEGUVKDtce6OUH/7329f7a3fcbe460e23a459eaaf2ca7f7/cloudflare-incident-on-october-30-2023-gljBr8.png&quot;]}],&quot;publicly_index&quot;:[0,true]}],[0,{&quot;id&quot;:[0,&quot;3tmgWjRNgroPDMiiOZFXsq&quot;],&quot;title&quot;:[0,&quot;How Cloudflare mitigated yet another Okta compromise&quot;],&quot;slug&quot;:[0,&quot;how-cloudflare-mitigated-yet-another-okta-compromise&quot;],&quot;excerpt&quot;:[0,&quot;On Wednesday, October 18, 2023, we discovered attacks on our system that we were able to trace back to Okta. We have verified that no Cloudflare customer information or systems were impacted by this event because of our rapid response. &quot;],&quot;featured&quot;:[0,false],&quot;html&quot;:[0,&quot;&lt;p&gt;&lt;/p&gt;&lt;p&gt;On Wednesday, October 18, 2023, we discovered attacks on our system that we were able to trace back to Okta – threat actors were able to leverage an authentication token compromised at Okta to pivot into Cloudflare’s Okta instance. While this was a troubling security incident, our Security Incident Response Team’s (SIRT) real-time detection and prompt response enabled containment and minimized the impact to Cloudflare systems and data. We have verified that &lt;b&gt;no Cloudflare customer information or systems were impacted by this event&lt;/b&gt; because of our rapid response. Okta has now released a &lt;a href=\&quot;https://sec.okta.com/harfiles\&quot;&gt;public statement&lt;/a&gt; about this incident.&lt;/p&gt;&lt;p&gt;This is the second time Cloudflare has been impacted by a breach of Okta’s systems. In &lt;a href=\&quot;/cloudflare-investigation-of-the-january-2022-okta-compromise/\&quot;&gt;March 2022&lt;/a&gt;, we blogged about our investigation on how a breach of Okta affected Cloudflare. In that incident, we concluded that there was no access from the threat actor to any of our systems or data – Cloudflare’s use of hard keys for multi-factor authentication stopped this attack.  &lt;/p&gt;&lt;p&gt;The key to mitigating this week’s incident was our team’s early detection and immediate response. In fact, we contacted Okta about the breach of their systems before they had notified us. The attacker used an open session from Okta, with Administrative privileges, and accessed our Okta instance. We were able to use our Cloudflare Zero Trust Access, Gateway, and Data Loss Prevention and our Cloudforce One threat research to validate the scope of the incident and contain it before the attacker could gain access to customer data, customer systems, or our production network. With this confidence, we were able to quickly mitigate the incident before the threat-actors were able to establish persistence.&lt;/p&gt;&lt;p&gt;According to Okta’s statement, the threat-actor accessed Okta’s customer support system and viewed files uploaded by certain Okta customers as part of recent support cases. It appears that in our case, the threat-actor was able to hijack a session token from a support ticket which was created by a Cloudflare employee. Using the token extracted from Okta, the threat-actor accessed Cloudflare systems on October 18. In this sophisticated attack, we observed that threat-actors compromised two separate Cloudflare employee accounts within the Okta platform. We detected this activity internally more than 24 hours before we were notified of the breach by Okta. Upon detection, our SIRT was able to engage quickly to identify the complete scope of compromise and contain the security incident. Cloudflare’s &lt;a href=\&quot;https://www.cloudflare.com/learning/security/glossary/what-is-zero-trust/\&quot;&gt;Zero Trust architecture&lt;/a&gt; protects our production environment, which helped prevent any impact to our customers.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;recommendations-for-okta\&quot;&gt;Recommendations for Okta&lt;/h2&gt;\n            &lt;a href=\&quot;#recommendations-for-okta\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;We urge Okta to consider implementing the following best practices, including:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;Take any report of compromise seriously and act immediately to limit damage; in this case Okta was first notified on October 2, 2023 by &lt;a href=\&quot;https://www.beyondtrust.com/blog/entry/okta-support-unit-breach\&quot;&gt;BeyondTrust&lt;/a&gt; but the attacker still had access to their support systems at least until October 18, 2023.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Provide timely, responsible disclosures to your customers when you identify that a breach of your systems has affected them.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Require hardware keys to protect all systems, including third-party support providers.&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;For a critical security service provider like Okta, we believe following these best practices is table stakes.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;recommendations-for-oktas-customers\&quot;&gt;Recommendations for Okta’s Customers&lt;/h2&gt;\n            &lt;a href=\&quot;#recommendations-for-oktas-customers\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;If you are an Okta customer, we recommend that you reach out to them for further information regarding potential impact to your organization. We also advise the following actions:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;Enable Hardware MFA for all user accounts. Passwords alone do not offer the necessary level of protection against attacks. We strongly recommend the usage of hardware keys, as other methods of MFA can be vulnerable to phishing attacks.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Investigate and respond to:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;All unexpected password and MFA changes for your Okta instances.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Suspicious support-initiated events.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Ensure all password resets are valid and force a password reset for any under suspicion.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Any suspicious MFA-related events, ensuring only valid MFA keys are present in the user&amp;#39;s account configuration.&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Monitor for:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;New Okta users created.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Reactivation of Okta users.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;All sessions have proper authentication associated with it.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;All Okta account and permission changes.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;MFA policy overrides, MFA changes, and MFA removal.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Delegation of sensitive applications.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Supply chain providers accessing your tenants.&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Review session expiration policies to limit session hijack attacks.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Utilize tools to validate devices connected to your critical systems, such as Cloudflare Access Device Posture Check.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Practice defense in depth for your detection and monitoring strategies.&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;Cloudflare’s Security and IT teams continue to remain vigilant after this compromise. If further information is disclosed by Okta or discovered through additional log analysis, we will publish an update to this post.&lt;/p&gt;&lt;p&gt;&lt;i&gt;Cloudflare&amp;#39;s Security Incident Response Team &lt;/i&gt;&lt;a href=\&quot;http://cloudflare.com/careers\&quot;&gt;&lt;i&gt;is hiring&lt;/i&gt;&lt;/a&gt;&lt;i&gt;.&lt;/i&gt;&lt;/p&gt;&quot;],&quot;published_at&quot;:[0,&quot;2023-10-20T22:39:13.000+01:00&quot;],&quot;updated_at&quot;:[0,&quot;2024-10-10T00:22:22.773Z&quot;],&quot;feature_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/2uxI0nb27T2YAwE7nghISd/131e9b05b696d2f4021a941fcecc36bc/how-cloudflare-mitigated-yet-another-okta-compromise.png&quot;],&quot;tags&quot;:[1,[[0,{&quot;id&quot;:[0,&quot;73fu66Q9EEIvQ8MOXiWoMH&quot;],&quot;name&quot;:[0,&quot;Okta&quot;],&quot;slug&quot;:[0,&quot;okta&quot;]}],[0,{&quot;id&quot;:[0,&quot;3cCNoJJ5uusKFBLYKFX1jB&quot;],&quot;name&quot;:[0,&quot;Post Mortem&quot;],&quot;slug&quot;:[0,&quot;post-mortem&quot;]}],[0,{&quot;id&quot;:[0,&quot;2FQK880QI5lKEUCjVHBber&quot;],&quot;name&quot;:[0,&quot;1.1.1.1&quot;],&quot;slug&quot;:[0,&quot;1-1-1-1&quot;]}]]],&quot;relatedTags&quot;:[0],&quot;authors&quot;:[1,[[0,{&quot;name&quot;:[0,&quot;Sourov Zaman&quot;],&quot;slug&quot;:[0,&quot;sourov&quot;],&quot;bio&quot;:[0,null],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/7EnNfUXOQM9YkKLfLRPjGn/63edde7c300b15ed04562dea06e30f25/sourov.png&quot;],&quot;location&quot;:[0,null],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,null],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}],[0,{&quot;name&quot;:[0,&quot;Lucas Ferreira&quot;],&quot;slug&quot;:[0,&quot;lucas-ferreira&quot;],&quot;bio&quot;:[0,null],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/6gNuYocEXTyvW1rHi3kwIA/33e9927372dfaff0b3f4210a89bbc6fd/lucas-ferreira.jpeg&quot;],&quot;location&quot;:[0,&quot;Lisbon&quot;],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,&quot;@lucassapao&quot;],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}],[0,{&quot;name&quot;:[0,&quot;Kimberly Hall&quot;],&quot;slug&quot;:[0,&quot;kimberly&quot;],&quot;bio&quot;:[0,null],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1NFsCzinTEFMdQjTpYMq4T/7c1a44b82e91f4e737c0589ba193407f/kimberly.jpg&quot;],&quot;location&quot;:[0,null],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,null],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}],[0,{&quot;name&quot;:[0,&quot;Grant Bourzikas&quot;],&quot;slug&quot;:[0,&quot;grant&quot;],&quot;bio&quot;:[0,null],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1vHlF4L08vT7IMvFcjXi1M/14e069cac54235bbd9d89db3ca13ffb5/grant.jpg&quot;],&quot;location&quot;:[0,&quot;https://www.linkedin.com/in/grantbourzikas/&quot;],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,&quot;@GrantBourzikas&quot;],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}]]],&quot;meta_description&quot;:[0,null],&quot;primary_author&quot;:[0,{}],&quot;localeList&quot;:[0,{&quot;name&quot;:[0,&quot;How Cloudflare mitigated yet another Okta compromise Config&quot;],&quot;enUS&quot;:[0,&quot;English for Locale&quot;],&quot;zhCN&quot;:[0,&quot;Translated for Locale&quot;],&quot;zhHansCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhTW&quot;:[0,&quot;Translated for Locale&quot;],&quot;frFR&quot;:[0,&quot;No Page for Locale&quot;],&quot;deDE&quot;:[0,&quot;No Page for Locale&quot;],&quot;itIT&quot;:[0,&quot;No Page for Locale&quot;],&quot;jaJP&quot;:[0,&quot;Translated for Locale&quot;],&quot;koKR&quot;:[0,&quot;Translated for Locale&quot;],&quot;ptBR&quot;:[0,&quot;No Page for Locale&quot;],&quot;esLA&quot;:[0,&quot;No Page for Locale&quot;],&quot;esES&quot;:[0,&quot;No Page for Locale&quot;],&quot;enAU&quot;:[0,&quot;No Page for Locale&quot;],&quot;enCA&quot;:[0,&quot;No Page for Locale&quot;],&quot;enIN&quot;:[0,&quot;No Page for Locale&quot;],&quot;enGB&quot;:[0,&quot;No Page for Locale&quot;],&quot;idID&quot;:[0,&quot;No Page for Locale&quot;],&quot;ruRU&quot;:[0,&quot;No Page for Locale&quot;],&quot;svSE&quot;:[0,&quot;No Page for Locale&quot;],&quot;viVN&quot;:[0,&quot;No Page for Locale&quot;],&quot;plPL&quot;:[0,&quot;No Page for Locale&quot;],&quot;arAR&quot;:[0,&quot;No Page for Locale&quot;],&quot;nlNL&quot;:[0,&quot;No Page for Locale&quot;],&quot;thTH&quot;:[0,&quot;No Page for Locale&quot;],&quot;trTR&quot;:[0,&quot;No Page for Locale&quot;],&quot;heIL&quot;:[0,&quot;No Page for Locale&quot;],&quot;lvLV&quot;:[0,&quot;No Page for Locale&quot;],&quot;etEE&quot;:[0,&quot;No Page for Locale&quot;],&quot;ltLT&quot;:[0,&quot;No Page for Locale&quot;]}],&quot;url&quot;:[0,&quot;https://blog.cloudflare.com/how-cloudflare-mitigated-yet-another-okta-compromise&quot;],&quot;metadata&quot;:[0,{&quot;title&quot;:[0,&quot;How Cloudflare mitigated yet another Okta compromise&quot;],&quot;description&quot;:[0,null],&quot;imgPreview&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/4taC5OERPjPY2EXdxPi3xr/f99e8cd933b7745d2def617f432dfef8/how-cloudflare-mitigated-yet-another-okta-compromise-3cHmZk.png&quot;]}],&quot;publicly_index&quot;:[0,true]}],[0,{&quot;id&quot;:[0,&quot;5Epuwd37zPtXIStrh5nqXB&quot;],&quot;title&quot;:[0,&quot;1.1.1.1 lookup failures on  October 4, 2023&quot;],&quot;slug&quot;:[0,&quot;1-1-1-1-lookup-failures-on-october-4th-2023&quot;],&quot;excerpt&quot;:[0,&quot;On 4 October 2023, Cloudflare experienced DNS resolution problems. Some users may have received SERVFAIL DNS responses to valid queries. In this blog, we’re going to talk about what the failure was, why it occurred, and what we’re doing to make sure this doesn’t happen again&quot;],&quot;featured&quot;:[0,false],&quot;html&quot;:[0,&quot;&lt;p&gt;&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/5S774vlQ0Giaa7OrRw5WpA/429311dc4a79f8e088291906058eb206/DNS-Incident-1.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1600\&quot; height=\&quot;900\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;On 4 October 2023, Cloudflare experienced DNS resolution problems starting at 07:00 UTC and ending at 11:00 UTC. Some users of 1.1.1.1 or products like WARP, Zero Trust, or third party DNS resolvers which use 1.1.1.1 may have received SERVFAIL DNS responses to valid queries. We’re very sorry for this outage. This outage was an internal software error and not the result of an attack. In this blog, we’re going to talk about what the failure was, why it occurred, and what we’re doing to make sure this doesn’t happen again.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;background\&quot;&gt;Background&lt;/h2&gt;\n            &lt;a href=\&quot;#background\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;In the &lt;a href=\&quot;https://www.cloudflare.com/learning/dns/what-is-dns/\&quot;&gt;Domain Name System (DNS)&lt;/a&gt;, every domain name exists within a DNS zone. The zone is a collection of domain names and host names that are controlled together. For example, Cloudflare is responsible for the domain name cloudflare.com, which we say is in the “cloudflare.com” zone. The .com top-level domain (TLD) is owned by a third party and is in the “com” zone. It gives directions on how to reach cloudflare.com. Above all of the TLDs is &lt;a href=\&quot;https://en.wikipedia.org/wiki/DNS_root_zone\&quot;&gt;the root zone&lt;/a&gt;, which gives &lt;a href=\&quot;https://www.iana.org/domains/root/db\&quot;&gt;directions on how to reach TLDs&lt;/a&gt;. This means that the root zone is important in being able to resolve all other domain names. Like other important parts of the DNS, &lt;a href=\&quot;https://www.iana.org/dnssec/procedures\&quot;&gt;the root zone is signed with DNSSEC&lt;/a&gt;, which means the root zone itself contains cryptographic signatures.&lt;/p&gt;&lt;p&gt;The root zone is published on &lt;a href=\&quot;https://root-servers.org/\&quot;&gt;the root servers&lt;/a&gt;, but it is also common for DNS operators to &lt;a href=\&quot;https://www.rfc-editor.org/rfc/rfc8806\&quot;&gt;retrieve and retain a copy of the root zone automatically&lt;/a&gt; so that in the event that the root servers cannot be reached, the information in the root zone is still available. Cloudflare’s recursive DNS infrastructure takes this approach as it also makes the resolution process faster. New versions of the root zone are normally published twice a day. 1.1.1.1 has a &lt;a href=\&quot;/big-pineapple-intro/\&quot;&gt;WebAssembly app&lt;/a&gt; called static_zone running on top of the main DNS logic that serves those new versions when they are available.&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/5tgd6rlFY7udR3qnaykmLu/b3256f48a8d2aa87e51de7da96bdfa4b/image2-1.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;951\&quot; height=\&quot;604\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;what-happened\&quot;&gt;What happened&lt;/h2&gt;\n            &lt;a href=\&quot;#what-happened\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;On 21 September, as part of &lt;a href=\&quot;https://blog.verisign.com/security/root-zone-zonemd/\&quot;&gt;a known and planned change in root zone management&lt;/a&gt;, a new resource record type was included in the root zones for the first time. The new resource record is named &lt;a href=\&quot;https://www.rfc-editor.org/rfc/rfc8976.html\&quot;&gt;ZONEMD&lt;/a&gt;, and is in effect a checksum for the contents of the root zone.&lt;/p&gt;&lt;p&gt;The root zone is retrieved by software running in Cloudflare’s core network. It is subsequently redistributed to Cloudflare’s data centers around the world. After the change, the root zone containing the ZONEMD record continued to be retrieved and distributed as normal. However, the 1.1.1.1 resolver systems that make use of that data had problems parsing the ZONEMD record. Because zones must be loaded and served in their entirety, the system’s failure to parse ZONEMD meant the new versions of the root zone were not used in Cloudflare’s resolver systems. Some of the servers hosting Cloudflare&amp;#39;s resolver infrastructure failed over to querying the DNS root servers directly on a request-by-request basis when they did not receive the new root zone. However, others continued to rely on the known working version of the root zone still available in their memory cache, which was the version pulled on 21 September before the change.&lt;/p&gt;&lt;p&gt;On 4 October 2023 at 07:00 UTC, the DNSSEC signatures in the version of the root zone from 21 September expired. Because there was no newer version that the Cloudflare resolver systems were able to use, some of Cloudflare’s resolver systems stopped being able to validate DNSSEC signatures and as a result started sending error responses (SERVFAIL). The rate at which Cloudflare resolvers generated SERVFAIL responses grew by 12%. The diagrams below illustrate the progression of the failure and how it became visible to users.&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1XAzPsw7SXN9MWtsdfATWP/6df4fb0f70eddd8d5a7b92ae242cb0f5/image3-1.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1337\&quot; height=\&quot;1999\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;incident-timeline-and-impact\&quot;&gt;Incident timeline and impact&lt;/h2&gt;\n            &lt;a href=\&quot;#incident-timeline-and-impact\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;&lt;b&gt;21 September 6:30 UTC&lt;/b&gt;: Last successful pull of the root zone.&lt;b&gt;4 October 7:00 UTC&lt;/b&gt;: DNSSEC signatures in the root zone obtained on 21 September expired causing an increase in SERVFAIL responses to client queries.&lt;b&gt;7:57&lt;/b&gt;: First external reports of unexpected SERVFAILs started coming in.&lt;b&gt;8:03&lt;/b&gt;: Internal Cloudflare incident declared.&lt;b&gt;8:50&lt;/b&gt;: Initial attempt made at stopping 1.1.1.1 from serving responses using the stale root zone file with an override rule.&lt;b&gt;10:30&lt;/b&gt;: Stopped 1.1.1.1 from preloading the root zone file entirely.&lt;b&gt;10:32&lt;/b&gt;: Responses returned to normal.&lt;b&gt;11:02&lt;/b&gt;: Incident closed.&lt;/p&gt;&lt;p&gt;This below chart shows the timeline of impact along with the percentage of DNS queries that returned with a SERVFAIL error:&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1Wfn8yZCTZqq1AcB8EjQ4L/fe78cafa32baa2553bdba082c61e9dca/image1-3.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1431\&quot; height=\&quot;414\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;We expect a baseline volume of SERVFAIL errors for regular traffic during normal operation. Usually that percentage sits at around 3%. These SERVFAILs can be caused by legitimate issues in the DNSSEC chain, failures to connect to authoritative servers, authoritative servers taking too long to respond, &lt;a href=\&quot;/unwrap-the-servfail/\&quot;&gt;and many others&lt;/a&gt;. During the incident the amount of SERVFAILs peaked at 15% of total queries, although the impact was not evenly distributed around the world and was mainly concentrated in our larger data centers like Ashburn, Virginia; Frankfurt, Germany; and Singapore.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;why-this-incident-happened\&quot;&gt;Why this incident happened&lt;/h2&gt;\n            &lt;a href=\&quot;#why-this-incident-happened\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;h4&gt;Why parsing the ZONEMD record failed&lt;/h4&gt;&lt;p&gt;DNS has a binary format for storing resource records. In this binary format the type of the resource record (TYPE)  is stored as a 16-bit integer. The type of resource record determines how the resource data (RDATA) is parsed. When the record type is 1, this means it is an A record, and the RDATA can be parsed as an IPv4 address. Record type 28 is an AAAA record, whose RDATA can be parsed as an IPv6 address instead. When a parser runs into an unknown resource type it won’t know how to parse its RDATA, but fortunately it doesn’t have to: the RDLENGTH field indicates how long the RDATA field is, allowing the parser to treat it as an opaque data element.&lt;/p&gt;\n            &lt;pre class=\&quot;language-bash\&quot;&gt;&lt;code class=\&quot;language-bash\&quot;&gt;                                   1  1  1  1  1  1\n      0  1  2  3  4  5  6  7  8  9  0  1  2  3  4  5\n    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+\n    |                                               |\n    /                                               /\n    /                      NAME                     /\n    |                                               |\n    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+\n    |                      TYPE                     |\n    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+\n    |                     CLASS                     |\n    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+\n    |                      TTL                      |\n    |                                               |\n    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+\n    |                   RDLENGTH                    |\n    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--|\n    /                     RDATA                     /\n    /                                               /\n    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;&lt;a href=\&quot;https://www.ietf.org/rfc/rfc1035.txt\&quot;&gt;RFC 1035&lt;/a&gt;&lt;/p&gt;&lt;p&gt;The reason static_zone didn’t support the new ZONEMD record is because up until now we had chosen to distribute the root zone internally in its presentation format, rather than in the binary format. When looking at the text representation for a few resource records we can see there is a lot more variation in how different records are presented.&lt;/p&gt;\n            &lt;pre class=\&quot;language-bash\&quot;&gt;&lt;code class=\&quot;language-bash\&quot;&gt;.\t\t\t86400\tIN\tSOA\ta.root-servers.net. nstld.verisign-grs.com. 2023100400 1800 900 604800 86400\n.\t\t\t86400\tIN\tRRSIG\tSOA 8 0 86400 20231017050000 20231004040000 46780 . J5lVTygIkJHDBt6HHm1QLx7S0EItynbBijgNlcKs/W8FIkPBfCQmw5BsUTZAPVxKj7r2iNLRddwRcM/1sL49jV9Jtctn8OLLc9wtouBmg3LH94M0utW86dKSGEKtzGzWbi5hjVBlkroB8XVQxBphAUqGxNDxdE6AIAvh/eSSb3uSQrarxLnKWvHIHm5PORIOftkIRZ2kcA7Qtou9NqPCSE8fOM5EdXxussKChGthmN5AR5S2EruXIGGRd1vvEYBrRPv55BAWKKRERkaXhgAp7VikYzXesiRLdqVlTQd+fwy2tm/MTw+v3Un48wXPg1lRPlQXmQsuBwqg74Ts5r8w8w==\n.\t\t\t518400\tIN\tNS\ta.root-servers.net.\n.\t\t\t86400\tIN\tZONEMD\t2023100400 1 241 E375B158DAEE6141E1F784FDB66620CC4412EDE47C8892B975C90C6A102E97443678CCA4115E27195B468E33ABD9F78C&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;Example records taken from &lt;a href=\&quot;https://www.internic.net/domain/root.zone\&quot;&gt;https://www.internic.net/domain/root.zone&lt;/a&gt;&lt;/p&gt;&lt;p&gt;When we run into an unknown resource record it’s not always easy to know how to handle it. Because of this, the library we use to parse the root zone at the edge does not make an attempt at doing so, and instead returns a parser error.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;why-a-stale-version-of-the-root-zone-was-used\&quot;&gt;Why a stale version of the root zone was used&lt;/h3&gt;\n            &lt;a href=\&quot;#why-a-stale-version-of-the-root-zone-was-used\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;The static_zone app, tasked with loading and parsing the root zone for the purpose of serving the root zone locally (&lt;a href=\&quot;https://datatracker.ietf.org/doc/html/rfc7706\&quot;&gt;RFC 7706&lt;/a&gt;), stores the latest version in memory. When a new version is published it parses it and, when successfully done so, drops the old version. However, as parsing failed the static_zone app never switched to a newer version, and instead continued using the old version indefinitely. When the 1.1.1.1 service is first started the static_zone app does not have an existing version in memory. When it tries to parse the root zone it fails in doing so, but because it does not have an older version of the root zone to fall back on, it falls back on querying the root servers directly for incoming requests.&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/6CnsfVerlBEVukAWjtcK0B/2bdf1562912f7694fe4c65f73e8a9810/image5.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1999\&quot; height=\&quot;1417\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;why-the-initial-attempt-at-disabling-static_zone-didnt-work\&quot;&gt;Why the initial attempt at disabling static_zone didn’t work&lt;/h3&gt;\n            &lt;a href=\&quot;#why-the-initial-attempt-at-disabling-static_zone-didnt-work\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Initially we tried to disable the static_zone app through override rules, a mechanism that allows us to programmatically change some behavior of 1.1.1.1. The rule we deployed was:&lt;/p&gt;\n            &lt;pre class=\&quot;language-bash\&quot;&gt;&lt;code class=\&quot;language-bash\&quot;&gt;phase = pre-cache set-tag rec_disable_static&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;For any incoming request this rule adds the tag rec_disable_static to the request. Inside the static_zone app we check for this tag and, if it’s set, we do not return a response from the cached, static root zone. However, &lt;a href=\&quot;/big-pineapple-intro/\&quot;&gt;to improve cache performance&lt;/a&gt; queries are sometimes forwarded to another node if the current node can’t find the response in its own cache. Unfortunately, the rec_disable_static tag is not included in the queries being forwarded to other nodes, which caused the static_zone app to continue replying with stale information until we eventually disabled the app entirely.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;why-the-impact-was-partial\&quot;&gt;Why the impact was partial&lt;/h3&gt;\n            &lt;a href=\&quot;#why-the-impact-was-partial\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Cloudflare regularly performs rolling reboots of the servers that host our services for tasks like kernel updates that can only take effect after a full system restart. At the time of this outage, resolver server instances that were restarted between the ZONEMD change and the DNSSEC invalidation did not contribute to impact. If they had restarted during this two-week period, they would have failed to load the root zone on startup and fallen back to resolving by sending DNS queries to root servers instead. In addition, the resolver uses a technique called serve stale (&lt;a href=\&quot;https://datatracker.ietf.org/doc/html/rfc8767\&quot;&gt;RFC 8767&lt;/a&gt;) with the purpose of being able to continue to serve popular records from a potentially stale cache to limit the impact. A record is considered to be stale once the TTL amount of seconds has passed since the record was retrieved from upstream.  This prevented a total outage; impact was mainly felt in our largest data centers which had many servers that had not restarted the 1.1.1.1 service in that timeframe.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;remediation-and-follow-up-steps\&quot;&gt;Remediation and follow-up steps&lt;/h2&gt;\n            &lt;a href=\&quot;#remediation-and-follow-up-steps\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;This incident had widespread impact, and we take the availability of our services very seriously. We have identified several areas of improvement and will continue to work on uncovering any other gaps that could cause a recurrence.&lt;/p&gt;&lt;p&gt;Here is what we are working on immediately:&lt;/p&gt;&lt;p&gt;&lt;b&gt;Visibility&lt;/b&gt;: We’re adding alerts to notify when static_zone serves a stale root zone file. It should not have been the case that serving a stale root zone file went unnoticed for as long as it did. If we had been monitoring this better, with the caching that exists, there would have been no impact. It is our goal to protect our customers and their users from upstream changes.&lt;/p&gt;&lt;p&gt;&lt;b&gt;Resilience:&lt;/b&gt; We will re-evaluate how we ingest and distribute the root zone internally. Our ingestion and distribution pipelines should handle new RRTYPEs seamlessly, and any brief interruption to the pipeline should be invisible to end users.&lt;/p&gt;&lt;p&gt;&lt;b&gt;Testing:&lt;/b&gt; Despite having tests in place around this problem, including tests related to unreleased changes in parsing the new ZONEMD records, we did not adequately test what happens when the root zone fails to parse. We will improve our test coverage and the related processes.&lt;/p&gt;&lt;p&gt;&lt;b&gt;Architecture&lt;/b&gt;: We should not use stale copies of the root zone past a certain point. While it’s certainly possible to continue to use stale root zone data for a limited amount of time, past a certain point there are unacceptable operational risks. We will take measures to ensure that the lifetime of cached root zone data is better managed as described in &lt;a href=\&quot;https://www.rfc-editor.org/rfc/rfc8806\&quot;&gt;RFC 8806: Running a Root Server Local to a Resolver&lt;/a&gt;.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;conclusion\&quot;&gt;Conclusion&lt;/h2&gt;\n            &lt;a href=\&quot;#conclusion\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;We are deeply sorry that this incident happened. There is one clear message from this incident: do not ever assume that something is not going to change!  Many modern systems are built with a long chain of libraries that are pulled into the final executable, each one of those may have bugs or may not be updated early enough for programs to operate correctly when changes in input happen. We understand how important it is to have good testing in place that allows detection of regressions and systems and components that fail gracefully on changes to input. We understand that we need to always assume that “format” changes in the most critical systems of the internet (DNS and BGP) are going to have an impact.&lt;/p&gt;&lt;p&gt;We have a lot to follow up on internally and are working around the clock to make sure something like this does not happen again.&lt;/p&gt;&quot;],&quot;published_at&quot;:[0,&quot;2023-10-04T20:40:34.000+01:00&quot;],&quot;updated_at&quot;:[0,&quot;2024-10-10T00:22:29.289Z&quot;],&quot;feature_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/3LJLAQmg8BED7Fe0uRQHK/9d2b3c7710d45c4b9b1c2d9fe0a610e8/1-1-1-1-lookup-failures-on-october-4th-2023.png&quot;],&quot;tags&quot;:[1,[[0,{&quot;id&quot;:[0,&quot;2FQK880QI5lKEUCjVHBber&quot;],&quot;name&quot;:[0,&quot;1.1.1.1&quot;],&quot;slug&quot;:[0,&quot;1-1-1-1&quot;]}],[0,{&quot;id&quot;:[0,&quot;3cCNoJJ5uusKFBLYKFX1jB&quot;],&quot;name&quot;:[0,&quot;Post Mortem&quot;],&quot;slug&quot;:[0,&quot;post-mortem&quot;]}],[0,{&quot;id&quot;:[0,&quot;4yliZlpBPZpOwBDZzo1tTh&quot;],&quot;name&quot;:[0,&quot;Outage&quot;],&quot;slug&quot;:[0,&quot;outage&quot;]}]]],&quot;relatedTags&quot;:[0],&quot;authors&quot;:[1,[[0,{&quot;name&quot;:[0,&quot;Ólafur Guðmundsson&quot;],&quot;slug&quot;:[0,&quot;olafur-gudmundsson&quot;],&quot;bio&quot;:[0,&quot;VP of Engineering at Cloudflare, long time Internet geek &quot;],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1Q0Z4uWqwV6Vc2zYTEzXXu/aba8f4a8aad6fba686bfc01780cf76d7/olafur-gudmundsson.jpg&quot;],&quot;location&quot;:[0,null],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,null],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}]]],&quot;meta_description&quot;:[0,null],&quot;primary_author&quot;:[0,{}],&quot;localeList&quot;:[0,{&quot;name&quot;:[0,&quot;1.1.1.1 lookup failures on  October 4, 2023 Config&quot;],&quot;enUS&quot;:[0,&quot;English for Locale&quot;],&quot;zhCN&quot;:[0,&quot;Translated for Locale&quot;],&quot;zhHansCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhTW&quot;:[0,&quot;Translated for Locale&quot;],&quot;frFR&quot;:[0,&quot;Translated for Locale&quot;],&quot;deDE&quot;:[0,&quot;Translated for Locale&quot;],&quot;itIT&quot;:[0,&quot;No Page for Locale&quot;],&quot;jaJP&quot;:[0,&quot;Translated for Locale&quot;],&quot;koKR&quot;:[0,&quot;Translated for Locale&quot;],&quot;ptBR&quot;:[0,&quot;No Page for Locale&quot;],&quot;esLA&quot;:[0,&quot;No Page for Locale&quot;],&quot;esES&quot;:[0,&quot;Translated for Locale&quot;],&quot;enAU&quot;:[0,&quot;No Page for Locale&quot;],&quot;enCA&quot;:[0,&quot;No Page for Locale&quot;],&quot;enIN&quot;:[0,&quot;No Page for Locale&quot;],&quot;enGB&quot;:[0,&quot;No Page for Locale&quot;],&quot;idID&quot;:[0,&quot;No Page for Locale&quot;],&quot;ruRU&quot;:[0,&quot;No Page for Locale&quot;],&quot;svSE&quot;:[0,&quot;No Page for Locale&quot;],&quot;viVN&quot;:[0,&quot;No Page for Locale&quot;],&quot;plPL&quot;:[0,&quot;No Page for Locale&quot;],&quot;arAR&quot;:[0,&quot;No Page for Locale&quot;],&quot;nlNL&quot;:[0,&quot;No Page for Locale&quot;],&quot;thTH&quot;:[0,&quot;No Page for Locale&quot;],&quot;trTR&quot;:[0,&quot;No Page for Locale&quot;],&quot;heIL&quot;:[0,&quot;No Page for Locale&quot;],&quot;lvLV&quot;:[0,&quot;No Page for Locale&quot;],&quot;etEE&quot;:[0,&quot;No Page for Locale&quot;],&quot;ltLT&quot;:[0,&quot;No Page for Locale&quot;]}],&quot;url&quot;:[0,&quot;https://blog.cloudflare.com/1-1-1-1-lookup-failures-on-october-4th-2023&quot;],&quot;metadata&quot;:[0,{&quot;title&quot;:[0,&quot;1.1.1.1 lookup failures on  October 4, 2023&quot;],&quot;description&quot;:[0,null],&quot;imgPreview&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/65mMjehDGuDeHTX7rulMBx/0660587459d9d86b491a2af0dd0ac8bf/1-1-1-1-lookup-failures-on-october-4th-2023-nzVtiu.png&quot;]}],&quot;publicly_index&quot;:[0,true]}],[0,{&quot;id&quot;:[0,&quot;6sRjpTRuwGjPJmHgwHlg7u&quot;],&quot;title&quot;:[0,&quot;Hardening Workers KV&quot;],&quot;slug&quot;:[0,&quot;workers-kv-restoring-reliability&quot;],&quot;excerpt&quot;:[0,&quot;A deep dive into the recent incidents relating to Workers KV, and how we’re going to fix them&quot;],&quot;featured&quot;:[0,false],&quot;html&quot;:[0,&quot;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/6lHi3fayACwD7kAST8MmOR/2394e18c88878b0691300f38a1820cd4/Fixing-Workers-KV-Reliability-1.png\&quot; alt=\&quot;Hardening Workers KV\&quot; class=\&quot;kg-image\&quot; width=\&quot;2401\&quot; height=\&quot;1350\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;Over the last couple of months, Workers KV has suffered from a series of incidents, culminating in three back-to-back incidents during the week of July 17th, 2023. These incidents have directly impacted customers that rely on KV — and this isn’t good enough.&lt;/p&gt;&lt;p&gt;We’re going to share the work we have done to understand why KV has had such a spate of incidents and, more importantly, share in depth what we’re doing to dramatically improve how we deploy changes to KV going forward.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;workers-kv\&quot;&gt;Workers KV?&lt;/h3&gt;\n            &lt;a href=\&quot;#workers-kv\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;&lt;a href=\&quot;https://www.cloudflare.com/developer-platform/workers-kv/\&quot;&gt;Workers KV&lt;/a&gt; — or just “KV” — is a key-value service for storing data: specifically, data with high read throughput requirements. It’s especially useful for user configuration, service routing, small assets and/or authentication data.&lt;/p&gt;&lt;p&gt;We use KV extensively inside Cloudflare too, with &lt;a href=\&quot;https://www.cloudflare.com/zero-trust/products/access/\&quot;&gt;Cloudflare Access&lt;/a&gt; (part of our Zero Trust suite) and &lt;a href=\&quot;https://pages.cloudflare.com/\&quot;&gt;Cloudflare Pages&lt;/a&gt; being some of our highest profile internal customers. Both teams benefit from KV’s ability to keep regularly accessed key-value pairs close to where they’re accessed, as well its ability to scale out horizontally without any need to become an expert in operating KV.&lt;/p&gt;&lt;p&gt;Given Cloudflare’s extensive use of KV, it wasn’t just external customers impacted. Our own internal teams felt the pain of these incidents, too.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;the-summary-of-the-post-mortem\&quot;&gt;The summary of the post-mortem&lt;/h3&gt;\n            &lt;a href=\&quot;#the-summary-of-the-post-mortem\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Back in June 2023, we announced the move to a new architecture for KV, which is designed to address two major points of customer feedback we’ve had around KV: high latency for infrequently accessed keys (or a key accessed in different regions), and working to ensure the upper bound on KV’s eventual consistency model for writes is 60 seconds — not “mostly 60 seconds”.&lt;/p&gt;&lt;p&gt;At the time of the blog, we’d already been testing this internally, including early access with our community champions and running a small % of production traffic to validate stability and performance expectations beyond what we could emulate within a staging environment.&lt;/p&gt;&lt;p&gt;However, in the weeks between mid-June and culminating in the series of incidents during the week of July 17th, we would continue to increase the volume of new traffic onto the new architecture. When we did this, we would encounter previously unseen problems (many of these customer-impacting) — then immediately roll back, fix bugs, and repeat. Internally, we’d begun to identify that this pattern was becoming unsustainable — each attempt to cut traffic onto the new architecture would surface errors or behaviors we hadn’t seen before and couldn’t immediately explain, and thus we would roll back and assess.&lt;/p&gt;&lt;p&gt;The issues at the root of this series of incidents proved to be significantly challenging to track and observe. Once identified, the two causes themselves proved to be quick to fix, but an (1) observability gap in our error reporting and (2) a mutation to local state that resulted in an unexpected mutation of global state were both hard to observe and reproduce over the days following the customer-facing impact ending.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;the-detail\&quot;&gt;The detail&lt;/h3&gt;\n            &lt;a href=\&quot;#the-detail\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;One important piece of context to understand before we go into detail on the post-mortem: Workers KV is composed of two separate Workers scripts – internally referred to as the Storage Gateway Worker and SuperCache. SuperCache is an optional path in the Storage Gateway Worker workflow, and is the basis for KV&amp;#39;s new (faster) backend (refer to the blog).&lt;/p&gt;&lt;p&gt;Here is a timeline of events:&lt;/p&gt;&lt;!--kg-card-begin: html--&gt;&lt;style type=\&quot;text/css\&quot;&gt;\n.tg  {border-collapse:collapse;border-color:#ccc;border-spacing:0;}\n.tg td{background-color:#fff;border-color:#ccc;border-style:solid;border-width:1px;color:#333;\n  font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;word-break:normal;}\n.tg th{background-color:#f0f0f0;border-color:#ccc;border-style:solid;border-width:1px;color:#333;\n  font-family:Arial, sans-serif;font-size:14px;font-weight:normal;overflow:hidden;padding:10px 5px;word-break:normal;}\n.tg .tg-0q7p{background-color:#F4F5F7;font-weight:bold;text-align:left;vertical-align:top}\n.tg .tg-0lax{text-align:left;vertical-align:top}\n&lt;/style&gt;\n&lt;table class=\&quot;tg\&quot; width=\&quot;100%\&quot;&gt;\n&lt;thead&gt;\n  &lt;tr&gt;\n    &lt;th class=\&quot;tg-0q7p\&quot;&gt;&lt;span style=\&quot;font-weight:700;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Time&lt;/span&gt;&lt;/th&gt;\n    &lt;th class=\&quot;tg-0q7p\&quot;&gt;&lt;span style=\&quot;font-weight:700;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Description&lt;/span&gt;&lt;/th&gt;\n  &lt;/tr&gt;\n&lt;/thead&gt;\n&lt;tbody&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;2023-07-17 21:52 UTC&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Cloudflare observes alerts showing 500 HTTP status codes in the MEL01 data-center (Melbourne, AU) and begins investigating.&lt;/span&gt;&lt;br&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;We also begin to see a small set of customers reporting HTTP 500s being returned via multiple channels. It is not immediately clear if this is a data-center-wide issue or KV specific, as there had not been a recent KV deployment, and the issue directly correlated with three data-centers being brought back online.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;2023-07-18 00:09 UTC&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;We disable the new backend for KV in MEL01 in an attempt to mitigate the issue (noting that there had not been a recent deployment or change to the % of users on the new backend).&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;2023-07-18 05:42 UTC&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Investigating alerts showing 500 HTTP status codes in VIE02 (Vienna, AT) and JNB01 (Johannesburg, SA).&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;2023-07-18 13:51 UTC&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;The new backend is disabled globally after seeing issues in VIE02 (Vienna, AT) and JNB01 (Johannesburg, SA) data-centers, similar to MEL01. In both cases, they had also recently come back online after maintenance, but it remained unclear as to why KV was failing.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;2023-07-20 19:12 UTC&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;The new backend is inadvertently re-enabled while deploying the update due to a misconfiguration in a deployment script. &lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;2023-07-20 19:33 UTC&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;The new backend is (re-) disabled globally as HTTP 500 errors return.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;2023-07-20 23:46 UTC&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Broken Workers script pipeline deployed as part of gradual rollout due to incorrectly defined pipeline configuration in the deployment script.&lt;/span&gt;&lt;br&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Metrics begin to report that a subset of traffic is being black-holed.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;2023-07-20 23:56 UTC&lt;/span&gt;&lt;/td&gt;\n    &lt;td class=\&quot;tg-0lax\&quot;&gt;&lt;span style=\&quot;font-weight:400;font-style:normal;text-decoration:none;color:#000;background-color:transparent\&quot;&gt;Broken pipeline rolled back; errors rates return to pre-incident (normal) levels.&lt;/span&gt;&lt;/td&gt;\n  &lt;/tr&gt;\n&lt;/tbody&gt;\n&lt;/table&gt;&lt;!--kg-card-end: html--&gt;&lt;p&gt;&lt;i&gt;All timestamps referenced are in Coordinated Universal Time (UTC).&lt;/i&gt;&lt;/p&gt;&lt;p&gt;We initially observed alerts showing 500 HTTP status codes in the MEL01 data-center (Melbourne, AU) at 21:52 UTC on July 17th, and began investigating. We also received reports from a small set of customers reporting HTTP 500s being returned via multiple channels. This correlated with three data centers being brought back online, and it was not immediately clear if it related to the data centers or was KV-specific — especially given there had not been a recent KV deployment. On 05:42, we began investigating alerts showing 500 HTTP status codes in VIE02 (Vienna) and JNB02 (Johannesburg) data-centers; while both had recently come back online after maintenance, it was still unclear why KV was failing. At 13:51 UTC, we made the decision to disable the new backend globally.&lt;/p&gt;&lt;p&gt;Following the incident on July 18th, we attempted to deploy an allow-list configuration to reduce the scope of impacted accounts. However, while attempting to roll out a change for the Storage Gateway Worker at 19:12 UTC on July 20th, an older configuration was progressed causing the new backend to be enabled again, leading to the third event. As the team worked to fix this and deploy this configuration, they attempted to manually progress the deployment at 23:46 UTC, which resulted in the passing of a malformed configuration value that caused traffic to be sent to an invalid Workers script configuration.&lt;/p&gt;&lt;p&gt;After all deployments and the broken Workers configuration (pipeline) had been rolled back at 23:56 on the 20th July, we spent the following three days working to identify the root cause of the issue. We lacked observability as KV&amp;#39;s Worker script (responsible for much of KV&amp;#39;s logic) was throwing an unhandled exception very early on in the request handling process. This was further exacerbated by prior work to disable error reporting in a disabled data-center due to the noise generated, which had previously resulted in logs being rate-limited upstream from our service.&lt;/p&gt;&lt;p&gt;This previous mitigation prevented us from capturing meaningful logs from the Worker, including identifying the exception itself, as an uncaught exception terminates request processing. This has raised the priority of improving how unhandled exceptions are reported and surfaced in a Worker (see Recommendations, below, for further details). This issue was exacerbated by the fact that KV&amp;#39;s Worker script would fail to re-enter its &amp;quot;healthy&amp;quot; state when a Cloudflare data center was brought back online, as the Worker was mutating an environment variable perceived to be in request scope, but that was in global scope and persisted across requests. This effectively left the Worker “frozen” with the previous, invalid configuration for the affected locations.&lt;/p&gt;&lt;p&gt;Further, the introduction of a new progressive release process for Workers KV, designed to de-risk rollouts (as an action from a prior incident), prolonged the incident. We found a bug in the deployment logic that led to a broader outage due to an incorrectly defined configuration.&lt;/p&gt;&lt;p&gt;This configuration effectively caused us to drop a single-digit % of traffic until it was rolled back 10 minutes later. This code is untested at scale, and we need to spend more time hardening it before using it as the default path in production.&lt;/p&gt;&lt;p&gt;Additionally: although the root cause of the incidents was limited to three Cloudflare data-centers (Melbourne, Vienna, and Johannesburg), traffic across these regions still uses these data centers to route reads and writes to our system of record. Because these three data centers participate in KV’s new backend as regional tiers, a portion of traffic across the Oceania, Europe, and African regions was affected. Only a portion of keys from enrolled namespaces use any given data center as a regional tier in order to limit a single (regional) point of failure, so while traffic across &lt;i&gt;all&lt;/i&gt; data centers in the region was impacted, nowhere was &lt;i&gt;all&lt;/i&gt; traffic in a given data center affected.&lt;/p&gt;&lt;p&gt;We estimated the affected traffic to be 0.2-0.5% of KV&amp;#39;s global traffic (based on our error reporting), however we observed some customers with error rates approaching 20% of their total KV operations. The impact was spread across KV namespaces and keys for customers within the scope of this incident.&lt;/p&gt;&lt;p&gt;Both KV’s high total traffic volume and its role as a critical dependency for many customers amplify the impact of even small error rates. In all cases, once the changes were rolled back, errors returned to normal levels and did not persist.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;thinking-about-risks-in-building-software\&quot;&gt;Thinking about risks in building software&lt;/h3&gt;\n            &lt;a href=\&quot;#thinking-about-risks-in-building-software\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Before we dive into what we’re doing to significantly improve how we build, test, deploy and observe Workers KV going forward, we think there are lessons from the real world that can equally apply to how we improve the safety factor of the software we ship.&lt;/p&gt;&lt;p&gt;In traditional engineering and construction, there is an extremely common procedure known as a   “JSEA”, or &lt;a href=\&quot;https://en.wikipedia.org/wiki/Job_safety_analysis\&quot;&gt;Job Safety and Environmental Analysis&lt;/a&gt; (sometimes just “JSA”). A JSEA is designed to help you iterate through a list of tasks, the potential hazards, and most importantly, the controls that will be applied to prevent those hazards from damaging equipment, injuring people, or worse.&lt;/p&gt;&lt;p&gt;One of the most critical concepts is the “hierarchy of controls” — that is, what controls should be applied to mitigate these hazards. In most practices, these are elimination, substitution, engineering, administration and personal protective equipment. Elimination and substitution are fairly self-explanatory: is there a different way to achieve this goal? Can we eliminate that task completely? Engineering and administration ask us whether there is additional engineering work, such as changing the placement of a panel, or using a horizontal boring machine to lay an underground pipe vs. opening up a trench that people can fall into.&lt;/p&gt;&lt;p&gt;The last and lowest on the hierarchy, is personal protective equipment (PPE). A hard hat can protect you from severe injury from something falling from above, but it’s a last resort, and it certainly isn’t guaranteed. In engineering practice, any hazard that &lt;i&gt;only&lt;/i&gt; lists PPE as a mitigating factor is unsatisfactory: there must be additional controls in place. For example, instead of only wearing a hard hat, we should &lt;i&gt;engineer&lt;/i&gt; the floor of scaffolding so that large objects (such as a wrench) cannot fall through in the first place. Further, if we require that all tools are attached to the wearer, then it significantly reduces the chance the tool can be dropped in the first place. These controls ensure that there are multiple degrees of mitigation — defense in depth — before your hard hat has to come into play.&lt;/p&gt;&lt;p&gt;Coming back to software, we can draw parallels between these controls: engineering can be likened to improving automation, gradual rollouts, and detailed metrics. Similarly, personal protective equipment can be likened to code review: useful, but code review cannot be the only thing protecting you from shipping bugs or untested code. Automation with linters, more robust testing, and new metrics are all vastly &lt;i&gt;safer&lt;/i&gt; ways of shipping software.&lt;/p&gt;&lt;p&gt;As we spent time assessing where to improve our existing controls and how to put new controls in place to mitigate risks and improve the reliability (safety) of Workers KV, we took a similar approach: eliminating unnecessary changes, engineering more resilience into our codebase, automation, deployment tooling, and only then looking at human processes.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;how-we-plan-to-get-better\&quot;&gt;How we plan to get better&lt;/h3&gt;\n            &lt;a href=\&quot;#how-we-plan-to-get-better\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Cloudflare is undertaking a larger, more structured review of KV&amp;#39;s observability tooling, release infrastructure and processes to mitigate not only the contributing factors to the incidents within this report, but recent incidents related to KV. Critically, we see tooling and automation as the most powerful mechanisms for preventing incidents, with process improvements designed to provide an additional layer of protection. Process improvements alone cannot be the only mitigation.&lt;/p&gt;&lt;p&gt;Specifically, we have identified and prioritized the below efforts as the most important next steps towards meeting our own availability SLOs, and (above all) make KV a service that customers building on Workers can rely on for storing configuration and service data in the hot path of their traffic:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;Substantially improve the existing observability tooling for unhandled exceptions, both for internal teams and customers building on Workers. This is especially critical for high-volume services, where traditional logging alone can be too noisy (and not specific enough) to aid in tracking down these cases. The existing ongoing work to land this will be prioritized further. In the meantime, we have directly addressed the specific uncaught exception with KV&amp;#39;s primary Worker script.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Improve the safety around the mutation of environmental variables in a Worker, which currently operate at &amp;quot;global&amp;quot; (per-isolate) scope, but can appear to be per-request. Mutating an environmental variable in request scope mutates the value for all requests transiting that same isolate (in a given location), which can be unexpected. Changes here will need to take backwards compatibility in mind.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Continue to expand KV’s test coverage to better address the above issues, in parallel with the aforementioned observability and tooling improvements, as an additional layer of defense. This includes allowing our test infrastructure to simulate traffic from any source data-center, which would have allowed us to more quickly reproduce the issue and identify a root cause.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Improvements to our release process, including how KV changes and releases are reviewed and approved, going forward. We will enforce a higher level of scrutiny for future changes, and where possible, reduce the number of changes deployed at once. This includes taking on new infrastructure dependencies, which will have a higher bar for both design and testing.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Additional logging improvements, including sampling, throughout our request handling process to improve troubleshooting &amp;amp; debugging. A significant amount of the challenge related to these incidents was due to the lack of logging around specific requests (especially non-2xx requests)&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Review and, where applicable, improve alerting thresholds surrounding error rates. As mentioned previously in this report, sub-% error rates at a global scale can have severe negative impact on specific users and/or locations: ensuring that errors are caught and not lost in the noise is an ongoing effort.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Address maturity issues with our progressive deployment tooling for Workers, which is net-new (and will eventually be exposed to customers directly).&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;This is not an exhaustive list: we&amp;#39;re continuing to expand on preventative measures associated with these and other incidents. These changes will not only improve KVs reliability, but other services across Cloudflare that KV relies on, or that rely on KV.&lt;/p&gt;&lt;p&gt;We recognize that KV hasn’t lived up to our customers’ expectations recently. Because we rely on KV so heavily internally, we’ve felt that pain first hand as well. The work to fix the issues that led to this cycle of incidents is already underway. That work will not only improve KV’s reliability but also improve the reliability of any software written on the Cloudflare Workers developer platform, whether by our customers or by ourselves.&lt;/p&gt;&quot;],&quot;published_at&quot;:[0,&quot;2023-08-02T14:05:42.000+01:00&quot;],&quot;updated_at&quot;:[0,&quot;2024-10-09T23:25:09.709Z&quot;],&quot;feature_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/5uVbbLtKhBx9TjD98Ny8f6/6dc4971948f03bad988250f7f812fec6/workers-kv-restoring-reliability.png&quot;],&quot;tags&quot;:[1,[[0,{&quot;id&quot;:[0,&quot;6hbkItfupogJP3aRDAq6v8&quot;],&quot;name&quot;:[0,&quot;Cloudflare Workers&quot;],&quot;slug&quot;:[0,&quot;workers&quot;]}],[0,{&quot;id&quot;:[0,&quot;6QVJOBzgKXUO9xAPEpqxvK&quot;],&quot;name&quot;:[0,&quot;Reliability&quot;],&quot;slug&quot;:[0,&quot;reliability&quot;]}],[0,{&quot;id&quot;:[0,&quot;3cCNoJJ5uusKFBLYKFX1jB&quot;],&quot;name&quot;:[0,&quot;Post Mortem&quot;],&quot;slug&quot;:[0,&quot;post-mortem&quot;]}],[0,{&quot;id&quot;:[0,&quot;4HIPcb68qM0e26fIxyfzwQ&quot;],&quot;name&quot;:[0,&quot;Developers&quot;],&quot;slug&quot;:[0,&quot;developers&quot;]}],[0,{&quot;id&quot;:[0,&quot;3JAY3z7p7An94s6ScuSQPf&quot;],&quot;name&quot;:[0,&quot;Developer Platform&quot;],&quot;slug&quot;:[0,&quot;developer-platform&quot;]}]]],&quot;relatedTags&quot;:[0],&quot;authors&quot;:[1,[[0,{&quot;name&quot;:[0,&quot;Matt Silverlock&quot;],&quot;slug&quot;:[0,&quot;silverlock&quot;],&quot;bio&quot;:[0,&quot;Director of Product at Cloudflare.&quot;],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/7xP5qePZD9eyVtwIesXYxh/e714aaa573161ec9eb48d59bd1aa6225/silverlock.jpeg&quot;],&quot;location&quot;:[0,null],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,&quot;@elithrar&quot;],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}],[0,{&quot;name&quot;:[0,&quot;Charles Burnett&quot;],&quot;slug&quot;:[0,&quot;charles&quot;],&quot;bio&quot;:[0,&quot;Product @ Cloudflare\nWorkers KV and Queues \nCustomer obsessed, developer at heart&quot;],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/6VtTqUbPMOE4KAAbkUFW1t/db851b54eefd66b754c56afb2a4b0bc2/charles.jpeg&quot;],&quot;location&quot;:[0,&quot;Charleston, SC&quot;],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,null],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}],[0,{&quot;name&quot;:[0,&quot;Rob Sutter&quot;],&quot;slug&quot;:[0,&quot;rob&quot;],&quot;bio&quot;:[0,null],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1r2dvD4G1iSv7nFKgpPkM8/8761e00579d18a125c994bb6fb93625b/rob.jpeg&quot;],&quot;location&quot;:[0,null],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,&quot;@rts_rob&quot;],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}],[0,{&quot;name&quot;:[0,&quot;Kris Evans&quot;],&quot;slug&quot;:[0,&quot;kris-evans&quot;],&quot;bio&quot;:[0,null],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/3lTRF3Io9Z4ejB4DM4XasI/13029949cc9a56fdcb152b48bfdb4617/kris-evans.jpeg&quot;],&quot;location&quot;:[0,&quot;Austin, TX&quot;],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,null],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}]]],&quot;meta_description&quot;:[0,&quot;A deep dive into the recent incidents relating to Workers KV, and how we’re going to fix them.&quot;],&quot;primary_author&quot;:[0,{}],&quot;localeList&quot;:[0,{&quot;name&quot;:[0,&quot;Hardening Workers KV Config&quot;],&quot;enUS&quot;:[0,&quot;English for Locale&quot;],&quot;zhCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhHansCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhTW&quot;:[0,&quot;No Page for Locale&quot;],&quot;frFR&quot;:[0,&quot;No Page for Locale&quot;],&quot;deDE&quot;:[0,&quot;No Page for Locale&quot;],&quot;itIT&quot;:[0,&quot;No Page for Locale&quot;],&quot;jaJP&quot;:[0,&quot;No Page for Locale&quot;],&quot;koKR&quot;:[0,&quot;No Page for Locale&quot;],&quot;ptBR&quot;:[0,&quot;No Page for Locale&quot;],&quot;esLA&quot;:[0,&quot;No Page for Locale&quot;],&quot;esES&quot;:[0,&quot;No Page for Locale&quot;],&quot;enAU&quot;:[0,&quot;No Page for Locale&quot;],&quot;enCA&quot;:[0,&quot;No Page for Locale&quot;],&quot;enIN&quot;:[0,&quot;No Page for Locale&quot;],&quot;enGB&quot;:[0,&quot;No Page for Locale&quot;],&quot;idID&quot;:[0,&quot;No Page for Locale&quot;],&quot;ruRU&quot;:[0,&quot;No Page for Locale&quot;],&quot;svSE&quot;:[0,&quot;No Page for Locale&quot;],&quot;viVN&quot;:[0,&quot;No Page for Locale&quot;],&quot;plPL&quot;:[0,&quot;No Page for Locale&quot;],&quot;arAR&quot;:[0,&quot;No Page for Locale&quot;],&quot;nlNL&quot;:[0,&quot;No Page for Locale&quot;],&quot;thTH&quot;:[0,&quot;No Page for Locale&quot;],&quot;trTR&quot;:[0,&quot;No Page for Locale&quot;],&quot;heIL&quot;:[0,&quot;No Page for Locale&quot;],&quot;lvLV&quot;:[0,&quot;No Page for Locale&quot;],&quot;etEE&quot;:[0,&quot;No Page for Locale&quot;],&quot;ltLT&quot;:[0,&quot;No Page for Locale&quot;]}],&quot;url&quot;:[0,&quot;https://blog.cloudflare.com/workers-kv-restoring-reliability&quot;],&quot;metadata&quot;:[0,{&quot;title&quot;:[0,&quot;Hardening Workers KV&quot;],&quot;description&quot;:[0,&quot;A deep dive into the recent incidents relating to Workers KV, and how we’re going to fix them.&quot;],&quot;imgPreview&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1TaOJzY1gZG5HhS7i2Ux87/dbb237ebaa890ac6f784ddc59f41e31d/workers-kv-restoring-reliability-96vEDZ.png&quot;]}],&quot;publicly_index&quot;:[0,true]}],[0,{&quot;id&quot;:[0,&quot;3ZlvMILKrfS2Z4IQ0qumTD&quot;],&quot;title&quot;:[0,&quot;Connection errors in Asia Pacific region on July 9, 2023&quot;],&quot;slug&quot;:[0,&quot;connection-errors-in-asia-pacific-region-on-july-9-2023&quot;],&quot;excerpt&quot;:[0,&quot;On July 9, 2023, users in the Asia Pacific region experienced connection errors due to origin DNS resolution failures to .com and .net TLD nameservers&quot;],&quot;featured&quot;:[0,false],&quot;html&quot;:[0,&quot;&lt;p&gt;&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/4XSclbffVsXyJvs6H28PzZ/8ca3e3e580eecf4e762af00eb94eb8d4/image2-5.png\&quot; alt=\&quot;Connection errors in Asia Pacific region on July 9, 2023\&quot; class=\&quot;kg-image\&quot; width=\&quot;1200\&quot; height=\&quot;675\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;On Sunday, July 9, 2023, early morning UTC time, we observed a high number of DNS resolution failures — up to 7% of all DNS queries across the Asia Pacific region — caused by invalid DNSSEC signatures from Verisign .com and .net Top Level Domain (TLD) nameservers. This resulted in connection errors for visitors of Internet properties on Cloudflare in the region.&lt;/p&gt;&lt;p&gt;The local instances of Verisign’s nameservers started to respond with expired DNSSEC signatures in the Asia Pacific region. In order to remediate the impact, we have rerouted upstream DNS queries towards Verisign to locations on the US west coast which are returning valid signatures.&lt;/p&gt;&lt;p&gt;We have already reached out to Verisign to get more information on the root cause. Until their issues have been resolved, we will keep our DNS traffic to .com and .net TLD nameservers rerouted, which might cause slightly increased latency for the first visitor to domains under .com and .net in the region.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;background\&quot;&gt;Background&lt;/h3&gt;\n            &lt;a href=\&quot;#background\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;In order to proxy a domain’s traffic through Cloudflare’s network, there are two components involved with respect to the Domain Name System (DNS) from the perspective of a Cloudflare data center: external DNS resolution, and upstream or origin DNS resolution.&lt;/p&gt;&lt;p&gt;To understand this, let’s look at the domain name &lt;code&gt;blog.cloudflare.com&lt;/code&gt; — which is proxied through Cloudflare’s network — and let’s assume it is configured to use &lt;code&gt;origin.example&lt;/code&gt; as the origin server:&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/5nnwNUFQmflIHHioGDISlg/250c388a2d796d0dc8139b4eddda6c05/image5-1.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1999\&quot; height=\&quot;124\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;Here, the external DNS resolution is the part where DNS queries to &lt;code&gt;blog.cloudflare.com&lt;/code&gt; sent by public resolvers like &lt;code&gt;1.1.1.1&lt;/code&gt; or &lt;code&gt;8.8.8.8&lt;/code&gt; on behalf of a visitor return a set of Cloudflare Anycast IP addresses. This ensures that the visitor’s browser knows where to send an HTTPS request to load the website. Under the hood your browser performs a DNS query that looks something like this (the trailing dot indicates the &lt;a href=\&quot;https://en.wikipedia.org/wiki/DNS_root_zone\&quot;&gt;DNS root zone&lt;/a&gt;):&lt;/p&gt;\n            &lt;pre class=\&quot;language-bash\&quot;&gt;&lt;code class=\&quot;language-bash\&quot;&gt;$ dig blog.cloudflare.com. +short\n104.18.28.7\n104.18.29.7&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;(Your computer doesn’t actually use the dig command internally; we’ve used it to illustrate the process) Then when the next closest Cloudflare data center receives the HTTPS request for blog.cloudflare.com, it needs to fetch the content from the origin server (assuming it is not cached).&lt;/p&gt;&lt;p&gt;There are two ways Cloudflare can reach the origin server. If the DNS settings in Cloudflare contain IP addresses then we can connect directly to the origin. In some cases, our customers use a CNAME which means Cloudflare has to perform another DNS query to get the IP addresses associated with the CNAME. In the example above, &lt;code&gt;blog.cloudflare.com&lt;/code&gt; has a CNAME record instructing us to look at &lt;code&gt;origin.example&lt;/code&gt; for IP addresses. During the incident, only customers with CNAME records like this going to .com and .net domain names may have been affected.&lt;/p&gt;&lt;p&gt;The domain &lt;code&gt;origin.example&lt;/code&gt; needs to be resolved by Cloudflare as part of the upstream or origin DNS resolution. This time, the Cloudflare data center needs to perform an outbound DNS query that looks like this:&lt;/p&gt;\n            &lt;pre class=\&quot;language-bash\&quot;&gt;&lt;code class=\&quot;language-bash\&quot;&gt;$ dig origin.example. +short\n192.0.2.1&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;DNS is a hierarchical protocol, so the recursive DNS resolver, which usually handles DNS resolution for whoever wants to resolve a &lt;a href=\&quot;https://www.cloudflare.com/learning/dns/glossary/what-is-a-domain-name/\&quot;&gt;domain name&lt;/a&gt;, needs to talk to several involved nameservers until it finally gets an answer from the authoritative nameservers of the domain (assuming no DNS responses are cached). This is the same process during the external DNS resolution and the origin DNS resolution. Here is an example for the origin DNS resolution:&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/7E1GLN7i8qGi3oB6Zentug/8b55136d3c67a79d0d9c711c428911b4/image6-1.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1165\&quot; height=\&quot;863\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;Inherently, DNS is a public system that was initially published without any means to validate the integrity of the DNS traffic. So in order to prevent someone from spoofing DNS responses, &lt;a href=\&quot;/dnssec-an-introduction/\&quot;&gt;DNS Security Extensions (DNSSEC)&lt;/a&gt; were introduced as a means to authenticate that DNS responses really come from who they claim to come from. This is achieved by generating cryptographic signatures alongside existing DNS records like A, AAAA, MX, CNAME, etc. By validating a DNS record’s associated signature, it is possible to verify that a requested DNS record really comes from its authoritative nameserver and wasn’t altered en-route. If a signature cannot be validated successfully, recursive resolvers usually return an error indicating the invalid signature. This is exactly what happened on Sunday.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;incident-timeline-and-impact\&quot;&gt;Incident timeline and impact&lt;/h3&gt;\n            &lt;a href=\&quot;#incident-timeline-and-impact\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;On Saturday, July 8, 2023, at 21:10 UTC our logs show the first instances of DNSSEC validation errors that happened during upstream DNS resolution from multiple Cloudflare data centers in the Asia Pacific region. It appeared DNS responses from the TLD nameservers of .com and .net of the type NSEC3 (a DNSSEC mechanism to &lt;a href=\&quot;/black-lies/\&quot;&gt;prove non-existing DNS records&lt;/a&gt;) included invalid signatures. About an hour later at 22:16 UTC, the first internal alerts went off (since it required issues to be consistent over a certain period of time), but error rates were still at a level at around 0.5% of all upstream DNS queries.&lt;/p&gt;&lt;p&gt;After several hours, the error rate had increased to a point in which ~13% of our upstream DNS queries in affected locations were failing. This percentage continued to fluctuate over the duration of the incident between the ranges of 10-15% of upstream DNS queries, and roughly 5-7% of all DNS queries (external &amp;amp; upstream resolution) to affected Cloudflare data centers in the Asia Pacific region.&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/acWvj718KdxYfGx33fBZT/7ee25b63cf83ee9ff18e6734aeb1cc3e/image1-6.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1636\&quot; height=\&quot;902\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;Initially it appeared as though only a single upstream nameserver was having issues with DNS resolution, however upon further investigation it was discovered that the issue was more widespread. Ultimately, we were able to verify that the Verisign nameservers for .com and .net were returning expired DNSSEC signatures on a portion of DNS queries in the Asia Pacific region. Based on our tests, other nameserver locations were correctly returning valid DNSSEC signatures.&lt;/p&gt;&lt;p&gt;In response, we rerouted our DNS traffic to the .com and .net TLD nameserver IP addresses to Verisign’s US west locations. After this change was propagated, the issue very quickly subsided and origin resolution error rates returned to normal levels.&lt;/p&gt;&lt;p&gt;All times are in UTC:&lt;/p&gt;&lt;p&gt;&lt;b&gt;2023-07-08 21:10&lt;/b&gt; First instances of DNSSEC validation errors appear in our logs for origin DNS resolution.&lt;/p&gt;&lt;p&gt;&lt;b&gt;2023-07-08 22:16&lt;/b&gt; First internal alerts for Asia Pacific data centers go off indicating origin DNS resolution error on our test domain. Very few errors for other domains at this point.&lt;/p&gt;&lt;p&gt;&lt;b&gt;2023-07-09 02:58&lt;/b&gt; Error rates have increased substantially since the first instance. An incident is declared.&lt;/p&gt;&lt;p&gt;&lt;b&gt;2023-07-09 03:28&lt;/b&gt; DNSSEC validation issues seem to be isolated to a single upstream provider. It is not abnormal that a single upstream has issues that propagate back to us, and in this case our logs were predominantly showing errors from domains that resolve to this specific upstream.&lt;/p&gt;&lt;p&gt;&lt;b&gt;2023-07-09 04:52&lt;/b&gt; We realize that DNSSEC validation issues are more widespread and affect multiple .com and .net domains. Validation issues continue to be isolated to the Asia Pacific region only, and appear to be intermittent.&lt;/p&gt;&lt;p&gt;&lt;b&gt;2023-07-09 05:15&lt;/b&gt; DNS queries via popular recursive resolvers like 8.8.8.8 and 1.1.1.1 do not return invalid DNSSEC signatures at this point. DNS queries using the local stub resolver continue to return DNSSEC errors.&lt;/p&gt;&lt;p&gt;&lt;b&gt;2023-07-09 06:24&lt;/b&gt; Responses from .com and .net Verisign nameservers in Singapore contain expired DNSSEC signatures, but responses from Verisign TLD nameservers in other locations are fine.&lt;/p&gt;&lt;p&gt;&lt;b&gt;2023-07-09 06:41&lt;/b&gt; We contact Verisign and notify them about expired DNSSEC signatures.&lt;/p&gt;&lt;p&gt;&lt;b&gt;2023-07-09 06:50&lt;/b&gt; In order to remediate the impact, we reroute DNS traffic via IPv4 for the .com and .net Verisign nameserver IPs to US west IPs instead. This immediately leads to a substantial drop in the error rate.&lt;/p&gt;&lt;p&gt;&lt;b&gt;2023-07-09 07:06&lt;/b&gt; We also reroute DNS traffic via IPv6 for the .com and .net Verisign nameserver IPs to US west IPs. This leads to the error rate going down to zero.&lt;/p&gt;&lt;p&gt;&lt;b&gt;2023-07-10 09:23&lt;/b&gt; The rerouting is still in place, but the underlying issue with expired signatures in the Asia Pacific region has still not been resolved.&lt;/p&gt;&lt;p&gt;&lt;b&gt;2023-07-10 18:23&lt;/b&gt; Verisign gets back to us confirming that they “were serving stale data” at their local site and have resolved the issues.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;technical-description-of-the-error-and-how-it-happened\&quot;&gt;Technical description of the error and how it happened&lt;/h3&gt;\n            &lt;a href=\&quot;#technical-description-of-the-error-and-how-it-happened\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;As mentioned in the introduction, the underlying cause for this incident was expired DNSSEC signatures for .net and .com zones. Expired DNSSEC signatures will cause a DNS response to be interpreted as invalid. There are two main scenarios in which this error was observed by a user:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;&lt;p&gt;&lt;a href=\&quot;https://developers.cloudflare.com/dns/cname-flattening/\&quot;&gt;CNAME flattening&lt;/a&gt; for external DNS resolution. This is when our authoritative nameservers attempt to return the IP address(es) that a CNAME record target resolves to rather than the CNAME record itself.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;CNAME target lookup for origin DNS resolution. This is most commonly used when an HTTPS request is sent to a Cloudflare anycast IP address, and we need to determine what IP address to forward the request to. See &lt;a href=\&quot;https://developers.cloudflare.com/fundamentals/get-started/concepts/how-cloudflare-works/\&quot;&gt;How Cloudflare works&lt;/a&gt; for more details.&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;In both cases, behind the scenes the DNS query goes through an in-house recursive DNS resolver in order to lookup what a hostname resolves to. The purpose of this resolver is to cache queries, optimize future queries and provide DNSSEC validation. If the query from this resolver fails for whatever reason, our authoritative DNS system will not be able to perform the two scenarios outlined above.&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/5qE0JFXaLHPwt3orOsNBm5/37d2d34d396d4cc4c2a22b7241e4120f/image3-1.png\&quot; alt=\&quot;If the query from this resolver fails for whatever reason, our authoritative DNS system will not be able to perform the two scenarios outlined above.\&quot; class=\&quot;kg-image\&quot; width=\&quot;1999\&quot; height=\&quot;935\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;During the incident, the recursive resolver was failing to validate the DNSSEC signatures in DNS responses for domains ending in .com and .net. These signatures are sent in the form of an RRSIG record alongside the other DNS records they cover. Together they form a Resource Record set (RRset). Each RRSIG has the corresponding fields:&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/3aZjsnpM6WSE70sPrnkHbr/6af366bd2accafc3f06296e241ceaba5/image4.png\&quot; alt=\&quot;As you can see, the main part of the payload is associated with the signature and its corresponding metadata. Each recursive resolver is responsible for not only checking the signature but also the expiration time of the signature. It is important to obey the expiration time in order to avoid returning responses for RRsets that have been signed by old keys, which could have potentially been compromised by that time.\&quot; class=\&quot;kg-image\&quot; width=\&quot;1999\&quot; height=\&quot;565\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;As you can see, the main part of the payload is associated with the signature and its corresponding metadata. Each recursive resolver is responsible for not only checking the signature but also the expiration time of the signature. It is important to obey the expiration time in order to avoid returning responses for RRsets that have been signed by old keys, which could have potentially been compromised by that time.&lt;/p&gt;&lt;p&gt;During this incident, Verisign, the authoritative operator for the .com and .net TLD zones, was occasionally returning expired signatures in its DNS responses in the Asia Pacific region. As a result our recursive resolver was not able to validate the corresponding RRset. Ultimately this meant that a percentage of DNS queries would return SERVFAIL as response code to our authoritative nameserver. This in turn caused connection issues for users trying to connect to a domain on Cloudflare, because we weren&amp;#39;t able to resolve the upstream target of affected domain names and thus didn’t know where to send proxied HTTPS requests to upstream servers.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;remediation-and-follow-up-steps\&quot;&gt;Remediation and follow-up steps&lt;/h3&gt;\n            &lt;a href=\&quot;#remediation-and-follow-up-steps\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Once we had identified the root cause we started to look at different ways to remedy the issue. We came to the conclusion that the fastest way to work around this very regionalized issue was to stop using the local route to Verisign&amp;#39;s nameservers. This means that, at the time of writing this, our outgoing DNS traffic towards Verisign&amp;#39;s nameservers in the Asia Pacific region now traverses the Pacific and ends up at the US west coast, rather than being served by closer nameservers. Due to the nature of DNS and the important role of DNS caching, this has less impact than you might initially expect. Frequently looked up names will be cached after the first request, and this only needs to happen once per data center, as we share and pool the local DNS recursor caches to maximize their efficiency.&lt;/p&gt;&lt;p&gt;Ideally, we would have been able to fix the issue right away as it potentially affected others in the region too, not just our customers. We will therefore work diligently to improve our incident communications channels with other providers in order to ensure that the DNS ecosystem remains robust against issues such as this. Being able to quickly get hold of other providers that can take action is vital when urgent issues like these arise.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;conclusion\&quot;&gt;Conclusion&lt;/h3&gt;\n            &lt;a href=\&quot;#conclusion\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;This incident &lt;a href=\&quot;/october-2021-facebook-outage/\&quot;&gt;once again&lt;/a&gt; shows how impactful DNS failures are and how crucial this technology is for the Internet. We will investigate how we can improve our systems to detect and resolve issues like this more efficiently and quickly if they occur again in the future.&lt;/p&gt;&lt;p&gt;While Cloudflare was not the cause of this issue, and we are certain that we were not the only ones affected by this, we are still sorry for the disruption to our customers and to all the users who were unable to access Internet properties during this incident.&lt;/p&gt;&lt;p&gt;&lt;b&gt;Update&lt;/b&gt;: On Tue Jul 11 22:24:21 UTC 2023_,_ Verisign posted an &lt;a href=\&quot;https://lists.dns-oarc.net/pipermail/dns-operations/2023-July/022174.html\&quot;&gt;announcement&lt;/a&gt;, providing more details:&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;&lt;i&gt;Last week, during a migration of one of our DNS resolution sites in Singapore, from one provider to another, we unexpectedly lost management access and the ability to deliver changes and DNS updates to the site. Following our standard procedure, we disabled all transit links to the affected site. Unfortunately, a peering router remained active, which was not immediately obvious to our teams due to the lack of connectivity there.&lt;/i&gt;&lt;/p&gt;&lt;/blockquote&gt;&lt;blockquote&gt;&lt;p&gt;&lt;i&gt;Over the weekend, this caused an issue that may have affected the ability of some internet users in the region to reach some .com and .net domains, as DNSSEC signatures on the site began expiring. The issue was resolved by powering off the site’s peering router, causing the anycast route announcement to be withdrawn and traffic to be directed to other sites.&lt;/i&gt;&lt;/p&gt;&lt;/blockquote&gt;&lt;blockquote&gt;&lt;p&gt;&lt;i&gt;We are updating our processes and procedures and will work to prevent such issues from recurring in the future.&lt;/i&gt;&lt;/p&gt;&lt;/blockquote&gt;&lt;blockquote&gt;&lt;p&gt;&lt;i&gt;The Singapore site is part of a highly redundant constellation of more than 200 sites that make up our global network. This issue had no effect on the core resolution of .com and .net resolution globally. We apologize to those who may have been affected.&lt;/i&gt;&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;&lt;/p&gt;&quot;],&quot;published_at&quot;:[0,&quot;2023-07-11T09:48:13.000+01:00&quot;],&quot;updated_at&quot;:[0,&quot;2024-11-21T08:28:37.556Z&quot;],&quot;feature_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1T0UIT1td3ggd2uDNoNmG6/32ba6091898b0d0ddee4fd6359349738/connection-errors-in-asia-pacific-region-on-july-9-2023.png&quot;],&quot;tags&quot;:[1,[[0,{&quot;id&quot;:[0,&quot;5fZHv2k9HnJ7phOPmYexHw&quot;],&quot;name&quot;:[0,&quot;DNS&quot;],&quot;slug&quot;:[0,&quot;dns&quot;]}],[0,{&quot;id&quot;:[0,&quot;5GwDZZTEDK1ZYAHNV31ygs&quot;],&quot;name&quot;:[0,&quot;DNSSEC&quot;],&quot;slug&quot;:[0,&quot;dnssec&quot;]}],[0,{&quot;id&quot;:[0,&quot;4yliZlpBPZpOwBDZzo1tTh&quot;],&quot;name&quot;:[0,&quot;Outage&quot;],&quot;slug&quot;:[0,&quot;outage&quot;]}],[0,{&quot;id&quot;:[0,&quot;3cCNoJJ5uusKFBLYKFX1jB&quot;],&quot;name&quot;:[0,&quot;Post Mortem&quot;],&quot;slug&quot;:[0,&quot;post-mortem&quot;]}]]],&quot;relatedTags&quot;:[0],&quot;authors&quot;:[1,[[0,{&quot;name&quot;:[0,&quot;Christian Elmerot&quot;],&quot;slug&quot;:[0,&quot;christian-elmerot&quot;],&quot;bio&quot;:[0,null],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/4zPndIfCPap7qoWuJNmDoX/63df26a703148859945848d9c3505b5d/christian-elmerot.png&quot;],&quot;location&quot;:[0,null],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,&quot;@Chreo&quot;],&quot;facebook&quot;:[0,&quot;christian.elmerot&quot;],&quot;publiclyIndex&quot;:[0,true]}],[0,{&quot;name&quot;:[0,&quot;Alex Fattouche&quot;],&quot;slug&quot;:[0,&quot;alex-fattouche&quot;],&quot;bio&quot;:[0,null],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/6yn7x5vl3Mx87V0s83LuNG/5182b3647a30ee4fc326a877997ad3d1/alex-fattouche.png&quot;],&quot;location&quot;:[0,null],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,null],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}],[0,{&quot;name&quot;:[0,&quot;Hannes Gerhart&quot;],&quot;slug&quot;:[0,&quot;hannes&quot;],&quot;bio&quot;:[0,null],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/4NLFewzqaiZmAizzu5u0wA/1552ecba4be976c9c2cde1ad4ea1ffc2/hannes.jpg&quot;],&quot;location&quot;:[0,&quot;Berlin, Germany&quot;],&quot;website&quot;:[0,&quot;https://linkedin.com/in/hannesgerhart&quot;],&quot;twitter&quot;:[0,null],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}]]],&quot;meta_description&quot;:[0,&quot;On July 9, 2023, users in the Asia Pacific region experienced connection errors due to origin DNS resolution failures to .com and .net TLD nameservers.&quot;],&quot;primary_author&quot;:[0,{}],&quot;localeList&quot;:[0,{&quot;name&quot;:[0,&quot;Connection errors in Asia Pacific region on July 9, 2023 Config&quot;],&quot;enUS&quot;:[0,&quot;English for Locale&quot;],&quot;zhCN&quot;:[0,&quot;Translated for Locale&quot;],&quot;zhHansCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhTW&quot;:[0,&quot;Translated for Locale&quot;],&quot;frFR&quot;:[0,&quot;No Page for Locale&quot;],&quot;deDE&quot;:[0,&quot;No Page for Locale&quot;],&quot;itIT&quot;:[0,&quot;No Page for Locale&quot;],&quot;jaJP&quot;:[0,&quot;Translated for Locale&quot;],&quot;koKR&quot;:[0,&quot;Translated for Locale&quot;],&quot;ptBR&quot;:[0,&quot;No Page for Locale&quot;],&quot;esLA&quot;:[0,&quot;No Page for Locale&quot;],&quot;esES&quot;:[0,&quot;No Page for Locale&quot;],&quot;enAU&quot;:[0,&quot;No Page for Locale&quot;],&quot;enCA&quot;:[0,&quot;No Page for Locale&quot;],&quot;enIN&quot;:[0,&quot;No Page for Locale&quot;],&quot;enGB&quot;:[0,&quot;No Page for Locale&quot;],&quot;idID&quot;:[0,&quot;No Page for Locale&quot;],&quot;ruRU&quot;:[0,&quot;No Page for Locale&quot;],&quot;svSE&quot;:[0,&quot;No Page for Locale&quot;],&quot;viVN&quot;:[0,&quot;No Page for Locale&quot;],&quot;plPL&quot;:[0,&quot;No Page for Locale&quot;],&quot;arAR&quot;:[0,&quot;No Page for Locale&quot;],&quot;nlNL&quot;:[0,&quot;No Page for Locale&quot;],&quot;thTH&quot;:[0,&quot;No Page for Locale&quot;],&quot;trTR&quot;:[0,&quot;No Page for Locale&quot;],&quot;heIL&quot;:[0,&quot;No Page for Locale&quot;],&quot;lvLV&quot;:[0,&quot;No Page for Locale&quot;],&quot;etEE&quot;:[0,&quot;No Page for Locale&quot;],&quot;ltLT&quot;:[0,&quot;No Page for Locale&quot;]}],&quot;url&quot;:[0,&quot;https://blog.cloudflare.com/connection-errors-in-asia-pacific-region-on-july-9-2023&quot;],&quot;metadata&quot;:[0,{&quot;title&quot;:[0,&quot;Connection errors in Asia Pacific region on July 9, 2023&quot;],&quot;description&quot;:[0,&quot;On July 9, 2023, users in the Asia Pacific region experienced connection errors due to origin DNS resolution failures to .com and .net TLD nameservers.&quot;],&quot;imgPreview&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1pkBFl3fjT7vumreRezUga/ec2da95dc3ea4dcb86abcebb88381777/connection-errors-in-asia-pacific-region-on-july-9-2023-PwONqt.png&quot;]}],&quot;publicly_index&quot;:[0,true]}],[0,{&quot;id&quot;:[0,&quot;3tE10kRNsnz600OfoztFNP&quot;],&quot;title&quot;:[0,&quot;Cloudflare incident on January 24, 2023&quot;],&quot;slug&quot;:[0,&quot;cloudflare-incident-on-january-24th-2023&quot;],&quot;excerpt&quot;:[0,&quot;Several Cloudflare services became unavailable for 121 minutes on January 24th, 2023 due to an error releasing code that manages service tokens. The incident degraded a wide range of Cloudflare products&quot;],&quot;featured&quot;:[0,false],&quot;html&quot;:[0,&quot;&lt;p&gt;&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/3JPzbkSERlYNUYIRem6tHA/905f3e05ada5ff76c9b9e1cfa8594a19/Disruption.png\&quot; alt=\&quot;Cloudflare incident on January 24, 2023\&quot; class=\&quot;kg-image\&quot; width=\&quot;1200\&quot; height=\&quot;675\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;Several Cloudflare services became unavailable for 121 minutes on January 24, 2023 due to an error releasing code that manages service tokens. The incident degraded a wide range of Cloudflare products including aspects of our Workers platform, our &lt;a href=\&quot;https://www.cloudflare.com/learning/security/glossary/what-is-zero-trust/\&quot;&gt;Zero Trust solution&lt;/a&gt;, and control plane functions in our content delivery network (CDN).&lt;/p&gt;&lt;p&gt;Cloudflare provides a &lt;a href=\&quot;https://developers.cloudflare.com/cloudflare-one/identity/service-tokens/\&quot;&gt;service token functionality&lt;/a&gt; to allow automated services to authenticate to other services. Customers can use service tokens to secure the interaction between an application running in a data center and a resource in a public cloud provider, for example. As part of the release, we intended to introduce a feature that showed administrators the time that a token was last used, giving users the ability to safely clean up unused tokens. The change inadvertently overwrote other metadata about the service tokens and rendered the tokens of impacted accounts invalid for the duration of the incident.&lt;/p&gt;&lt;p&gt;The reason this release affected other services is due to the fact that Cloudflare runs on Cloudflare. Service tokens impact the ability for accounts to authenticate, and two of the impacted accounts power multiple Cloudflare services. When these accounts’ service tokens were overwritten, the services that run on these accounts began to experience failed requests and other unexpected errors.&lt;/p&gt;&lt;p&gt;Although a limited segment of customers and end users were directly affected by this incident and other customers may have experienced service degradation, the overall impact on Cloudflare’s network and services was not substantial. Nevertheless, we know the impact to the customers that were affected was painful. We’re documenting what went wrong so that you can understand why this happened and the steps we are taking to prevent this from occurring again.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;what-is-a-service-token\&quot;&gt;What is a service token?&lt;/h3&gt;\n            &lt;a href=\&quot;#what-is-a-service-token\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;When users log into an application or identity provider, they typically input a username and a password. The password allows that user to demonstrate that they are in control of the username and that the service should allow them to proceed. Layers of additional authentication can be added, like hard keys or device posture, but the workflow consists of a human proving they are who they say they are to a service.&lt;/p&gt;&lt;p&gt;However, humans are not the only users that need to authenticate to a service. Applications frequently need to talk to other applications. For example, imagine you build an application that shows a user information about their upcoming travel plans.&lt;/p&gt;&lt;p&gt;The airline holds details about the flight and its duration in their own system. They do not want to make the details of every individual trip public on the Internet, and they do not want to invite your application into their private network. Likewise, the hotel wants to make sure that they only send details of a room booking to a valid, approved third party service.&lt;/p&gt;&lt;p&gt;Your application needs a trusted way to authenticate with those external systems. Service tokens solve this problem by functioning as a kind of username and password for your service. Like usernames and passwords, service tokens come in two parts: a Client ID and a Client Secret. Both the ID and Secret must be sent with a request for authentication. Tokens are also assigned a duration, after which they become invalid and must be rotated. You can grant your application a service token and, if the upstream systems you need validate it, your service can grab airline and hotel information and present it to the end user in a joint report.&lt;/p&gt;&lt;p&gt;When administrators create Cloudflare service tokens, we generate the Client ID and the Client Secret pair. Customers can then configure their requesting services to send both values as HTTP headers when they need to reach a protected resource. The requesting service can run in any environment, including inside of Cloudflare’s network in the form of a &lt;a href=\&quot;https://workers.cloudflare.com/\&quot;&gt;Worker&lt;/a&gt; or in a separate location like a public cloud provider. Customers need to deploy the corresponding protected resource behind Cloudflare’s reverse proxy. Our network checks every request bound for a configured service for the HTTP headers. If present, Cloudflare validates their authenticity and either blocks the request or allows it to proceed. We also log the authentication event.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;incident-timeline\&quot;&gt;Incident Timeline&lt;/h3&gt;\n            &lt;a href=\&quot;#incident-timeline\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;&lt;i&gt;All Timestamps are UTC&lt;/i&gt;&lt;/p&gt;&lt;p&gt;At 2023-01-24 16:55 the Access engineering team initiated the release that inadvertently began to overwrite service token metadata, causing the incident.&lt;/p&gt;&lt;p&gt;At 2023-01-24 17:05 a member of the Access engineering team noticed an unrelated issue and rolled back the release which stopped any further overwrites of service token metadata.&lt;/p&gt;&lt;p&gt;Service token values are not updated across Cloudflare’s network until the service token itself is updated (more details below). This caused a staggered impact of the service token’s that had their metadata overwritten.&lt;/p&gt;&lt;p&gt;2023-01-24 17:50: The first invalid service token for Cloudflare WARP was synced to our global network. &lt;b&gt;Impact began for WARP and Zero Trust users.&lt;/b&gt;&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/7dyvv4PuLisXrl4fuvmj6A/c047190855c2406dc9640a5aee2abc84/Group-1.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;903\&quot; height=\&quot;339\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;WARP device posture uploads dropped to zero which raised an internal alert&lt;/p&gt;&lt;p&gt;At 2023-01-24 18:12 an incident was declared due to the large drop in successful WARP device posture uploads.&lt;/p&gt;&lt;p&gt;2023-01-24 18:19: The first invalid service token for the Cloudflare API was synced to our global network. &lt;b&gt;Impact began for Cache Purge, Cache Reserve, Images and R2.&lt;/b&gt; Alerts were triggered for these products which identified a larger scope of the incident.&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/4yduPwUxIs2g3oO8ebjPxX/d86e78fcd25b6e84cf430e450f736a4b/2-4.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1600\&quot; height=\&quot;815\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;At 2023-01-24 18:21 the overwritten services tokens were discovered during the initial investigation.&lt;/p&gt;&lt;p&gt;At 2023-01-24 18:28 the incident was elevated to include all impacted products.&lt;/p&gt;&lt;p&gt;At 2023-01-24 18:51 An initial solution was identified and implemented to revert the service token to its original value for the Cloudflare WARP account, impacting WARP and Zero Trust. &lt;b&gt;Impact ended for WARP and Zero Trust.&lt;/b&gt;&lt;/p&gt;&lt;p&gt;At 2023-01-24 18:56 The same solution was implemented on the Cloudflare API account, impacting Cache Purge, Cache Reserve, Images and R2. &lt;b&gt;Impact ended for Cache Purge, Cache Reserve, Images and R2.&lt;/b&gt;&lt;/p&gt;&lt;p&gt;At 2023-01-24 19:00 An update was made to the Cloudflare API account which incorrectly overwrote the Cloudflare API account. &lt;b&gt;Impact restarted for Cache Purge, Cache Reserve, Images and R2.&lt;/b&gt; All internal Cloudflare account changes were then locked until incident resolution.&lt;/p&gt;&lt;p&gt;At 2023-01-24 19:07 the Cloudflare API was updated to include the correct service token value. &lt;b&gt;Impact ended for Cache Purge, Cache Reserve, Images and R2.&lt;/b&gt;&lt;/p&gt;&lt;p&gt;At 2023-01-24 19:51 all affected accounts had their service tokens restored from a database backup. &lt;b&gt;Incident Ends.&lt;/b&gt;&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;what-was-released-and-how-did-it-break\&quot;&gt;What was released and how did it break?&lt;/h2&gt;\n            &lt;a href=\&quot;#what-was-released-and-how-did-it-break\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;The Access team was rolling out a new change to service tokens that added a “Last seen at” field. This was a popular feature request to help identify which service tokens were actively in use.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;what-went-wrong\&quot;&gt;What went wrong?&lt;/h3&gt;\n            &lt;a href=\&quot;#what-went-wrong\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;The “last seen at” value was derived by scanning all new login events in an account’s login event Kafka queue. If a login event using a service token was detected, an update to the corresponding service token’s last seen value was initiated.&lt;/p&gt;&lt;p&gt;In order to update the service token’s “last seen at” value a read write transaction is made to collect the information about the corresponding service token. Service token read requests redact the “client secret” value by default for security reasons. The “last seen at” update to the service token then used that information from the read did not include the “client secret” and updated the service token with an empty “client secret” on the write.&lt;/p&gt;&lt;p&gt;An example of the correct and incorrect service token values shown below:&lt;/p&gt;&lt;p&gt;&lt;b&gt;Example Access Service Token values&lt;/b&gt;&lt;/p&gt;\n            &lt;pre class=\&quot;language-bash\&quot;&gt;&lt;code class=\&quot;language-bash\&quot;&gt;{\n  &amp;quot;1a4ddc9e-a1234-4acc-a623-7e775e579c87&amp;quot;: {\n    &amp;quot;client_id&amp;quot;: &amp;quot;6b12308372690a99277e970a3039343c.access&amp;quot;,\n    &amp;quot;client_secret&amp;quot;: &amp;quot;&amp;lt;hashed-value&amp;gt;&amp;quot;, &amp;lt;-- what you would expect\n    &amp;quot;expires_at&amp;quot;: 1698331351\n  },\n  &amp;quot;23ade6c6-a123-4747-818a-cd7c20c83d15&amp;quot;: {\n    &amp;quot;client_id&amp;quot;: &amp;quot;1ab44976dbbbdadc6d3e16453c096b00.access&amp;quot;,\n    &amp;quot;client_secret&amp;quot;: &amp;quot;&amp;quot;, &amp;lt;--- this is the problem\n    &amp;quot;expires_at&amp;quot;: 1670621577\n  }\n}&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;The service token “client secret” database did have a “not null” check however in this situation an empty text string did not trigger as a null value.&lt;/p&gt;&lt;p&gt;As a result of the bug, any Cloudflare account that used a service token to authenticate during the 10 minutes “last seen at” release was out would have its “client secret” value set to an empty string. The service token then needed to be modified in order for the empty “client secret” to be used for authentication. There were a total of 4 accounts in this state, all of which are internal to Cloudflare.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;how-did-we-fix-the-issue\&quot;&gt;How did we fix the issue?&lt;/h3&gt;\n            &lt;a href=\&quot;#how-did-we-fix-the-issue\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;As a temporary solution, we were able to manually restore the correct service token values for the accounts with overwritten service tokens. This stopped the immediate impact across the affected Cloudflare services.&lt;/p&gt;&lt;p&gt;The database team was then able to implement a solution to restore the service tokens of all impacted accounts from an older database copy. This concluded any impact from this incident.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;why-did-this-impact-other-cloudflare-services\&quot;&gt;Why did this impact other Cloudflare services?&lt;/h3&gt;\n            &lt;a href=\&quot;#why-did-this-impact-other-cloudflare-services\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Service tokens impact the ability for accounts to authenticate. Two of the impacted accounts power multiple Cloudflare services. When these accounts’ services tokens were overwritten, the services that run on these accounts began to experience failed requests and other unexpected errors.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;cloudflare-warp-enrollment\&quot;&gt;Cloudflare WARP enrollment&lt;/h3&gt;\n            &lt;a href=\&quot;#cloudflare-warp-enrollment\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Cloudflare provides a mobile and desktop forward proxy, &lt;a href=\&quot;https://1.1.1.1/\&quot;&gt;Cloudflare WARP&lt;/a&gt; (our “1.1.1.1” app), that any user can install on a device to improve the privacy of their Internet traffic. Any individual can install this service without the need for a Cloudflare account and we do not retain logs that map activity to a user.&lt;/p&gt;&lt;p&gt;When a user connects using WARP, Cloudflare validates the enrollment of a device by relying on a service that receives and validates the keys on the device. In turn, that service communicates with another system that tells our network to provide the newly enrolled device with access to our network&lt;/p&gt;&lt;p&gt;During the incident, the enrollment service could no longer communicate with systems in our network that would validate the device. As a result, users could no longer register new devices and/or install the app on a new device, and may have experienced issues upgrading to a new version of the app (which also triggers re-registration).&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;cloudflare-zero-trust-device-posture-and-re-auth-policies\&quot;&gt;Cloudflare Zero Trust device posture and re-auth policies&lt;/h3&gt;\n            &lt;a href=\&quot;#cloudflare-zero-trust-device-posture-and-re-auth-policies\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Cloudflare provides a comprehensive Zero Trust solution that customers can deploy with or without an agent living on the device. Some use cases are only available when using the Cloudflare agent on the device. The agent is an enterprise version of the same Cloudflare WARP solution and experienced similar degradation anytime the agent needed to send or receive device state. This impacted three use cases in Cloudflare Zero Trust.&lt;/p&gt;&lt;p&gt;First, similar to the consumer product, new devices could not be enrolled and existing devices could not be revoked. Administrators were also unable to modify settings of enrolled devices.. In all cases errors would have been presented to the user.&lt;/p&gt;&lt;p&gt;Second, many customers who replace their existing private network with Cloudflare’s Zero Trust solution may add rules that continually validate a user’s identity through the use of session duration policies. The goal of these rules is to enforce users to reauthenticate in order to prevent stale sessions from having ongoing access to internal systems. The agent on the device prompts the user to reauthenticate based on signals from Cloudflare’s control plane. During the incident, the signals were not sent and users could not successfully reauthenticate.&lt;/p&gt;&lt;p&gt;Finally, customers who rely on device posture rules also experienced impact. &lt;a href=\&quot;https://developers.cloudflare.com/cloudflare-one/identity/devices/\&quot;&gt;Device posture rules&lt;/a&gt; allow customers who use Access or Gateway policies to rely on the WARP agent to continually enforce that a device meets corporate compliance rules.&lt;/p&gt;&lt;p&gt;The agent communicates these signals to a Cloudflare service responsible for maintaining the state of the device. Cloudflare’s Zero Trust access control product uses a service token to receive this signal and evaluate it along with other rules to determine if a user can access a given resource. During this incident those rules defaulted to a block action, meaning that traffic modified by these policies would appear broken to the user. In some cases this meant that all Internet bound traffic from a device was completely blocked leaving users unable to access anything.&lt;/p&gt;&lt;p&gt;Cloudflare Gateway caches the device posture state for users every 5 minutes to apply Gateway policies. The device posture state is cached so Gateway can apply policies without having to verify device state on every request. Depending on which Gateway policy type was matched, the user would experience two different outcomes. If they matched a network policy the user would experience a dropped connection and for an HTTP policy they would see a 5XX error page. We peaked at over 50,000 5XX errors/minute over baseline and had over 10.5 million posture read errors until the incident was resolved.&lt;/p&gt;&lt;p&gt;&lt;b&gt;Gateway 5XX errors per minute&lt;/b&gt;&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/4Fsk0lJWSO2YeGOlKIEEmZ/02808054f2934348741656512a80e809/3-4.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1600\&quot; height=\&quot;1336\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;&lt;b&gt;Total count of Gateway Device posture errors&lt;/b&gt;&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/71QxP96PCuCDObTVdJ5dde/6bc1a0c7ec2036e7c62d95608d6c54b9/4-4.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1600\&quot; height=\&quot;1202\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;cloudflare-r2-storage-and-cache-reserve\&quot;&gt;Cloudflare R2 Storage and Cache Reserve&lt;/h3&gt;\n            &lt;a href=\&quot;#cloudflare-r2-storage-and-cache-reserve\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;&lt;a href=\&quot;/r2-ga/\&quot;&gt;Cloudflare R2 Storage&lt;/a&gt; allows developers to store large amounts of unstructured data without the costly egress bandwidth fees associated with typical cloud storage services.&lt;/p&gt;&lt;p&gt;During the incident, the R2 service was unable to make outbound API requests to other parts of the Cloudflare infrastructure. As a result, R2 users saw elevated request failure rates when making requests to R2.  &lt;/p&gt;&lt;p&gt;Many Cloudflare products also depend on R2 for data storage and were also affected. For example, Cache Reserve users were impacted during this window and saw increased origin load for any items not in the primary cache. The majority of read and write operations to the Cache Reserve service were impacted during this incident causing entries into and out of Cache Reserve to fail. However, when Cache Reserve sees an R2 error, it falls back to the customer origin, so user traffic was still serviced during this period.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;cloudflare-cache-purge\&quot;&gt;Cloudflare Cache Purge&lt;/h3&gt;\n            &lt;a href=\&quot;#cloudflare-cache-purge\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Cloudflare’s content delivery network (CDN) caches the content of Internet properties on our network in our data centers around the world to reduce the distance that a user’s request needs to travel for a response. In some cases, customers want to purge what we cache and replace it with different data.&lt;/p&gt;&lt;p&gt;The Cloudflare control plane, the place where an administrator interacts with our network, uses a service token to authenticate and reach the cache purge service. During the incident, many purge requests failed while the service token was invalid. We saw an average impact of 20 purge requests/second failing and a maximum of 70 requests/second.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;what-are-we-doing-to-prevent-this-from-happening-again\&quot;&gt;What are we doing to prevent this from happening again?&lt;/h3&gt;\n            &lt;a href=\&quot;#what-are-we-doing-to-prevent-this-from-happening-again\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;We take incidents like this seriously and recognize the impact it had. We have identified several steps we can take to address the risk of a similar problem occurring in the future. We are implementing the following remediation plan as a result of this incident:&lt;/p&gt;&lt;p&gt;&lt;b&gt;Test:&lt;/b&gt; The Access engineering team will add unit tests that would automatically catch any similar issues with service token overwrites before any new features are launched.&lt;/p&gt;&lt;p&gt;&lt;b&gt;Alert:&lt;/b&gt; The Access team will implement an automatic alert for any dramatic increase in failed service token authentication requests to catch issues before they are fully launched.&lt;/p&gt;&lt;p&gt;&lt;b&gt;Process:&lt;/b&gt; The Access team has identified process improvements to allow for faster rollbacks for specific database tables.&lt;/p&gt;&lt;p&gt;&lt;b&gt;Implementation:&lt;/b&gt; All relevant database fields will be updated to include checks for empty strings on top of existing “not null checks”&lt;/p&gt;&lt;p&gt;We are sorry for the disruption this caused for our customers across a number of Cloudflare services. We are actively making these improvements to ensure improved stability moving forward and that this problem will not happen again.&lt;/p&gt;&quot;],&quot;published_at&quot;:[0,&quot;2023-01-25T03:47:09.000+00:00&quot;],&quot;updated_at&quot;:[0,&quot;2024-10-10T00:28:33.067Z&quot;],&quot;feature_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/aO8BtqbuwR74sUARmrzoB/276b714c61dd939d18dd191b99daa11a/cloudflare-incident-on-january-24th-2023.png&quot;],&quot;tags&quot;:[1,[[0,{&quot;id&quot;:[0,&quot;4yliZlpBPZpOwBDZzo1tTh&quot;],&quot;name&quot;:[0,&quot;Outage&quot;],&quot;slug&quot;:[0,&quot;outage&quot;]}],[0,{&quot;id&quot;:[0,&quot;3cCNoJJ5uusKFBLYKFX1jB&quot;],&quot;name&quot;:[0,&quot;Post Mortem&quot;],&quot;slug&quot;:[0,&quot;post-mortem&quot;]}]]],&quot;relatedTags&quot;:[0],&quot;authors&quot;:[1,[[0,{&quot;name&quot;:[0,&quot;Kenny Johnson&quot;],&quot;slug&quot;:[0,&quot;kenny&quot;],&quot;bio&quot;:[0,&quot;Cloudflare Zero Trust PM\nAustin TX&quot;],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/4sLNWTlos4CkLxMZ9WzkKg/f0435153a94adcf13569842c86dfeabb/kenny.jpeg&quot;],&quot;location&quot;:[0,null],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,&quot;@KennyJohnsonATX&quot;],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}],[0,{&quot;name&quot;:[0,&quot;Sam Rhea&quot;],&quot;slug&quot;:[0,&quot;sam&quot;],&quot;bio&quot;:[0,&quot; &quot;],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/2U8kgggIwXALYQIRjBDjyp/f71c76bd477134eab95f46d29136f902/sam.png&quot;],&quot;location&quot;:[0,null],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,&quot;@LakeAustinBlvd&quot;],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}]]],&quot;meta_description&quot;:[0,null],&quot;primary_author&quot;:[0,{}],&quot;localeList&quot;:[0,{&quot;name&quot;:[0,&quot;Cloudflare incident on January 24, 2023 Config&quot;],&quot;enUS&quot;:[0,&quot;English for Locale&quot;],&quot;zhCN&quot;:[0,&quot;Translated for Locale&quot;],&quot;zhHansCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhTW&quot;:[0,&quot;Translated for Locale&quot;],&quot;frFR&quot;:[0,&quot;Translated for Locale&quot;],&quot;deDE&quot;:[0,&quot;Translated for Locale&quot;],&quot;itIT&quot;:[0,&quot;No Page for Locale&quot;],&quot;jaJP&quot;:[0,&quot;Translated for Locale&quot;],&quot;koKR&quot;:[0,&quot;Translated for Locale&quot;],&quot;ptBR&quot;:[0,&quot;No Page for Locale&quot;],&quot;esLA&quot;:[0,&quot;No Page for Locale&quot;],&quot;esES&quot;:[0,&quot;Translated for Locale&quot;],&quot;enAU&quot;:[0,&quot;No Page for Locale&quot;],&quot;enCA&quot;:[0,&quot;No Page for Locale&quot;],&quot;enIN&quot;:[0,&quot;No Page for Locale&quot;],&quot;enGB&quot;:[0,&quot;No Page for Locale&quot;],&quot;idID&quot;:[0,&quot;No Page for Locale&quot;],&quot;ruRU&quot;:[0,&quot;No Page for Locale&quot;],&quot;svSE&quot;:[0,&quot;No Page for Locale&quot;],&quot;viVN&quot;:[0,&quot;No Page for Locale&quot;],&quot;plPL&quot;:[0,&quot;No Page for Locale&quot;],&quot;arAR&quot;:[0,&quot;No Page for Locale&quot;],&quot;nlNL&quot;:[0,&quot;No Page for Locale&quot;],&quot;thTH&quot;:[0,&quot;No Page for Locale&quot;],&quot;trTR&quot;:[0,&quot;No Page for Locale&quot;],&quot;heIL&quot;:[0,&quot;No Page for Locale&quot;],&quot;lvLV&quot;:[0,&quot;No Page for Locale&quot;],&quot;etEE&quot;:[0,&quot;No Page for Locale&quot;],&quot;ltLT&quot;:[0,&quot;No Page for Locale&quot;]}],&quot;url&quot;:[0,&quot;https://blog.cloudflare.com/cloudflare-incident-on-january-24th-2023&quot;],&quot;metadata&quot;:[0,{&quot;title&quot;:[0,&quot;Cloudflare incident on January 24, 2023&quot;],&quot;description&quot;:[0,null],&quot;imgPreview&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1nyUNfxY7TaxyAePm25lgG/23485f6061d1200e5aecb69a89e38a7e/cloudflare-incident-on-january-24th-2023-BMqmlu.png&quot;]}],&quot;publicly_index&quot;:[0,true]}],[0,{&quot;id&quot;:[0,&quot;2TjJcc3wlhfY93xN3mESJ2&quot;],&quot;title&quot;:[0,&quot;Partial Cloudflare outage on October 25, 2022&quot;],&quot;slug&quot;:[0,&quot;partial-cloudflare-outage-on-october-25-2022&quot;],&quot;excerpt&quot;:[0,&quot;Today, a change to our Tiered Cache system caused some requests to fail for users with status code 530&quot;],&quot;featured&quot;:[0,false],&quot;html&quot;:[0,&quot;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/5hJhY1sHBOZSpglFZVl7Hq/df78cb9e5dccac95d320287b3cb42dd8/1-2.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1200\&quot; height=\&quot;675\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;Today, a change to our Tiered Cache system caused some requests to fail for users with status code 530. The impact lasted for almost six hours in total. We estimate that about 5% of all requests failed at peak. Because of the complexity of our system and a blind spot in our tests, we did not spot this when the change was released to our test environment.  &lt;/p&gt;&lt;p&gt;The failures were caused by side effects of how we handle cacheable requests across locations. At first glance, the errors looked like they were caused by a different system that had started a release some time before. It took our teams a number of tries to identify exactly what was causing the problems. Once identified we expedited a rollback which completed in 87 minutes.&lt;/p&gt;&lt;p&gt;We’re sorry, and we’re taking steps to make sure this does not happen again.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;background\&quot;&gt;Background&lt;/h3&gt;\n            &lt;a href=\&quot;#background\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;One of Cloudflare’s products is our Content Delivery Network, or CDN. This is used to cache assets for websites globally. However, a data center is not guaranteed to have an asset cached. It could be new, expired, or has been purged. If that happens, and a user requests that asset, our CDN needs to retrieve a fresh copy from a website’s origin server. But the data center that the user is accessing might still be pretty far away from the origin server. This presents an additional issue for customers: every time an asset is not cached in the data center, we need to retrieve a new copy from the origin server.&lt;/p&gt;&lt;p&gt;To improve cache hit ratios, we introduced &lt;a href=\&quot;/introducing-smarter-tiered-cache-topology-generation/\&quot;&gt;Tiered Cache&lt;/a&gt;. With Tiered Cache, we organize our data centers in the CDN into a hierarchy of “lower tiers” which are closer to the end users and “upper tiers” that are closer to the origin. When a cache-miss occurs in a lower tier, the upper tier is checked. If the upper tier has a fresh copy of the asset, we can serve that in response to the request. This improves performance and reduces the amount of times that Cloudflare has to reach out to an origin server to retrieve assets that are not cached in lower tier data centers.&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/yyZ1ow2W0dM1zPPSWlYDb/442072566ebc71758aa6e70c0193a9fd/2-2.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1439\&quot; height=\&quot;883\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;incident-timeline-and-impact\&quot;&gt;Incident timeline and impact&lt;/h3&gt;\n            &lt;a href=\&quot;#incident-timeline-and-impact\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;At 08:40 UTC, a software release of a CDN component containing a bug began slowly rolling out. The bug was triggered when a user visited a site with either Tiered Cache, Cloudflare Images, or Bandwidth Alliance configured. This bug caused a subset of those customers to return HTTP Status Code 530 — an error. Content that could be served directly from a data center&amp;#39;s local cache was unaffected.&lt;/p&gt;&lt;p&gt;We started an investigation after receiving customer reports of an intermittent increase in 530s after the faulty component was released to a subset of data centers.&lt;/p&gt;&lt;p&gt;Once the release started rolling out globally to the remaining data centers, a sharp increase in 530s triggered alerts along with more customer reports, and an incident was declared.&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/5GRoqSuj9kxooMxIeQ7X6o/e751538115c6108f2335261d3f835807/3-2.png\&quot; alt=\&quot;Requests resulting in a response with status code 530\&quot; class=\&quot;kg-image\&quot; width=\&quot;1600\&quot; height=\&quot;705\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;&lt;i&gt;Requests resulting in a response with status code 530&lt;/i&gt;&lt;/p&gt;&lt;p&gt;We confirmed a bad release was responsible by rolling back the release in a data center at 17:03 UTC. After the rollback, we observed a drop in 530 errors. After this confirmation, an accelerated global rollback began and the 530s started to decrease. Impact ended once the release was reverted in all data centers configured as Tiered Cache upper tiers at 18:04 UTC.&lt;/p&gt;&lt;p&gt;Timeline:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;2022-10-25 08:40: The release started to roll out to a small subset of data centers.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;2022-10-25 10:35: An individual customer alert fires, indicating an increase in 500 error codes.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;2022-10-25 11:20: After an investigation, a single small data center is pinpointed as the source of the issue and removed from production while teams investigate the issue there.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;2022-10-25 12:30: Issue begins spreading more broadly as more data centers get the code changes.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;2022-10-25 14:22: 530s errors increase as the release starts to slowly roll out to our largest data centers.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;2022-10-25 14:39: Multiple teams become involved in the investigation as more customers start reporting increases in errors.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;2022-10-25 17:03: CDN Release is rolled back in Atlanta and root cause is confirmed.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;2022-10-25 17:28: Peak impact with approximately 5% of all HTTP requests resulting in an error with status code 530.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;2022-10-25 17:38: An accelerated rollback continues with large data centers acting as Upper tier for many customers.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;2022-10-25 18:04: Rollback is complete in all Upper Tiers.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;2022-10-25 18:30: Rollback is complete.&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;During the early phases of the investigation, the indicators were that this was a problem with our internal DNS system that also had a release rolling out at the same time. As the following section shows, that was a side effect rather than the cause of the outage.  &lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;adding-distributed-tracing-to-tiered-cache-introduced-the-problem\&quot;&gt;Adding distributed tracing to Tiered Cache introduced the problem&lt;/h3&gt;\n            &lt;a href=\&quot;#adding-distributed-tracing-to-tiered-cache-introduced-the-problem\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;In order to help improve our performance, we routinely add monitoring code to various parts of our services. Monitoring code helps by giving us visibility into how various components are performing, allowing us to determine bottlenecks that we can improve on. Our team recently added additional distributed tracing to our Tiered Cache logic. The tiered cache entrypoint code is as follows:&lt;/p&gt;&lt;p&gt;* Before:&lt;/p&gt;\n            &lt;pre class=\&quot;language-lua\&quot;&gt;&lt;code class=\&quot;language-lua\&quot;&gt;function _M.go()\n   -- code to run here\nend\n&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;* After:&lt;/p&gt;\n            &lt;pre class=\&quot;language-lua\&quot;&gt;&lt;code class=\&quot;language-lua\&quot;&gt;local trace_fn = require(&amp;quot;opentracing&amp;quot;).trace_fn\n\nlocal function go()\n  -- code to run here\nend\n\nfunction _M.go()\n  trace_fn(ngx.ctx, &amp;quot;tiered_cache_rewrite&amp;quot;, go)\nend&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;The code above wraps the existing go() function with trace_fn() which will call the go() function and then reports its execution time.&lt;/p&gt;&lt;p&gt;However, the logic that injects a function to the opentracing module clears control headers on every request:&lt;/p&gt;\n            &lt;pre class=\&quot;language-lua\&quot;&gt;&lt;code class=\&quot;language-lua\&quot;&gt;require(&amp;quot;opentracing&amp;quot;).configure_module(conf,\n  -- control header extractor\n  function(ctx)\n    -- Always clear the headers.\n    clear_control_headers()\n    -- &lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;Normally, we extract data from these control headers before clearing them as a routine part of how we process requests.&lt;/p&gt;&lt;p&gt;But internal tiered cache traffic expects the control headers from the lower tier to be passed as-is. The combination of clearing headers and using an upper tier meant that information that might be critical to the routing of the request was not available. In the subset of requests affected, we were missing the hostname to resolve by our internal DNS lookup for origin server IP addresses. As a result, a 530 DNS error was returned to the client.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;remediation-and-follow-up-steps\&quot;&gt;Remediation and follow-up steps&lt;/h3&gt;\n            &lt;a href=\&quot;#remediation-and-follow-up-steps\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;To prevent this from happening again, in addition to the fixing the bug, we have identified a set of changes that help us detect and prevent issues like this in the future:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;Include a larger data center that is configured as a Tiered Cache upper tier in an earlier stage in the release plan. This will allow us to notice similar issues more quickly, before a global release.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Expand our acceptance test coverage to include a broader set of configurations, including various Tiered Cache topologies.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Alert more aggressively in situations where we do not have full context on requests, and need the extra host information in the control headers.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Ensure that our system correctly fails fast in an error like this, which would have helped identify the problem during development and test.&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;conclusion\&quot;&gt;Conclusion&lt;/h3&gt;\n            &lt;a href=\&quot;#conclusion\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;We experienced an incident that affected a significant set of customers using Tiered Cache. After identifying the faulty component, we were able to quickly rollback and remediate the issue. We are sorry for any disruption this has caused our customers and end users trying to access services.&lt;/p&gt;&lt;p&gt;Remediations to prevent such an incident from happening in the future will be put in place as soon as possible.&lt;/p&gt;&quot;],&quot;published_at&quot;:[0,&quot;2022-10-26T04:02:50.000+01:00&quot;],&quot;updated_at&quot;:[0,&quot;2024-10-10T00:28:37.718Z&quot;],&quot;feature_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/2zud7OXWGXTGPHnVK1TVcR/bd0bdb9dd780b80ff80c6255553314d7/partial-cloudflare-outage-on-october-25-2022.png&quot;],&quot;tags&quot;:[1,[[0,{&quot;id&quot;:[0,&quot;4yliZlpBPZpOwBDZzo1tTh&quot;],&quot;name&quot;:[0,&quot;Outage&quot;],&quot;slug&quot;:[0,&quot;outage&quot;]}],[0,{&quot;id&quot;:[0,&quot;3cCNoJJ5uusKFBLYKFX1jB&quot;],&quot;name&quot;:[0,&quot;Post Mortem&quot;],&quot;slug&quot;:[0,&quot;post-mortem&quot;]}]]],&quot;relatedTags&quot;:[0],&quot;authors&quot;:[1,[[0,{&quot;name&quot;:[0,&quot;John Graham-Cumming&quot;],&quot;slug&quot;:[0,&quot;john-graham-cumming&quot;],&quot;bio&quot;:[0,null],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/5vGNsXzZrtSLn2X30pnpUY/6f350e7dd36058a6422f9199b452bb02/john-graham-cumming.jpg&quot;],&quot;location&quot;:[0,&quot;Lisbon, Portugal&quot;],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,null],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}]]],&quot;meta_description&quot;:[0,null],&quot;primary_author&quot;:[0,{}],&quot;localeList&quot;:[0,{&quot;name&quot;:[0,&quot;Partial Cloudflare outage on October 25, 2022 Config&quot;],&quot;enUS&quot;:[0,&quot;English for Locale&quot;],&quot;zhCN&quot;:[0,&quot;Translated for Locale&quot;],&quot;zhHansCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhTW&quot;:[0,&quot;No Page for Locale&quot;],&quot;frFR&quot;:[0,&quot;Translated for Locale&quot;],&quot;deDE&quot;:[0,&quot;Translated for Locale&quot;],&quot;itIT&quot;:[0,&quot;No Page for Locale&quot;],&quot;jaJP&quot;:[0,&quot;Translated for Locale&quot;],&quot;koKR&quot;:[0,&quot;No Page for Locale&quot;],&quot;ptBR&quot;:[0,&quot;No Page for Locale&quot;],&quot;esLA&quot;:[0,&quot;No Page for Locale&quot;],&quot;esES&quot;:[0,&quot;Translated for Locale&quot;],&quot;enAU&quot;:[0,&quot;No Page for Locale&quot;],&quot;enCA&quot;:[0,&quot;No Page for Locale&quot;],&quot;enIN&quot;:[0,&quot;No Page for Locale&quot;],&quot;enGB&quot;:[0,&quot;No Page for Locale&quot;],&quot;idID&quot;:[0,&quot;No Page for Locale&quot;],&quot;ruRU&quot;:[0,&quot;No Page for Locale&quot;],&quot;svSE&quot;:[0,&quot;No Page for Locale&quot;],&quot;viVN&quot;:[0,&quot;No Page for Locale&quot;],&quot;plPL&quot;:[0,&quot;No Page for Locale&quot;],&quot;arAR&quot;:[0,&quot;No Page for Locale&quot;],&quot;nlNL&quot;:[0,&quot;No Page for Locale&quot;],&quot;thTH&quot;:[0,&quot;No Page for Locale&quot;],&quot;trTR&quot;:[0,&quot;No Page for Locale&quot;],&quot;heIL&quot;:[0,&quot;No Page for Locale&quot;],&quot;lvLV&quot;:[0,&quot;No Page for Locale&quot;],&quot;etEE&quot;:[0,&quot;No Page for Locale&quot;],&quot;ltLT&quot;:[0,&quot;No Page for Locale&quot;]}],&quot;url&quot;:[0,&quot;https://blog.cloudflare.com/partial-cloudflare-outage-on-october-25-2022&quot;],&quot;metadata&quot;:[0,{&quot;title&quot;:[0,&quot;Partial Cloudflare outage on October 25, 2022&quot;],&quot;description&quot;:[0,null],&quot;imgPreview&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/16rgrdQ2eaTFCPvx1UyY1m/085be70a073c6c24fed03edc39e19e89/partial-cloudflare-outage-on-october-25-2022-oWY2Lc.png&quot;]}],&quot;publicly_index&quot;:[0,true]}],[0,{&quot;id&quot;:[0,&quot;4NqFdSmdzCcdoVLRQ05xzx&quot;],&quot;title&quot;:[0,&quot;The mechanics of a sophisticated phishing scam and how we stopped it&quot;],&quot;slug&quot;:[0,&quot;2022-07-sms-phishing-attacks&quot;],&quot;excerpt&quot;:[0,&quot;Yesterday, August 8, 2022, Twilio shared that they’d been compromised by a targeted phishing attack. Around the same time as Twilio was attacked, we saw an attack with very similar characteristics also targeting Cloudflare’s employees&quot;],&quot;featured&quot;:[0,false],&quot;html&quot;:[0,&quot;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/2vy7jqCfIMxTuvDhya2fKs/a453ffa6dc931126a0e1a8c536608596/unnamed-1.png\&quot; alt=\&quot;The mechanics of a sophisticated phishing scam and how we stopped it\&quot; class=\&quot;kg-image\&quot; width=\&quot;1600\&quot; height=\&quot;900\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;Yesterday, August 8, 2022, Twilio shared that they’d been &lt;a href=\&quot;https://www.twilio.com/blog/august-2022-social-engineering-attack\&quot;&gt;compromised by a targeted phishing attack&lt;/a&gt;. Around the same time as Twilio was attacked, we saw an attack with very similar characteristics also targeting Cloudflare’s employees. While individual employees did fall for the phishing messages, we were able to thwart the attack through our own use of &lt;a href=\&quot;https://www.cloudflare.com/cloudflare-one/\&quot;&gt;Cloudflare One products&lt;/a&gt;, and physical security keys issued to every employee that are required to access all our applications.&lt;/p&gt;&lt;p&gt;We have confirmed that no Cloudflare systems were compromised. Our &lt;a href=\&quot;/introducing-cloudforce-one-threat-operations-and-threat-research/\&quot;&gt;Cloudforce One threat intelligence team&lt;/a&gt; was able to perform additional analysis to further dissect the mechanism of the attack and gather critical evidence to assist in tracking down the attacker.&lt;/p&gt;&lt;p&gt;This was a sophisticated attack targeting employees and systems in such a way that we believe most organizations would be likely to be breached. Given that the attacker is targeting multiple organizations, we wanted to share here a rundown of exactly what we saw in order to help other companies recognize and mitigate this attack.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;targeted-text-messages\&quot;&gt;Targeted Text Messages&lt;/h2&gt;\n            &lt;a href=\&quot;#targeted-text-messages\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;On July 20, 2022, the Cloudflare Security team received reports of employees receiving legitimate-looking text messages pointing to what appeared to be a Cloudflare Okta login page. The messages began at 2022-07-20 22:50 UTC. Over the course of less than 1 minute, at least 76 employees received text messages on their personal and work phones. Some messages were also sent to the employees family members. We have not yet been able to determine how the attacker assembled the list of employees phone numbers but have reviewed access logs to our employee directory services and have found no sign of compromise.&lt;/p&gt;&lt;p&gt;Cloudflare runs a 24x7 Security Incident Response Team (SIRT). Every Cloudflare employee is trained to report anything that is suspicious to the SIRT. More than 90 percent of the reports to SIRT turn out to not be threats. Employees are encouraged to report anything and never discouraged from over-reporting. In this case, however, the reports to SIRT were a real threat.&lt;/p&gt;&lt;p&gt;The text messages received by employees looked like this:&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/2NzSGBSGfCogIk4BXWmXND/cb4bc7d2f174f8b360b7c51664e71f66/image3-5.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1125\&quot; height=\&quot;945\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;They came from four phone numbers associated with T-Mobile-issued SIM cards: (754) 268-9387, (205) 946-7573, (754) 364-6683 and (561) 524-5989. They pointed to an official-looking domain: cloudflare-okta.com. That domain had been registered via Porkbun, a &lt;a href=\&quot;https://www.cloudflare.com/learning/dns/glossary/what-is-a-domain-name-registrar/\&quot;&gt;domain registrar&lt;/a&gt;, at 2022-07-20 22:13:04 UTC — less than 40 minutes before the phishing campaign began.&lt;/p&gt;&lt;p&gt;Cloudflare built our &lt;a href=\&quot;https://www.cloudflare.com/products/registrar/custom-domain-protection/\&quot;&gt;secure registrar product&lt;/a&gt; in part to be able to monitor when domains using the Cloudflare brand were registered and get them shut down. However, because this domain was registered so recently, it had not yet been published as a new .com registration, so our systems did not detect its registration and our team had not yet moved to terminate it.&lt;/p&gt;&lt;p&gt;If you clicked on the link it took you to a phishing page. The phishing page was hosted on DigitalOcean and looked like this:&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/32GWziRZv7ijycvETvNHny/58f811265c86872398b876d64f65a55d/image1-13.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1600\&quot; height=\&quot;1200\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;Cloudflare uses Okta as our identity provider. The phishing page was designed to look identical to a legitimate Okta login page. The phishing page prompted anyone who visited it for their username and password.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;real-time-phishing\&quot;&gt;Real-Time Phishing&lt;/h2&gt;\n            &lt;a href=\&quot;#real-time-phishing\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;We were able to analyze the payload of the &lt;a href=\&quot;https://www.cloudflare.com/learning/email-security/what-is-email-security/\&quot;&gt;phishing attack&lt;/a&gt; based on what our employees received as well as its content being posted to services like VirusTotal by other companies that had been attacked. When the phishing page was completed by a victim, the credentials were immediately relayed to the attacker via the messaging service Telegram. This real-time relay was important because the phishing page would also prompt for a Time-based One Time Password (TOTP) code.&lt;/p&gt;&lt;p&gt;Presumably, the attacker would receive the credentials in real-time, enter them in a victim company’s actual login page, and, for many organizations that would generate a code sent to the employee via SMS or displayed on a password generator. The employee would then enter the TOTP code on the phishing site, and it too would be relayed to the attacker. The attacker could then, before the TOTP code expired, use it to access the company’s actual login page — defeating most two-factor authentication implementations.&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/6kHLCU7dpKptSuJXwOy39X/0da593615149665ba8f7360e4232a996/image2-6.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;951\&quot; height=\&quot;332\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;protected-even-if-not-perfect\&quot;&gt;Protected Even If Not Perfect&lt;/h2&gt;\n            &lt;a href=\&quot;#protected-even-if-not-perfect\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;We confirmed that three Cloudflare employees fell for the phishing message and entered their credentials. However, Cloudflare does not use TOTP codes. Instead, every employee at the company is issued a FIDO2-compliant security key from a vendor like YubiKey. Since the hard keys are tied to users and implement &lt;a href=\&quot;https://www.yubico.com/blog/creating-unphishable-security-key/\&quot;&gt;origin binding&lt;/a&gt;, even a sophisticated, real-time phishing operation like this cannot gather the information necessary to log in to any of our systems. While the attacker attempted to log in to our systems with the compromised username and password credentials, they could not get past the hard key requirement.&lt;/p&gt;&lt;p&gt;But this phishing page was not simply after credentials and TOTP codes. If someone made it past those steps, the phishing page then initiated the download of a phishing payload which included AnyDesk’s remote access software. That software, if installed, would allow an attacker to control the victim’s machine remotely. We confirmed that none of our team members got to this step. If they had, however, our endpoint security would have stopped the installation of the remote access software.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;how-did-we-respond\&quot;&gt;How Did We Respond?&lt;/h2&gt;\n            &lt;a href=\&quot;#how-did-we-respond\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;The main response actions we took for this incident were:&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;1-block-the-phishing-domain-using-cloudflare-gateway\&quot;&gt;1. Block the phishing domain using Cloudflare Gateway&lt;/h3&gt;\n            &lt;a href=\&quot;#1-block-the-phishing-domain-using-cloudflare-gateway\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Cloudflare Gateway is a &lt;a href=\&quot;https://www.cloudflare.com/learning/access-management/what-is-a-secure-web-gateway/\&quot;&gt;Secure Web Gateway&lt;/a&gt; solution providing threat and data protection with DNS / HTTP filtering and natively-integrated &lt;a href=\&quot;https://www.cloudflare.com/learning/security/glossary/what-is-zero-trust/\&quot;&gt;Zero Trust&lt;/a&gt;. We use this  solution internally to proactively identify malicious domains and block them. Our team added the malicious domain to Cloudflare Gateway to block all employees from accessing it.&lt;/p&gt;&lt;p&gt;Gateway’s automatic detection of malicious domains also identified the domain and blocked it, but the fact that it was registered and messages were sent within such a short interval of time meant that the system hadn’t automatically taken action before some employees had clicked on the links. Given this incident we are working to speed up how quickly malicious domains are identified and blocked. We’re also implementing controls on access to newly registered domains which we offer to customers but had not implemented ourselves.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;2-identify-all-impacted-cloudflare-employees-and-reset-compromised-credentials\&quot;&gt;2. Identify all impacted Cloudflare employees and reset compromised credentials&lt;/h3&gt;\n            &lt;a href=\&quot;#2-identify-all-impacted-cloudflare-employees-and-reset-compromised-credentials\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;We were able to compare recipients of the phishing texts to login activity and identify threat-actor attempts to authenticate to our employee accounts. We identified login attempts blocked due to the hard key (U2F) requirements indicating that the correct password was used, but the second factor could not be verified. For the three of our employees&amp;#39; credentials were leaked, we reset their credentials and any active sessions and initiated scans of their devices.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;3-identify-and-take-down-threat-actor-infrastructure\&quot;&gt;3. Identify and take down threat-actor infrastructure&lt;/h3&gt;\n            &lt;a href=\&quot;#3-identify-and-take-down-threat-actor-infrastructure\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;The threat actor&amp;#39;s phishing domain was newly registered via Porkbun, and hosted on DigitalOcean. The phishing domain used to target Cloudflare was set up less than an hour before the initial phishing wave. The site had a Nuxt.js frontend, and a Django backend. We worked with DigitalOcean to shut down the attacker’s server. We also worked with Porkbun to seize control of the malicious domain.&lt;/p&gt;&lt;p&gt;From the failed sign-in attempts we were able to determine that the threat actor was leveraging Mullvad VPN software and distinctively using the Google Chrome browser on a Windows 10 machine. The VPN IP addresses used by the attacker were 198.54.132.88, and 198.54.135.222. Those IPs are assigned to Tzulo, a US-based dedicated server provider whose website claims they have servers located in Los Angeles and Chicago. It appears, actually, that the first was actually running on a server in the Toronto area and the latter on a server in the Washington, DC area. We blocked these IPs from accessing any of our services.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;4-update-detections-to-identify-any-subsequent-attack-attempts\&quot;&gt;4. Update detections to identify any subsequent attack attempts&lt;/h3&gt;\n            &lt;a href=\&quot;#4-update-detections-to-identify-any-subsequent-attack-attempts\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;With what we were able to uncover about this attack, we incorporated additional signals to our already existing detections to specifically identify this threat-actor. At the time of writing we have not observed any additional waves targeting our employees. However, intelligence from the server indicated the attacker was targeting other organizations, including Twilio. We reached out to these other organizations and shared intelligence on the attack.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;5-audit-service-access-logs-for-any-additional-indications-of-attack\&quot;&gt;5. Audit service access logs for any additional indications of attack&lt;/h3&gt;\n            &lt;a href=\&quot;#5-audit-service-access-logs-for-any-additional-indications-of-attack\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Following the attack, we screened all our system logs for any additional fingerprints from this particular attacker. Given Cloudflare Access serves as the central control point for all Cloudflare applications, we can search the logs for any indication the attacker may have breached any systems. Given employees’ phones were targeted, we also carefully reviewed the logs of our employee directory providers. We did not find any evidence of compromise.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;lessons-learned-and-additional-steps-were-taking\&quot;&gt;Lessons Learned and Additional Steps We’re Taking&lt;/h2&gt;\n            &lt;a href=\&quot;#lessons-learned-and-additional-steps-were-taking\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;We learn from every attack. Even though the attacker was not successful, we are making additional adjustments from what we’ve learned. We’re adjusting the settings for Cloudflare Gateway to restrict or sandbox access to sites running on domains that were registered within the last 24 hours. We will also run any non-allow listed sites containing terms such as “cloudflare” “okta” “sso” and “2fa” through our &lt;a href=\&quot;https://www.cloudflare.com/learning/access-management/what-is-browser-isolation/\&quot;&gt;browser isolation technology&lt;/a&gt;. We are also increasingly using &lt;a href=\&quot;https://www.cloudflare.com/products/zero-trust/email-security/\&quot;&gt;Cloudflare Area 1’s phish-identification technology&lt;/a&gt; to scan the web and look for any pages that are designed to target Cloudflare. Finally, we’re tightening up our Access implementation to prevent any logins from unknown VPNs, residential proxies, and infrastructure providers. All of these are standard features of the same products we offer to customers.&lt;/p&gt;&lt;p&gt;The attack also reinforced the importance of three things we’re doing well. First, requiring hard keys for access to all applications. &lt;a href=\&quot;https://krebsonsecurity.com/2018/07/google-security-keys-neutralized-employee-phishing/\&quot;&gt;Like Google&lt;/a&gt;, we have not seen any successful phishing attacks since rolling hard keys out. Tools like Cloudflare Access made it easy to support hard keys even across legacy applications. If you’re an organization interested in how we rolled out hard keys, reach out to &lt;a href=\&quot;mailto:cloudforceone-irhelp@cloudflare.com\&quot;&gt;cloudforceone-irhelp@cloudflare.com&lt;/a&gt; and our security team would be happy to share the best practices we learned through this process.&lt;/p&gt;&lt;p&gt;Second, using Cloudflare’s own technology to protect our employees and systems. Cloudflare One’s solutions like Access and Gateway were critical to staying ahead of this attack. We configured our Access implementation to require hard keys for every application. It also creates a central logging location for all application authentications. And, if ever necessary, a place from which we can kill the sessions of a potentially compromised employee. Gateway allows us the ability to shut down malicious sites like this one quickly and understand what employees may have fallen for the attack. These are all functionalities that we make available to Cloudflare customers as part of our Cloudflare One suite and this attack demonstrates how effective they can be.&lt;/p&gt;&lt;p&gt;Third, having a paranoid but blame-free culture is critical for security. The three employees who fell for the phishing scam were not reprimanded. We’re all human and we make mistakes. It’s critically important that when we do, we report them and don’t cover them up. This incident provided another example of why security is part of every team member at Cloudflare’s job.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;detailed-timeline-of-events\&quot;&gt;Detailed Timeline of Events&lt;/h2&gt;\n            &lt;a href=\&quot;#detailed-timeline-of-events\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;.tg {border-collapse:collapse;border-spacing:0;} .tg td{border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px; overflow:hidden;padding:10px 5px;word-break:normal;} .tg th{border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px; font-weight:normal;overflow:hidden;padding:10px 5px;word-break:normal;} .tg .tg-0lax{text-align:left;vertical-align:top}&lt;/p&gt;&lt;p&gt;2022-07-20 22:49 UTC&lt;/p&gt;&lt;p&gt;Attacker sends out 100+ SMS messages to Cloudflare employees and their families.&lt;/p&gt;&lt;p&gt;2022-07-20 22:50 UTC&lt;/p&gt;&lt;p&gt;Employees begin reporting SMS messages to Cloudflare Security team.&lt;/p&gt;&lt;p&gt;2022-07-20 22:52 UTC&lt;/p&gt;&lt;p&gt;Verify that the attacker&amp;#39;s domain is blocked in Cloudflare Gateway for corporate devices.&lt;/p&gt;&lt;p&gt;2022-07-20 22:58 UTC&lt;/p&gt;&lt;p&gt;Warning communication sent to all employees across chat and email.&lt;/p&gt;&lt;p&gt;2022-07-20 22:50 UTC to2022-07-20 23:26 UTC&lt;/p&gt;&lt;p&gt;Monitor telemetry in the Okta System log &amp;amp; Cloudflare Gateway HTTP logs to locate credential compromise. Clear login sessions and suspend accounts on discovery.&lt;/p&gt;&lt;p&gt;2022-07-20 23:26 UTC&lt;/p&gt;&lt;p&gt;Phishing site is taken down by the hosting provider.&lt;/p&gt;&lt;p&gt;2022-07-20 23:37 UTC&lt;/p&gt;&lt;p&gt;Reset leaked employee credentials.&lt;/p&gt;&lt;p&gt;2022-07-21 00:15 UTC&lt;/p&gt;&lt;p&gt;Deep dive into attacker infrastructure and capabilities.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;indicators-of-compromise\&quot;&gt;Indicators of compromise&lt;/h2&gt;\n            &lt;a href=\&quot;#indicators-of-compromise\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;!--kg-card-begin: html--&gt;&lt;style type=\&quot;text/css\&quot;&gt;\n.tg  {border-collapse:collapse;border-spacing:0;}\n.tg td{border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;\n  overflow:hidden;padding:10px 5px;word-break:normal;}\n.tg th{border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;\n  font-weight:normal;overflow:hidden;padding:10px 5px;word-break:normal;}\n.tg .tg-nr0u{border-color:inherit;font-family:inherit;font-size:100%;text-align:left;vertical-align:top}\n.tg .tg-0pky{border-color:inherit;text-align:left;vertical-align:top}\n&lt;/style&gt;\n&lt;table class=\&quot;tg\&quot;&gt;\n&lt;thead&gt;\n  &lt;tr&gt;\n    &lt;th class=\&quot;tg-nr0u\&quot;&gt;Value&lt;/th&gt;\n    &lt;th class=\&quot;tg-0pky\&quot;&gt;Type&lt;/th&gt;\n    &lt;th class=\&quot;tg-0pky\&quot;&gt;Context and MITRE Mapping&lt;/th&gt;\n  &lt;/tr&gt;\n&lt;/thead&gt;\n&lt;tbody&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-0pky\&quot;&gt;cloudflare-okta[.]com hosted on 147[.]182[.]132[.]52&lt;/td&gt;\n    &lt;td class=\&quot;tg-0pky\&quot;&gt;Phishing URL&lt;/td&gt;\n    &lt;td class=\&quot;tg-0pky\&quot;&gt;&lt;a href=\&quot;https://attack.mitre.org/techniques/T1566/002/\&quot;&gt;T1566.002&lt;/a&gt;: Phishing: Spear Phishing Link sent to users.&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\&quot;tg-0pky\&quot;&gt;64547b7a4a9de8af79ff0eefadde2aed10c17f9d8f9a2465c0110c848d85317a&lt;/td&gt;\n    &lt;td class=\&quot;tg-0pky\&quot;&gt;SHA-256&lt;/td&gt;\n    &lt;td class=\&quot;tg-0pky\&quot;&gt;&lt;a href=\&quot;https://attack.mitre.org/techniques/T1219/\&quot;&gt;T1219&lt;/a&gt;: Remote Access Software being distributed by the threat actor&lt;/td&gt;\n  &lt;/tr&gt;\n&lt;/tbody&gt;\n&lt;/table&gt;&lt;!--kg-card-end: html--&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;what-you-can-do\&quot;&gt;What You Can Do&lt;/h2&gt;\n            &lt;a href=\&quot;#what-you-can-do\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;If you are seeing similar attacks in your environment, please don’t hesitate to reach out to &lt;a href=\&quot;mailto:cloudforceone-irhelp@cloudflare.com\&quot;&gt;cloudforceone-irhelp@cloudflare.com&lt;/a&gt;, and we’re happy to share best practices on how to keep your business secure. If on the other hand, you are interested in learning more about how we implemented security keys please review our &lt;a href=\&quot;/how-cloudflare-implemented-fido2-and-zero-trust/\&quot;&gt;blog post&lt;/a&gt; or reach out to &lt;a href=\&quot;mailto:securitykeys@cloudflare.com\&quot;&gt;securitykeys@cloudflare.com&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;Finally, do you want to work on detecting and mitigating the next attacks with us? We’re hiring on our Detection and Response team, &lt;a href=\&quot;https://boards.greenhouse.io/cloudflare/jobs/4364485?gh_jid=4364485\&quot;&gt;come join us&lt;/a&gt;!&lt;/p&gt;&quot;],&quot;published_at&quot;:[0,&quot;2022-08-09T16:56:30.000+01:00&quot;],&quot;updated_at&quot;:[0,&quot;2024-10-09T23:19:46.654Z&quot;],&quot;feature_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1wqOFooPTEY7ZgPE81oNOV/9f4f19920ff74ee253389386d429ab6d/2022-07-sms-phishing-attacks.png&quot;],&quot;tags&quot;:[1,[[0,{&quot;id&quot;:[0,&quot;6Mp7ouACN2rT3YjL1xaXJx&quot;],&quot;name&quot;:[0,&quot;Security&quot;],&quot;slug&quot;:[0,&quot;security&quot;]}],[0,{&quot;id&quot;:[0,&quot;3cCNoJJ5uusKFBLYKFX1jB&quot;],&quot;name&quot;:[0,&quot;Post Mortem&quot;],&quot;slug&quot;:[0,&quot;post-mortem&quot;]}],[0,{&quot;id&quot;:[0,&quot;21DTsaKOfe5jbKfPDzYIBX&quot;],&quot;name&quot;:[0,&quot;Phishing&quot;],&quot;slug&quot;:[0,&quot;phishing&quot;]}],[0,{&quot;id&quot;:[0,&quot;15qx2Nvwrm4X8zknw3vXgC&quot;],&quot;name&quot;:[0,&quot;Cloudflare Gateway&quot;],&quot;slug&quot;:[0,&quot;gateway&quot;]}],[0,{&quot;id&quot;:[0,&quot;6c9EM6c5poinGKIR6xldFo&quot;],&quot;name&quot;:[0,&quot;Cloudflare Access&quot;],&quot;slug&quot;:[0,&quot;cloudflare-access&quot;]}]]],&quot;relatedTags&quot;:[0],&quot;authors&quot;:[1,[[0,{&quot;name&quot;:[0,&quot;Matthew Prince&quot;],&quot;slug&quot;:[0,&quot;matthew-prince&quot;],&quot;bio&quot;:[0,&quot;A little bit geek, wonk, and nerd. Repeat entrepreneur, recovering lawyer, and former ski instructor. Co-founder &amp; CEO of Cloudflare (NYSE: NET).&quot;],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1VD9WePJ1jvjFwuSRF0IfQ/5e4f7d5fd4825358b33b2ead623140d8/matthew-prince.jpeg&quot;],&quot;location&quot;:[0,&quot;San Francisco, CA&quot;],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,&quot;@eastdakota&quot;],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}],[0,{&quot;name&quot;:[0,&quot;Daniel Stinson-Diess&quot;],&quot;slug&quot;:[0,&quot;daniel-stinson-diess&quot;],&quot;bio&quot;:[0,&quot;Security @ Cloudflare.&quot;],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1BGQGSJbC4bHwCMQQYbuEn/05b88bc2f83671272ecadd4856bc4bc0/daniel-stinson-diess.png&quot;],&quot;location&quot;:[0,null],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,&quot;@shellcromancer&quot;],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}],[0,{&quot;name&quot;:[0,&quot;Sourov Zaman&quot;],&quot;slug&quot;:[0,&quot;sourov&quot;],&quot;bio&quot;:[0,null],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/7EnNfUXOQM9YkKLfLRPjGn/63edde7c300b15ed04562dea06e30f25/sourov.png&quot;],&quot;location&quot;:[0,null],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,null],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}]]],&quot;meta_description&quot;:[0,&quot;Yesterday, August 8, 2022, Twilio shared that they’d been compromised by a targeted phishing attack. Around the same time as Twilio was attacked, we saw an attack with very similar characteristics also targeting Cloudflare’s employees.&quot;],&quot;primary_author&quot;:[0,{}],&quot;localeList&quot;:[0,{&quot;name&quot;:[0,&quot;The mechanics of a sophisticated phishing scam and how we stopped it Config&quot;],&quot;enUS&quot;:[0,&quot;English for Locale&quot;],&quot;zhCN&quot;:[0,&quot;Translated for Locale&quot;],&quot;zhHansCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhTW&quot;:[0,&quot;No Page for Locale&quot;],&quot;frFR&quot;:[0,&quot;No Page for Locale&quot;],&quot;deDE&quot;:[0,&quot;No Page for Locale&quot;],&quot;itIT&quot;:[0,&quot;No Page for Locale&quot;],&quot;jaJP&quot;:[0,&quot;Translated for Locale&quot;],&quot;koKR&quot;:[0,&quot;No Page for Locale&quot;],&quot;ptBR&quot;:[0,&quot;No Page for Locale&quot;],&quot;esLA&quot;:[0,&quot;No Page for Locale&quot;],&quot;esES&quot;:[0,&quot;Translated for Locale&quot;],&quot;enAU&quot;:[0,&quot;No Page for Locale&quot;],&quot;enCA&quot;:[0,&quot;No Page for Locale&quot;],&quot;enIN&quot;:[0,&quot;No Page for Locale&quot;],&quot;enGB&quot;:[0,&quot;No Page for Locale&quot;],&quot;idID&quot;:[0,&quot;No Page for Locale&quot;],&quot;ruRU&quot;:[0,&quot;Translated for Locale&quot;],&quot;svSE&quot;:[0,&quot;No Page for Locale&quot;],&quot;viVN&quot;:[0,&quot;No Page for Locale&quot;],&quot;plPL&quot;:[0,&quot;Translated for Locale&quot;],&quot;arAR&quot;:[0,&quot;No Page for Locale&quot;],&quot;nlNL&quot;:[0,&quot;No Page for Locale&quot;],&quot;thTH&quot;:[0,&quot;No Page for Locale&quot;],&quot;trTR&quot;:[0,&quot;No Page for Locale&quot;],&quot;heIL&quot;:[0,&quot;No Page for Locale&quot;],&quot;lvLV&quot;:[0,&quot;No Page for Locale&quot;],&quot;etEE&quot;:[0,&quot;No Page for Locale&quot;],&quot;ltLT&quot;:[0,&quot;No Page for Locale&quot;]}],&quot;url&quot;:[0,&quot;https://blog.cloudflare.com/2022-07-sms-phishing-attacks&quot;],&quot;metadata&quot;:[0,{&quot;title&quot;:[0,&quot;The mechanics of a sophisticated phishing scam and how we stopped it&quot;],&quot;description&quot;:[0,&quot;Yesterday, August 8, 2022, Twilio shared that they’d been compromised by a targeted phishing attack. Around the same time as Twilio was attacked, we saw an attack with very similar characteristics also targeting Cloudflare’s employees.&quot;],&quot;imgPreview&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/ktQe7q48InxT3Z5bUvwiv/585952810b64a9e7b011963f25a0f005/2022-07-sms-phishing-attacks-8wgqDv.png&quot;]}],&quot;publicly_index&quot;:[0,true]}],[0,{&quot;id&quot;:[0,&quot;5rERCOYkkrYTVgFUr46dlN&quot;],&quot;title&quot;:[0,&quot;Cloudflare outage on June 21, 2022&quot;],&quot;slug&quot;:[0,&quot;cloudflare-outage-on-june-21-2022&quot;],&quot;excerpt&quot;:[0,&quot;Today, June 21, 2022, Cloudflare suffered an outage that affected traffic in 19 of our data centers&quot;],&quot;featured&quot;:[0,false],&quot;html&quot;:[0,&quot;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/2LzOzlg7mmUmt62U2SepS2/7d09343a7115e0eb064b482a6dc3df14/BLOG-1226-Global-Latency-1.png\&quot; alt=\&quot;Cloudflare outage on June 21, 2022\&quot; class=\&quot;kg-image\&quot; width=\&quot;1200\&quot; height=\&quot;675\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;introduction\&quot;&gt;Introduction&lt;/h3&gt;\n            &lt;a href=\&quot;#introduction\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Today, June 21, 2022, Cloudflare suffered an outage that affected traffic in 19 of our data centers. Unfortunately, these 19 locations handle a significant proportion of our global traffic. This outage was caused by a change that was part of a long-running project to increase resilience in our busiest locations. A change to the network configuration in those locations caused an outage which started at 06:27 UTC. At 06:58 UTC the first data center was brought back online and by 07:42 UTC all data centers were online and working correctly.&lt;/p&gt;&lt;p&gt;Depending on your location in the world you may have been unable to access websites and services that rely on Cloudflare. In other locations, Cloudflare continued to operate normally.&lt;/p&gt;&lt;p&gt;We are very sorry for this outage. This was our error and not the result of an attack or malicious activity.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;background\&quot;&gt;Background&lt;/h3&gt;\n            &lt;a href=\&quot;#background\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Over the last 18 months, Cloudflare has been working to convert all of our busiest locations to a more flexible and resilient architecture. In this time, we’ve converted 19 of our data centers to this architecture, internally called Multi-Colo PoP (MCP): Amsterdam, Atlanta, Ashburn, Chicago, Frankfurt, London, Los Angeles, Madrid, Manchester, Miami, Milan, Mumbai, Newark, Osaka, São Paulo, San Jose, Singapore, Sydney, Tokyo.&lt;/p&gt;&lt;p&gt;A critical part of this new architecture, which is designed as a &lt;a href=\&quot;https://en.wikipedia.org/wiki/Clos_network\&quot;&gt;Clos network&lt;/a&gt;, is an added layer of routing that creates a mesh of connections. This mesh allows us to easily disable and enable parts of the internal network in a data center for maintenance or to deal with a problem. This layer is represented by the spines in the following diagram.&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/3wHXMwydO0BJOwgL8myKrl/4c603771d020ef604f23bcbfd9b44649/image2-27.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1071\&quot; height=\&quot;1260\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;This new architecture has provided us with significant reliability improvements, as well as allowing us to run maintenance in these locations without disrupting customer traffic. As these locations also carry a significant proportion of the Cloudflare traffic, any problem here can have a very wide impact, and unfortunately, that’s what happened today.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;incident-timeline-and-impact\&quot;&gt;Incident timeline and impact&lt;/h3&gt;\n            &lt;a href=\&quot;#incident-timeline-and-impact\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;In order to be reachable on the Internet, networks like Cloudflare make use of a protocol called &lt;a href=\&quot;https://www.cloudflare.com/en-gb/learning/security/glossary/what-is-bgp/\&quot;&gt;BGP&lt;/a&gt;. As part of this protocol, operators define policies which decide which prefixes (a collection of adjacent IP addresses) are advertised to peers (the other networks they connect to), or accepted from peers.&lt;/p&gt;&lt;p&gt;These policies have individual components, which are evaluated sequentially. The end result is that any given prefixes will either be advertised or not advertised. A change in policy can mean a previously advertised prefix is no longer advertised, known as being &amp;quot;withdrawn&amp;quot;, and those IP addresses will no longer be reachable on the Internet.&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/4oS7n2Z7dAA9LNGAsz23rf/b7e176a7985fbebef456f7fad251de24/image1-27.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1048\&quot; height=\&quot;1013\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;While deploying a change to our prefix advertisement policies, a re-ordering of terms caused us to withdraw a critical subset of prefixes.&lt;/p&gt;&lt;p&gt;Due to this withdrawal, Cloudflare engineers experienced added difficulty in reaching the affected locations to revert the problematic change. We have backup procedures for handling such an event and used them to take control of the affected locations.&lt;/p&gt;&lt;p&gt;&lt;b&gt;03:56 UTC&lt;/b&gt;: We deploy the change to our first location. None of our locations are impacted by the change, as these are using our older architecture.&lt;b&gt;06:17&lt;/b&gt;: The change is deployed to our busiest locations, but not the locations with the MCP architecture.&lt;b&gt;06:27&lt;/b&gt;: The rollout reached the MCP-enabled locations, and the change is deployed to our spines. &lt;b&gt;This is when the incident started&lt;/b&gt;, as this swiftly took these 19 locations offline.&lt;b&gt;06:32&lt;/b&gt;: Internal Cloudflare incident declared.&lt;b&gt;06:51&lt;/b&gt;: First change made on a router to verify the root cause.&lt;b&gt;06:58&lt;/b&gt;: Root cause found and understood. Work begins to revert the problematic change.&lt;b&gt;07:42&lt;/b&gt;: The last of the reverts has been completed. This was delayed as network engineers walked over each other&amp;#39;s changes, reverting the previous reverts, causing the problem to re-appear sporadically.&lt;b&gt;08:00&lt;/b&gt;: Incident closed.&lt;/p&gt;&lt;p&gt;The criticality of these data centers can clearly be seen in the volume of successful HTTP requests we handled globally:&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card kg-width-wide\&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1bgGYgoUmRFFbay19ThYit/74168099ecf004a6dc1bbda9aa81919f/image3-19.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1999\&quot; height=\&quot;1179\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;Even though these locations are only 4% of our total network, the outage impacted 50% of total requests. The same can be seen in our egress bandwidth:&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card kg-width-wide\&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/4gWQTaPkyGxypCw4LBdZML/df1e2bbe7ca4a06f5746f7be42700c37/image6-11.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1999\&quot; height=\&quot;1182\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;technical-description-of-the-error-and-how-it-happened\&quot;&gt;Technical description of the error and how it happened&lt;/h3&gt;\n            &lt;a href=\&quot;#technical-description-of-the-error-and-how-it-happened\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;As part of our continued effort to standardize our infrastructure configuration, we were rolling out a change to standardize the BGP communities we attach to a subset of the prefixes we advertise. Specifically, we were adding informational communities to our site-local prefixes.&lt;/p&gt;&lt;p&gt;These prefixes allow our metals to communicate with each other, as well as connect to customer origins. As part of the change procedure at Cloudflare, a Change Request ticket was created, which includes a dry-run of the change, as well as a stepped rollout procedure. Before it was allowed to go out, it was also peer reviewed by multiple engineers. Unfortunately, in this case, the steps weren’t small enough to catch the error before it hit all of our spines.&lt;/p&gt;&lt;p&gt;The change looked like this on one of the routers:&lt;/p&gt;\n            &lt;pre class=\&quot;language-bash\&quot;&gt;&lt;code class=\&quot;language-bash\&quot;&gt;[edit policy-options policy-statement 4-COGENT-TRANSIT-OUT term ADV-SITELOCAL then]\n+      community add STATIC-ROUTE;\n+      community add SITE-LOCAL-ROUTE;\n+      community add TLL01;\n+      community add EUROPE;\n[edit policy-options policy-statement 4-PUBLIC-PEER-ANYCAST-OUT term ADV-SITELOCAL then]\n+      community add STATIC-ROUTE;\n+      community add SITE-LOCAL-ROUTE;\n+      community add TLL01;\n+      community add EUROPE;\n[edit policy-options policy-statement 6-COGENT-TRANSIT-OUT term ADV-SITELOCAL then]\n+      community add STATIC-ROUTE;\n+      community add SITE-LOCAL-ROUTE;\n+      community add TLL01;\n+      community add EUROPE;\n[edit policy-options policy-statement 6-PUBLIC-PEER-ANYCAST-OUT term ADV-SITELOCAL then]\n+      community add STATIC-ROUTE;\n+      community add SITE-LOCAL-ROUTE;\n+      community add TLL01;\n+      community add EUROPE;&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;This was harmless, and just added some additional information to these prefix advertisements. The change on the spines was the following:&lt;/p&gt;\n            &lt;pre class=\&quot;language-bash\&quot;&gt;&lt;code class=\&quot;language-bash\&quot;&gt;[edit policy-options policy-statement AGGREGATES-OUT]\nterm 6-DISABLED_PREFIXES { ... }\n!    term 6-ADV-TRAFFIC-PREDICTOR { ... }\n!    term 4-ADV-TRAFFIC-PREDICTOR { ... }\n!    term ADV-FREE { ... }\n!    term ADV-PRO { ... }\n!    term ADV-BIZ { ... }\n!    term ADV-ENT { ... }\n!    term ADV-DNS { ... }\n!    term REJECT-THE-REST { ... }\n!    term 4-ADV-SITE-LOCALS { ... }\n!    term 6-ADV-SITE-LOCALS { ... }\n[edit policy-options policy-statement AGGREGATES-OUT term 4-ADV-SITE-LOCALS then]\ncommunity delete NO-EXPORT { ... }\n+      community add STATIC-ROUTE;\n+      community add SITE-LOCAL-ROUTE;\n+      community add AMS07;\n+      community add EUROPE;\n[edit policy-options policy-statement AGGREGATES-OUT term 6-ADV-SITE-LOCALS then]\ncommunity delete NO-EXPORT { ... }\n+      community add STATIC-ROUTE;\n+      community add SITE-LOCAL-ROUTE;\n+      community add AMS07;\n+      community add EUROPE;&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;An initial glance at this diff might give the impression that this change is identical, but unfortunately, that’s not the case. If we focus on one part of the diff, it might become clear why:&lt;/p&gt;\n            &lt;pre class=\&quot;language-bash\&quot;&gt;&lt;code class=\&quot;language-bash\&quot;&gt;!    term REJECT-THE-REST { ... }\n!    term 4-ADV-SITE-LOCALS { ... }\n!    term 6-ADV-SITE-LOCALS { ... }&lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;In this diff format, the exclamation marks in front of the terms indicate a re-ordering of the terms. In this case, multiple terms moved up, and two terms were added to the bottom. Specifically, the 4-ADV-SITE-LOCALS and 6-ADV-SITE-LOCALS terms moved from the top to the bottom. These terms were now behind the REJECT-THE-REST term, and as might be clear from the name, this term is an explicit reject:&lt;/p&gt;\n            &lt;pre class=\&quot;language-bash\&quot;&gt;&lt;code class=\&quot;language-bash\&quot;&gt;term REJECT-THE-REST {\n    then reject;\n} &lt;/pre&gt;&lt;/code&gt;\n            &lt;p&gt;As this term is now before the site-local terms, we immediately stopped advertising our site-local prefixes, removing our direct access to all the impacted locations, as well as removing the ability of our servers to reach origin servers.&lt;/p&gt;&lt;p&gt;On top of the inability to contact origins, the removal of these site-local prefixes also caused our internal load balancing system Multimog (a variation of our &lt;a href=\&quot;/unimog-cloudflares-edge-load-balancer/\&quot;&gt;Unimog load-balancer&lt;/a&gt;) to stop working, as it could no longer forward requests between the servers in our MCPs. This meant that our smaller compute clusters in an MCP received the same amount of traffic as our largest clusters, causing the smaller ones to overload.&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card kg-width-wide\&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/jBcPxvumdeOx5Ffojnwuw/d34adc458e95b357c521733a933d73bf/image4-15.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1999\&quot; height=\&quot;1180\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;remediation-and-follow-up-steps\&quot;&gt;Remediation and follow-up steps&lt;/h3&gt;\n            &lt;a href=\&quot;#remediation-and-follow-up-steps\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;This incident had widespread impact, and we take availability very seriously. We have identified several areas of improvement and will continue to work on uncovering any other gaps that could cause a recurrence.&lt;/p&gt;&lt;p&gt;Here is what we are working on immediately:&lt;/p&gt;&lt;p&gt;&lt;b&gt;Process&lt;/b&gt;: While the MCP program was designed to improve availability, a procedural gap in how we updated these data centers ultimately caused a broader impact in MCP locations specifically. While we did use a stagger procedure for this change, the stagger policy did not include an MCP data center until the final step. Change procedures and automation need to include MCP-specific test and deploy procedures to ensure there are no unintended consequences.&lt;/p&gt;&lt;p&gt;&lt;b&gt;Architecture&lt;/b&gt;: The incorrect router configuration prevented the proper routes from being announced, preventing traffic from flowing properly to our infrastructure. Ultimately the policy statement that caused the incorrect routing advertisement will be redesigned to prevent an unintentional incorrect ordering.&lt;/p&gt;&lt;p&gt;&lt;b&gt;Automation&lt;/b&gt;: There are several opportunities in our automation suite that would mitigate some or all of the impact seen from this event. Primarily, we will be concentrating on automation improvements that enforce an improved stagger policy for rollouts of network configuration and provide an automated “commit-confirm” rollback. The former enhancement would have significantly lessened the overall impact, and the latter would have greatly reduced the Time-to-Resolve during the incident.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;conclusion\&quot;&gt;Conclusion&lt;/h3&gt;\n            &lt;a href=\&quot;#conclusion\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Although Cloudflare has invested significantly in our MCP design to improve service availability, we clearly fell short of our customer expectations with this very painful incident. We are deeply sorry for the disruption to our customers and to all the users who were unable to access Internet properties during the outage. We have already started working on the changes outlined above and will continue our diligence to ensure this cannot happen again.&lt;/p&gt;&quot;],&quot;published_at&quot;:[0,&quot;2022-06-21T13:38:05.000+01:00&quot;],&quot;updated_at&quot;:[0,&quot;2024-10-09T23:19:04.529Z&quot;],&quot;feature_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/7gLRaAn8lSV9b8yjXqJqqs/6117d99c7564f02da084909be3c7e8c6/cloudflare-outage-on-june-21-2022.png&quot;],&quot;tags&quot;:[1,[[0,{&quot;id&quot;:[0,&quot;4yliZlpBPZpOwBDZzo1tTh&quot;],&quot;name&quot;:[0,&quot;Outage&quot;],&quot;slug&quot;:[0,&quot;outage&quot;]}],[0,{&quot;id&quot;:[0,&quot;3cCNoJJ5uusKFBLYKFX1jB&quot;],&quot;name&quot;:[0,&quot;Post Mortem&quot;],&quot;slug&quot;:[0,&quot;post-mortem&quot;]}]]],&quot;relatedTags&quot;:[0],&quot;authors&quot;:[1,[[0,{&quot;name&quot;:[0,&quot;Tom Strickx&quot;],&quot;slug&quot;:[0,&quot;tom-strickx&quot;],&quot;bio&quot;:[0,&quot;Principal network engineer&quot;],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/4WM06S2SGZ2gLRjQWh3eMA/12e0fcb787bc3206936957472d291b9c/4UUTxNu__400x400.jpg&quot;],&quot;location&quot;:[0,null],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,&quot;@tstrickx&quot;],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}],[0,{&quot;name&quot;:[0,&quot;Jeremy Hartman&quot;],&quot;slug&quot;:[0,&quot;jeremy-hartman&quot;],&quot;bio&quot;:[0,null],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1yTvNpd60qmjgY8fbItcDp/f964f6cd281c1693cee7b4a43a6e3845/jeremy-hartman.jpeg&quot;],&quot;location&quot;:[0,null],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,null],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}]]],&quot;meta_description&quot;:[0,&quot;Today, June 21, 2022, Cloudflare suffered an outage that affected traffic in 19 of our data centers.&quot;],&quot;primary_author&quot;:[0,{}],&quot;localeList&quot;:[0,{&quot;name&quot;:[0,&quot;Cloudflare outage on June 21, 2022 Config&quot;],&quot;enUS&quot;:[0,&quot;English for Locale&quot;],&quot;zhCN&quot;:[0,&quot;Translated for Locale&quot;],&quot;zhHansCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhTW&quot;:[0,&quot;Translated for Locale&quot;],&quot;frFR&quot;:[0,&quot;Translated for Locale&quot;],&quot;deDE&quot;:[0,&quot;Translated for Locale&quot;],&quot;itIT&quot;:[0,&quot;No Page for Locale&quot;],&quot;jaJP&quot;:[0,&quot;Translated for Locale&quot;],&quot;koKR&quot;:[0,&quot;Translated for Locale&quot;],&quot;ptBR&quot;:[0,&quot;No Page for Locale&quot;],&quot;esLA&quot;:[0,&quot;No Page for Locale&quot;],&quot;esES&quot;:[0,&quot;Translated for Locale&quot;],&quot;enAU&quot;:[0,&quot;No Page for Locale&quot;],&quot;enCA&quot;:[0,&quot;No Page for Locale&quot;],&quot;enIN&quot;:[0,&quot;No Page for Locale&quot;],&quot;enGB&quot;:[0,&quot;No Page for Locale&quot;],&quot;idID&quot;:[0,&quot;No Page for Locale&quot;],&quot;ruRU&quot;:[0,&quot;No Page for Locale&quot;],&quot;svSE&quot;:[0,&quot;No Page for Locale&quot;],&quot;viVN&quot;:[0,&quot;No Page for Locale&quot;],&quot;plPL&quot;:[0,&quot;No Page for Locale&quot;],&quot;arAR&quot;:[0,&quot;No Page for Locale&quot;],&quot;nlNL&quot;:[0,&quot;No Page for Locale&quot;],&quot;thTH&quot;:[0,&quot;Translated for Locale&quot;],&quot;trTR&quot;:[0,&quot;No Page for Locale&quot;],&quot;heIL&quot;:[0,&quot;No Page for Locale&quot;],&quot;lvLV&quot;:[0,&quot;No Page for Locale&quot;],&quot;etEE&quot;:[0,&quot;No Page for Locale&quot;],&quot;ltLT&quot;:[0,&quot;No Page for Locale&quot;]}],&quot;url&quot;:[0,&quot;https://blog.cloudflare.com/cloudflare-outage-on-june-21-2022&quot;],&quot;metadata&quot;:[0,{&quot;title&quot;:[0,&quot;Cloudflare outage on June 21, 2022&quot;],&quot;description&quot;:[0,&quot;Today, June 21, 2022, Cloudflare suffered an outage that affected traffic in 19 of our data centers.&quot;],&quot;imgPreview&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1yEsmVng5ZHkOBiDLI4N8L/7a79b5cc4cebdbe21c2639be6597ef6d/cloudflare-outage-on-june-21-2022-MNcYiH.png&quot;]}],&quot;publicly_index&quot;:[0,true]}],[0,{&quot;id&quot;:[0,&quot;6n12upwKATxTxAiY2DIYoV&quot;],&quot;title&quot;:[0,&quot;PIPEFAIL: How a missing shell option slowed Cloudflare down&quot;],&quot;slug&quot;:[0,&quot;pipefail-how-a-missing-shell-option-slowed-cloudflare-down&quot;],&quot;excerpt&quot;:[0,&quot;This post tells the story of how a missing shell option called “pipefail” slowed Cloudflare down.&quot;],&quot;featured&quot;:[0,false],&quot;html&quot;:[0,&quot;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/3E6lhMo3qjyAuKxbUDRZmq/3bec6efe7835c0f61af00cf453e54724/image4-4.png\&quot; alt=\&quot;PIPEFAIL: How a missing shell option slowed Cloudflare down\&quot; class=\&quot;kg-image\&quot; width=\&quot;1200\&quot; height=\&quot;675\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;At Cloudflare, we’re used to being the fastest in the world. However, for approximately 30 minutes last December, &lt;a href=\&quot;https://www.cloudflarestatus.com/incidents/qz5m74q8q0jl\&quot;&gt;Cloudflare was slow&lt;/a&gt;. Between 20:10 and 20:40 UTC on December 16, 2021, web requests served by Cloudflare were artificially delayed by up to five seconds before being processed. This post tells the story of how a missing shell option called “pipefail” slowed Cloudflare down.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;background\&quot;&gt;Background&lt;/h2&gt;\n            &lt;a href=\&quot;#background\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;Before we can tell this story, we need to introduce you to some of its characters.&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/2W5dv9p2aH8jQJ7TgRHg3k/166b93cb03261e6110c8560d1037d7ee/image7-3.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1999\&quot; height=\&quot;1506\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;Cloudflare’s &lt;b&gt;Front Line&lt;/b&gt; protects millions of users from some of the &lt;a href=\&quot;/cloudflare-thwarts-17-2m-rps-ddos-attack-the-largest-ever-reported/\&quot;&gt;largest attacks&lt;/a&gt; ever recorded. This protection is orchestrated by a sidecar service called &lt;code&gt;&lt;b&gt;dosd&lt;/b&gt;&lt;/code&gt;, which analyzes traffic and looks for attacks. When &lt;code&gt;dosd&lt;/code&gt; detects an attack, it provides Front Line with a list of attack fingerprints that describe how Front Line can match and block the attack traffic.&lt;/p&gt;&lt;p&gt;Instances of &lt;code&gt;dosd&lt;/code&gt; run on every Cloudflare server, and they communicate with each other using a peer-to-peer mesh to identify malicious traffic patterns. This decentralized design allows &lt;code&gt;dosd&lt;/code&gt; to perform analysis with much higher fidelity than is possible with a centralized system, but its scale also imposes some strict performance requirements. To meet these requirements, we need to provide &lt;code&gt;dosd&lt;/code&gt; with very fast access to large amounts of configuration data, which naturally means that &lt;code&gt;dosd&lt;/code&gt; depends on &lt;b&gt;Quicksilver&lt;/b&gt;. Cloudflare developed &lt;a href=\&quot;/moving-quicksilver-into-production/\&quot;&gt;Quicksilver&lt;/a&gt; to manage configuration data and replicate it around the world in milliseconds, allowing it to be accessed by services like &lt;code&gt;dosd&lt;/code&gt; in microseconds.&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/5GMjP5VPXF8I00vVTs8TYG/e992ee18efda5bef6970b7d0f4df1c06/image2-5.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1999\&quot; height=\&quot;1506\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;One piece of configuration data that &lt;code&gt;dosd&lt;/code&gt; needs comes from the &lt;b&gt;Addressing API&lt;/b&gt;, which is our authoritative IP address management service. The addressing data it provides is important because &lt;code&gt;dosd&lt;/code&gt; uses it to understand what kind of traffic is expected on particular IPs. Since addressing data doesn’t change very frequently, we use a simple &lt;b&gt;Kubernetes cron job&lt;/b&gt; to query it at 10 minutes past each hour and write it into Quicksilver, allowing it to be efficiently accessed by &lt;code&gt;dosd&lt;/code&gt;.&lt;/p&gt;&lt;p&gt;With this context, let’s walk through the change we made on December 16 that ultimately led to the slowdown.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;the-change\&quot;&gt;The Change&lt;/h2&gt;\n            &lt;a href=\&quot;#the-change\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;Approximately once a week, all of our Bug Fixes and Performance Improvements to the Front Line codebase are released to the network. On December 16, the Front Line team released a fix for a subtle bug in how the code handled compression in the presence of a &lt;code&gt;Cache-Control: no-transform&lt;/code&gt; header. Unfortunately, the team realized pretty quickly that this fix actually broke some customers who had started &lt;i&gt;depending&lt;/i&gt; on that buggy behavior, so the team decided to roll back the release and work with those customers to correct the issue.&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/2CY4wCLdkRVp38bNOgLSYc/260fb9ef0e342f8581860a905bca0898/image3-5.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1999\&quot; height=\&quot;560\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;Here’s a graph showing the progression of the rollback. While most releases and rollbacks are fully automated, this particular rollback needed to be performed manually due to its urgency. Since this was a manual rollback, SREs decided to perform it in two batches as a safety measure. The first batch went to our smaller tier 2 and 3 data centers, and the second batch went to our larger tier 1 data centers.&lt;/p&gt;&lt;p&gt;SREs started the first batch at 19:25 UTC, and it completed in about 30 minutes. Then, after verifying that there were no issues, they started the second batch at 20:10. That’s when the slowdown started.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;the-slowdown\&quot;&gt;The Slowdown&lt;/h2&gt;\n            &lt;a href=\&quot;#the-slowdown\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;Within minutes of starting the second batch of rollbacks, alerts started firing. “Traffic levels are dropping.” “CPU utilization is dropping.” “A P0 incident has been automatically declared.” The timing could not be a coincidence. Somehow, a deployment of known-good code, which had been limited to a subset of the network and which had just been successfully performed 40 minutes earlier, appeared to be causing a global problem.&lt;/p&gt;&lt;p&gt;A P0 incident is an “all hands on deck” emergency, so dozens of Cloudflare engineers quickly began to assess impact to their services and test their theories about the root cause. The rollback was paused, but that did not fix the problem. Then, approximately 10 minutes after the start of the incident, my team – the DOS team – received a concerning alert: “&lt;code&gt;dosd&lt;/code&gt; is not running on numerous servers.” Before that alert fired we had been investigating whether the slowdown was caused by an unmitigated attack, but this required our immediate attention.&lt;/p&gt;&lt;p&gt;Based on service logs, we were able to see that &lt;code&gt;dosd&lt;/code&gt; was &lt;a href=\&quot;https://doc.rust-lang.org/book/ch09-03-to-panic-or-not-to-panic.html\&quot;&gt;panicking&lt;/a&gt; because the customer addressing data in Quicksilver was corrupted in some way. Remember: the data in this Quicksilver key is important. Without it, &lt;code&gt;dosd&lt;/code&gt; could not make correct choices anymore, so it refused to continue.&lt;/p&gt;&lt;p&gt;Once we realized that the addressing data was corrupted, we had to figure out how it was corrupted so that we could fix it. The answer turned out to be pretty obvious: the Quicksilver key was completely empty.&lt;/p&gt;&lt;p&gt;Following the old adage – “did you try restarting it?” – we decided to manually re-run the Kubernetes cron job that populates this key and see what happened. At 20:40 UTC, the cron job was manually triggered. Seconds after it completed, &lt;code&gt;dosd&lt;/code&gt; started running again, and traffic levels began returning to normal. We confirmed that the Quicksilver key was no longer empty, and the incident was over.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;the-aftermath\&quot;&gt;The Aftermath&lt;/h2&gt;\n            &lt;a href=\&quot;#the-aftermath\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;Despite fixing the problem, we still didn’t really understand what had just happened.&lt;/p&gt;&lt;!--kg-card-begin: html--&gt;&lt;h5&gt;Why was the Quicksilver key empty?&lt;/h5&gt;&lt;!--kg-card-end: html--&gt;&lt;p&gt;It was urgent that we quickly figure out how an empty value was written into that Quicksilver key, because for all we knew, it could happen again at any moment.&lt;/p&gt;&lt;p&gt;We started by looking at the Kubernetes cron job, which turned out to have a bug:&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/3aUI8NLFqWrUDAwPCgITNq/790db9c627fe3f07005f9bea64856191/cron.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1600\&quot; height=\&quot;438\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;This cron job is implemented using a small Bash script. If you’re unfamiliar with Bash (particularly &lt;a href=\&quot;https://en.wikipedia.org/wiki/Pipeline_(Unix)\&quot;&gt;shell pipelining&lt;/a&gt;), here’s what it does:&lt;/p&gt;&lt;p&gt;First, the &lt;code&gt;dos-make-addr-conf&lt;/code&gt; executable runs. Its job is to query the Addressing API for various bits of JSON data and serialize it into a &lt;a href=\&quot;https://toml.io/\&quot;&gt;Toml&lt;/a&gt; document, which gets written Into &lt;code&gt;config.toml&lt;/code&gt;. Afterward, that Toml is passed as input into the &lt;code&gt;dosctl&lt;/code&gt; executable, whose job is to simply write it into a Quicksilver key called &lt;code&gt;template_vars&lt;/code&gt;.&lt;/p&gt;&lt;p&gt;Can you spot the bug? Here’s a hint: what happens if &lt;code&gt;dos-make-addr-conf&lt;/code&gt; fails for some reason and exits with a non-zero error code? It turns out that, by default, the shell pipeline ignores the error code and continues executing! This means that the output of &lt;code&gt;dos-make-addr-conf&lt;/code&gt; (which could be empty) gets unconditionally written into &lt;code&gt;dosctl&lt;/code&gt; and used as the value of the &lt;code&gt;template_vars&lt;/code&gt; key, regardless of whether &lt;code&gt;dos-make-addr-conf&lt;/code&gt; succeeded or failed.&lt;/p&gt;&lt;p&gt;30 years ago, when the first users of Bourne shell were burned by this problem, a shell option called “pipefail” was introduced. Enabling this option changes the shell’s behavior so that, when any command in a pipeline series fails, the entire pipeline fails. However, this option is not enabled by default, so it’s widely recommended as best practice that all scripts should start by enabling &lt;a href=\&quot;https://sipb.mit.edu/doc/safe-shell/\&quot;&gt;this (and a few other) options&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;Here’s the fixed version of that cron job:&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1T2JIQhn9ok8YfZPVrRBR3/1e1603db3355688999e30165dad8eb0b/cron-fixed.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1600\&quot; height=\&quot;496\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;This bug was particularly insidious because &lt;code&gt;dosd&lt;/code&gt; actually did attempt to gracefully handle the case where this Quicksilver key contained invalid Toml. However, an empty string is a perfectly valid Toml document. If an error message had been accidentally written into this Quicksilver key instead of an empty string, then &lt;code&gt;dosd&lt;/code&gt; would have rejected the update and continued to use the previous value.&lt;/p&gt;&lt;!--kg-card-begin: html--&gt;&lt;h5&gt;Why did that cause the Front Line to slow down?&lt;/h5&gt;&lt;!--kg-card-end: html--&gt;&lt;p&gt;We had figured out how an empty key could be written into Quicksilver, and we were confident that it wouldn’t happen again. However, we still needed to untangle how that empty key caused such a severe incident.&lt;/p&gt;&lt;p&gt;As I mentioned earlier, the Front Line relies on &lt;code&gt;dosd&lt;/code&gt; to tell it how to mitigate attacks, but it doesn’t depend on &lt;code&gt;dosd&lt;/code&gt; directly to serve requests. Instead, once every few seconds, the Front Line asynchronously asks &lt;code&gt;dosd&lt;/code&gt; for new attack fingerprints and stores them in an in-memory cache. This cache is consulted while serving each request, and if &lt;code&gt;dosd&lt;/code&gt; ever fails to provide fresh attack fingerprints, then the stale fingerprints will continue to be used instead. So how could this have caused the impact that we saw?&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/USGRrOwhXqmL8Aotx0Ydw/aa50b72ba06a847e4fbc3ab19d33a1c1/image6-3.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1999\&quot; height=\&quot;1506\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;As part of the rollback process, the Front Line’s code needed to be reloaded. Reloading this code implicitly flushed the in-memory caches, including the attack fingerprint data from &lt;code&gt;dosd&lt;/code&gt;. The next time that a request tried to consult with the cache, the caching layer realized that it had no attack fingerprints to return and a “cache miss” happened.&lt;/p&gt;&lt;p&gt;To handle a cache miss, the caching layer tried to reach out to &lt;code&gt;dosd&lt;/code&gt;, and this is when the slowdown happened. While the caching layer was waiting for &lt;code&gt;dosd&lt;/code&gt; to reply, it blocked all pending requests from progressing. Since &lt;code&gt;dosd&lt;/code&gt; wasn’t running, the attempt eventually timed out after five seconds when the caching layer gave up. But in the meantime, each pending request was stuck waiting for the timeout to happen. Once it did, all the pending requests that were queued up over the five-second timeout period became unblocked and were finally allowed to progress. This cycle repeated over and over again every five seconds on every server until the &lt;code&gt;dosd&lt;/code&gt; failure was resolved.&lt;/p&gt;&lt;p&gt;To trigger this slowdown, not only did &lt;code&gt;dosd&lt;/code&gt; have to fail, but the Front Line’s in-memory cache had to also be flushed at the same time. If &lt;code&gt;dosd&lt;/code&gt; had failed, but the Front Line’s cache had not been flushed, then the stale attack fingerprints would have remained in the cache and request processing would not have been impacted.&lt;/p&gt;&lt;!--kg-card-begin: html--&gt;&lt;h5&gt;Why didn’t the first rollback cause this problem?&lt;/h5&gt;&lt;!--kg-card-end: html--&gt;&lt;p&gt;These two batches of rollbacks were performed by forcing servers to run a &lt;a href=\&quot;https://docs.saltproject.io/en/latest/ref/states/highstate.html\&quot;&gt;Salt highstate&lt;/a&gt;. When each batch was executed, thousands of servers began running highstates at the same time. The highstate process involves, among other things, contacting the Addressing API in order to retrieve various bits of customer addressing information.&lt;/p&gt;&lt;p&gt;The first rollback started at 19:25 UTC, and the second rollback started 45 minutes later at 20:10. Remember how I mentioned that our Kubernetes cron job only runs on the 10th minute of every hour? At 21:10 – exactly the time that our cron job started executing – thousands of servers also began to highstate, flooding the Addressing API with requests. All of these requests were queued up and &lt;i&gt;eventually&lt;/i&gt; served, but it took the Addressing API a few minutes to work through the backlog. This delay was long enough to cause our cron job to time out, and, due to the “pipefail”  bug, inadvertently clobber the Quicksilver key that it was responsible for updating.&lt;/p&gt;&lt;p&gt;To trigger the “pipefail” bug, not only did we have to flood the Addressing API with requests, we also had to do it at exactly 10 minutes after the hour. If SREs had started the second batch of rollbacks a few minutes earlier or later, this bug would have continued to lay dormant.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h2 id=\&quot;lessons-learned\&quot;&gt;Lessons Learned&lt;/h2&gt;\n            &lt;a href=\&quot;#lessons-learned\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n          &lt;p&gt;This was a unique incident where a chain of small or unlikely failures cascaded into a severe and painful outage that we deeply regret. In response, we have hardened each link in the chain:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;A manual rollback inadvertently triggered the thundering herd problem, which overwhelmed the Addressing API. We have since significantly scaled out the Addressing API, so that it can handle high request rates if it ever again has to.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;An error in a Kubernetes cron job caused invalid data to be written to Quicksilver. We have since made sure that, when this cron job fails, it is no longer possible for that failure to clobber the Quicksilver key.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;code&gt;dosd&lt;/code&gt; did not correctly handle all possible error conditions when loading configuration data from Quicksilver, causing it to fail. We have since taken these additional conditions into account where necessary, so that &lt;code&gt;dosd&lt;/code&gt; will gracefully degrade in the face of corrupt Quicksilver data.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;The Front Line had an unexpected dependency on &lt;code&gt;dosd&lt;/code&gt;, which caused it to fail when &lt;code&gt;dosd&lt;/code&gt; failed. We have since removed all such dependencies, and the Front Line will now gracefully survive &lt;code&gt;dosd&lt;/code&gt; failures.&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;More broadly, this incident has served as an example to us of why code and systems must always be resilient to failure, no matter how unlikely that failure may seem.&lt;/p&gt;&quot;],&quot;published_at&quot;:[0,&quot;2022-04-05T13:57:28.000+01:00&quot;],&quot;updated_at&quot;:[0,&quot;2024-10-09T23:18:04.892Z&quot;],&quot;feature_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/QH2rrW2TGXO58Hmm43x5I/fa23d89a629605c63bd9bfd36d18e702/pipefail-how-a-missing-shell-option-slowed-cloudflare-down.png&quot;],&quot;tags&quot;:[1,[[0,{&quot;id&quot;:[0,&quot;3cCNoJJ5uusKFBLYKFX1jB&quot;],&quot;name&quot;:[0,&quot;Post Mortem&quot;],&quot;slug&quot;:[0,&quot;post-mortem&quot;]}],[0,{&quot;id&quot;:[0,&quot;4yliZlpBPZpOwBDZzo1tTh&quot;],&quot;name&quot;:[0,&quot;Outage&quot;],&quot;slug&quot;:[0,&quot;outage&quot;]}],[0,{&quot;id&quot;:[0,&quot;2UVIYusJwlvsmPYl2AvSuR&quot;],&quot;name&quot;:[0,&quot;Deep Dive&quot;],&quot;slug&quot;:[0,&quot;deep-dive&quot;]}],[0,{&quot;id&quot;:[0,&quot;48r7QV00gLMWOIcM1CSDRy&quot;],&quot;name&quot;:[0,&quot;Speed &amp; Reliability&quot;],&quot;slug&quot;:[0,&quot;speed-and-reliability&quot;]}]]],&quot;relatedTags&quot;:[0],&quot;authors&quot;:[1,[[0,{&quot;name&quot;:[0,&quot;Alex Forster&quot;],&quot;slug&quot;:[0,&quot;alex-forster&quot;],&quot;bio&quot;:[0,null],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/4pCN3DTLyeVoIeQ2amvqdy/dd9104d78b872da4184d71f64c4cb35c/alex-forster.png&quot;],&quot;location&quot;:[0,null],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,&quot;@alex_forster&quot;],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}]]],&quot;meta_description&quot;:[0,&quot;At Cloudflare, we’re used to being the fastest in the world. However, for approximately 30 minutes last December, Cloudflare was slow. Between 20:10 and 20:40 UTC on December 16th, web requests served by Cloudflare were artificially delayed by up to five seconds before being processed. This post tells the story of how a missing shell option called “pipefail” slowed Cloudflare down.&quot;],&quot;primary_author&quot;:[0,{}],&quot;localeList&quot;:[0,{&quot;name&quot;:[0,&quot;PIPEFAIL: How a missing shell option slowed Cloudflare down Config&quot;],&quot;enUS&quot;:[0,&quot;English for Locale&quot;],&quot;zhCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhHansCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhTW&quot;:[0,&quot;No Page for Locale&quot;],&quot;frFR&quot;:[0,&quot;No Page for Locale&quot;],&quot;deDE&quot;:[0,&quot;No Page for Locale&quot;],&quot;itIT&quot;:[0,&quot;No Page for Locale&quot;],&quot;jaJP&quot;:[0,&quot;No Page for Locale&quot;],&quot;koKR&quot;:[0,&quot;No Page for Locale&quot;],&quot;ptBR&quot;:[0,&quot;No Page for Locale&quot;],&quot;esLA&quot;:[0,&quot;No Page for Locale&quot;],&quot;esES&quot;:[0,&quot;No Page for Locale&quot;],&quot;enAU&quot;:[0,&quot;No Page for Locale&quot;],&quot;enCA&quot;:[0,&quot;No Page for Locale&quot;],&quot;enIN&quot;:[0,&quot;No Page for Locale&quot;],&quot;enGB&quot;:[0,&quot;No Page for Locale&quot;],&quot;idID&quot;:[0,&quot;No Page for Locale&quot;],&quot;ruRU&quot;:[0,&quot;No Page for Locale&quot;],&quot;svSE&quot;:[0,&quot;No Page for Locale&quot;],&quot;viVN&quot;:[0,&quot;No Page for Locale&quot;],&quot;plPL&quot;:[0,&quot;No Page for Locale&quot;],&quot;arAR&quot;:[0,&quot;No Page for Locale&quot;],&quot;nlNL&quot;:[0,&quot;No Page for Locale&quot;],&quot;thTH&quot;:[0,&quot;No Page for Locale&quot;],&quot;trTR&quot;:[0,&quot;No Page for Locale&quot;],&quot;heIL&quot;:[0,&quot;No Page for Locale&quot;],&quot;lvLV&quot;:[0,&quot;No Page for Locale&quot;],&quot;etEE&quot;:[0,&quot;No Page for Locale&quot;],&quot;ltLT&quot;:[0,&quot;No Page for Locale&quot;]}],&quot;url&quot;:[0,&quot;https://blog.cloudflare.com/pipefail-how-a-missing-shell-option-slowed-cloudflare-down&quot;],&quot;metadata&quot;:[0,{&quot;title&quot;:[0,&quot;PIPEFAIL: How a missing shell option slowed Cloudflare down&quot;],&quot;description&quot;:[0,&quot;At Cloudflare, we’re used to being the fastest in the world. However, for approximately 30 minutes last December, Cloudflare was slow. Between 20:10 and 20:40 UTC on December 16th, web requests served by Cloudflare were artificially delayed by up to five seconds before being processed. This post tells the story of how a missing shell option called “pipefail” slowed Cloudflare down.&quot;],&quot;imgPreview&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/4cTeLXK7Sh5UBlUdmNS31B/f849fd02b21e9d4393200ca7992a89a6/pipefail-how-a-missing-shell-option-slowed-cloudflare-down-SM93yI.png&quot;]}],&quot;publicly_index&quot;:[0,true]}],[0,{&quot;id&quot;:[0,&quot;2adIs12PUMYCgRU2zfLCJs&quot;],&quot;title&quot;:[0,&quot;Cloudflare’s investigation of the January 2022 Okta compromise&quot;],&quot;slug&quot;:[0,&quot;cloudflare-investigation-of-the-january-2022-okta-compromise&quot;],&quot;excerpt&quot;:[0,&quot;Today at 03:30 UTC we learnt of a compromise of Okta. We use Okta internally for employee identity as part of our authentication stack. We have investigated this compromise carefully and do not believe we have been compromised as a result&quot;],&quot;featured&quot;:[0,false],&quot;html&quot;:[0,&quot;&lt;p&gt;Today, March 22, 2022 at 03:30 UTC we learnt of a compromise of Okta. We use Okta internally for employee identity as part of our authentication stack. We have investigated this compromise carefully and do not believe we have been compromised as a result. We do not use Okta for customer accounts; customers do not need to take any action unless they themselves use Okta.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;investigation-and-actions\&quot;&gt;Investigation and actions&lt;/h3&gt;\n            &lt;a href=\&quot;#investigation-and-actions\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Our &lt;a href=\&quot;https://twitter.com/toddmckinnon/status/1506184721922859010\&quot;&gt;understanding&lt;/a&gt; is that during January 2022, hackers outside Okta had access to an Okta support employee’s account and were able to take actions as if they were that employee. In a screenshot shared on social media, a Cloudflare employee’s email address was visible, along with a popup indicating the hacker was posing as an Okta employee and could have initiated a password reset.&lt;/p&gt;&lt;p&gt;We learnt of this incident via Cloudflare’s internal SIRT. SIRT is our Security Incident Response Team and any employee at Cloudflare can alert SIRT to a potential problem. At exactly 03:30 UTC, a Cloudflare employee emailed SIRT with a link to a &lt;a href=\&quot;https://twitter.com/_MG_/status/1506109152665382920\&quot;&gt;tweet&lt;/a&gt; that had been sent at 03:22 UTC. The tweet indicated that Okta had potentially been breached. Multiple other Cloudflare employees contacted SIRT over the following two hours.&lt;/p&gt;&lt;p&gt;The following timeline outlines the major steps we took following that initial 03:30 UTC email to SIRT.&lt;/p&gt;&lt;h4&gt;Timeline (times in UTC)&lt;/h4&gt;&lt;p&gt;03:30 - SIRT receives the first warning of the existence of the tweets.&lt;/p&gt;&lt;p&gt;03:38 - SIRT sees that the tweets contain information about Cloudflare (logo, user information).&lt;/p&gt;&lt;p&gt;03:41 - SIRT creates an incident room to start the investigation and starts gathering the necessary people.&lt;/p&gt;&lt;p&gt;03:50 - SIRT concludes that there were no relevant audit log events (such as password changes) for the user that appears in the screenshot mentioned above.&lt;/p&gt;&lt;p&gt;04:13 - Reached out to Okta directly asking for detailed information to help our investigation.&lt;/p&gt;&lt;p&gt;04:23 - All Okta logs that we ingest into our Security Information and Event Management (SIEM) system are reviewed for potential suspicious activities, including password resets over the past three months.&lt;/p&gt;&lt;p&gt;05:03 - SIRT suspends accounts of users that could have been affected.&lt;/p&gt;&lt;p&gt;We temporarily suspended access for the Cloudflare employee whose email address appeared in the hacker’s screenshots.&lt;/p&gt;&lt;p&gt;05:06 - SIRT starts an investigation of access logs (IPs, locations, multifactor methods) for the affected users.&lt;/p&gt;&lt;p&gt;05:38 - First &lt;a href=\&quot;https://twitter.com/eastdakota/status/1506143353544478724\&quot;&gt;tweet&lt;/a&gt; from Matthew Prince acknowledging the issue.&lt;/p&gt;&lt;p&gt;Because it appeared that an Okta support employee with access to do things like force a password reset on an Okta customer account had been compromised, we decided to look at every employee who had reset their password or modified their Multi-Factor Authentication (MFA) in any way since December 1 up until today. Since Dec. 1, 2021, 144 Cloudflare employees had reset their password or modified their MFA. We forced a password reset for them all and let them know of the change.&lt;/p&gt;&lt;p&gt;05:44 - A list of all users that changed their password in the last three months is finalized. All accounts were required to go through a password reset.&lt;/p&gt;&lt;p&gt;06:40 - &lt;a href=\&quot;https://twitter.com/eastdakota/status/1506158901078618118\&quot;&gt;Tweet&lt;/a&gt; from Matthew Prince about the password reset.&lt;/p&gt;&lt;p&gt;07:57 - We received confirmation from Okta that there were no relevant events that may indicate malicious activity in their support console for Cloudflare instances.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;how-cloudflare-uses-okta\&quot;&gt;How Cloudflare uses Okta&lt;/h3&gt;\n            &lt;a href=\&quot;#how-cloudflare-uses-okta\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Cloudflare uses Okta internally as our identity provider, integrated with Cloudflare Access to guarantee that our users can safely access internal resources. In previous blog posts, we described &lt;a href=\&quot;/dogfooding-from-home/\&quot;&gt;how we use Access to protect internal resources&lt;/a&gt; and &lt;a href=\&quot;/securing-cloudflare-using-cloudflare/\&quot;&gt;how we integrated hardware tokens to make our user authentication process more resilient&lt;/a&gt; and &lt;a href=\&quot;/account-compromise-security-overview/\&quot;&gt;prevent account takeovers&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;In the case of the Okta compromise, it would not suffice to just change a user&amp;#39;s password. The attacker would also need to change the hardware (FIDO) token configured for the same user. As a result it would be easy to spot compromised accounts based on the associated hardware keys.&lt;/p&gt;&lt;p&gt;Even though logs are available in the Okta console, we also store them in our own systems. This adds an extra layer of security as we are able to store logs longer than what is available in the Okta console. That also ensures that a compromise in the Okta platform cannot alter evidence we have already collected and stored.&lt;/p&gt;&lt;p&gt;Okta is not used for customer authentication on our systems, and we do not store any customer data in Okta. It is only used for managing the accounts of our employees.&lt;/p&gt;&lt;p&gt;The main actions we took during this incident were:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;&lt;p&gt;Reach out to Okta to gather more information on what is known about the attack.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Suspend the one Cloudflare account visible in the screenshots.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Search the &lt;a href=\&quot;https://developer.okta.com/docs/reference/api/system-log/\&quot;&gt;Okta System logs&lt;/a&gt; for any signs of compromise (password changes, hardware token changes, etc.). Cloudflare reads the system Okta logs every five minutes and stores these in our SIEM so that if we were to experience an incident such as this one, we can look back further than the 90 days provided in the Okta dashboard. Some event types within Okta that we searched for are: &lt;code&gt;user.account.reset_password&lt;/code&gt;, &lt;code&gt;user.mfa.factor.update&lt;/code&gt;, &lt;code&gt;system.mfa.factor.deactivate&lt;/code&gt;, &lt;code&gt;user.mfa.attempt_bypass&lt;/code&gt;, and &lt;code&gt;user.session.impersonation.initiate&lt;/code&gt;. It’s unclear from communications we’ve received from Okta so far who we would expect the &lt;a href=\&quot;https://developer.okta.com/docs/reference/api/system-log/#actor-object\&quot;&gt;System Log Actor&lt;/a&gt; to be from the compromise of an Okta support employee.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Search &lt;a href=\&quot;https://support.google.com/a/answer/11479100?ref_topic=11479095\&quot;&gt;Google Workplace email logs&lt;/a&gt; to view password resets. We confirmed password resets matched the Okta System logs using a separate source from Okta considering they were breached, and we were not sure how reliable their logging would be.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Compile a list of Cloudflare employee accounts that changed their passwords in the last three months and require a new password reset for all of them. As part of their account recovery, each user will join a video call with the Cloudflare IT team to verify their identity prior to having their account re-enabled.&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;what-to-do-if-you-are-an-okta-customer\&quot;&gt;What to do if you are an Okta customer&lt;/h3&gt;\n            &lt;a href=\&quot;#what-to-do-if-you-are-an-okta-customer\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;If you are also an Okta customer, you should reach out to them for further information. We advise the following actions:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;&lt;p&gt;Enable MFA for all user accounts. Passwords alone do not offer the necessary level of protection against attacks. We strongly recommend the usage of hard keys, as other methods of MFA can be vulnerable to phishing attacks.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Investigate and respond:a. Check all password and MFA changes for your Okta instances.b. Pay special attention to support initiated events.c. Make sure all password resets are valid or just assume they are all under suspicion and force a new password reset.d. If you find any suspicious MFA-related events, make sure only valid MFA keys are present in the user&amp;#39;s account configuration.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Make sure you have other security layers to provide extra security in case one of them fails.&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;conclusion\&quot;&gt;Conclusion&lt;/h3&gt;\n            &lt;a href=\&quot;#conclusion\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Cloudflare’s Security and IT teams are continuing to work on this compromise. If further information comes to light that indicates compromise beyond the January timeline we will publish further posts detailing our findings and actions.&lt;/p&gt;&lt;p&gt;We are also in contact with Okta with a number of requests for additional logs and information. If anything comes to light that alters our assessment of the situation we will update the blog or write further posts.&lt;/p&gt;&quot;],&quot;published_at&quot;:[0,&quot;2022-03-22T16:57:44.000+00:00&quot;],&quot;updated_at&quot;:[0,&quot;2024-10-09T23:17:57.380Z&quot;],&quot;feature_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1lPEkvJ5REDKWhFjfIjhQj/0dd9390650bbedbd8979e5c0a49daa67/cloudflare-investigation-of-the-january-2022-okta-compromise.png&quot;],&quot;tags&quot;:[1,[[0,{&quot;id&quot;:[0,&quot;73fu66Q9EEIvQ8MOXiWoMH&quot;],&quot;name&quot;:[0,&quot;Okta&quot;],&quot;slug&quot;:[0,&quot;okta&quot;]}],[0,{&quot;id&quot;:[0,&quot;6Mp7ouACN2rT3YjL1xaXJx&quot;],&quot;name&quot;:[0,&quot;Security&quot;],&quot;slug&quot;:[0,&quot;security&quot;]}],[0,{&quot;id&quot;:[0,&quot;3cCNoJJ5uusKFBLYKFX1jB&quot;],&quot;name&quot;:[0,&quot;Post Mortem&quot;],&quot;slug&quot;:[0,&quot;post-mortem&quot;]}]]],&quot;relatedTags&quot;:[0],&quot;authors&quot;:[1,[[0,{&quot;name&quot;:[0,&quot;John Graham-Cumming&quot;],&quot;slug&quot;:[0,&quot;john-graham-cumming&quot;],&quot;bio&quot;:[0,null],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/5vGNsXzZrtSLn2X30pnpUY/6f350e7dd36058a6422f9199b452bb02/john-graham-cumming.jpg&quot;],&quot;location&quot;:[0,&quot;Lisbon, Portugal&quot;],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,null],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}],[0,{&quot;name&quot;:[0,&quot;Lucas Ferreira&quot;],&quot;slug&quot;:[0,&quot;lucas-ferreira&quot;],&quot;bio&quot;:[0,null],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/6gNuYocEXTyvW1rHi3kwIA/33e9927372dfaff0b3f4210a89bbc6fd/lucas-ferreira.jpeg&quot;],&quot;location&quot;:[0,&quot;Lisbon&quot;],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,&quot;@lucassapao&quot;],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}],[0,{&quot;name&quot;:[0,&quot;Daniel Stinson-Diess&quot;],&quot;slug&quot;:[0,&quot;daniel-stinson-diess&quot;],&quot;bio&quot;:[0,&quot;Security @ Cloudflare.&quot;],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1BGQGSJbC4bHwCMQQYbuEn/05b88bc2f83671272ecadd4856bc4bc0/daniel-stinson-diess.png&quot;],&quot;location&quot;:[0,null],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,&quot;@shellcromancer&quot;],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}]]],&quot;meta_description&quot;:[0,&quot;Today at 03:30 UTC we learnt of a compromise of Okta. We use Okta internally for employee identity as part of our authentication stack. We have investigated this compromise carefully and do not believe we have been compromised as a result.&quot;],&quot;primary_author&quot;:[0,{}],&quot;localeList&quot;:[0,{&quot;name&quot;:[0,&quot;Cloudflare’s investigation of the January 2022 Okta compromise Config&quot;],&quot;enUS&quot;:[0,&quot;English for Locale&quot;],&quot;zhCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhHansCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhTW&quot;:[0,&quot;No Page for Locale&quot;],&quot;frFR&quot;:[0,&quot;No Page for Locale&quot;],&quot;deDE&quot;:[0,&quot;No Page for Locale&quot;],&quot;itIT&quot;:[0,&quot;No Page for Locale&quot;],&quot;jaJP&quot;:[0,&quot;Translated for Locale&quot;],&quot;koKR&quot;:[0,&quot;No Page for Locale&quot;],&quot;ptBR&quot;:[0,&quot;No Page for Locale&quot;],&quot;esLA&quot;:[0,&quot;No Page for Locale&quot;],&quot;esES&quot;:[0,&quot;Translated for Locale&quot;],&quot;enAU&quot;:[0,&quot;No Page for Locale&quot;],&quot;enCA&quot;:[0,&quot;No Page for Locale&quot;],&quot;enIN&quot;:[0,&quot;No Page for Locale&quot;],&quot;enGB&quot;:[0,&quot;No Page for Locale&quot;],&quot;idID&quot;:[0,&quot;No Page for Locale&quot;],&quot;ruRU&quot;:[0,&quot;No Page for Locale&quot;],&quot;svSE&quot;:[0,&quot;No Page for Locale&quot;],&quot;viVN&quot;:[0,&quot;No Page for Locale&quot;],&quot;plPL&quot;:[0,&quot;No Page for Locale&quot;],&quot;arAR&quot;:[0,&quot;No Page for Locale&quot;],&quot;nlNL&quot;:[0,&quot;No Page for Locale&quot;],&quot;thTH&quot;:[0,&quot;No Page for Locale&quot;],&quot;trTR&quot;:[0,&quot;No Page for Locale&quot;],&quot;heIL&quot;:[0,&quot;No Page for Locale&quot;],&quot;lvLV&quot;:[0,&quot;No Page for Locale&quot;],&quot;etEE&quot;:[0,&quot;No Page for Locale&quot;],&quot;ltLT&quot;:[0,&quot;No Page for Locale&quot;]}],&quot;url&quot;:[0,&quot;https://blog.cloudflare.com/cloudflare-investigation-of-the-january-2022-okta-compromise&quot;],&quot;metadata&quot;:[0,{&quot;title&quot;:[0,&quot;Cloudflare’s investigation of the January 2022 Okta compromise&quot;],&quot;description&quot;:[0,&quot;Today at 03:30 UTC we learnt of a compromise of Okta. We use Okta internally for employee identity as part of our authentication stack. We have investigated this compromise carefully and do not believe we have been compromised as a result.&quot;],&quot;imgPreview&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1qtgqkpuXcZFxQvWSbRpOA/2493a023cb9ac02b60333471b863d41e/cloudflare-investigation-of-the-january-2022-okta-compromise-QIuVdm.png&quot;]}],&quot;publicly_index&quot;:[0,true]}],[0,{&quot;id&quot;:[0,&quot;2ZWbB5QAV3XoI1iJe1T0dz&quot;],&quot;title&quot;:[0,&quot;Incorrect proxying of 24 hostnames on January 24, 2022&quot;],&quot;slug&quot;:[0,&quot;incorrect-proxying-of-24-hostnames-on-january-24-2022&quot;],&quot;excerpt&quot;:[0,&quot;On January 24, 2022, as a result of an internal product migration, 24 hostnames (including www.cloudflare.com) that were actively proxied through the Cloudflare global network were mistakenly redirected to the wrong origin&quot;],&quot;featured&quot;:[0,false],&quot;html&quot;:[0,&quot;&lt;p&gt;On January 24, 2022, as a result of an internal Cloudflare product migration, 24 hostnames (including &lt;a href=\&quot;http://www.cloudflare.com\&quot;&gt;www.cloudflare.com&lt;/a&gt;) that were actively proxied through the Cloudflare global network were mistakenly redirected to the wrong origin. During this incident, traffic destined for these hostnames was passed through to the clickfunnels.com origin and may have resulted in a &lt;code&gt;clickfunnels.com&lt;/code&gt; page being displayed instead of the intended website. This was our doing and clickfunnels.com was unaware of our error until traffic started to reach their origin.&lt;/p&gt;&lt;p&gt;API calls or other expected responses to and from these hostnames may not have responded properly, or may have failed completely. For example, if you were making an API call to api.example.com, and api.example.com was an impacted hostname, you likely would not have received the response you would have expected.&lt;/p&gt;&lt;p&gt;Here is what happened:&lt;/p&gt;&lt;p&gt;At 2022-01-24 22:24 UTC we started a migration of hundreds of thousands of custom hostnames to the Cloudflare for SaaS product. Cloudflare for SaaS allows SaaS providers to manage their customers’ websites and SSL certificates at scale - more information is available &lt;a href=\&quot;/cloudflare-for-saas/\&quot;&gt;here&lt;/a&gt;. This &lt;a href=\&quot;https://developers.cloudflare.com/ssl/ssl-for-saas/reference/versioning\&quot;&gt;migration&lt;/a&gt; was intended to be completely seamless, with the outcome being enhanced features and security for our customers. The migration process was designed to read the custom hostname configuration from a database and migrate it from SaaS v1 (the old system) to SaaS v2 (the current version) automatically.&lt;/p&gt;&lt;p&gt;To better understand what happened next, it’s important to explain a bit more about how custom hostnames are configured.&lt;/p&gt;&lt;p&gt;First, Cloudflare for SaaS customers can configure any hostname; but before we will proxy traffic to them, they must prove (via DNS validation) that they actually are allowed to handle that hostname’s traffic.&lt;/p&gt;&lt;p&gt;When the Cloudflare for SaaS customer first configures the hostname, it is marked as pending until DNS validation has occurred. Pending hostnames are very common for Cloudflare for SaaS customers as the hostname gets provisioned, and then the SaaS provider will typically work with their customer to put in place the appropriate DNS validation that proves ownership.&lt;/p&gt;&lt;p&gt;Once a hostname passes DNS validation, it moves from a pending state to an active state and can be proxied. Except in one case: there’s a special check for whether the hostname is marked as blocked within Cloudflare’s system. A blocked hostname is one that can’t be activated without manual approval by our Trust &amp;amp; Safety team. Some scenarios that could lead to a hostname being blocked include when the hostname is a Cloudflare-owned property, a well known brand, or a hostname in need of additional review for a variety of reasons.&lt;/p&gt;&lt;p&gt;During this incident, a very small number of blocked hostnames were erroneously moved to the active state while migrating clickfunnels.com’s customers. Once that occurred, traffic destined for those previously blocked hostnames was then processed by a configuration belonging to clickfunnels.com, sending traffic to the clickfunnels.com’s origin. One of those hostnames was &lt;a href=\&quot;http://www.cloudflare.com\&quot;&gt;www.cloudflare.com&lt;/a&gt;. Note that it was &lt;a href=\&quot;http://www.cloudflare.com\&quot;&gt;www.cloudflare.com&lt;/a&gt; and not cloudflare.com, so subdomains like dash.cloudflare.com, api.cloudflare.com, cdnjs.cloudflare.com, and so on were unaffected by this problem.&lt;/p&gt;&lt;p&gt;As the migration process continued down the list of hostnames, additional traffic was re-routed to the clickfunnels.com origin. At 23:06 UTC &lt;a href=\&quot;http://www.cloudflare.com\&quot;&gt;www.cloudflare.com&lt;/a&gt; was affected. At 23:15 UTC an incident was declared internally. Since the first alert we received was for &lt;a href=\&quot;http://www.cloudflare.com\&quot;&gt;www.cloudflare.com&lt;/a&gt;, we started our investigation there. In the next 19 minutes, the team restored &lt;a href=\&quot;http://www.cloudflare.com\&quot;&gt;www.cloudflare.com&lt;/a&gt; to its correct origin, determined the breadth of the impact and the root cause of the incident, and began remediation for the remaining affected hostnames.&lt;/p&gt;&lt;p&gt;By 2022-01-25 00:13 UTC, all custom hostnames had been restored to their proper configuration and the incident was closed. We have contacted all the customers who were affected by this error. We have worked with ClickFunnels to delete logs of this event to ensure that no data erroneously sent to the clickfunnels.com’s origin is retained by them and are very grateful for their speedy assistance.&lt;/p&gt;&lt;p&gt;Here is a graph (on a log scale) of requests to clickfunnels.com during the event. Out of a total of 268,430,157 requests redirected, 268,220,296 (99.92%) were for &lt;a href=\&quot;http://www.cloudflare.com\&quot;&gt;www.cloudflare.com&lt;/a&gt;:&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1ZJtL8tRo16K0DbDL5D2lj/720a2b3ff7593778925e94f6d0af1084/unnamed-16.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1196\&quot; height=\&quot;664\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;At Cloudflare, we take these types of incidents very seriously, dedicating massive amounts of resources in preventative action and in follow-up engineering. In this case, there are both procedural and technical follow-ups to prevent reoccurrence. Here are our next steps:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;No more blocked hostname overrides. All blocked hostname changes will route through our verification pipeline as part of the migration process.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;All migrations will require explicit validation and approval from SaaS customers for a blocked hostname to be considered for activation.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Additional monitoring will be added to the hostnames being migrated to spot potential erroneous traffic patterns and alert the migration team.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Additional monitoring added for &lt;a href=\&quot;http://www.cloudflare.com\&quot;&gt;www.cloudflare.com&lt;/a&gt;.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Stage hostname activations on non-production elements prior to promoting to production will enable the ability to verify the new hostname state is expected. This will allow us to catch issues before they hit production traffic.&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;conclusion\&quot;&gt;Conclusion&lt;/h3&gt;\n            &lt;a href=\&quot;#conclusion\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;This event exposed previously unknown gaps in our process and technology that directly impacted our customers. We are truly sorry for the disruption to our customers and any potential visitor to the impacted properties. Our commitment is to provide fully reliable and secure products, and we will continue to make every effort possible to deliver just that for our customers and partners.&lt;/p&gt;&quot;],&quot;published_at&quot;:[0,&quot;2022-01-26T18:34:08.000+00:00&quot;],&quot;updated_at&quot;:[0,&quot;2024-10-09T23:17:05.508Z&quot;],&quot;feature_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/6IeXybuliWDzpWxEqvcuP4/6f630d424bb4a05b7c9eaac7861074c6/incorrect-proxying-of-24-hostnames-on-january-24-2022.png&quot;],&quot;tags&quot;:[1,[[0,{&quot;id&quot;:[0,&quot;3cCNoJJ5uusKFBLYKFX1jB&quot;],&quot;name&quot;:[0,&quot;Post Mortem&quot;],&quot;slug&quot;:[0,&quot;post-mortem&quot;]}]]],&quot;relatedTags&quot;:[0],&quot;authors&quot;:[1,[[0,{&quot;name&quot;:[0,&quot;Jeremy Hartman&quot;],&quot;slug&quot;:[0,&quot;jeremy-hartman&quot;],&quot;bio&quot;:[0,null],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1yTvNpd60qmjgY8fbItcDp/f964f6cd281c1693cee7b4a43a6e3845/jeremy-hartman.jpeg&quot;],&quot;location&quot;:[0,null],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,null],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}]]],&quot;meta_description&quot;:[0,&quot;On January 24, 2022, as a result of an internal product migration, 24 hostnames (including www.cloudflare.com) that were actively proxied through the Cloudflare global network were mistakenly redirected to the wrong origin&quot;],&quot;primary_author&quot;:[0,{}],&quot;localeList&quot;:[0,{&quot;name&quot;:[0,&quot;Incorrect proxying of 24 hostnames on January 24, 2022 Config&quot;],&quot;enUS&quot;:[0,&quot;English for Locale&quot;],&quot;zhCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhHansCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhTW&quot;:[0,&quot;No Page for Locale&quot;],&quot;frFR&quot;:[0,&quot;No Page for Locale&quot;],&quot;deDE&quot;:[0,&quot;No Page for Locale&quot;],&quot;itIT&quot;:[0,&quot;No Page for Locale&quot;],&quot;jaJP&quot;:[0,&quot;No Page for Locale&quot;],&quot;koKR&quot;:[0,&quot;No Page for Locale&quot;],&quot;ptBR&quot;:[0,&quot;No Page for Locale&quot;],&quot;esLA&quot;:[0,&quot;No Page for Locale&quot;],&quot;esES&quot;:[0,&quot;No Page for Locale&quot;],&quot;enAU&quot;:[0,&quot;No Page for Locale&quot;],&quot;enCA&quot;:[0,&quot;No Page for Locale&quot;],&quot;enIN&quot;:[0,&quot;No Page for Locale&quot;],&quot;enGB&quot;:[0,&quot;No Page for Locale&quot;],&quot;idID&quot;:[0,&quot;No Page for Locale&quot;],&quot;ruRU&quot;:[0,&quot;No Page for Locale&quot;],&quot;svSE&quot;:[0,&quot;No Page for Locale&quot;],&quot;viVN&quot;:[0,&quot;No Page for Locale&quot;],&quot;plPL&quot;:[0,&quot;No Page for Locale&quot;],&quot;arAR&quot;:[0,&quot;No Page for Locale&quot;],&quot;nlNL&quot;:[0,&quot;No Page for Locale&quot;],&quot;thTH&quot;:[0,&quot;No Page for Locale&quot;],&quot;trTR&quot;:[0,&quot;No Page for Locale&quot;],&quot;heIL&quot;:[0,&quot;No Page for Locale&quot;],&quot;lvLV&quot;:[0,&quot;No Page for Locale&quot;],&quot;etEE&quot;:[0,&quot;No Page for Locale&quot;],&quot;ltLT&quot;:[0,&quot;No Page for Locale&quot;]}],&quot;url&quot;:[0,&quot;https://blog.cloudflare.com/incorrect-proxying-of-24-hostnames-on-january-24-2022&quot;],&quot;metadata&quot;:[0,{&quot;title&quot;:[0,&quot;Incorrect proxying of 24 hostnames on January 24, 2022&quot;],&quot;description&quot;:[0,&quot;On January 24, 2022, as a result of an internal product migration, 24 hostnames (including www.cloudflare.com) that were actively proxied through the Cloudflare global network were mistakenly redirected to the wrong origin&quot;],&quot;imgPreview&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/6tRxMlRAFsooZyjruXcrZQ/10b160dafff9d30e9ca4505ea18bcf43/incorrect-proxying-of-24-hostnames-on-january-24-2022-R4oi05.png&quot;]}],&quot;publicly_index&quot;:[0,true]}],[0,{&quot;id&quot;:[0,&quot;7cztH7o1B3T3GmwGGNBZ6v&quot;],&quot;title&quot;:[0,&quot;A Byzantine failure in the real world&quot;],&quot;slug&quot;:[0,&quot;a-byzantine-failure-in-the-real-world&quot;],&quot;excerpt&quot;:[0,&quot;At Cloudflare, we are always on the lookout for Single Points of Failure. In this post, we explore the role a failure mode known as a Byzantine fault played in a a real-world incident.&quot;],&quot;featured&quot;:[0,false],&quot;html&quot;:[0,&quot;&lt;p&gt;&lt;i&gt;An analysis of the Cloudflare API availability incident on 2020-11-02&lt;/i&gt;&lt;/p&gt;&lt;p&gt;When we review design documents at Cloudflare, we are always on the lookout for Single Points of Failure (SPOFs). Eliminating these is a necessary step in architecting a system you can be confident in. Ironically, when you’re designing a system with built-in redundancy, you spend most of your time thinking about how well it functions when that redundancy is lost.&lt;/p&gt;&lt;p&gt;On November 2, 2020, Cloudflare had an &lt;a href=\&quot;https://www.cloudflarestatus.com/incidents/9ggr0k6dwzwg\&quot;&gt;incident&lt;/a&gt; that impacted the availability of the API and dashboard for six hours and 33 minutes. During this incident, the success rate for queries to our API periodically dipped as low as 75%, and the dashboard experience was as much as 80 times slower than normal. While Cloudflare’s edge is massively distributed across the world (and kept working without a hitch), Cloudflare’s control plane (API &amp;amp; dashboard) is made up of a large number of microservices that are redundant across two regions. For most services, the databases backing those microservices are only writable in one region at a time.&lt;/p&gt;&lt;p&gt;Each of Cloudflare’s control plane data centers has multiple racks of servers. Each of those racks has two switches that operate as a pair—both are normally active, but either can handle the load if the other fails. Cloudflare survives rack-level failures by spreading the most critical services across racks. Every piece of hardware has two or more power supplies with different power feeds. Every server that stores critical data uses RAID 10 redundant disks or storage systems that replicate data across at least three machines in different racks, or both. Redundancy at each layer is something we review and require. So—how could things go wrong?&lt;/p&gt;&lt;p&gt;In this post we present a timeline of what happened, and how a difficult failure mode known as a Byzantine fault played a role in a cascading series of events.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;2020-11-02-14-43-utc-partial-switch-failure\&quot;&gt;2020-11-02 14:43 UTC: Partial Switch Failure&lt;/h3&gt;\n            &lt;a href=\&quot;#2020-11-02-14-43-utc-partial-switch-failure\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;At 14:43, a network switch started misbehaving. Alerts began firing about the switch being unreachable to pings. The device was in a partially operating state: network control plane protocols such as &lt;a href=\&quot;https://en.wikipedia.org/wiki/Link_aggregation#Link_Aggregation_Control_Protocol\&quot;&gt;LACP&lt;/a&gt; and &lt;a href=\&quot;https://www.cloudflare.com/learning/security/glossary/what-is-bgp/\&quot;&gt;BGP&lt;/a&gt; remained operational, while others, such as vPC, were not. The vPC link is used to synchronize ports across multiple switches, so that they appear as one large, aggregated switch to servers connected to them. At the same time, the data plane (or forwarding plane) was not processing and forwarding all the packets received from connected devices.&lt;/p&gt;&lt;p&gt;This failure scenario is completely invisible to the connected nodes, as each server only sees an issue for some of its traffic due to the load-balancing nature of LACP. Had the switch failed fully, all traffic would have failed over to the peer switch, as the connected links would&amp;#39;ve simply gone down, and the ports would&amp;#39;ve dropped out of the forwarding LACP bundles.&lt;/p&gt;&lt;p&gt;Six minutes later, the switch recovered without human intervention. But this odd failure mode led to further problems that lasted long after the switch had returned to normal operation.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;2020-11-02-14-44-utc-etcd-errors-begin\&quot;&gt;2020-11-02 14:44 UTC: etcd Errors begin&lt;/h3&gt;\n            &lt;a href=\&quot;#2020-11-02-14-44-utc-etcd-errors-begin\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;The rack with the misbehaving switch included one server in our etcd cluster. We use &lt;a href=\&quot;https://etcd.io/\&quot;&gt;etcd&lt;/a&gt; heavily in our core data centers whenever we need strongly consistent data storage that’s reliable across multiple nodes.&lt;/p&gt;&lt;p&gt;In the event that the cluster leader fails, etcd uses the &lt;a href=\&quot;https://raft.github.io/\&quot;&gt;RAFT&lt;/a&gt; protocol to maintain consistency and establish consensus to promote a new leader. In the RAFT protocol, cluster members are assumed to be either available or unavailable, and to provide accurate information or none at all. This works fine when a machine crashes, but is not always able to handle situations where different members of the cluster have conflicting information.&lt;/p&gt;&lt;p&gt;In this particular situation:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;Network traffic between node 1 (in the affected rack) and node 3 (the leader) was being sent through the switch in the degraded state,&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Network traffic between node 1 and node 2 were going through its working peer, and&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Network traffic between node 2 and node 3 was unaffected.&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;This caused cluster members to have conflicting views of reality, known in distributed systems theory as a &lt;a href=\&quot;https://en.wikipedia.org/wiki/Byzantine_fault\&quot;&gt;Byzantine fault&lt;/a&gt;. As a consequence of this conflicting information, node 1 repeatedly initiated leader elections, voting for itself, while node 2 repeatedly voted for node 3, which it could still connect to. This resulted in ties that did not promote a leader node 1 could reach. RAFT leader elections are disruptive, blocking all writes until they&amp;#39;re resolved, so this made the cluster read-only until the faulty switch recovered and node 1 could once again reach node 3.&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/37eeMzKeltqOt105GJ4ctK/0a0a320ace579b8f28cc2aded23abc9a/image1-20.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1999\&quot; height=\&quot;1006\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;2020-11-02-14-45-utc-database-system-promotes-a-new-primary-database\&quot;&gt;2020-11-02 14:45 UTC: Database system promotes a new primary database&lt;/h3&gt;\n            &lt;a href=\&quot;#2020-11-02-14-45-utc-database-system-promotes-a-new-primary-database\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Cloudflare’s control plane services use relational databases hosted across multiple clusters within a data center. Each cluster is configured for &lt;a href=\&quot;https://www.cloudflare.com/learning/performance/glossary/application-availability/\&quot;&gt;high availability&lt;/a&gt;. The cluster setup includes a primary database, a synchronous replica, and one or more asynchronous replicas. This setup allows redundancy within a data center. For cross-datacenter redundancy, a similar high availability secondary cluster is set up and replicated in a geographically dispersed data center for disaster recovery. The cluster management system leverages etcd for cluster member discovery and coordination.&lt;/p&gt;&lt;p&gt;When etcd became read-only, two clusters were unable to communicate that they had a healthy primary database. This triggered the automatic promotion of a synchronous database replica to become the new primary. This process happened automatically and without error or data loss.&lt;/p&gt;&lt;p&gt;There was a defect in our cluster management system that requires a rebuild of all database replicas when a new primary database is promoted. So, although the new primary database was available instantly, the replicas would take considerable time to become available, depending on the size of the database. For one of the clusters, service was restored quickly. Synchronous and asynchronous database replicas were rebuilt and started replicating successfully from primary, and the impact was minimal.&lt;/p&gt;&lt;p&gt;For the other cluster, however, performant operation of that database &lt;i&gt;required&lt;/i&gt; a replica to be online. Because this database handles authentication for API calls and dashboard activities, it takes a lot of reads, and one replica was heavily utilized to spare the primary the load. When this failover happened and no replicas were available, the primary was overloaded, as it had to take all of the load. This is when the main impact started.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;reduce-load-leverage-redundancy\&quot;&gt;Reduce Load, Leverage Redundancy&lt;/h3&gt;\n            &lt;a href=\&quot;#reduce-load-leverage-redundancy\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;At this point we saw that our primary authentication database was overwhelmed and began shedding load from it. We dialed back the rate at which we push SSL certificates to the edge, send emails, and other features, to give it space to handle the additional load. Unfortunately, because of its size, we knew it would take several hours for a replica to be fully rebuilt.&lt;/p&gt;&lt;p&gt;A silver lining here is that every database cluster in our primary data center also has online replicas in our secondary data center. Those replicas are not part of the local failover process, and were online and available throughout the incident. The process of steering read-queries to those replicas was not yet automated, so we manually diverted API traffic that could leverage those read replicas to the secondary data center. This substantially improved our API availability.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;the-dashboard\&quot;&gt;The Dashboard&lt;/h3&gt;\n            &lt;a href=\&quot;#the-dashboard\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;The Cloudflare dashboard, like most web applications, has the notion of a user session. When user sessions are created (each time a user logs in) we perform some database operations and keep data in a Redis cluster for the duration of that user’s session. Unlike our API calls, our user sessions cannot currently be moved across the ocean without disruption. As we took actions to improve the availability of our API calls, we were unfortunately making the user experience on the dashboard worse.&lt;/p&gt;&lt;p&gt;This is an area of the system that is currently designed to be able to fail over across data centers in the event of a disaster, but has not yet been designed to work in both data centers at the same time. After a first period in which users on the dashboard became increasingly frustrated, we failed the authentication calls fully back to our primary data center, and kept working on our primary database to ensure we could provide the best service levels possible in that degraded state.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;2020-11-02-21-20-utc-database-replica-rebuilt\&quot;&gt;2020-11-02 21:20 UTC Database Replica Rebuilt&lt;/h3&gt;\n            &lt;a href=\&quot;#2020-11-02-21-20-utc-database-replica-rebuilt\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;The instant the first database replica rebuilt, it put itself back into service, and performance resumed to normal levels. We re-ramped all of the services that had been turned down, so all asynchronous processing could catch up, and after a period of monitoring marked the end of the incident.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;redundant-points-of-failure\&quot;&gt;Redundant Points of Failure&lt;/h3&gt;\n            &lt;a href=\&quot;#redundant-points-of-failure\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;The cascade of failures in this incident was interesting because each system, on its face, had redundancy. Moreover, no system fully failed—each entered a degraded state. That combination meant the chain of events that transpired was considerably harder to model and anticipate. It was frustrating yet reassuring that some of the possible failure modes were already being addressed.&lt;/p&gt;&lt;p&gt;A team was already working on fixing the limitation that requires a database replica rebuild upon promotion. Our user sessions system was inflexible in scenarios where we’d like to steer traffic around, and redesigning that was already in progress.&lt;/p&gt;&lt;p&gt;This incident also led us to revisit the configuration parameters we put in place for things that auto-remediate. In previous years, promoting a database replica to primary took far longer than we liked, so getting that process automated and able to trigger on a minute’s notice was a point of pride. At the same time, for at least one of our databases, the cure may be worse than the disease, and in fact we may not want to invoke the promotion process so quickly. Immediately after this incident we adjusted that configuration accordingly.&lt;/p&gt;&lt;p&gt;Byzantine Fault Tolerance (BFT) is a hot research topic. Solutions have been known since 1982, but have had to choose between a variety of engineering tradeoffs, including security, performance, and algorithmic simplicity. Most general-purpose cluster management systems choose to forgo BFT entirely and use protocols based on PAXOS, or simplifications of PAXOS such as RAFT, that perform better and are easier to understand than BFT consensus protocols. In many cases, a simple protocol that is known to be vulnerable to a rare failure mode is safer than a complex protocol that is difficult to implement correctly or debug.&lt;/p&gt;&lt;p&gt;The first uses of BFT consensus were in safety-critical systems such as aircraft and spacecraft controls. These systems typically have hard real time latency constraints that require tightly coupling consensus with application logic in ways that make these implementations unsuitable for general-purpose services like etcd. Contemporary research on BFT consensus is mostly focused on applications that cross trust boundaries, which need to protect against malicious cluster members as well as malfunctioning cluster members. These designs are more suitable for implementing general-purpose services such as etcd, and we look forward to collaborating with researchers and the open source community to make them suitable for production cluster management.&lt;/p&gt;&lt;p&gt;We are very sorry for the difficulty the outage caused, and are continuing to improve as our systems grow. We’ve since fixed the bug in our cluster management system, and are continuing to tune each of the systems involved in this incident to be more resilient to failures of their dependencies.  If you’re interested in helping solve these problems at scale, please visit &lt;a href=\&quot;https://www.cloudflare.com/careers/\&quot;&gt;cloudflare.com/careers&lt;/a&gt;.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;postscript\&quot;&gt;Postscript&lt;/h3&gt;\n            &lt;a href=\&quot;#postscript\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;The distributed systems community has pointed out that the failure we&amp;#39;ve encountered would be better characterized as an omission fault rather than a Byzantine fault. Omission faults are much more specific and can be tolerated without BFT protocols.&lt;/p&gt;&lt;p&gt;We’re grateful to all those who read and critiqued this post and will be following up with a detailed post about different fault types in distributed systems soon. Stay tuned.&lt;/p&gt;&quot;],&quot;published_at&quot;:[0,&quot;2020-11-27T12:00:00.000+00:00&quot;],&quot;updated_at&quot;:[0,&quot;2025-04-01T16:02:59.880Z&quot;],&quot;feature_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/HnIBD6LQ4175YJSVdeM4a/c622b4259dddddf19fd0f02fbafc3033/a-byzantine-failure-in-the-real-world.png&quot;],&quot;tags&quot;:[1,[[0,{&quot;id&quot;:[0,&quot;3cCNoJJ5uusKFBLYKFX1jB&quot;],&quot;name&quot;:[0,&quot;Post Mortem&quot;],&quot;slug&quot;:[0,&quot;post-mortem&quot;]}],[0,{&quot;id&quot;:[0,&quot;5x72ei67SoD11VQ0uqFtpF&quot;],&quot;name&quot;:[0,&quot;API&quot;],&quot;slug&quot;:[0,&quot;api&quot;]}],[0,{&quot;id&quot;:[0,&quot;5f5l99WZnbCCF9O6Emw56A&quot;],&quot;name&quot;:[0,&quot;Postgres&quot;],&quot;slug&quot;:[0,&quot;postgres&quot;]}],[0,{&quot;id&quot;:[0,&quot;4yliZlpBPZpOwBDZzo1tTh&quot;],&quot;name&quot;:[0,&quot;Outage&quot;],&quot;slug&quot;:[0,&quot;outage&quot;]}]]],&quot;relatedTags&quot;:[0],&quot;authors&quot;:[1,[[0,{&quot;name&quot;:[0,&quot;Tom Lianza&quot;],&quot;slug&quot;:[0,&quot;tom-lianza&quot;],&quot;bio&quot;:[0,null],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/5Rge4A1beH3Elh4c0AnDAH/4e8c3254b7e2abc15a757b5070277a6e/tom-lianza.jpg&quot;],&quot;location&quot;:[0,&quot;San Francisco&quot;],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,&quot;@tlianza&quot;],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}],[0,{&quot;name&quot;:[0,&quot;Chris Snook&quot;],&quot;slug&quot;:[0,&quot;chris-snook&quot;],&quot;bio&quot;:[0,&quot;I&#39;m a member of Cloudflare&#39;s Core SRE team, responsible for the reliability of configuration, logging, and analytics services.&quot;],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1bGqXXkJR4Bz1aCWLqTbNw/40afee2fac437fcc3dc09b08b328aaa4/chris-snook.jpg&quot;],&quot;location&quot;:[0,&quot;San Francisco Bay Area, California, United States&quot;],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,null],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}]]],&quot;meta_description&quot;:[0,&quot;When we review design documents at Cloudflare, we are always on the lookout for Single Points of Failure (SPOFs). But is redundancy enough? In this post we present a timeline of a real world incident, and how an interesting failure mode known as a Byzantine fault played a role in a cascading series of events.&quot;],&quot;primary_author&quot;:[0,{}],&quot;localeList&quot;:[0,{&quot;name&quot;:[0,&quot;A Byzantine failure in the real world Config&quot;],&quot;enUS&quot;:[0,&quot;English for Locale&quot;],&quot;zhCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhHansCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhTW&quot;:[0,&quot;No Page for Locale&quot;],&quot;frFR&quot;:[0,&quot;No Page for Locale&quot;],&quot;deDE&quot;:[0,&quot;No Page for Locale&quot;],&quot;itIT&quot;:[0,&quot;No Page for Locale&quot;],&quot;jaJP&quot;:[0,&quot;No Page for Locale&quot;],&quot;koKR&quot;:[0,&quot;No Page for Locale&quot;],&quot;ptBR&quot;:[0,&quot;No Page for Locale&quot;],&quot;esLA&quot;:[0,&quot;No Page for Locale&quot;],&quot;esES&quot;:[0,&quot;No Page for Locale&quot;],&quot;enAU&quot;:[0,&quot;No Page for Locale&quot;],&quot;enCA&quot;:[0,&quot;No Page for Locale&quot;],&quot;enIN&quot;:[0,&quot;No Page for Locale&quot;],&quot;enGB&quot;:[0,&quot;No Page for Locale&quot;],&quot;idID&quot;:[0,&quot;No Page for Locale&quot;],&quot;ruRU&quot;:[0,&quot;No Page for Locale&quot;],&quot;svSE&quot;:[0,&quot;No Page for Locale&quot;],&quot;viVN&quot;:[0,&quot;No Page for Locale&quot;],&quot;plPL&quot;:[0,&quot;No Page for Locale&quot;],&quot;arAR&quot;:[0,&quot;No Page for Locale&quot;],&quot;nlNL&quot;:[0,&quot;No Page for Locale&quot;],&quot;thTH&quot;:[0,&quot;No Page for Locale&quot;],&quot;trTR&quot;:[0,&quot;No Page for Locale&quot;],&quot;heIL&quot;:[0,&quot;No Page for Locale&quot;],&quot;lvLV&quot;:[0,&quot;No Page for Locale&quot;],&quot;etEE&quot;:[0,&quot;No Page for Locale&quot;],&quot;ltLT&quot;:[0,&quot;No Page for Locale&quot;]}],&quot;url&quot;:[0,&quot;https://blog.cloudflare.com/a-byzantine-failure-in-the-real-world&quot;],&quot;metadata&quot;:[0,{&quot;title&quot;:[0,&quot;A Byzantine failure in the real world&quot;],&quot;description&quot;:[0,&quot;When we review design documents at Cloudflare, we are always on the lookout for Single Points of Failure (SPOFs). But is redundancy enough? In this post we present a timeline of a real world incident, and how an interesting failure mode known as a Byzantine fault played a role in a cascading series of events.&quot;],&quot;imgPreview&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/5yXVxVWr46vXosoCZXYq75/0256ef2a0b5e5094e50a3c8da5f3cc5a/a-byzantine-failure-in-the-real-world-hRPCej.png&quot;]}],&quot;publicly_index&quot;:[0,true]}],[0,{&quot;id&quot;:[0,&quot;67HqDCJx0TPvwWKdhDqL9J&quot;],&quot;title&quot;:[0,&quot;August 30th 2020: Analysis of CenturyLink/Level(3) outage&quot;],&quot;slug&quot;:[0,&quot;analysis-of-todays-centurylink-level-3-outage&quot;],&quot;excerpt&quot;:[0,&quot;Today CenturyLink/Level(3), a major ISP and Internet bandwidth provider, experienced a significant outage that impacted some of Cloudflare’s customers as well as a significant number of other services and providers across the Internet. &quot;],&quot;featured&quot;:[0,false],&quot;html&quot;:[0,&quot;&lt;p&gt;Today CenturyLink/Level(3), a major ISP and Internet bandwidth provider, experienced a significant outage that impacted some of Cloudflare’s customers as well as a significant number of other services and providers across the Internet. While we’re waiting for a postmortem from CenturyLink/Level(3), I wanted to write up the timeline of what we saw, how Cloudflare’s systems routed around the problem, why some of our customers were still impacted in spite of our mitigations, and what appears to be the likely root cause of the issue.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;increase-in-errors\&quot;&gt;Increase In Errors&lt;/h3&gt;\n            &lt;a href=\&quot;#increase-in-errors\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;At 10:03 UTC our monitoring systems started to observe an increased number of errors reaching our customers’ origin servers. These show up as “522 Errors” and indicate that there is an issue connecting from Cloudflare’s network to wherever our customers’ applications are hosted.&lt;/p&gt;&lt;p&gt;Cloudflare is connected to CenturyLink/Level(3) among a large and diverse set of network providers. When we see an increase in errors from one network provider, our systems automatically attempt to reach customers’ applications across alternative providers. Given the number of providers we have access to, we are generally able to continue to route traffic even when one provider has an issue.&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/4Ucm3D0MTr0jFICxEASaRY/4eb5c93e58c69dba68a9397dafed9dd7/1-3.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1462\&quot; height=\&quot;936\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;The diverse set of network providers Cloudflare connects to. Source: &lt;a href=\&quot;https://bgp.he.net/AS13335#_asinfo\&quot;&gt;https://bgp.he.net/AS13335#_asinfo&lt;/a&gt;‌‌&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;automatic-mitigations\&quot;&gt;Automatic Mitigations&lt;/h3&gt;\n            &lt;a href=\&quot;#automatic-mitigations\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;In this case, beginning within seconds of the increase in 522 errors, our systems automatically rerouted traffic from CenturyLink/Level(3) to alternate network providers we connect to including Cogent, NTT, GTT, Telia, and Tata.&lt;/p&gt;&lt;p&gt;Our Network Operations Center was also alerted and our team began taking additional steps to mitigate any issues our automated systems weren’t automatically able to address beginning at 10:09 UTC. We were successful in keeping traffic flowing across our network for most customers and end users even with the loss of CenturyLink/Level(3) as one of our network providers.&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/2IaqqA25SioJLk6FRblsgn/a653c09f9c03ea1975100cd4f0372789/2-1.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1600\&quot; height=\&quot;1174\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;Dashboard Cloudflare’s automated systems recognizing the damage to the Internet caused by the CenturyLink/Level(3) failure and automatically routing around it.&lt;/p&gt;&lt;p&gt;The graph below shows traffic between Cloudflare’s network and six major tier-1 networks that are among the network providers we connect to. The red portion shows CenturyLink/Level(3) traffic, which dropped to near-zero during the incident. You can also see how we automatically shifted traffic to other network providers during the incident to mitigate the impact and ensure traffic continued to flow.&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/2gRbJZ7VJViIBe1zJ9mbC6/6154af99efaa90c4e8f5537848360b77/3-2.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1510\&quot; height=\&quot;319\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;Traffic across six major tier-1 networks that are among the network providers Cloudflare connects to. CenturyLink/Level(3) in red.&lt;/p&gt;&lt;p&gt;The following graph shows 522 errors (indicating our inability to reach customers’ applications) across our network during the time of the incident.&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/7AcGLxXmSoDEtjAKB4thEQ/44b93339570b58ed8e5d2e57ba21d749/4-2.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1428\&quot; height=\&quot;880\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;The sharp spike up at 10:03 UTC was the CenturyLink/Level(3) network failing. Our automated systems immediately kicked in to attempt to reroute and rebalance traffic across alternative network providers, causing the errors to drop in half immediately and then fall to approximately 25 percent of the peak as those paths were automatically optimized.&lt;/p&gt;&lt;p&gt;Between 10:03 UTC and 10:11 UTC our systems automatically disabled CenturyLink/Level(3) in the 48 cities where we’re connected to them and rerouted traffic across alternate network providers. Our systems take into account capacity on other providers before shifting out traffic in order to prevent cascading failures. This is why the failover, while automatic, isn’t instantaneous in all locations. Our team was able to apply additional manual mitigations to reduce the number of errors another 5 percent.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;why-did-the-errors-not-drop-to-zero\&quot;&gt;Why Did the Errors Not Drop to Zero?&lt;/h3&gt;\n            &lt;a href=\&quot;#why-did-the-errors-not-drop-to-zero\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;Unfortunately, there were still an elevated number of errors indicating we were still unable to reach some customers. CenturyLink/Level(3) is among the largest network providers in the world. As a result, many hosting providers only have single-homed connectivity to the Internet through their network.&lt;/p&gt;&lt;p&gt;To use the &lt;a href=\&quot;https://www.theverge.com/2014/8/20/6046003/a-history-of-metaphors-for-the-internet\&quot;&gt;old Internet as a “superhighway” analogy&lt;/a&gt;, that’s like only having a single offramp to a town. If the offramp is blocked, then there’s no way to reach the town. This was exacerbated in some cases because CenturyLink/Level(3)’s network was not honoring route withdrawals and continued to advertise routes to networks like Cloudflare’s even after they’d been withdrawn. In the case of customers whose only connectivity to the Internet is via CenturyLink/Level(3), or if CenturyLink/Level(3) continued to announce bad routes after they&amp;#39;d been withdrawn, there was no way for us to reach their applications and they continued to see 522 errors until CenturyLink/Level(3) resolved their issue around 14:30 UTC.&lt;/p&gt;&lt;p&gt;The same was a problem on the other (“eyeball”) side of the network. Individuals need to have an onramp onto the Internet’s superhighway. An onramp to the Internet is essentially what your ISP provides. CenturyLink is one of the largest ISPs in the United States.&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/2icudbLYouwM170cYZ6Sgg/65c7a019da7606b8525980ef0f35f2e4/image-3.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1426\&quot; height=\&quot;1406\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;Source: &lt;a href=\&quot;https://broadbandnow.com/CenturyLink\&quot;&gt;https://broadbandnow.com/CenturyLink&lt;/a&gt;&lt;/p&gt;&lt;p&gt;Because this outage appeared to take all of the CenturyLink/Level(3) network offline, individuals who are CenturyLink customers would not have been able to reach Cloudflare or any other Internet provider until the issue was resolved. Globally, we saw a 3.5% drop in global traffic during the outage, nearly all of which was due to a nearly complete outage of CenturyLink’s ISP service across the United States.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;so-what-likely-happened-here\&quot;&gt;So What Likely Happened Here?&lt;/h3&gt;\n            &lt;a href=\&quot;#so-what-likely-happened-here\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;While we will not know exactly what happened until CenturyLink/Level(3) issue a post mortem, we can see clues from BGP announcements and how they propagated across the Internet during the outage. BGP is the Border Gateway Protocol. It is how routers on the Internet announce to each other what IPs sit behind them and therefore what traffic they should receive.&lt;/p&gt;&lt;p&gt;Starting at 10:04 UTC, there were a significant number of BGP updates. A BGP update is the signal a router makes to say that a route has changed or is no longer available. Under normal conditions, the Internet sees about 1.5MBs – 2MBs of BGP updates every 15 minutes. At the start of the incident, the number of BGP updates spiked to more than 26MBs of BGP updates per 15 minute period and stayed elevated throughout the incident.&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/5QVexHMHnmU6OVZdcPpy94/d3804627c952b3d8bc417e5442340a9e/6-1.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;734\&quot; height=\&quot;312\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;&lt;p&gt;Source: &lt;a href=\&quot;http://archive.routeviews.org/bgpdata/2020.08/UPDATES/\&quot;&gt;http://archive.routeviews.org/bgpdata/2020.08/UPDATES/&lt;/a&gt;&lt;/p&gt;&lt;p&gt;These updates show the instability of BGP routes inside the CenturyLink/Level(3) backbone. The question is what would have caused this instability. The CenturyLink/Level(3) status update offers some hints and points at a flowspec update as the root cause.&lt;/p&gt;\n            &lt;figure class=\&quot;kg-card kg-image-card \&quot;&gt;\n            \n            &lt;Image src=\&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/6cy2Ywz7cnqyfNFwIX3nGa/4fc128b22c7b5524504283e87f087a89/7-1.png\&quot; alt=\&quot;\&quot; class=\&quot;kg-image\&quot; width=\&quot;1540\&quot; height=\&quot;312\&quot; loading=\&quot;lazy\&quot;/&gt;\n            \n            &lt;/figure&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;whats-flowspec\&quot;&gt;What’s Flowspec?&lt;/h3&gt;\n            &lt;a href=\&quot;#whats-flowspec\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;In CenturyLink/Level(3)’s update they mention that a bad Flowspec rule caused the issue. So what is Flowspec? Flowspec is an extension to BGP, which allows firewall rules to be easily distributed across a network, or even between networks, using BGP. Flowspec is a powerful tool. It allows you to efficiently push rules across an entire network almost instantly. It is great when you are trying to quickly respond to something like an attack, but it can be dangerous if you make a mistake.&lt;/p&gt;&lt;p&gt;At Cloudflare, early in our history, we used to use Flowspec ourselves to push out firewall rules in order to, for instance, mitigate large network-layer DDoS attacks. We &lt;a href=\&quot;/todays-outage-post-mortem-82515/\&quot;&gt;suffered our own Flowspec-induced outage more than 7 years ago&lt;/a&gt;. We no longer use Flowspec ourselves, but it remains a common protocol for pushing out network firewall rules.&lt;/p&gt;&lt;p&gt;We can only speculate what happened at CenturyLink/Level(3), but one plausible scenario is that they issued a Flowspec command to try to block an attack or other abuse directed at their network. The status report indicates that the Flowspec rule prevented BGP itself from being announced. We have no way of knowing what that Flowspec rule was, but here’s one in Juniper’s format that would have blocked all BGP communications across their network.&lt;/p&gt;\n            &lt;pre class=\&quot;language-bash\&quot;&gt;&lt;code class=\&quot;language-bash\&quot;&gt;route DISCARD-BGP {\n   match {\n      protocol tcp;\n      destination-port 179;\n   }\n then discard;\n}&lt;/pre&gt;&lt;/code&gt;\n            \n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;why-so-many-updates\&quot;&gt;Why So Many Updates?&lt;/h3&gt;\n            &lt;a href=\&quot;#why-so-many-updates\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;A mystery remains, however, why global BGP updates stayed elevated throughout the incident. If the rule blocked BGP then you would expect to see an increase in BGP announcements initially, and then they would fall back to normal.&lt;/p&gt;&lt;p&gt;One possible explanation is that the offending Flowspec rule came near the end of a long list of BGP updates. If that were the case, what may have happened is that every router in CenturyLink/Level(3)’s network would receive the Flowspec rule. They would then block BGP. That would cause them to stop receiving the rule. They would start back up again, working their way through all the BGP rules until they got to the offending Flowspec rule again. BGP would be dropped again. The Flowspec rule would no longer be received. And the loop would continue, over and over.&lt;/p&gt;&lt;p&gt;One challenge of this is that on every cycle, the queue of BGP updates would continue to increase within CenturyLink/Level(3)’s network. This may have gotten to a point where the memory and CPU of their routers was overloaded, causing an additional set of challenges to getting their network back online.&lt;/p&gt;\n          &lt;div class=\&quot;flex anchor relative\&quot;&gt;\n            &lt;h3 id=\&quot;why-did-it-take-so-long-to-fix\&quot;&gt;Why Did It Take So Long to Fix?&lt;/h3&gt;\n            &lt;a href=\&quot;#why-did-it-take-so-long-to-fix\&quot; aria-hidden=\&quot;true\&quot; class=\&quot;relative sm:absolute sm:-left-5\&quot;&gt;\n              &lt;svg width=\&quot;16\&quot; height=\&quot;16\&quot; viewBox=\&quot;0 0 24 24\&quot;&gt;&lt;path fill=\&quot;currentcolor\&quot; d=\&quot;m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n            &lt;/a&gt;\n          &lt;/div&gt;\n        &lt;p&gt;This was a significant global Internet outage and, undoubtedly, the CenturyLink/Level(3) team received immediate alerts. They are a very sophisticated network operator with a world-class Network Operations Center (NOC). So why did it take more than four hours to resolve?&lt;/p&gt;&lt;p&gt;Again, we can only speculate. First, it may have been that the Flowspec rule and the significant load that large number of BGP updates imposed on their routers made it difficult for them to login to their own interfaces. Several of the other tier-1 providers took action, it appears at CenturyLink/Level(3)’s request, to de-peer their networks. This would have limited the number of BGP announcements being received by the CenturyLink/Level(3) network and helped give it time to catch up.&lt;/p&gt;&lt;p&gt;Second, it also may have been that the Flowspec rule was not issued by CenturyLink/Level(3) themselves but rather by one of their customers. Many network providers will allow Flowspec peering. This can be a powerful tool for downstream customers wishing to block attack traffic, but can make it much more difficult to track down an offending Flowspec rule when something goes wrong.&lt;/p&gt;&lt;p&gt;Finally, it never helps when these issues occur early on a Sunday morning. Networks the size and scale of CenturyLink/Level(3)’s are extremely complicated. Incidents happen. We appreciate their team keeping us informed with what was going on throughout the incident. #hugops&lt;/p&gt;&quot;],&quot;published_at&quot;:[0,&quot;2020-08-30T21:55:17.000+01:00&quot;],&quot;updated_at&quot;:[0,&quot;2024-10-09T21:27:13.937Z&quot;],&quot;feature_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/6nsX8J6T5JObTBYKWf1sLF/4d97c8220fb534384e00351a47583687/analysis-of-todays-centurylink-level-3-outage.png&quot;],&quot;tags&quot;:[1,[[0,{&quot;id&quot;:[0,&quot;4yliZlpBPZpOwBDZzo1tTh&quot;],&quot;name&quot;:[0,&quot;Outage&quot;],&quot;slug&quot;:[0,&quot;outage&quot;]}],[0,{&quot;id&quot;:[0,&quot;3cCNoJJ5uusKFBLYKFX1jB&quot;],&quot;name&quot;:[0,&quot;Post Mortem&quot;],&quot;slug&quot;:[0,&quot;post-mortem&quot;]}]]],&quot;relatedTags&quot;:[0],&quot;authors&quot;:[1,[[0,{&quot;name&quot;:[0,&quot;Matthew Prince&quot;],&quot;slug&quot;:[0,&quot;matthew-prince&quot;],&quot;bio&quot;:[0,&quot;A little bit geek, wonk, and nerd. Repeat entrepreneur, recovering lawyer, and former ski instructor. Co-founder &amp; CEO of Cloudflare (NYSE: NET).&quot;],&quot;profile_image&quot;:[0,&quot;https://cf-assets.www.cloudflare.com/zkvhlag99gkb/1VD9WePJ1jvjFwuSRF0IfQ/5e4f7d5fd4825358b33b2ead623140d8/matthew-prince.jpeg&quot;],&quot;location&quot;:[0,&quot;San Francisco, CA&quot;],&quot;website&quot;:[0,null],&quot;twitter&quot;:[0,&quot;@eastdakota&quot;],&quot;facebook&quot;:[0,null],&quot;publiclyIndex&quot;:[0,true]}]]],&quot;meta_description&quot;:[0,&quot;Today CenturyLink/Level(3), a major ISP and Internet bandwidth provider, experienced a significant outage that impacted some of Cloudflare’s customers as well as a significant number of other services and providers across the Internet. &quot;],&quot;primary_author&quot;:[0,{}],&quot;localeList&quot;:[0,{&quot;name&quot;:[0,&quot;August 30th 2020: Analysis of CenturyLink/Level(3) outage Config&quot;],&quot;enUS&quot;:[0,&quot;English for Locale&quot;],&quot;zhCN&quot;:[0,&quot;Translated for Locale&quot;],&quot;zhHansCN&quot;:[0,&quot;No Page for Locale&quot;],&quot;zhTW&quot;:[0,&quot;No Page for Locale&quot;],&quot;frFR&quot;:[0,&quot;Translated for Locale&quot;],&quot;deDE&quot;:[0,&quot;Translated for Locale&quot;],&quot;itIT&quot;:[0,&quot;No Page for Locale&quot;],&quot;jaJP&quot;:[0,&quot;Translated for Locale&quot;],&quot;koKR&quot;:[0,&quot;No Page for Locale&quot;],&quot;ptBR&quot;:[0,&quot;No Page for Locale&quot;],&quot;esLA&quot;:[0,&quot;No Page for Locale&quot;],&quot;esES&quot;:[0,&quot;Translated for Locale&quot;],&quot;enAU&quot;:[0,&quot;No Page for Locale&quot;],&quot;enCA&quot;:[0,&quot;No Page for Locale&quot;],&quot;enIN&quot;:[0,&quot;No Page for Locale&quot;],&quot;enGB&quot;:[0,&quot;No Page for Locale&quot;],&quot;idID&quot;:[0,&quot;No Page for Locale&quot;],&quot;ruRU&quot;:[0,&quot;No Page for Locale&quot;],&quot;svSE&quot;:[0,&quot;No Page for Locale&quot;],&quot;viVN&quot;:[0,&quot;No Page for Locale&quot;],&quot;plPL&quot;:[0,&quot;No Page for Locale&quot;],&quot;arAR&quot;:[0,&quot;No Page for Locale&quot;],&quot;nlNL&quot;:[0,&quot;No Page for Locale&quot;],&quot;thTH&quot;:[0,&quot;No Page for Locale&quot;],&quot;trTR&quot;:[0,&quot;No Page for Locale&quot;],&quot;heIL&quot;:[0,&quot;No Page for Locale&quot;],&quot;lvLV&quot;:[0,&quot;No Page for Locale&quot;],&quot;etEE&quot;:[0,&quot;No Page for Locale&quot;],&quot;ltLT&quot;:[0,&quot;No Page for Locale&quot;]}],&quot;url&quot;:[0,&quot;https://blog.cloudflare.com/analysis-of-todays-centurylink-level-3-outage&quot;],&quot;metadata&quot;:[0,{&quot;title&quot;:[0],&quot;description&quot;:[0],&quot;imgPreview&quot;:[0,&quot;&quot;]}],&quot;publicly_index&quot;:[0,true]}]]],&quot;translations&quot;:[0,{&quot;posts.by&quot;:[0,&quot;By&quot;],&quot;footer.gdpr&quot;:[0,&quot;GDPR&quot;],&quot;lang_blurb1&quot;:[0,&quot;This post is also available in {lang1}.&quot;],&quot;lang_blurb2&quot;:[0,&quot;This post is also available in {lang1} and {lang2}.&quot;],&quot;lang_blurb3&quot;:[0,&quot;This post is also available in {lang1}, {lang2} and {lang3}.&quot;],&quot;footer.press&quot;:[0,&quot;Press&quot;],&quot;header.title&quot;:[0,&quot;The Cloudflare Blog&quot;],&quot;search.clear&quot;:[0,&quot;Clear&quot;],&quot;search.filter&quot;:[0,&quot;Filter&quot;],&quot;search.source&quot;:[0,&quot;Source&quot;],&quot;footer.careers&quot;:[0,&quot;Careers&quot;],&quot;footer.company&quot;:[0,&quot;Company&quot;],&quot;footer.support&quot;:[0,&quot;Support&quot;],&quot;footer.the_net&quot;:[0,&quot;theNet&quot;],&quot;search.filters&quot;:[0,&quot;Filters&quot;],&quot;footer.our_team&quot;:[0,&quot;Our team&quot;],&quot;footer.webinars&quot;:[0,&quot;Webinars&quot;],&quot;page.more_posts&quot;:[0,&quot;More posts&quot;],&quot;posts.time_read&quot;:[0,&quot;{time} min read&quot;],&quot;search.language&quot;:[0,&quot;Language&quot;],&quot;footer.community&quot;:[0,&quot;Community&quot;],&quot;footer.resources&quot;:[0,&quot;Resources&quot;],&quot;footer.solutions&quot;:[0,&quot;Solutions&quot;],&quot;footer.trademark&quot;:[0,&quot;Trademark&quot;],&quot;header.subscribe&quot;:[0,&quot;Subscribe&quot;],&quot;footer.compliance&quot;:[0,&quot;Compliance&quot;],&quot;footer.free_plans&quot;:[0,&quot;Free plans&quot;],&quot;footer.impact_ESG&quot;:[0,&quot;Impact/ESG&quot;],&quot;posts.follow_on_X&quot;:[0,&quot;Follow on X&quot;],&quot;footer.help_center&quot;:[0,&quot;Help center&quot;],&quot;footer.network_map&quot;:[0,&quot;Network Map&quot;],&quot;header.please_wait&quot;:[0,&quot;Please Wait&quot;],&quot;page.related_posts&quot;:[0,&quot;Related posts&quot;],&quot;search.result_stat&quot;:[0,&quot;Results &lt;strong&gt;{search_range}&lt;/strong&gt; of &lt;strong&gt;{search_total}&lt;/strong&gt; for &lt;strong&gt;{search_keyword}&lt;/strong&gt;&quot;],&quot;footer.case_studies&quot;:[0,&quot;Case Studies&quot;],&quot;footer.connect_2024&quot;:[0,&quot;Connect 2024&quot;],&quot;footer.terms_of_use&quot;:[0,&quot;Terms of Use&quot;],&quot;footer.white_papers&quot;:[0,&quot;White Papers&quot;],&quot;footer.cloudflare_tv&quot;:[0,&quot;Cloudflare TV&quot;],&quot;footer.community_hub&quot;:[0,&quot;Community Hub&quot;],&quot;footer.compare_plans&quot;:[0,&quot;Compare plans&quot;],&quot;footer.contact_sales&quot;:[0,&quot;Contact Sales&quot;],&quot;header.contact_sales&quot;:[0,&quot;Contact Sales&quot;],&quot;header.email_address&quot;:[0,&quot;Email Address&quot;],&quot;page.error.not_found&quot;:[0,&quot;Page not found&quot;],&quot;footer.developer_docs&quot;:[0,&quot;Developer docs&quot;],&quot;footer.privacy_policy&quot;:[0,&quot;Privacy Policy&quot;],&quot;footer.request_a_demo&quot;:[0,&quot;Request a demo&quot;],&quot;page.continue_reading&quot;:[0,&quot;Continue reading&quot;],&quot;footer.analysts_report&quot;:[0,&quot;Analyst reports&quot;],&quot;footer.for_enterprises&quot;:[0,&quot;For enterprises&quot;],&quot;footer.getting_started&quot;:[0,&quot;Getting Started&quot;],&quot;footer.learning_center&quot;:[0,&quot;Learning Center&quot;],&quot;footer.project_galileo&quot;:[0,&quot;Project Galileo&quot;],&quot;pagination.newer_posts&quot;:[0,&quot;Newer Posts&quot;],&quot;pagination.older_posts&quot;:[0,&quot;Older Posts&quot;],&quot;posts.social_buttons.x&quot;:[0,&quot;Discuss on X&quot;],&quot;search.icon_aria_label&quot;:[0,&quot;Search&quot;],&quot;search.source_location&quot;:[0,&quot;Source/Location&quot;],&quot;footer.about_cloudflare&quot;:[0,&quot;About Cloudflare&quot;],&quot;footer.athenian_project&quot;:[0,&quot;Athenian Project&quot;],&quot;footer.become_a_partner&quot;:[0,&quot;Become a partner&quot;],&quot;footer.cloudflare_radar&quot;:[0,&quot;Cloudflare Radar&quot;],&quot;footer.network_services&quot;:[0,&quot;Network services&quot;],&quot;footer.trust_and_safety&quot;:[0,&quot;Trust &amp; Safety&quot;],&quot;header.get_started_free&quot;:[0,&quot;Get Started Free&quot;],&quot;page.search.placeholder&quot;:[0,&quot;Search Cloudflare&quot;],&quot;footer.cloudflare_status&quot;:[0,&quot;Cloudflare Status&quot;],&quot;footer.cookie_preference&quot;:[0,&quot;Cookie Preferences&quot;],&quot;header.valid_email_error&quot;:[0,&quot;Must be valid email.&quot;],&quot;search.result_stat_empty&quot;:[0,&quot;Results &lt;strong&gt;{search_range}&lt;/strong&gt; of &lt;strong&gt;{search_total}&lt;/strong&gt;&quot;],&quot;footer.connectivity_cloud&quot;:[0,&quot;Connectivity cloud&quot;],&quot;footer.developer_services&quot;:[0,&quot;Developer services&quot;],&quot;footer.investor_relations&quot;:[0,&quot;Investor relations&quot;],&quot;page.not_found.error_code&quot;:[0,&quot;Error Code: 404&quot;],&quot;search.autocomplete_title&quot;:[0,&quot;Insert a query. Press enter to send&quot;],&quot;footer.logos_and_press_kit&quot;:[0,&quot;Logos &amp; press kit&quot;],&quot;footer.application_services&quot;:[0,&quot;Application services&quot;],&quot;footer.get_a_recommendation&quot;:[0,&quot;Get a recommendation&quot;],&quot;posts.social_buttons.reddit&quot;:[0,&quot;Discuss on Reddit&quot;],&quot;footer.sse_and_sase_services&quot;:[0,&quot;SSE and SASE services&quot;],&quot;page.not_found.outdated_link&quot;:[0,&quot;You may have used an outdated link, or you may have typed the address incorrectly.&quot;],&quot;footer.report_security_issues&quot;:[0,&quot;Report Security Issues&quot;],&quot;page.error.error_message_page&quot;:[0,&quot;Sorry, we can&#39;t find the page you are looking for.&quot;],&quot;header.subscribe_notifications&quot;:[0,&quot;Subscribe to receive notifications of new posts:&quot;],&quot;footer.cloudflare_for_campaigns&quot;:[0,&quot;Cloudflare for Campaigns&quot;],&quot;header.subscription_confimation&quot;:[0,&quot;Subscription confirmed. Thank you for subscribing!&quot;],&quot;posts.social_buttons.hackernews&quot;:[0,&quot;Discuss on Hacker News&quot;],&quot;footer.diversity_equity_inclusion&quot;:[0,&quot;Diversity, equity &amp; inclusion&quot;],&quot;footer.critical_infrastructure_defense_project&quot;:[0,&quot;Critical Infrastructure Defense Project&quot;]}]}" ssr client="load" opts="{&quot;name&quot;:&quot;MorePosts&quot;,&quot;value&quot;:true}" await-children><div class="w-100 bt-l b--gray8"><h3 data-testid="more-posts-title" class="orange fw5 f4 ph3 mt4">MORE POSTS</h3></div><article data-testid="more-posts-article" class="w-100 w-100-m ph3 mb4"><p class="f3 fw5 gray1" data-iso-date="2023-11-04T06:18:55.000+00:00">November 04, 2023  6:18 AM</p><a href="/post-mortem-on-cloudflare-control-plane-and-analytics-outage/" class="no-underline gray1 f4 fw5"><h6 class="gray1 f4 fw5 mt2">Post mortem on the Cloudflare Control Plane and Analytics Outage</h6></a><p class="gray1 lh-copy">Beginning on Thursday, November 2, 2023, at 11:43 UTC Cloudflare&#x27;s control plane and analytics services experienced an outage. Here are the details<!-- -->...</p><ul class="flex pl0 fw6 f2"><span>By<!-- --> </span><li class="list flex items-center"><div class="author-name-tooltip"><a href="/author/matthew-prince/" class="fw5 f2 black no-underline">Matthew Prince</a></div></li></ul><div class="flex flex-row flex-wrap"><div><a href="/tag/outage/" class="no-underline f1 fw2 blue3 underline-hover">Outage</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/post-mortem/" class="no-underline f1 fw2 blue3 underline-hover">Post Mortem</a></div></div></article><article data-testid="more-posts-article" class="w-100 w-100-m ph3 mb4"><p class="f3 fw5 gray1" data-iso-date="2023-11-01T16:39:43.000+00:00">November 01, 2023  4:39 PM</p><a href="/cloudflare-incident-on-october-30-2023/" class="no-underline gray1 f4 fw5"><h6 class="gray1 f4 fw5 mt2">Cloudflare incident on October 30, 2023</h6></a><p class="gray1 lh-copy">Multiple Cloudflare services were unavailable for 37 minutes on October 30, 2023, due to the misconfiguration of a deployment tool used by Workers KV.<!-- -->...</p><ul class="flex pl0 fw6 f2"><span>By<!-- --> </span><li class="list flex items-center"><div class="author-name-tooltip"><a href="/author/silverlock/" class="fw5 f2 black no-underline">Matt Silverlock</a></div></li><li class="list flex items-center"><div class="author-name-tooltip"><span class="fw5 f2 black no-underline">, </span><a href="/author/kris-evans/" class="fw5 f2 black no-underline">Kris Evans</a></div></li></ul><div class="flex flex-row flex-wrap"><div><a href="/tag/post-mortem/" class="no-underline f1 fw2 blue3 underline-hover">Post Mortem</a></div></div></article><article data-testid="more-posts-article" class="w-100 w-100-m ph3 mb4"><p class="f3 fw5 gray1" data-iso-date="2023-10-20T22:39:13.000+01:00">October 20, 2023  9:39 PM</p><a href="/how-cloudflare-mitigated-yet-another-okta-compromise/" class="no-underline gray1 f4 fw5"><h6 class="gray1 f4 fw5 mt2">How Cloudflare mitigated yet another Okta compromise</h6></a><p class="gray1 lh-copy">On Wednesday, October 18, 2023, we discovered attacks on our system that we were able to trace back to Okta. We have verified that no Cloudflare customer information or systems were impacted by this event because of our rapid response. <!-- -->...</p><ul class="flex pl0 fw6 f2"><span>By<!-- --> </span><li class="list flex items-center"><div class="author-name-tooltip"><a href="/author/sourov/" class="fw5 f2 black no-underline">Sourov Zaman</a></div></li><li class="list flex items-center"><div class="author-name-tooltip"><span class="fw5 f2 black no-underline">, </span><a href="/author/lucas-ferreira/" class="fw5 f2 black no-underline">Lucas Ferreira</a></div></li><li class="list flex items-center"><div class="author-name-tooltip"><span class="fw5 f2 black no-underline">, </span><a href="/author/kimberly/" class="fw5 f2 black no-underline">Kimberly Hall</a></div></li><li class="list flex items-center"><div class="author-name-tooltip"><span class="fw5 f2 black no-underline">, </span><a href="/author/grant/" class="fw5 f2 black no-underline">Grant Bourzikas</a></div></li></ul><div class="flex flex-row flex-wrap"><div><a href="/tag/okta/" class="no-underline f1 fw2 blue3 underline-hover">Okta</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/post-mortem/" class="no-underline f1 fw2 blue3 underline-hover">Post Mortem</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/1-1-1-1/" class="no-underline f1 fw2 blue3 underline-hover">1.1.1.1</a></div></div></article><article data-testid="more-posts-article" class="w-100 w-100-m ph3 mb4"><p class="f3 fw5 gray1" data-iso-date="2023-10-04T20:40:34.000+01:00">October 04, 2023  7:40 PM</p><a href="/1-1-1-1-lookup-failures-on-october-4th-2023/" class="no-underline gray1 f4 fw5"><h6 class="gray1 f4 fw5 mt2">1.1.1.1 lookup failures on  October 4, 2023</h6></a><p class="gray1 lh-copy">On 4 October 2023, Cloudflare experienced DNS resolution problems. Some users may have received SERVFAIL DNS responses to valid queries. In this blog, we’re going to talk about what the failure was, why it occurred, and what we’re doing to make sure this doesn’t happen again<!-- -->...</p><ul class="flex pl0 fw6 f2"><span>By<!-- --> </span><li class="list flex items-center"><div class="author-name-tooltip"><a href="/author/olafur-gudmundsson/" class="fw5 f2 black no-underline">Ólafur Guðmundsson</a></div></li></ul><div class="flex flex-row flex-wrap"><div><a href="/tag/1-1-1-1/" class="no-underline f1 fw2 blue3 underline-hover">1.1.1.1</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/post-mortem/" class="no-underline f1 fw2 blue3 underline-hover">Post Mortem</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/outage/" class="no-underline f1 fw2 blue3 underline-hover">Outage</a></div></div></article><article data-testid="more-posts-article" class="w-100 w-100-m ph3 mb4"><p class="f3 fw5 gray1" data-iso-date="2023-08-02T14:05:42.000+01:00">August 02, 2023  1:05 PM</p><a href="/workers-kv-restoring-reliability/" class="no-underline gray1 f4 fw5"><h6 class="gray1 f4 fw5 mt2">Hardening Workers KV</h6></a><p class="gray1 lh-copy">A deep dive into the recent incidents relating to Workers KV, and how we’re going to fix them<!-- -->...</p><ul class="flex pl0 fw6 f2"><span>By<!-- --> </span><li class="list flex items-center"><div class="author-name-tooltip"><a href="/author/silverlock/" class="fw5 f2 black no-underline">Matt Silverlock</a></div></li><li class="list flex items-center"><div class="author-name-tooltip"><span class="fw5 f2 black no-underline">, </span><a href="/author/charles/" class="fw5 f2 black no-underline">Charles Burnett</a></div></li><li class="list flex items-center"><div class="author-name-tooltip"><span class="fw5 f2 black no-underline">, </span><a href="/author/rob/" class="fw5 f2 black no-underline">Rob Sutter</a></div></li><li class="list flex items-center"><div class="author-name-tooltip"><span class="fw5 f2 black no-underline">, </span><a href="/author/kris-evans/" class="fw5 f2 black no-underline">Kris Evans</a></div></li></ul><div class="flex flex-row flex-wrap"><div><a href="/tag/workers/" class="no-underline f1 fw2 blue3 underline-hover">Cloudflare Workers</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/reliability/" class="no-underline f1 fw2 blue3 underline-hover">Reliability</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/post-mortem/" class="no-underline f1 fw2 blue3 underline-hover">Post Mortem</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/developers/" class="no-underline f1 fw2 blue3 underline-hover">Developers</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/developer-platform/" class="no-underline f1 fw2 blue3 underline-hover">Developer Platform</a></div></div></article><article data-testid="more-posts-article" class="w-100 w-100-m ph3 mb4"><p class="f3 fw5 gray1" data-iso-date="2023-07-11T09:48:13.000+01:00">July 11, 2023  8:48 AM</p><a href="/connection-errors-in-asia-pacific-region-on-july-9-2023/" class="no-underline gray1 f4 fw5"><h6 class="gray1 f4 fw5 mt2">Connection errors in Asia Pacific region on July 9, 2023</h6></a><p class="gray1 lh-copy">On July 9, 2023, users in the Asia Pacific region experienced connection errors due to origin DNS resolution failures to .com and .net TLD nameservers<!-- -->...</p><ul class="flex pl0 fw6 f2"><span>By<!-- --> </span><li class="list flex items-center"><div class="author-name-tooltip"><a href="/author/christian-elmerot/" class="fw5 f2 black no-underline">Christian Elmerot</a></div></li><li class="list flex items-center"><div class="author-name-tooltip"><span class="fw5 f2 black no-underline">, </span><a href="/author/alex-fattouche/" class="fw5 f2 black no-underline">Alex Fattouche</a></div></li><li class="list flex items-center"><div class="author-name-tooltip"><span class="fw5 f2 black no-underline">, </span><a href="/author/hannes/" class="fw5 f2 black no-underline">Hannes Gerhart</a></div></li></ul><div class="flex flex-row flex-wrap"><div><a href="/tag/dns/" class="no-underline f1 fw2 blue3 underline-hover">DNS</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/dnssec/" class="no-underline f1 fw2 blue3 underline-hover">DNSSEC</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/outage/" class="no-underline f1 fw2 blue3 underline-hover">Outage</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/post-mortem/" class="no-underline f1 fw2 blue3 underline-hover">Post Mortem</a></div></div></article><article data-testid="more-posts-article" class="w-100 w-100-m ph3 mb4"><p class="f3 fw5 gray1" data-iso-date="2023-01-25T03:47:09.000+00:00">January 25, 2023  3:47 AM</p><a href="/cloudflare-incident-on-january-24th-2023/" class="no-underline gray1 f4 fw5"><h6 class="gray1 f4 fw5 mt2">Cloudflare incident on January 24, 2023</h6></a><p class="gray1 lh-copy">Several Cloudflare services became unavailable for 121 minutes on January 24th, 2023 due to an error releasing code that manages service tokens. The incident degraded a wide range of Cloudflare products<!-- -->...</p><ul class="flex pl0 fw6 f2"><span>By<!-- --> </span><li class="list flex items-center"><div class="author-name-tooltip"><a href="/author/kenny/" class="fw5 f2 black no-underline">Kenny Johnson</a></div></li><li class="list flex items-center"><div class="author-name-tooltip"><span class="fw5 f2 black no-underline">, </span><a href="/author/sam/" class="fw5 f2 black no-underline">Sam Rhea</a></div></li></ul><div class="flex flex-row flex-wrap"><div><a href="/tag/outage/" class="no-underline f1 fw2 blue3 underline-hover">Outage</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/post-mortem/" class="no-underline f1 fw2 blue3 underline-hover">Post Mortem</a></div></div></article><article data-testid="more-posts-article" class="w-100 w-100-m ph3 mb4"><p class="f3 fw5 gray1" data-iso-date="2022-10-26T04:02:50.000+01:00">October 26, 2022  3:02 AM</p><a href="/partial-cloudflare-outage-on-october-25-2022/" class="no-underline gray1 f4 fw5"><h6 class="gray1 f4 fw5 mt2">Partial Cloudflare outage on October 25, 2022</h6></a><p class="gray1 lh-copy">Today, a change to our Tiered Cache system caused some requests to fail for users with status code 530<!-- -->...</p><ul class="flex pl0 fw6 f2"><span>By<!-- --> </span><li class="list flex items-center"><div class="author-name-tooltip"><a href="/author/john-graham-cumming/" class="fw5 f2 black no-underline">John Graham-Cumming</a></div></li></ul><div class="flex flex-row flex-wrap"><div><a href="/tag/outage/" class="no-underline f1 fw2 blue3 underline-hover">Outage</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/post-mortem/" class="no-underline f1 fw2 blue3 underline-hover">Post Mortem</a></div></div></article><article data-testid="more-posts-article" class="w-100 w-100-m ph3 mb4"><p class="f3 fw5 gray1" data-iso-date="2022-08-09T16:56:30.000+01:00">August 09, 2022  3:56 PM</p><a href="/2022-07-sms-phishing-attacks/" class="no-underline gray1 f4 fw5"><h6 class="gray1 f4 fw5 mt2">The mechanics of a sophisticated phishing scam and how we stopped it</h6></a><p class="gray1 lh-copy">Yesterday, August 8, 2022, Twilio shared that they’d been compromised by a targeted phishing attack. Around the same time as Twilio was attacked, we saw an attack with very similar characteristics also targeting Cloudflare’s employees<!-- -->...</p><ul class="flex pl0 fw6 f2"><span>By<!-- --> </span><li class="list flex items-center"><div class="author-name-tooltip"><a href="/author/matthew-prince/" class="fw5 f2 black no-underline">Matthew Prince</a></div></li><li class="list flex items-center"><div class="author-name-tooltip"><span class="fw5 f2 black no-underline">, </span><a href="/author/daniel-stinson-diess/" class="fw5 f2 black no-underline">Daniel Stinson-Diess</a></div></li><li class="list flex items-center"><div class="author-name-tooltip"><span class="fw5 f2 black no-underline">, </span><a href="/author/sourov/" class="fw5 f2 black no-underline">Sourov Zaman</a></div></li></ul><div class="flex flex-row flex-wrap"><div><a href="/tag/security/" class="no-underline f1 fw2 blue3 underline-hover">Security</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/post-mortem/" class="no-underline f1 fw2 blue3 underline-hover">Post Mortem</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/phishing/" class="no-underline f1 fw2 blue3 underline-hover">Phishing</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/gateway/" class="no-underline f1 fw2 blue3 underline-hover">Cloudflare Gateway</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/cloudflare-access/" class="no-underline f1 fw2 blue3 underline-hover">Cloudflare Access</a></div></div></article><article data-testid="more-posts-article" class="w-100 w-100-m ph3 mb4"><p class="f3 fw5 gray1" data-iso-date="2022-06-21T13:38:05.000+01:00">June 21, 2022  12:38 PM</p><a href="/cloudflare-outage-on-june-21-2022/" class="no-underline gray1 f4 fw5"><h6 class="gray1 f4 fw5 mt2">Cloudflare outage on June 21, 2022</h6></a><p class="gray1 lh-copy">Today, June 21, 2022, Cloudflare suffered an outage that affected traffic in 19 of our data centers<!-- -->...</p><ul class="flex pl0 fw6 f2"><span>By<!-- --> </span><li class="list flex items-center"><div class="author-name-tooltip"><a href="/author/tom-strickx/" class="fw5 f2 black no-underline">Tom Strickx</a></div></li><li class="list flex items-center"><div class="author-name-tooltip"><span class="fw5 f2 black no-underline">, </span><a href="/author/jeremy-hartman/" class="fw5 f2 black no-underline">Jeremy Hartman</a></div></li></ul><div class="flex flex-row flex-wrap"><div><a href="/tag/outage/" class="no-underline f1 fw2 blue3 underline-hover">Outage</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/post-mortem/" class="no-underline f1 fw2 blue3 underline-hover">Post Mortem</a></div></div></article><article data-testid="more-posts-article" class="w-100 w-100-m ph3 mb4"><p class="f3 fw5 gray1" data-iso-date="2022-04-05T13:57:28.000+01:00">April 05, 2022  12:57 PM</p><a href="/pipefail-how-a-missing-shell-option-slowed-cloudflare-down/" class="no-underline gray1 f4 fw5"><h6 class="gray1 f4 fw5 mt2">PIPEFAIL: How a missing shell option slowed Cloudflare down</h6></a><p class="gray1 lh-copy">This post tells the story of how a missing shell option called “pipefail” slowed Cloudflare down.<!-- -->...</p><ul class="flex pl0 fw6 f2"><span>By<!-- --> </span><li class="list flex items-center"><div class="author-name-tooltip"><a href="/author/alex-forster/" class="fw5 f2 black no-underline">Alex Forster</a></div></li></ul><div class="flex flex-row flex-wrap"><div><a href="/tag/post-mortem/" class="no-underline f1 fw2 blue3 underline-hover">Post Mortem</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/outage/" class="no-underline f1 fw2 blue3 underline-hover">Outage</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/deep-dive/" class="no-underline f1 fw2 blue3 underline-hover">Deep Dive</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/speed-and-reliability/" class="no-underline f1 fw2 blue3 underline-hover">Speed &amp; Reliability</a></div></div></article><article data-testid="more-posts-article" class="w-100 w-100-m ph3 mb4"><p class="f3 fw5 gray1" data-iso-date="2022-03-22T16:57:44.000+00:00">March 22, 2022  4:57 PM</p><a href="/cloudflare-investigation-of-the-january-2022-okta-compromise/" class="no-underline gray1 f4 fw5"><h6 class="gray1 f4 fw5 mt2">Cloudflare’s investigation of the January 2022 Okta compromise</h6></a><p class="gray1 lh-copy">Today at 03:30 UTC we learnt of a compromise of Okta. We use Okta internally for employee identity as part of our authentication stack. We have investigated this compromise carefully and do not believe we have been compromised as a result<!-- -->...</p><ul class="flex pl0 fw6 f2"><span>By<!-- --> </span><li class="list flex items-center"><div class="author-name-tooltip"><a href="/author/john-graham-cumming/" class="fw5 f2 black no-underline">John Graham-Cumming</a></div></li><li class="list flex items-center"><div class="author-name-tooltip"><span class="fw5 f2 black no-underline">, </span><a href="/author/lucas-ferreira/" class="fw5 f2 black no-underline">Lucas Ferreira</a></div></li><li class="list flex items-center"><div class="author-name-tooltip"><span class="fw5 f2 black no-underline">, </span><a href="/author/daniel-stinson-diess/" class="fw5 f2 black no-underline">Daniel Stinson-Diess</a></div></li></ul><div class="flex flex-row flex-wrap"><div><a href="/tag/okta/" class="no-underline f1 fw2 blue3 underline-hover">Okta</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/security/" class="no-underline f1 fw2 blue3 underline-hover">Security</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/post-mortem/" class="no-underline f1 fw2 blue3 underline-hover">Post Mortem</a></div></div></article><article data-testid="more-posts-article" class="w-100 w-100-m ph3 mb4"><p class="f3 fw5 gray1" data-iso-date="2022-01-26T18:34:08.000+00:00">January 26, 2022  6:34 PM</p><a href="/incorrect-proxying-of-24-hostnames-on-january-24-2022/" class="no-underline gray1 f4 fw5"><h6 class="gray1 f4 fw5 mt2">Incorrect proxying of 24 hostnames on January 24, 2022</h6></a><p class="gray1 lh-copy">On January 24, 2022, as a result of an internal product migration, 24 hostnames (including www.cloudflare.com) that were actively proxied through the Cloudflare global network were mistakenly redirected to the wrong origin<!-- -->...</p><ul class="flex pl0 fw6 f2"><span>By<!-- --> </span><li class="list flex items-center"><div class="author-name-tooltip"><a href="/author/jeremy-hartman/" class="fw5 f2 black no-underline">Jeremy Hartman</a></div></li></ul><div class="flex flex-row flex-wrap"><div><a href="/tag/post-mortem/" class="no-underline f1 fw2 blue3 underline-hover">Post Mortem</a></div></div></article><article data-testid="more-posts-article" class="w-100 w-100-m ph3 mb4"><p class="f3 fw5 gray1" data-iso-date="2020-11-27T12:00:00.000+00:00">November 27, 2020  12:00 PM</p><a href="/a-byzantine-failure-in-the-real-world/" class="no-underline gray1 f4 fw5"><h6 class="gray1 f4 fw5 mt2">A Byzantine failure in the real world</h6></a><p class="gray1 lh-copy">At Cloudflare, we are always on the lookout for Single Points of Failure. In this post, we explore the role a failure mode known as a Byzantine fault played in a a real-world incident.<!-- -->...</p><ul class="flex pl0 fw6 f2"><span>By<!-- --> </span><li class="list flex items-center"><div class="author-name-tooltip"><a href="/author/tom-lianza/" class="fw5 f2 black no-underline">Tom Lianza</a></div></li><li class="list flex items-center"><div class="author-name-tooltip"><span class="fw5 f2 black no-underline">, </span><a href="/author/chris-snook/" class="fw5 f2 black no-underline">Chris Snook</a></div></li></ul><div class="flex flex-row flex-wrap"><div><a href="/tag/post-mortem/" class="no-underline f1 fw2 blue3 underline-hover">Post Mortem</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/api/" class="no-underline f1 fw2 blue3 underline-hover">API</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/postgres/" class="no-underline f1 fw2 blue3 underline-hover">Postgres</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/outage/" class="no-underline f1 fw2 blue3 underline-hover">Outage</a></div></div></article><article data-testid="more-posts-article" class="w-100 w-100-m ph3 mb4"><p class="f3 fw5 gray1" data-iso-date="2020-08-30T21:55:17.000+01:00">August 30, 2020  8:55 PM</p><a href="/analysis-of-todays-centurylink-level-3-outage/" class="no-underline gray1 f4 fw5"><h6 class="gray1 f4 fw5 mt2">August 30th 2020: Analysis of CenturyLink/Level(3) outage</h6></a><p class="gray1 lh-copy">Today CenturyLink/Level(3), a major ISP and Internet bandwidth provider, experienced a significant outage that impacted some of Cloudflare’s customers as well as a significant number of other services and providers across the Internet. <!-- -->...</p><ul class="flex pl0 fw6 f2"><span>By<!-- --> </span><li class="list flex items-center"><div class="author-name-tooltip"><a href="/author/matthew-prince/" class="fw5 f2 black no-underline">Matthew Prince</a></div></li></ul><div class="flex flex-row flex-wrap"><div><a href="/tag/outage/" class="no-underline f1 fw2 blue3 underline-hover">Outage</a></div><div><span class="f1 fw2 blue3 no-underline underline-hover">, </span><a href="/tag/post-mortem/" class="no-underline f1 fw2 blue3 underline-hover">Post Mortem</a></div></div></article><!--astro:end--></astro-island> <div class="pagination mw-100 center mv5 ph3 w-100 tc"><div class="center w-50-l w-100"><div class="flex items-center justify-center justify-around-m "><ul class="flex list ml3" style="padding-inline-start:inherit"><li class="gray"><a class="no-underline  underline-hover  dib-m dib-l mr1 gray3 " href="/tag/post-mortem/">1</a></li><li class=""><a class="no-underline  underline-hover  dib-m dib-l mr1 blue3" href="/tag/post-mortem/page/2/">2</a></li><li class="ml">…</li><li><a class="no-underline  underline-hover dib-m dib-l mr3 blue3" href="/tag/post-mortem/page/2/">2</a></li></ul><span><a class="no-underline blue3 underline-hover" data-testid="pagination-toggle-next" href="/tag/post-mortem/page/2/" rel="prev"><span class="underline-hover dn dib-m dib-l">Older Posts</span> →</a></span></div></div></div> </main>  <footer class="pt4 pb4 pl1 pr1 main-footer"><div class="mw8 center dn db-l ph3"><div class="flex flex-row justify-between"><div class="main-footer__menu-group"><ul id="getting-started-menu" class="list pl0"><li class="pt1 pb1 f1 main-footer__menu-group__header js-toggle-footer-group" data-submenu="getting-started-menu">Getting Started<i class="icon-caret-down"></i></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/plans/free/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="free-plans" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Free plans</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/enterprise/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="enterprise" class="f1 blue3 no-underline underline-hover" rel="noreferrer">For enterprises</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/plans/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="compare-plans" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Compare plans</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/about-your-website/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="get-a-recommendation" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Get a recommendation</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/plans/enterprise/demo/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="request-a-demo" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Request a demo</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/plans/enterprise/contact/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="contact-sales" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Contact Sales</a></li></ul></div><div class="main-footer__menu-group"><ul id="company-menu" class="list pl0"><li class="pt1 pb1 f1" data-submenu="company-menu">Resources<i class="icon-caret-down"></i></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/learning/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="learning-center" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Learning Center</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/analysts/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="analysts-report" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Analyst reports</a></li><li class="pt1 pb1"><a href="https://radar.cloudflare.com/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="overview" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Cloudflare Radar</a></li><li class="pt1 pb1"><a href="https://cloudflare.tv/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="tv" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Cloudflare TV</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/case-studies/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="case-studies" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Case Studies</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/resource-hub/?resourcetype=Webinar" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="webinars" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Webinars</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/resource-hub/?resourcetype=Whitepaper" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="white-papers" class="f1 blue3 no-underline underline-hover" rel="noreferrer">White Papers</a></li><li class="pt1 pb1"><a href="https://developers.cloudflare.com" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="developer-docs" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Developer docs</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/the-net/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="theNet" class="f1 blue3 no-underline underline-hover" rel="noreferrer">theNet</a></li></ul></div><div class="main-footer__menu-group"><ul id="sales-menu" class="list pl0"><li class="pt1 pb1 f1 main-footer__menu-group__header js-toggle-footer-group" data-submenu="sales-menu">Solutions<i class="icon-caret-down"></i></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/connectivity-cloud/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="connectivity-cloud" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Connectivity cloud</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/zero-trust/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="zero-trust" class="f1 blue3 no-underline underline-hover" rel="noreferrer">SSE and SASE services</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/application-services/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="application-services" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Application services</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/network-services/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="network-services" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Network services</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/developer-platform/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="developer-services" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Developer services</a></li></ul></div><div class="main-footer__menu-group"><ul id="community-menu" class="list pl0"><li class="pt1 pb1 f1 main-footer__menu-group__header js-toggle-footer-group" data-submenu="community-menu">Community<i class="icon-caret-down"></i></li><li class="pt1 pb1"><a href="https://community.cloudflare.com" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="community_hub" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Community Hub</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/galileo/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="galileo" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Project Galileo</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/athenian/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="athenian" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Athenian Project</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/campaigns/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="cloudflare-for-campaigns" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Cloudflare for Campaigns</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/partners/technology-partners/cidp/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="critical-infrastructure-defense-project" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Critical Infrastructure Defense Project</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/connect2024/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="connect-2024" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Connect 2024</a></li></ul></div><div class="main-footer__menu-group"><ul id="support-menu" class="list pl0"><li class="pt1 pb1 f1 main-footer__menu-group__header js-toggle-footer-group" data-submenu="support-menu">Support<i class="icon-caret-down"></i></li><li class="pt1 pb1"><a href="https://support.cloudflare.com" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="help-center" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Help center</a></li><li class="pt1 pb1"><a href="https://www.cloudflarestatus.com" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="status" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Cloudflare Status</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/compliance/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="compliance" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Compliance</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/gdpr/introduction/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="gdpr" class="f1 blue3 no-underline underline-hover" rel="noreferrer">GDPR</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/trust-hub/abuse-approach/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="trust-and-safety" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Trust &amp; Safety</a></li></ul></div><div class="main-footer__menu-group"><ul id="company-menu" class="list pl0"><li class="pt1 pb1 f1 main-footer__menu-group__header js-toggle-footer-group" data-submenu="company-menu">Company<i class="icon-caret-down"></i></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/about-overview/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="overview" class="f1 blue3 no-underline underline-hover" rel="noreferrer">About Cloudflare</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/people/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="our_team" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Our team</a></li><li class="pt1 pb1"><a href="https://cloudflare.net/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="investor-relations" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Investor relations</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/press/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="press" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Press</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/careers/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="careers" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Careers</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/diversity-equity-and-inclusion/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="diversity-equity-inclusion" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Diversity, equity &amp; inclusion</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/impact/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="impact-ESG" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Impact/ESG</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/network/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="network_map" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Network Map</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/press-kit/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="press-kit" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Logos &amp; press kit</a></li><li class="pt1 pb1"><a href="https://www.cloudflare.com/partners/" target="_blank" data-tracking-category="footer" data-tracking-action="click" data-tracking-label="partners" class="f1 blue3 no-underline underline-hover" rel="noreferrer">Become a partner</a></li></ul></div></div></div><div class="mw8 center ph3"><div class="flex flex-row flex-wrap justify-center md:justify-between items-center pt4"><div class="flex flex-row space-x-4 items-start w-25-l pb4 pb0-l"><a target="_blank" rel="noreferrer" href="https://www.facebook.com/Cloudflare/" class="w-8"><img class="w-8" src="https://www.cloudflare.com/img/footer/facebook.svg" alt="facebook"/></a><a target=" _blank" rel="noreferrer" href="https://x.com/Cloudflare" class="w-8"><img class="w-8" src="https://www.cloudflare.com/img/footer/twitter.svg" alt="X"/></a><a target="_blank" rel="noreferrer" href="https://www.linkedin.com/company/cloudflare" class="w-8"><img class="w-8" src="https://www.cloudflare.com/img/footer/linkedin.svg" alt="linkedin"/></a><a target="_blank" rel="noreferrer" href="https://www.youtube.com/cloudflare" class="w-8"><img class="w-8" src="https://www.cloudflare.com/img/footer/youtube.svg" alt="youtube"/></a><a target="_blank" rel="noreferrer" href="https://www.instagram.com/cloudflare" class="w-8"><img class="w-8" src="https://www.cloudflare.com/img/footer/instagram.svg" alt="instagram"/></a></div><div class="w-70-l tr-l tl-ns"><div><span class="main-footer__copyright f1">© <!-- -->2025<!-- --> Cloudflare, Inc.<!-- --> </span><span class="main-footer__copyright f1">|</span><a href="https://www.cloudflare.com/privacypolicy/" target="_blank" class="main-footer__copyright f1 no-underline underline-hover" rel="noreferrer"> <!-- -->Privacy Policy<!-- --> </a><span class="main-footer__copyright f1">|</span><a href="https://www.cloudflare.com/website-terms/" target="_blank" class="main-footer__copyright f1 no-underline underline-hover" rel="noreferrer"> <!-- -->Terms of Use<!-- --> </a><span class="main-footer__copyright f1">|</span><a href="https://www.cloudflare.com/disclosure/" target="_blank" class="main-footer__copyright f1 no-underline underline-hover" rel="noreferrer"> <!-- -->Report Security Issues<!-- --> </a><span class="main-footer__copyright f1">|</span><img class="mw2 ph1" src="/images/privacy-options.svg" alt="Privacy Options"/><a href="#cookie-settings" id="ot-sdk-btn" class="ot-sdk-show-settings main-footer__copyright f1 no-underline underline-hover"><span class="brandGray5">Cookie Preferences</span> </a><span class="main-footer__copyright f1">|</span><a href="https://www.cloudflare.com/trademark/" target="_blank" class="main-footer__copyright f1 no-underline underline-hover" rel="noreferrer"> <!-- -->Trademark<!-- --> </a></div></div></div></div></footer></html>